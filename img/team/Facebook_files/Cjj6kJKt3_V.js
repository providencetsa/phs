/*!CK:1411291978!*//*1455720984,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["geGfG"]); }

__d("GenderConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null);
__d("IrisProtocolMessageLifetime",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};},null);
__d("MercuryMessageSourceTags",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercurySendMessageFields",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null);
__d("MercuryTypeaheadConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={COMPOSER_FRIENDS_MAX:4,COMPOSER_FB4C_MAX:4,COMPOSER_NON_FRIENDS_MAX:2,COMPOSER_SHOW_MORE_LIMIT:2,COMPOSER_THREADS_INITIAL_LIMIT:2,COMPOSER_CHATTAB_MAX:5,COMPOSER_PAGES_MAX:4,COMPOSER_WM_MAX:18,USER_TYPE:"user",PAGE_TYPE:"page",THREAD_TYPE:"thread",HEADER_TYPE:"header",FRIEND_TYPE:"friend",NON_FRIEND_TYPE:"non_friend",FB4C_TYPE:"fb4c",MEETING_ROOM_PAGE_TYPE:"meeting_room_page",COMMERCE_PAGE_TYPE:"commerce_page",VALID_EMAIL:"^([A-Z0-9._\u0025+-]+\u0040((?!facebook\\.com))[A-Z0-9.-]+\\.[A-Z]{2,4}|(([A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*)|([A-Z0-9._\u0025+-]+[A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*))\u0040(?:facebook\\.com))$"};},null);
__d("MessagesViewerSetID",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};},null);
__d("MessengerView",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DETAIL:{COMPOSE:"detail\/compose",THREAD:"detail\/thread"},MASTER:{GROUPS:"master\/groups",PEOPLE:"master\/people",RECENT:"master\/recent"}};},null);
__d("P2PPaymentLoggerEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ACTN_ADD_CREDIT_CARD:"Actn_AddCreditCard",ACTN_UPDATE_CREDIT_CARD:"Actn_UpdateCreditCard",ACTN_REMOVE_CREDIT_CARD:"Actn_RemoveCreditCard",ACTN_UNLOCK_CREDIT_CARD:"Actn_UnlockCreditCard",ACTN_VALIDATE_CARD:"Actn_ValidateCard",ACTN_TRANSFER_MONEY:"Actn_TransferMoney",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN:"Actn_TransferMoneyWithCampaign",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN_PARENT_CALL:"Actn_TransferMoneyWithCampaignParentCall",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN_POST_SUCCESS:"Actn_TransferMoneyWithCampaignPostSuccess",ACTN_TRANSFER_MONEY_CHECK_NEEDS_REVERT:"Actn_TransferMoneyCheckNeedsRevert",ACTN_TRANSFER_MONEY_REVERT:"Actn_TransferMoneyRevert",ACTN_TRANSFER_MONEY_CREATE_CONTEXT:"Actn_TransferMoneyCreateContext",ACTN_TRANSFER_MONEY_CREATE_PLATFORM_ITEM:"Actn_TransferMoneyCreatePlatformItem",ACTN_ACCEPT_MONEY:"Actn_AcceptMoney",ACTN_DECLINE_MONEY:"Actn_DeclineMoney",ACTN_SET_PRIMARY:"Actn_SetPrimary",ACTN_WITHDRAW_MONEY:"Actn_WithdrawMoney",ACTN_CREATE_MSGR_COMMERCE_CART:"Actn_CreateMsgrCommerceCart",ACTN_PLACE_MSGR_COMMERCE_ORDER:"Actn_PlaceMsgrCommerceOrder",ACTN_SEND_TRANSFER_MESSAGE:"Actn_SendTransferMessage",ACTN_POST_TRANSFER_STEPS:"Actn_PostTransferSteps",ACTN_SEND_EXPIRE_NOTIFICATIONS:"Actn_SendExpireNotifications",ACTN_UNCATEGORIZED_EXCEPTION:"Actn_Uncategorized_Exception",ACTN_INCREASE_CAMPAIGN_COUNTER:"Actn_Increase_Campaign_Counter",ACTN_CREATE_PAYMENT_REQUEST:"Actn_CreatePaymentRequest",ACTN_REMIND_PAYMENT_REQUEST:"Actn_RemindPaymentRequest",ACTN_PAY_PAYMENT_REQUEST:"Actn_PayPaymentRequest",ACTN_DECLINE_PAYMENT_REQUEST:"Actn_DeclinePaymentRequest",ACTN_CANCEL_PAYMENT_REQUEST:"Actn_CancelPaymentRequest",ACTN_EXPIRE_PAYMENT_REQUEST:"Actn_ExpirePaymentRequest",ACTN_SEND_PAYMENT_REQUEST_MESSAGE:"Actn_SendPaymentRequestMessage",ACTN_AUTH_FOR_SENDER_REVIEW:"Actn_AuthForSenderReview",ACTN_COMPLETE_SENDER_REVIEW:"Actn_CompleteSenderReview",ACTN_COMPLETE_RECEIVER_REVIEW:"Actn_CompleteReceiverReview",ACTN_SUBMIT_VERIFICATION_STEP:"Actn_SubmitVerificationStep",ACTN_COMPLETE_SENDER_VERIFICATION:"Actn_CompleteSenderVerification",ACTN_COMPLETE_RECEIVER_VERIFICATION:"Actn_CancelReceiverVerification",ACTN_CANCEL_SENDER_VERIFICATION:"Actn_CancelSenderVerification",ACTN_CANCEL_RECEIVER_VERIFICATION:"Actn_CancelReceiverVerification",ACTN_CANCEL_SENDER_RISK:"Actn_CancelSenderRisk",ACTN_CANCEL_EXPIRE:"Actn_CancelExpire",ACTN_CANCEL_FOR_SAME_CARD:"Actn_CancelForSameCard",ACTN_CANCEL_BY_CUSTOMER_SERVICE:"Actn_CancelByCustomerService",ACTN_CANCEL_RECEIVER_REVIEW:"Actn_CancelReceiverReview",ACTN_CANCEL_SENDER_REVIEW:"Actn_CancelSenderReview",ACTN_CANCEL_ALL_PENDING_TRANSFERS:"Actn_CancelAllPendingTransfers",ACTN_FILTER_LOGMESSAGE:"Actn_FilterLogMessage",ACTN_FILTER_NOTIFICATION:"Actn_FilterNotification",ACTN_SEND_NOTIFICATION:"Actn_SendNotification",ACTN_ADD_PIN:"Actn_AddPIN",ACTN_UPDATE_PIN:"Actn_UpdatePIN",ACTN_REMOVE_PIN:"Actn_RemovePIN",ACTN_RESET_PIN:"Actn_ResetPIN",ACTN_ENABLE_TOUCH_ID:"Actn_EnableTouchID",ACTN_VERIFY_TOUCH_ID:"Actn_VerifyTouchID",ACTN_DISABLE_TOUCH_ID:"Actn_DisableTouchID",ACTN_CHANNEL_NOTIF_CARD_EVENT:"Actn_ChannelNotifCardEvent",ACTN_CHANNEL_NOTIF_TRANSFER_STATUS_EVENT:"Actn_ChannelNotifTransferStatusEvent",ACTN_CHANNEL_NOTIF_PLATFORM_EVENT:"Actn_ChannelNotifPlatformEvent",ACTN_CHANNEL_NOTIF_PAYMENT_REQUEST_STATUS_EVENT:"Actn_ChannelNotifPaymentRequestStatusEvent",ACTN_PLATFORM_BANNER_DISMISSED:"Actn_PlatformBannerDismissed",ACTN_PLATFORM_BANNER_MARK_AS_SOLD:"Actn_PlatformBannerMarkAsSold",ACTN_ADD_ADDRESS:"Actn_AddAddress",ACTN_GET_ADDRESSES:"Actn_GetAddresses",ACTN_GET_CURRENT_USER_PROFILE_DATA:"Actn_GetCurrentUserProfileData",ACTN_CAMPAIGN_CHECK_USER_HAS_NEW_ACTIVITY:"Actn_CampaignCheckUserHasNewActivity",ACTN_CAMPAIGN_SAVE_PROMO_NOTIFICATION_TIME:"Actn_CampaignSavePromoNotificationTime",UI_ACTN_SEND_MONEY_BUTTON_CLICKED:"UI_Actn_Send_Money_Button_Clicked",UI_ACTN_SEND_MONEY_BUTTON_PLACEHOLDER_CLICKED:"UI_Actn_Send_Money_Button_Placeholder_Clicked",UI_ACTN_INITIATE_SEND:"UI_Actn_Initiate_Send",UI_ACTN_CANCEL_SEND:"UI_Actn_Send_Money_Cancelled",UI_ACTN_INITIATE_ADD_CARD:"UI_Actn_Initiate_Add_Card",UI_ACTN_INITIATE_CHOOSE_CARD:"UI_Actn_Initiate_Choose_Card",UI_ACTN_CANCEL_ADD_CARD:"UI_Actn_Cancel_Add_Card",UI_ACTN_CONFIRM_CARD_DETAILS:"UI_Actn_Confirm_Card_Details",UI_ACTN_ACCEPT_MONEY_CANCEL:"UI_Actn_Accept_Money_Cancel",UI_ACTN_ACCEPT_WITH_CARD:"UI_Actn_Accept_With_Card",UI_ACTN_ADD_CARD_SUCCESS:"UI_Actn_Add_Card_Success",UI_ACTN_ADD_CARD_FAIL:"UI_Actn_Add_Card_Fail",UI_ACTN_CONFIRM_SEND:"UI_Actn_Confirm_Send",UI_ACTN_SEND_SUCCESS:"UI_Actn_Send_Success",UI_ACTN_SEND_MONEY_CANCELLED:"UI_Actn_Send_Money_Cancelled",UI_ACTN_SEND_FAIL:"UI_Actn_Send_Fail",UI_ACTN_INITIATE_EDIT_CARD:"UI_Actn_Initiate_Edit_Card",UI_ACTN_CANCEL_EDIT_CARD:"UI_Actn_Cancel_Edit_Card",UI_ACTN_CONFIRM_EDIT_CARD_DETAILS:"UI_Actn_Confirm_Edit_Card_Details",UI_ACTN_EDIT_CARD_SUCCESS:"UI_Actn_Edit_Card_Success",UI_ACTN_EDIT_CARD_FAIL:"UI_Actn_Edit_Card_Fail",UI_ACTN_INITIATE_REMOVE_CARD:"UI_Actn_Initiate_Remove_Card",UI_ACTN_CONFIRM_REMOVE_CARD:"UI_Actn_Confirm_Remove_Card",UI_ACTN_REMOVE_CARD_SUCCESS:"UI_Actn_Remove_Card_Success",UI_ACTN_REMOVE_CARD_FAIL:"UI_Actn_Remove_Card_Fail",UI_ACTN_INITIATE_PASSWORD_PROTECTION_NUX:"UI_Actn_Initiate_Password_Protection_NUX",UI_ACTN_OPT_IN_PASSWORD_PROTECTION_NUX:"UI_Actn_Opt_In_Password_Protection_NUX",UI_ACTN_OPT_OUT_PASSWORD_PROTECTION_NUX:"UI_Actn_Opt_Out_Password_Protection_NUX",UI_ACTN_ENABLED_PASSWORD_PROTECTION_SETTING:"UI_Actn_Enabled_Password_Protection_Setting",UI_ACTN_DISABLED_PASSWORD_PROTECTION_SETTING:"UI_Actn_Disabled_Password_Protection_Setting",UI_ACTN_SEND_CLICKED:"UI_Actn_Send_Clicked",UI_ACTN_VERIFY_CSC:"UI_Actn_Verify_CSC",UI_ACTN_CONFIRM_AMOUNT:"UI_Actn_Confirm_Amount",UI_ACTN_EDIT_CARD:"UI_Actn_Edit_Card",UI_ACTN_CHANGE_CARD:"UI_Actn_Change_Card",UI_ACTN_INITIATE_SEND_TRIGGER:"UI_Actn_Initiate_Send_Trigger",UI_ACTN_INITIATE_GROUP_SEND:"UI_Actn_Initiate_Group_Send",UI_ACTN_GROUP_SEND_CANCELLED:"UI_Actn_Group_Send_Cancelled",UI_ACTN_INITIATE_GROUP_SEND_TRIGGER:"UI_Actn_Initiate_Group_Send_Trigger",UI_ACTN_GROUP_SEND_RECIPIENT_PICKED:"UI_Actn_Group_Send_Recipient_Picked",UI_ACTN_3RD_PARTY_RECEIPT_SHOWN:"UI_Actn_3rd_Party_Receipt_Shown",UI_ACTN_3RD_PARTY_RECEIPT_DISMISSED:"UI_Actn_3rd_Party_Receipt_Dismissed",UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CLICKED:"UI_Actn_3rd_Party_Non_Enabled_Log_Message_Clicked",UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CANCELLED:"UI_Actn_3rd_Party_Non_Enabled_Log_Message_Cancelled",UI_ACTN_CHAT_THREAD_BANNER_CLICKED:"UI_Actn_Chat_Thread_Banner_Clicked",UI_ACTN_CHAT_THREAD_BANNER_VIEWED:"UI_Actn_Chat_Thread_Banner_Viewed",UI_ACTN_CHAT_THREAD_BANNER_DISMISSED:"UI_Actn_Chat_Thread_Banner_Dismissed",UI_ACTN_INITIATE_MONEYPENNY_ORDER:"UI_Actn_Initiate_Moneypenny_Order",UI_ACTN_CONFIRM_MONEYPENNY_ORDER:"UI_Actn_Confirm_Moneypenny_Order",UI_ACTN_MONEYPENNY_ORDER_FAIL:"UI_Actn_Moneypenny_Order_Fail",UI_ACTN_MONEYPENNY_ORDER_SUCCESS:"UI_Actn_Moneypenny_Order_Success",UI_ACTN_MONEYPENNY_ORDER_CANCEL:"UI_Actn_Moneypenny_Order_Cancel",UI_ACTN_FRIEND_PICKER_SEARCH:"UI_Actn_Friend_Picker_Search",UI_ACTN_FRIEND_PICKER_SELECT:"UI_Actn_Friend_Picker_Select",UI_ACTN_FRIEND_PICKER_SHOWN:"UI_Actn_Friend_Picker_Shown",UI_ACTN_FI_CANCEL:"UI_Actn_FI_Cancel",UI_ACTN_FI_SUCCESS_DIALOG_NEXT:"UI_Action_Success_Dialog_Next",UI_ACTN_FI_BANNER_DISMISSED:"UI_Actn_FI_Banner_Dismissed",UI_ACTN_FI_BANNER_IMPRESSION:"UI_Actn_FI_Banner_Impression",UI_ACTN_INCENTIVE_TRANSFER_SUCCESS:"UI_Actn_Incentive_Transfer_Success",UI_ACTN_INCENTIVE_TRANSFER_FAILURE:"UI_Actn_Incentive_Transfer_Failure",UI_ACTN_PLATFORM_BANNER_SELLER_HIDE_CLICKED:"UI_Actn_Platform_Banner_Seller_Hide_Clicked",UI_ACTN_PLATFORM_BANNER_BUYER_HIDE_CLICKED:"UI_Actn_Platform_Banner_Buyer_Hide_Clicked",UI_ACTN_PLATFORM_BANNER_SOLD_CLICKED:"UI_Actn_Platform_Banner_Sold_Clicked",UI_ACTN_PLATFORM_BANNER_IMAGE_CLICKED:"UI_Actn_Platform_Banner_Image_Clicked",UI_ACTN_PLATFORM_BANNER_TITLE_CLICKED:"UI_Actn_Platform_Banner_Title_Clicked",UI_ACTN_PLATFORM_BANNER_PAY_CLICKED:"UI_Actn_Platform_Banner_Pay_Clicked",UI_ACTN_PLATFORM_BANNER_SELLER_VIEWED:"UI_Actn_Platform_Banner_Seller_Viewed",UI_ACTN_PLATFORM_BANNER_BUYER_VIEWED:"UI_Actn_Platform_Banner_Buyer_Viewed",UI_ACTN_PLATFORM_BANNER_PAY_NUX_SHOWN:"UI_Actn_Platform_Banner_Pay_Nux_Shown",UI_ACTN_INITIATE_REQUEST:"UI_Actn_Initiate_Request",UI_ACTN_REQUEST_CLICKED:"UI_Actn_Request_Clicked",UI_ACTN_CONFIRM_REQUEST:"UI_Actn_Confirm_Request",UI_ACTN_REQUEST_SUCCESS:"UI_Actn_Request_Success",UI_ACTN_REQUEST_FAIL:"UI_Actn_Request_Fail",UI_ACTN_INITIATE_DECLINE_REQUEST:"UI_Actn_Initiate_Decline_Request",UI_ACTN_CONFIRM_DECLINE_REQUEST:"UI_Actn_Confirm_Decline_Request",UI_ACTN_DECLINE_REQUEST_FAIL:"UI_Actn_Decline_Request_Fail",UI_ACTN_DECLINE_REQUEST_SUCCESS:"UI_Actn_Decline_Request_Success",UI_ACTN_INITIATE_CANCEL_REQUEST:"UI_Actn_Initiate_Cancel_Request",UI_ACTN_CONFIRM_CANCEL_REQUEST:"UI_Actn_Confirm_Cancel_Request",UI_ACTN_CANCEL_REQUEST_FAIL:"UI_Actn_Cancel_Request_Fail",UI_ACTN_CANCEL_REQUEST_SUCCESS:"UI_Actn_Cancel_Request_Success",UI_ACTN_INITIATE_CHECKOUT:"UI_Actn_Initiate_Checkout",UI_ACTN_CHECKOUT_CONFIRM:"UI_Actn_Checkout_Confirm",UI_ACTN_INITIATE_ADD_ADDRESS:"UI_Actn_Initiate_Add_Address",UI_ACTN_CANCEL_ADD_ADDRESS:"UI_Actn_Cancel_Add_Address",UI_ACTN_INITIATE_CHOOSE_ADDRESS:"UI_Actn_Initiate_Choose_Address",UI_ACTN_CONFIRM_ADDRESS_DETAILS:"UI_Actn_Confirm_Address_Details",UI_ACTN_ADD_ADDRESS_SUCCESS:"UI_Actn_Add_Address_Success",UI_ACTN_ADD_ADDRESS_FAIL:"UI_Actn_Add_Address_Fail",UI_ACTN_CHECKOUT_FAIL:"UI_Actn_Checkout_Fail",UI_ACTN_CHECKOUT_CART_CREATION_FAIL:"UI_Actn_Checkout_Cart_Creation_Fail",UI_ACTN_CHECKOUT_CANCEL:"UI_Actn_Checkout_Cancel",UI_ACTN_CHECKOUT_SUCCESS:"UI_Actn_Checkout_Success",UI_ACTN_CHECKOUT_CART_CREATION_SUCCESS:"UI_Actn_Checkout_Cart_Creation_Success",UI_ACTN_SEND_MONEY_PAGE_VIEWED:"UI_Actn_Send_Money_Page_Viewed",UI_ACTN_ACCEPT_MONEY_NUX_SHOWN:"UI_Actn_Accept_Money_NUX_Shown",UI_ACTN_ACCEPT_MONEY_NUX_NEXT_CLICK:"UI_Actn_Accept_Money_NUX_Next_Click",UI_ACTN_SEND_MONEY_NUX_SHOWN:"UI_Actn_Send_Money_NUX_Shown",UI_ACTN_SEND_MONEY_NUX_NEXT_CLICK:"UI_Actn_Send_Money_NUX_Next_Click",UI_ACTN_GET_CREDIT_CARDS_EXCEPTION:"UI_ACTN_GET_CREDIT_CARDS_EXCEPTION",UI_ACTN_CREATE_TRANSFER_EXCEPTION:"UI_ACTN_CREATE_TRANSFER_EXCEPTION",UI_ACTN_ADD_CARD_EXCEPTION:"UI_ACTN_ADD_CARD_EXCEPTION",UI_ACTN_GET_TRANSFERS_EXCEPTION:"UI_ACTN_GET_TRANSFERS_EXCEPTION",UI_ACTN_GET_EXTENSIVE_TRANSFERS_EXCEPTION:"UI_ACTN_GET_EXTENSIVE_TRANSFERS_EXCEPTION",UI_ACTN_GET_NUX_TRANSFERS_EXCEPTION:"UI_ACTN_GET_NUX_TRANSFERS_EXCEPTION",UI_ACTN_UPDATE_PRESET_CARD_EXCEPTION:"UI_ACTN_UPDATE_PRESET_CARD_EXCEPTION",UI_ACTN_UPDATE_CARD_EXCEPTION:"UI_ACTN_UPDATE_CARD_EXCEPTION",UI_ACTN_DELETE_CARD_EXCEPTION:"UI_ACTN_DELETE_CARD_EXCEPTION",UI_ACTN_GET_PASSWORD_PROTECTION_EXCEPTION:"UI_ACTN_GET_PASSWORD_PROTECTION_EXCEPTION",UI_ACTN_SET_PASSWORD_PROTECTION_EXCEPTION:"UI_ACTN_SET_PASSWORD_PROTECTION_EXCEPTION",UI_ACTN_DECLINE_TRANSFER_EXCEPTION:"UI_ACTN_DECLINE_TRANSFER_EXCEPTION",UI_ACTN_CANCEL_TRANSFER_EXCEPTION:"UI_ACTN_CANCEL_TRANSFER_EXCEPTION",UI_ACTN_VERIFY_CARD_EXCEPTION:"UI_ACTN_VERIFY_CARD_EXCEPTION",UI_ACTN_VALIDATE_BIN_EXCEPTION:"UI_ACTN_VALIDATE_BIN_EXCEPTION",UI_ACTN_GET_ELIGIBILITY_EXCEPTION:"UI_ACTN_GET_ELIGIBILITY_EXCEPTION",UI_ACTN_GET_FRIEND_LIST_EXCEPTION:"UI_ACTN_GET_FRIEND_LIST_EXCEPTION",UI_ACTN_GET_BANNER_STATES_EXCEPTION:"UI_ACTN_GET_BANNER_STATES_EXCEPTION",UI_ACTN_INCREMENT_BANNER_VIEW_EXCEPTION:"UI_ACTN_INCREMENT_BANNER_VIEW_EXCEPTION",UI_ACTN_INCREMENT_BANNER_DISMISSAL_EXCEPTION:"UI_ACTN_INCREMENT_BANNER_DISMISSAL_EXCEPTION",UI_ACTN_CREATE_M_TRANSFER_EXCEPTION:"UI_ACTN_CREATE_M_TRANSFER_EXCEPTION",UI_ACTN_CREATE_FI_TRANSER_EXCEPTION:"UI_ACTN_CREATE_FI_TRANSER_EXCEPTION",UI_ACTN_GET_PLATFORM_CONTEXT_EXCEPTION:"UI_ACTN_GET_PLATFORM_CONTEXT_EXCEPTION",UI_ACTN_DISMISS_PLATFORM_CONTEXT_EXCEPTION:"UI_ACTN_DISMISS_PLATFORM_CONTEXT_EXCEPTION",UI_ACTN_MARK_SOLD_CONTEXT_EXCEPTION:"UI_ACTN_MARK_SOLD_CONTEXT_EXCEPTION",UI_ACTN_GET_ADDRESSES_EXCEPTION:"UI_ACTN_GET_ADDRESSES_EXCEPTION",UI_ACTN_ADD_ADDRESS_EXCEPTION:"UI_ACTN_ADD_ADDRESS_EXCEPTION",UI_ACTN_CREATE_CART_EXCEPTION:"UI_ACTN_CREATE_CART_EXCEPTION",UI_ACTN_SET_CART_ADDRESS_EXCEPTION:"UI_ACTN_SET_CART_ADDRESS_EXCEPTION",UI_ACTN_GET_PROFILE_EXCEPTION:"UI_ACTN_GET_PROFILE_EXCEPTION",UI_ACTN_CREATE_REQUEST_EXCEPTION:"UI_ACTN_CREATE_REQUEST_EXCEPTION",UI_ACTN_DECLINE_REQUEST_EXCEPTION:"UI_ACTN_DECLINE_REQUEST_EXCEPTION",UI_ACTN_CANCEL_REQUEST_EXCEPTION:"UI_ACTN_CANCEL_REQUEST_EXCEPTION",UI_ACTN_GET_PENDING_REQUESTS_EXCEPTION:"UI_ACTN_GET_PENDING_REQUESTS_EXCEPTION",UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_SHOWN:"UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_SHOWN",UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_NEXT_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_NEXT_CLICK",UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SELLER_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SELLER_CLICK",UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SEND_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SEND_CLICK",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK",UI_ACTN_PAYMENTS_HISTORY_BLUEBAR_CLICK:"UI_ACTN_PAYMENTS_HISTORY_BLUEBAR_CLICK"};},null);
__d("P2PPaymentLoggerEventFlow",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UI_FLOW_P2P_SEND:"UI_Flow_P2P_Send",UI_FLOW_P2P_REQUEST:"UI_Flow_P2P_Request",UI_FLOW_P2P_RECEIVE:"UI_Flow_P2P_Receive",UI_FLOW_P2P_SETTINGS:"UI_Flow_P2P_Settings",UI_FLOW_P2P_GROUP_SEND:"UI_Flow_P2P_Group_Send",UI_FLOW_P2P_GROUP_REQUEST:"UI_Flow_P2P_Group_Request",UI_FLOW_MONEYPENNY_CHECKOUT:"UI_Flow_Moneypenny_Checkout",UI_FLOW_FINANCIAL_INCENTIVES:"UI_Flow_Financial_Incentives",UI_FLOW_FINANCIAL_INCENTIVES_ZERO_INDEX_JEWEL:"UI_Flow_Financial_Incentives_Zero_Index_Jewel",UI_FLOW_PLATFORM_BANNER:"UI_Flow_Platform_Banner",UI_FLOW_CHECKOUT:"UI_Flow_Checkout",UI_FLOW_SEND_MONEY_PAGE:"UI_Flow_Send_Money_Page",UI_FLOW_REQUEST_SENDER_NUX_CHAT_THREAD_BANNER:"UI_Flow_Request_Sender_NUX_Chat_Thread_Banner",UI_FLOW_SENDER_NUX_CHAT_THREAD_BANNER:"UI_Flow_Sender_NUX_Chat_Thread_Banner",UI_FLOW_GROUP_SELL_INTEREST_DIALOG:"UI_FLOW_GROUP_SELL_INTEREST_DIALOG",UI_FLOW_SEND_MONEY_BLUEBAR:"UI_FLOW_SEND_MONEY_BLUEBAR",UI_FLOW_PAYMENTS_MENU_BLUEBAR:"UI_FLOW_PAYMENTS_MENU_BLUEBAR",UI_FLOW_BOOKMARK:"UI_FLOW_BOOKMARK"};},null);
__d("SidebarType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SIDEBAR:"sidebar",BUDDYLIST:"buddylist",BUDDYLIST_NUB:"buddylist_nub"};},null);
__d("StickerConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};},null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(t,u,v){this.xhr=n();if(!(u instanceof l))u=new l(u);if(v&&t=='GET'){u.setQueryData(v);}else this._params=v;this.method=t;this.uri=u;this.xhr.open(t,u);}var q=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();p.supportsCORS=function(){return q;};p.ERROR='ar:error';p.TIMEOUT='ar:timeout';p.PROXY_ERROR='ar:proxy error';p.TRANSPORT_ERROR='ar:transport error';p.SERVER_ERROR='ar:http error';p.PARSE_ERROR='ar:parse error';p.SERVICE_UNAVAILABLE='ar:noservice';p._inflight=[];function r(){var t=p._inflight;p._inflight=[];t.forEach(function(u){u.abort();});}function s(t){t.onJSON=t.onError=t.onSuccess=null;clearTimeout(t._timer);if(t.xhr&&t.xhr.readyState<4){t.xhr.abort();t.xhr=null;}p._inflight=p._inflight.filter(function(u){return u&&u!=t&&u.xhr&&u.xhr.readyState<4;});}Object.assign(p.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(t){if(this[t])this[t](this);},_parseStatus:function(){var t;try{this.status=this.xhr.status;t=this.xhr.statusText;}catch(u){if(this.xhr.readyState>=4){this.errorType=p.TRANSPORT_ERROR;this.errorText=u.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=p.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=p.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=p.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=p.SERVER_ERROR;}else if(this.status===503){this.errorType=p.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=p.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=p.TRANSPORT_ERROR;}else{t='unrecognized status code: '+this.status;this.errorType=p.ERROR;}if(!this.errorText)this.errorText=t;},_parseResponse:function(){var t,u=this.xhr.readyState;try{t=this.xhr.responseText||'';}catch(v){if(u>=4){this.errorType=p.ERROR;this.errorText='responseText not available - '+v.message;}return;}while(this.xhr){var w=this._eol+1,x=this.streamMode?t.indexOf('\n',w):t.length;if(x<0&&u==4)x=t.length;if(x<=this._eol)break;var y=t;if(this.streamMode)y=t.substr(w,x-w).replace(/^\s*|\s*$/g,'');if(w===0&&this.prelude)if(this.prelude.test(y))y=y.replace(this.prelude,'');this._eol=x;if(y){try{this.json=JSON.parse(y);}catch(v){var z=/(<body[\S\s]+?<\/body>)/i.test(t)&&RegExp.$1,aa={message:v.message,'char':w,excerpt:(w===0&&z||y).substr(512)};this.errorType=p.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(aa);return;}h.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var t=this.xhr&&this.xhr.readyState||0;if(this.status==null&&t>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(t==3&&this.streamMode||t==4)this._parseResponse();if(this.errorType||t==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');s(this);}},send:function(t){this.xhr.onreadystatechange=k.guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var u=this.timeout;if(u)this._timer=o((function(){this.errorType=p.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');s(this);}).bind(this),u);p._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(t?j.serialize(t):'');},abort:function(){s(this);},toString:function(){var t='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)t+=' errorType='+this.errorType+' ('+this.errorText+')';return t+']';},toJSON:function(){var t={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)t.uri=this.uri;for(var u in t)if(t[u]==null)delete t[u];return t;}});if(window.addEventListener&&m.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',r);f.exports=p;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','setTimeoutAcrossTransitions','LogHistory','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('LogHistory').getInstance('channel'),m=c('WebStorage').getLocalStorage(),n=i.create('channel'),o='channel_sub:',p=7,q=100*1000,r=null,s;function t(){if(s){clearTimeout(s);s=null;}if(m&&r!=null)m.removeItem(o+r);r=null;}function u(v,w,x){var y=(v-1)*p;if(x){if(s)clearTimeout(s);r=s=null;}if(w==null)w=Math.floor(Math.random()*y);if(r==null)if(m){var z=[];for(var aa=0;aa<m.length;aa++){var ba=m.key(aa);if(ba.indexOf(o)===0){var ca=parseInt(ba.substr(o.length),10);z[ca]=parseInt(m.getItem(ba),10);}}var da=Date.now()-q;for(aa=0;aa<y;aa++){var ea=(aa+w)%y;if(!z[ea]||z[ea]<da){r=ea;break;}}if(r!=null){var fa=function(){try{m.setItem(o+r,Date.now());}catch(ga){l.warn('subdomain set failed',ga.message);}s=k(fa,q/2);};fa();}else{l.warn('no channel subdomain',z);n.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){h.listen(window,'pagehide',t);}else j.onUnload(t);}else r=w;return r==null?null:r%p;}f.exports={allocate:u,clear:t};},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.getInstance('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(ba,ca){var da=ba.subdomain;da=da===null?'':da+'-';var ea=ba.host;ea=ea===null||ea===undefined?'edge-chat':ba.host;var fa=new m(ca).setDomain(da+ea+'.'+ba.domain).setPort(ba.port).setSecure(new m(window.location.href).isSecure());return fa;}function s(ba){var ca={partition:ba.partition,cb:q(),failure:ba.pingFailuresOnSubdomain};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;var da=r(ba,'/p').setQueryData(ca);p.log('start_p',{uri:da.toString()});var ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;var fa=function(ga){p.log('finish_p',{xhr:ga.toJSON?ga.toJSON():ga,subdomain:ba.subdomain,fullHost:ba.fullHost});};ea.onError=function(ga){fa(ga);if(ba.subdomain===null)return;ba.pingFailuresOnSubdomain++;ba.subdomain++;if(ba.subdomain>6)ba.subdomain=0;};ea.timeout=ba.P_TIMEOUT;ea.onSuccess=fa;ea.send();}function t(ba,ca,da){var ea=new Image(),fa=0,ga=function(ja){ea.abort();return ja?ca():da();};ea.onload=l.guard(function(){p.log('ping_ok',{duration:Date.now()-fa});ga(true);},'ChannelTransport image.onload');ea.onerror=l.guard(function(){s(ba);ga(false);},'ChannelTransport image.onerror');var ha=o(ea.onerror,10000);ea.abort=function(){if(ha){clearTimeout(ha);ha=null;}ea.onload=ea.onerror=null;};var ia={partition:ba.partition,cb:q()};if(ba.sticky_token)ia.sticky_token=ba.sticky_token;if(ba.sticky_pool)ia.sticky_pool=ba.sticky_pool;if(ba.lastRequestErrorReason){ia.reason=ba.lastRequestErrorReason;ba.lastRequestErrorReason=null;}if(ba.uid&&ba.viewerUid){ia.uid=ba.uid;ia.viewer_uid=ba.viewerUid;}fa=Date.now();ea.src=r(ba,'/ping').setQueryData(ia);return ea;}function u(ba,ca){var da={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)da.sticky_token=ba.sticky_token;if(ba.sticky_pool)da.sticky_pool=ba.sticky_pool;if(ba.profile)da.profile=ba.profile;if(ba.capabilities)da.cap=ba.capabilities;da.id=ca;var ea=r(ba,'/add_bud').setQueryData(da),fa=new h('GET',ea);if(h.supportsCORS())fa.xhr.withCredentials=true;fa.onError=function(ga){p.warn('add_buddy_error');};fa.onSuccess=function(ga){p.log('add_buddy_ok');};fa.timeout=ba.P_TIMEOUT;fa.send();}function v(ba){var ca={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;if(ba.is_offline||ba.shouldSuppressPresence){ca.state='offline';}else ca.state='active';if(ca.state===ba.lastPresenceState)return;ba.lastPresenceState=ca.state;if(ba.profile)ca.profile=ba.profile;if(ba.capabilities)ca.cap=ba.capabilities;var da=r(ba,'/active_ping').setQueryData(ca),ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;ea.onError=function(fa){p.warn('active_ping_error');};ea.onSuccess=function(fa){p.log('active_ping_ok');};ea.timeout=ba.P_TIMEOUT;ea.send();}function w(ba,ca,da,ea){var fa=new Date(),ga=-1;if(ba.userActive>0){ga=(fa-ba.userActive)/1000|0;if(ga<0)p.warn('idle_regression',{idleTime:ga,now:fa.getTime(),userActive:ba.userActive});}var ha={channel:ba.user_channel,seq:ba.seq,partition:ba.partition,clientid:ba.sessionID,cb:q(),idle:ga,qp:'y',cap:0};if(ba.state.aiq)ha.aiq=ba.state.aiq;if(ba.ready)if(ba.seqTurSentAt==-1||ba.seqTurSentAt==ba.seq){ha.tur=ba.timeUntilReady;ha.qpmade=ba.queueMade;ba.seqTurSentAt=ba.seq;}ha.pws=ba.pws;if(ba.sequenceId>0)ha.isq=ba.sequenceId;ha.msgs_recv=ba.estimatedReceived;if(ba.uid&&ba.viewerUid){ha.uid=ba.uid;ha.viewer_uid=ba.viewerUid;}if(ba.sticky_token){ha.sticky_token=ba.sticky_token;}else{if(ba.requestBatchedPull)ha.request_batch=1;if(ba.msgr_region)ha.msgr_region=ba.msgr_region;}if(ba.sticky_pool)ha.sticky_pool=ba.sticky_pool;if('trace_id' in ba)ha.traceid=ba.trace_id;if(ba.is_offline||ba.shouldSuppressPresence){ha.state='offline';}else if(ba.userActive>0&&ga<60)ha.state='active';ba.lastPresenceState=ha.state;if(ba.streamingCapable){ha.mode='stream';ha.format='json';}if(ba.profile)ha.profile=ba.profile;if(ba.capabilities)ha.cap=ba.capabilities;var ia=r(ba,'/pull').setQueryData(ha),ja='GET',ka=new h(ja,ia);if(h.supportsCORS())ka.xhr.withCredentials=true;ka.timeout=ba.streamingCapable?ba.STREAMING_TIMEOUT:ba.LONGPOLL_TIMEOUT;ka.onJSON=ca;ka.onSuccess=da;ka.onError=function(){var la=this.status==12002&&this._time>=ba.MIN_12002_TIMEOUT||this.status==504&&this._time>=ba.MIN_504_TIMEOUT,ma=la?da:ea;return ma&&ma.apply(this,arguments);};ka.send();ba.inStreaming=ba.streamingCapable;return ka;}function x(ba){this.manager=ba;this.init&&this.init();}function y(ba){x.apply(this,arguments);}Object.assign(y.prototype,{logName:'CORS',enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='init')o(n(this.manager,'exitState',{status:i.OK,stateId:ca.stateId}),0);if(!/pull|ping/.test(ba))return;var da=this.manager;if(ba=='ping'){this._request=t(ca,n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(da,'_processTransportData',ca.stateId),n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});function z(ba){p.log('iframe_init_constructor');x.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);j.publish(this,'outerTransport');}Object.assign(z.prototype,{logName:'iframe',_initIframe:function(ba){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return ba.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(ba){this._iframeURI=r(ba,ba.path);if(ba.resources){var ca=this._iframeURI.getDomain();ba.resources=ba.resources.map(function(fa){var ga=new m(fa);if(ga.getPath().startsWith('/intern/rsrc.php')&&ga.getQueryData().origin!==undefined)return ga.addQueryData('origin',ca).toString();return fa;});}if(ba.bustIframe){var da={partition:ba.partition,cb:q()};this._iframeURI.setQueryData(da);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ea){p.error('iframe_uri_set_error',ea);this.exitState({status:i.ERROR,stateId:ba.stateId},ea+'');}},enterState:function(ba,ca){if(ba=='init'){this._initIframe(ca);}else if(/idle|ping|pull/.test(ba)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(ba!='idle')this.exitState({status:i.ERROR,stateId:ca.stateId},'iframe not yet loaded');}else if(ba=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(ba){if(this.manager.state=='init'&&ba.status==i.OK)this._iframeProxy=j.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function aa(){this.init=this.init.bind(this);x.apply(this,arguments);}Object.assign(aa.prototype,{logName:'iframe(inner)',init:function(){j.publish(this,'innerTransport');try{var ca=j.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,ca);this.exitState({status:i.OK,stateId:1e+06});}catch(ba){p.error('iframe_inner_init_error',ba);}},enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='ping'){this._request=t(ca,n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(this,'_processTransportData',ca.stateId),n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});f.exports={getURI:r,Transport:x,CORSTransport:y,IframeTransport:z,IframeInnerTransport:aa,sendActivePing:v,sendAdditionalBuddyRequest:u};},null);
__d('ChatProxyConnectionState',['Map'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){'use strict';this.auxiliaryIrisQueues=new h();this.aiq=null;}i.prototype.subscribeIrisQueue=function(j,k){'use strict';this.auxiliaryIrisQueues.set(j,k);this.updateCaches();};i.prototype.unsubscribeIrisQueue=function(j){'use strict';this.auxiliaryIrisQueues['delete'](j);this.updateCaches();};i.prototype.updateCaches=function(){'use strict';var j=[];this.auxiliaryIrisQueues.forEach(function(k,l,m){j.push(l);j.push(k);},this);if(j.length===0){this.aiq=null;}else this.aiq=j.join(',');};f.exports=i;},null);
__d('FBRTCSupport',['ChannelConstants','RTCConfig','UserAgent'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={isSendWebrtcSupported:function(){return i.SendNewVCGK;},isReceiveWebrtcSupported:function(){return i.ReceiveNewVCGK;},isVideoInteropSupported:function(){return i.VideoInteropGK;},isVideoCallBlockingSupported:function(){return i.VideoCallBlockingGK;},isWebrtcSupported:function(){return (j.isBrowser('Chrome >= 28')||j.isBrowser('Firefox >= 25')||j.isBrowser('Opera >= 20'));},isOSSupported:function(){return !j.isPlatform('Android')&&!j.isPlatform('iOS');},getCapabilities:function(){var l=0;if(this.isReceiveWebrtcSupported())l=h.CAPABILITY_VOIP_INTEROP;return l;}};f.exports=k;},null);
__d('FantailLogger',['Bootloader','FantailConfig'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={debug:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).debug.apply(q,[l].concat(n));});},info:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).info.apply(q,[l].concat(n));});},warn:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).warn.apply(q,[l].concat(n));});},error:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).error.apply(q,[l].concat(n));});}};f.exports=j;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('RTISession',['URI','AjaxRequest','invariant','ErrorUtils'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){!n?j(0):undefined;!q?j(0):undefined;!r?j(0):undefined;this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){!n?j(0):undefined;!o?j(0):undefined;!q?j(0):undefined;var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)!!o[x]?j(0):undefined;Object.assign(w,o);var y=new h(n).setDomain(u).setPort(this.port).setSecure(new h(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new i(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};f.exports=m;},null);
__d('ChannelManager',['AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatConfig','ChatVisibility','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','Run','SystemEvents','URI','UserActivity','ChatProxyConnectionState','errorCode','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){if(c.__markCompiled)c.__markCompiled();var oa,pa=x.create('channel'),qa=y.getInstance('channel_manager'),ra=null;function sa(fb){ra=fb;}var ta={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ua={state:new ja(),reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:k.getID(),capabilities:v.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:ca.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},va=1,wa={},xa=0;function ya(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function za(){var fb={};if(oa.getConfig('host'))fb[oa.getConfig('user_channel')]=oa.getConfig('seq',0);return fb;}function ab(){var fb=Date.now(),gb=Date.now(),hb={total:0},ib='idle',jb=false;ga.subscribe([ga.USER,ga.ONLINE,ga.TIME_TRAVEL],function(mb,nb){cb(true);gb=null;oa.lastPullTime=Date.now();var ob;switch(mb){case ga.USER:ob=ga.isPageOwner()?l.SYS_OWNER:l.SYS_NONOWNER;break;case ga.ONLINE:ob=nb?l.SYS_ONLINE:l.SYS_OFFLINE;break;case ga.TIME_TRAVEL:ob=l.SYS_TIMETRAVEL;break;}oa.exitState({status:ob,stateId:va});});var kb=function(mb,nb){var ob=Date.now(),pb=null;if(nb){fb=ob;pb=nb.nextState||nb.state;}else pb=ib;ga.checkTimeTravel();if(gb){var qb=Math.round((ob-gb)/1000);if(qb>0){hb[ib]=(hb[ib]||0)+qb;hb.total+=qb;}}ib=pb;gb=ob;if(!mb){hb.lastSuccessTime=ya();hb.online=ga.isOnline();qa.log('rollup',JSON.stringify(hb));}};i.subscribe(l.ON_ENTER_STATE,kb);ma(kb,60000);i.subscribe(x.DUMP_EVENT,function(mb,nb){nb.channelRollup=hb;});var lb=function(){if(oa.isShutdown()||oa.shouldIdle())return;ga.checkTimeTravel();var mb=Date.now()-(oa.lastPullTime||s.start);if(!jb&&mb>ua.STALL_THRESHOLD){var nb=ya();qa.error('stall',JSON.stringify({lastSuccessTime:nb,rollupState:ib}));jb=true;}var ob=Date.now()-fb;if(oa.state=='pull'&&ob>ua.JUMPSTART_THRESHOLD){fb=null;qa.warn('jumpstart',JSON.stringify({state:oa.state,dormant:ob}));oa.enterState('init');}};ma(lb,10000);}function bb(){var fb=Date.now(),gb=1;function hb(){na(hb,gb*1000);var mb=oa.state;if(mb=='idle'&&oa.shouldIdle())return;pa.bump('conn_t',gb);if(mb=='pull')pa.bump('conn_t_pull',gb);}hb();var ib=[15,30,60,120,240],jb=false,kb=false;function lb(mb){na(function(){pa.rate('pullenter_'+mb,jb);pa.rate('pullexit_'+mb,kb);},mb*1000);}while(ib.length)lb(ib.shift());i.subscribe(l.ON_ENTER_STATE,function(mb,nb){if(nb.state=='pull')jb=true;fb=Date.now();});i.subscribe(l.ON_EXIT_STATE,function(mb,nb){if(nb.state!='pull'||!fb)return;var ob='other';if(nb.status==l.OK){kb=true;ob='ok';}else if(nb.xhr&&nb.xhr.errorType){ob=/ar:(\w+)/.test(nb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(nb.status))return;var pb=(Date.now()-fb)/1000;if(pb<0){return;}else if(pb>3600)pb=3600;pa.bump('conn_num');pa.bump('conn_exit',pb);pa.bump('conn_num_'+ob);pa.bump('conn_exit_'+ob,pb);});}function cb(fb){if(fb){xa=0;wa={};}else xa++;}function db(){var fb=!h.supportsCORS()||ua.forceIframe;if(ua.subdomain===null||fb){ua.fullHost=ua.host;}else ua.fullHost=ua.subdomain+'-'+ua.host;}oa={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:sa,backoff:false,sessionRegistered:false,init:function(fb,gb){this.init=function(){};i.subscribe(l.GET_RTI_SESSION_REQUEST,(function(event,kb){this.informCurrentSession();}).bind(this));la(function(){t.info(l.FANTAIL_SERVICE,'client initialized');t.info(l.FANTAIL_SERVICE,'using session id: %s at seq: %d with sticky: %s/%s',ua.sessionID,ua.sequenceId,ua.sticky_token,ua.sticky_pool);ia.subscribe(function(){ua.userActive=Date.now();o.sendActivePing(ua);});});ba.register('ch',za);var hb=this.getConfig('max_conn',2);ua.subdomain=n.allocate(hb);this._transportRate=new aa(30000);var ib=h.supportsCORS()&&!ua.forceIframe?'CORSTransport':'IframeTransport';this.transport=new o[ib](this);if(fb)this.enterState(fb,gb);la((function(){i.subscribe(x.DUMP_EVENT,(function(event,kb){kb.transportRate=this._transportRate.tally();kb.transportType=ib;kb.transportVersion=2;}).bind(this));ab();bb();}).bind(this));if(oa.getConfig('tryStreaming')&&oa.getConfig('host')&&h.supportsCORS()&&!ua.forceIframe){var jb=ua.MIN_INIT_PROBE_DELAY+Math.random()*ua.INIT_PROBE_DELAY_RANDOMIZE_RANGE;na(this._probeTest,jb);}},configure:function(){for(var fb=arguments.length,gb=Array(fb),hb=0;hb<fb;hb++)gb[hb]=arguments[hb];qa.log('configure',JSON.stringify(gb));gb.forEach(function(ib){return Object.assign(ua,ib);});db();i.inform(l.ON_CONFIG,this);},getConfig:function(fb,gb){return fb in ua?ua[fb]:gb;},getCompleteConfig:function(){return ua;},subscribeIrisQueue:function(fb,gb){ua.state.subscribeIrisQueue(fb,gb);this.exitState({status:l.OK,stateId:va});},unsubscribeIrisQueue:function(fb){ua.state.unsubscribeIrisQueue(fb);},informCurrentSession:function(){var fb=null;if(this.sessionRegistered&&ua&&ua.fullHost&&ua.sticky_token&&ua.uid)fb=new ea(ua.fullHost,ua.port,ua.sticky_pool,ua.sticky_token,ua.uid,ua.viewerUid,ua.profile,ua.sessionID,ua.capabilities);i.inform(l.RTI_SESSION,fb);},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(ga.isPageOwner()&&ga.isOnline());},_sendIframeError:function(fb){var gb=new j().setURI('/ajax/presence/reconnect.php').setData({reason:fb,fb_dtsg:r.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);gb.specifiesWriteRequiredParams()&&gb.send();},_getDelay:function(){var fb=Math.min(ua.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,xa-1)),ua.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in ua)fb=ua.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(fb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)qa.warn('enterstate_recursion','{}');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(fb){this._inEnterState=false;throw fb;}},_enterState:function(fb){if((fb.indexOf('pull')===0||fb.indexOf('ping')===0||fb.indexOf('shutdown')===0)&&!!ua.active_config_refresh){var gb=Date.now(),hb=(gb-ua.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in ua&&ua.config_refresh_seconds>0&&hb>ua.config_refresh_seconds){fb='reconnect';t.debug(l.FANTAIL_SERVICE,'forcing reconnect to refresh config - this is normal behavior');}}if(fb.indexOf('reconnect')===0)ua.reconnectOverrideTimeMillis=Date.now();var ib=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){t.warn(l.FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',fb);return;}if(fb!='idle!'&&this.shouldIdle()){t.warn(l.FANTAIL_SERVICE,'forced idleness');return;}va++;ua.stateId=va;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(fb)){var jb=this._transportRate.tally().timeAverage,kb=oa.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(jb>=kb){if(!this._throttled){this._throttled=true;qa.warn('throttled','{}');}pa.bump('throttle');ib=1000/kb;}}else if(!(/#$/.test(fb)))ib=this._getDelay();fb=fb.replace(/\W*$/,'');if(!ta[fb]){t.error(l.FANTAIL_SERVICE,'invalid state: %s',fb);throw new Error('invalid state:'+fb);}var lb=Array.from(arguments),mb;if(ib<=0){mb={state:fb};this._transportRate.add(1);this.state=fb;var nb=this['_enter_'+this.state];if(nb){lb.shift();nb.apply(this,lb);}if(/init|idle|pull|ping/.test(this.state)){if(ua.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];ua.is_offline=!q.isOnline();ua.capabilities=v.getCapabilities();t.info(l.FANTAIL_SERVICE,'entering transport state: %s',this.state);this.transport.enterState(this.state,ua);if(this.state=='ping'){mb.url=o.getURI(ua).toString();mb.port=ua.port||'undefined';}}}else{this.state='idle';this.nextState=fb;mb={state:this.state,delay:ib,nextState:fb};lb[0]=fb+'#';this._deferredTransition=na((function(){this._deferredTransition=null;this.enterState.apply(this,lb);}).bind(this),ib);}if(/pull/.test(fb)){mb.client_id=ua.sessionID;mb.streaming=ua.inStreaming;}i.inform(l.ON_ENTER_STATE,mb);},exitState:function(fb,gb){var hb=fb.stateId,ib=fb.status;if(this.isShutdown()||hb<va)return;var jb=this.state,kb=Array.from(arguments);kb[0]=fb.status;var lb={state:jb,status:ib};if(/pull/.test(jb)){lb.client_id=ua.sessionID;lb.streaming=ua.inStreaming;}if(/ping/.test(jb)&&ib!=l.OK)lb.url=o.getURI(ua).toString();if(this.nextState)lb.nextState=this.nextState;if(gb&&gb.errorType){ua.lastRequestErrorReason=gb.errorType;lb.xhr=gb.toJSON?gb.toJSON():gb;if(gb.errorType==h.SERVICE_UNAVAILABLE){t.error(l.FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete lb.xhr.json;}else if(ib!=l.OK)ua.lastRequestErrorReason=ib;if(gb&&gb.json){if(gb.json.t)lb.t=gb.json.t;if(gb.json.reason)lb.reason=gb.json.reason;if(gb.json.seq)lb.seq=gb.json.seq;}i.inform(l.ON_EXIT_STATE,lb);var mb=this['_exit_'+jb];if(mb)ib=mb.apply(this,kb)||ib;if(ib!=l.OK){cb();wa[jb]=(wa[jb]||0)+1;}var nb=ta[this.nextState||jb][ib]||ta._all[ib],ob=nb&&nb.replace(/!*$/,'');if(!ob){qa.error('terminal_transition',JSON.stringify(lb));this._shutdownHint=l.HINT_INVALID_STATE;nb='shutdown!';t.error(l.FANTAIL_SERVICE,'entering shutdown state');}this._lastState=jb;this._lastStatus=ib;this.enterState(nb);},_processTransportData:function(fb,gb){this._processTransportData0(fb,gb,gb.json);},_processTransportData0:function(fb,gb,hb){var ib=hb.t;if('s' in hb){hb.seq=hb.s;delete hb.s;}if(hb.u&&ua.user&&hb.u!=ua.user){qa.warn('misguided_msg',JSON.stringify({user:ua.user,target:hb.u}));this._reportProxyMisguidedMsg(hb.u,ua.user);return;}var jb=ua.seq;if('seq' in hb){ua.seq=hb.seq;ca.doSync();}switch(ib){case 'continue':if(ua.inStreaming&&this.heartbeats.length<1){ua.streamingCapable=false;qa.log('switch_to_longpoll','{}');na(this._probeTest,ua.PROBE_DELAY);}cb(true);if(!ua.inStreaming||ua.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:l.OK,stateId:fb});break;case 'refresh':case 'refreshDelay':t.info(l.FANTAIL_SERVICE,'got refresh with reason: %s',hb.reason);this.exitState({status:'refresh_'+(hb.reason||0),stateId:fb},gb);break;case 'backoff':t.warn(l.FANTAIL_SERVICE,'server told client to back off');cb();this.backoff=true;break;case 'lb':var kb=hb.lb_info;if(kb){ua.sticky_token=kb.sticky;if('pool' in kb)ua.sticky_pool=kb.pool;if('sd' in kb)ua.subdomain=kb.subdomain;if('vip' in kb)ua.host=kb.vip;db();}else qa.error('missing_lb_info','{}');break;case 'test_streaming':na(this._probeTest,500);break;case 'fullReload':ba.clear();qa.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();i.inform(l.ON_INVALID_HISTORY);cb(true);t.info(l.FANTAIL_SERVICE,'full reload incurred');var lb=l.OK;this.exitState({status:lb,stateId:fb},gb);if('ms' in hb)this._processMessages(hb,jb);break;case 'msg':cb(true);this._processMessages(hb,jb);break;case 'heartbeat':if(ua.inStreaming){var mb=Date.now();if(this.heartbeats.length>0)var nb=mb-this.heartbeats[this.heartbeats.length-1];qa.log('heartbeat_interval',JSON.stringify({client_id:ua.sessionID,interval:nb}));this.heartbeats.push(mb);}break;case 'batched':var ob=hb.batches,pb;for(pb=0;pb<ob.length;pb++)this._processTransportData0(fb,gb,ob[pb]);break;default:t.error(l.FANTAIL_SERVICE,'got an unknown protocol message: %s',ib);qa.error('unknown_msg_type',JSON.stringify({type:ib}));break;}},_processMessages:function(fb,gb){var hb,ib,jb,kb;if('tr' in fb)ua.trace_id=fb.tr;ib=fb.ms;jb=ua.seq-ib.length;for(hb=0;hb<ib.length;hb++,jb++){ua.estimatedReceived++;if(jb>=gb){kb=ib[hb];if(kb.type){var lb=l.getArbiterType(kb.type);if(kb.type==='messaging'){var mb={type:'messaging',event:kb.event};if(kb.message){mb.inbox_unread=kb.unread_counts&&kb.unread_counts.inbox;mb.tid=kb.message.tid;mb.mid=kb.message.mid;t.info(l.FANTAIL_SERVICE,'got message with id: %s',kb.message.mid);}}else if(kb.type==='pages_messaging'){if(kb.unread_counts&&kb.unread_counts.inbox)i.inform(l.getArbiterType('pages_inbox_count_update'),{page_id:kb[z.VIEWER_FBID],inbox_unread:kb.unread_counts.inbox});}else if(kb.type==='skywalker'){lb=l.SKYWALKER;}else if(kb.type==='qprimer'){kb.first=!ua.ready;if(kb.first){ua.ready=true;ua.timeUntilReady=Date.now()-ua.created;ua.queueMade=kb.made;}lb=l.CHANNEL_ESTABLISHED;}else if(kb.type==='pws'){ua.pws=kb.pws;}else if(kb.type==='delta')ua.sequenceId=kb.iseq;i.inform(lb,{obj:kb});}}else qa.warn('seq_regression',JSON.stringify({last_seq:gb,messages:ib.length,seq:jb}));}},_enter_init:function(){if(wa.init>=oa.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:l.ERROR_MAX,stateId:va}),0);this._initTimer=na(this.exitState.bind(this,{status:l.ERROR,stateId:va},'timeout'),ua.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(fb){qa.warn('enter_reconnect',fb);t.info(l.FANTAIL_SERVICE,'entered reconnect with reason: %s',fb);var gb=va;if(!da.hasUserCookie()){t.warn(l.FANTAIL_SERVICE,'user has no cookie???');qa.warn('no_user_cookie','{}');setTimeout(function(){oa._shutdownHint=l.HINT_AUTH;oa.exitState({status:l.ERROR_SHUTDOWN,stateId:gb});},0);return;}var hb={reason:fb,fb_dtsg:r.getToken()};if(w.token)hb.fb_isb=w.token;if(ra)ra(hb);var ib=new u('GET','/ajax/presence/reconnect.php',hb);ib.onSuccess=(function(){oa.configure(ib.json);ba.store();this.exitState({status:l.OK,stateId:gb});}).bind(this);ib.onError=(function(){var jb=ib.json&&ib.json.error;t.error(l.FANTAIL_SERVICE,'reconnect error: %s',ib.errorType);if(ib.errorType==h.TRANSPORT_ERROR||ib.errorType==h.PROXY_ERROR||ib.errorType==h.SERVICE_UNAVAILABLE)this._shutdownHint=l.HINT_CONN;if(jb&&jb==1356007){this._shutdownHint=l.HINT_MAINT;}else if(jb==1357001||jb==1357004||jb==1348009){this._shutdownHint=l.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?l.ERROR_SHUTDOWN:l.ERROR,stateId:gb},ib);}).bind(this);ib.send();},_enter_shutdown:function(){i.inform(l.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!ua.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in ua&&ua.shutdown_recovery_interval_seconds>0){var fb=ua.shutdown_recovery_interval_seconds*1000;na((function(){i.inform(l.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),fb);}},_exit_init:function(fb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(fb==l.ERROR_MAX)this._sendIframeError(l.reason_IFrameLoadGiveUp);},_exit_pull:function(fb,gb){var hb=fb==l.OK;if(hb){this.lastPullTime=Date.now();}else{var ib='exit status: '+fb;if(gb&&gb.errorType)ib+=' ajax request error: '+gb.errorType;t.error(l.FANTAIL_SERVICE,'pull failed with status: %s',ib);}},_exit_ping:function(fb){if(fb==l.OK){var gb=Date.now()-(this.lastPullTime||s.start);if(gb>ua.STALL_THRESHOLD){t.error(l.FANTAIL_SERVICE,'didnt complete a successful pull for too long');return l.ERROR_STALE;}}else t.error(l.FANTAIL_SERVICE,'ping failed with status: %s',fb);},_reportProxyMisguidedMsg:function(fb,gb){t.error(l.FANTAIL_SERVICE,'misguided message to %d meant for %d',gb,fb);var hb=Date.now();if(hb-this.lastReportOnMisguidedMsgTime<=ua.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=hb;var ib={received_uid:fb,expected_uid:gb};if(ua.sticky_token)ib.sticky_token=ua.sticky_token;var jb=new ha('/err_misguided_msg').setDomain(ua.host+'.'+ua.domain).setPort(ua.port).setSecure(new ha(window.location.href).isSecure()).setQueryData(ib),kb=new h('GET',jb);if(h.supportsCORS())kb.xhr.withCredentials=true;kb.onSuccess=function(lb){};kb.onError=function(lb){};kb.onJSON=function(lb,mb){};kb.send();},_probeTest:function(){ua.streamingCapable=false;var fb=[],gb={mode:'stream',format:'json'};if(ua.sticky_token)gb.sticky_token=ua.sticky_token;var hb=new ha('/probe').setDomain(ua.host+'.'+ua.domain).setPort(ua.port).setSecure(new ha(window.location.href).isSecure()).setQueryData(gb),ib=new h('GET',hb);ib.onJSON=function(jb,kb){if(jb&&jb.json&&jb.json.t==='heartbeat'){fb.push(Date.now());if(fb.length>=2){var lb=fb[1]-fb[0];if(lb>=ua.PROBE_HEARTBEATS_INTERVAL_LOW&&lb<=ua.PROBE_HEARTBEATS_INTERVAL_HIGH){ua.streamingCapable=true;qa.log('switch_to_streaming','{}');}}}};ib.onSuccess=function(jb){if(fb.length!=2){ua.streamingCapable=false;qa.error('probe_error',JSON.stringify({error:'beats.length = '+fb.length}));}qa.log('probe_success','{}');};ib.onError=function(jb){ua.streamingCapable=false;qa.error('probe_error',JSON.stringify(jb));};ib.send();}};f.exports=oa;function eb(){if(m.channelConfig){oa.configure(m.channelConfig);if(/shutdown/.test(m.state))oa._shutdownHint=l[m.reason];oa.init(m.state,m.reason);}}if(p.get('early_channel',false)){eb();}else fa.onAfterLoad(eb);},6);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=Object.assign(new h(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});i.onBeforeUnload(function(){});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ca){v();q=n(w,ca);o.log('mute_warning',{time:ca});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ca,da){y();if(ca===k.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var ea=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:ea});}}else if(ca===k.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||!da.nextState&&da.state==='idle')){r=n(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=da.delay||0;o.log('reconnecting',{delay:fa});if(u.disconnected())o.log('reconnecting_ui',{delay:fa});s=u.RECONNECTING;da.state==='idle'&&t++;if(t>1){u.inform(u.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')z(ca,da);},500);}else if(ca===k.ON_SHUTDOWN){o.log('shutdown',{reason:da.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,da.reason);}}function aa(){if(l.isShutdown()){z(k.ON_SHUTDOWN,l._shutdownHint);}else z(k.ON_ENTER_STATE,{state:l.state,nextState:l.nextState,delay:0});}i.onAfterLoad(aa);Object.assign(u,{disconnected:function(){return s===u.SHUTDOWN||s===u.RECONNECTING&&!q&&t>1;},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:function(ca){if(l.state==='ping'||l.isShutdown())return;o.log('reconnect',{now:ca});u.inform(u.RECONNECTING,0);if(!!ca){if(p!==null){clearTimeout(p);p=null;}l.enterState('ping!');}else if(!p)p=n(function(){l.enterState('ping!');p=null;},k.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:w});function ba(){h.subscribe([k.ON_ENTER_STATE,k.ON_SHUTDOWN],z);h.subscribe(k.ATTEMPT_RECONNECT,function(){if(u.disconnected())u.reconnect();});j.subscribe(j.TIME_TRAVEL,function(){u.reconnect();x(k.MUTE_WARNING_TIME_MSEC);});i.onBeforeUnload(y,false);}i.onAfterLoad(ba);u.mockAfterLoad=function(){aa();ba();};f.exports=u;},6);
__d('ChatSidebarActionTypes',['keyMirror'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=h({INIT:null,LOADED:null,SET_ENABLED:null,SHOW:null,TOGGLE:null});},null);
__d('ChatSidebarStore',['ChatDispatcher','ChatOptionsInitialData','ChatSidebarActionTypes','FluxStore','SidebarType','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;'use strict';n=babelHelpers.inherits(p,k);o=n&&n.prototype;function p(){o.constructor.call(this,h);this.$ChatSidebarStore1={initialized:false,initTime:m(),loaded:false,enabled:!!i.sidebar_mode,visible:null};this.$ChatSidebarStore2={};}p.prototype.__onDispatch=function(q){var r=q.type;this.$ChatSidebarStore2=babelHelpers._extends({},this.$ChatSidebarStore1);switch(r){case j.INIT:if(!this.$ChatSidebarStore2.initialized)this.$ChatSidebarStore1.initTime=m();this.$ChatSidebarStore1.initialized=true;break;case j.LOADED:this.$ChatSidebarStore1.loaded=true;break;case j.SHOW:this.$ChatSidebarStore1.visible=q.sidebarType;break;case j.SET_ENABLED:this.$ChatSidebarStore1.enabled=q.enabled;this.$ChatSidebarStore1.visible=q.sidebarType;break;case j.TOGGLE:this.$ChatSidebarStore1.enabled=!this.$ChatSidebarStore1.enabled;this.$ChatSidebarStore1.visible=this.$ChatSidebarStore1.enabled?q.visible:l.BUDDYLIST;break;}for(var s in this.$ChatSidebarStore1)if(this.$ChatSidebarStore1.hasOwnProperty(s))if(this.$ChatSidebarStore1[s]!==this.$ChatSidebarStore2[s]){this.__emitChange();break;}};p.prototype.getPrevState=function(){return this.$ChatSidebarStore2;};p.prototype.getState=function(){return this.$ChatSidebarStore1;};p.prototype.isInitialized=function(){return this.$ChatSidebarStore1.initialized;};p.prototype.isLoaded=function(){return this.$ChatSidebarStore1.loaded;};p.prototype.isEnabled=function(){return this.$ChatSidebarStore1.enabled;};p.prototype.getInitTime=function(){return this.$ChatSidebarStore1.initTime;};p.prototype.getVisibleType=function(){return this.$ChatSidebarStore1.visible;};f.exports=new p();},null);
__d('OrderedFriendsList',['AvailableListConstants','MercuryIDs','PresenceStatus','SearchableEntry','ShortProfiles','WorkModeConfig','createArrayFromMixed','isValidUniqueID','InitialChatFriendsList'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=[],q=[],r={},s=[],t={},u=[];function v(x){return i.isValid(x)?x:i.getParticipantIDFromUserID(x);}var w={contains:function(x){return x in r;},getList:function(){if(m.is_work_user)return n(p);w.reRank();var x=n(p);x=x.filter(function(y){var z=l.getNowUnsafe(y);return !z||z.type=='friend'||z.is_nonfriend_messenger_contact;});return x;},getSearchableEntries:function(x,y){var z=w.getList();l.getMulti(z.slice(0,x),function(aa){var ba=[];for(var ca in aa)ba.push(w.normalizeProfileEntry(aa[ca],ca));var da=w.getGroups().map(w.normalizeThreadEntry);y(ba.concat(da).filter(function(ea){return !!ea;}).sort(function(ea,fa){return ea.getOrder()-fa.getOrder();}));});},normalizeProfileEntry:function(x,y){var z=x.searchTokens||[],aa=x.name,ba=null;if(x.threadNickname){aa=x.threadNickname;ba=x.name;}return new k({uniqueID:x.id||y,keywordString:z.join(' '),order:w.getRank(x.id||y),photo:x.thumbSrc,title:aa,subtitle:ba,type:x.type,uri:x.uri,auxiliaryData:{isMessengerUser:x.is_messenger_user}});},normalizeThreadEntry:function(x,y){var z=x.mercury_thread,aa=x.participants_to_render.map(function(fa){return babelHelpers._extends({},fa,{id:v(fa.id)});});z.participants=z.participants.map(v);var ba=x.text,ca=null;if(!ba)ba=z.name;var da=aa.map(function(fa){return fa.name;}).join(', ');if(!ba){ba=da;}else ca=da;var ea=x.uid;if(!ba||!o(ea))return null;return new k({uniqueID:ea,order:y,photo:z.image_src,title:ba,subtitle:ca,type:'thread',auxiliaryData:{participantsToRender:aa,thread:z}});},getRank:function(x){return x in r?r[x]:p.length;},getActiveList:function(){if(s.length>0)return s;return w.getList();},getActiveRank:function(x){return x in t?t[x]:w.getRank(x);},reRank:function(){p=[];var x=0;u.forEach(function(y){var z=y.slice(0,-2),aa=y.slice(-1);if(j.get(z)==aa){p[x]=z;r[z]=x++;}});},rankActive:function(){var x=0;u.forEach(function(y){var z=y.slice(0,-2),aa=y.slice(-1);if(aa==h.ACTIVE){s[x]=z;t[z]=x++;}});},getGroups:function(){return q;}};(function(){var x=c('InitialChatFriendsList');p=x.list.length?x.list:[];q=x.groups||[];if(x.shortProfiles)l.setMulti(x.shortProfiles);if(!m.is_work_user){u=p.slice();w.rankActive();w.reRank();}else p.forEach(function(y,z){r[y]=z;});})();f.exports=b.OrderedFriendsList||w;},null);
__d('ChatSidebarVisibility',['ChatConfig','ChatSidebarStore','OrderedFriendsList','getViewportDimensions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.get('sidebar.min_friends'),m=h.get('sidebar.minimum_width'),n={getViewport:function(){return k.withoutScrollbars();},hasLowFriendCount:function(){return j.getActiveList().length<=l;},isViewportCapable:function(o){o=o||n.getViewport();return o.width>m;},shouldShowSidebar:function(){return n.shouldShowSidebarIgnoreEnabled()&&i.isEnabled();},shouldShowSidebarIgnoreEnabled:function(){return n.isViewportCapable()&&!n.hasLowFriendCount();}};f.exports=n;},null);
__d('ChatSidebarActions',['ChatDispatcher','ChatSidebarActionTypes','ChatSidebarVisibility','SidebarType'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(){if(j.shouldShowSidebar())return k.SIDEBAR;return k.BUDDYLIST;}function m(){if(j.shouldShowSidebarIgnoreEnabled())return k.SIDEBAR;return k.BUDDYLIST;}var n={init:function(){h.dispatch({type:i.INIT});},loaded:function(){h.dispatch({type:i.LOADED});},disable:function(){h.dispatch({type:i.SET_ENABLED,enabled:false,sidebarType:k.BUDDYLIST});},enable:function(){h.dispatch({type:i.SET_ENABLED,enabled:true,sidebarType:m()});},show:function(){h.dispatch({type:i.SHOW,sidebarType:l()});},toggle:function(){h.dispatch({type:i.TOGGLE,sidebarType:l()});}};f.exports=n;},null);
__d('FBRTCDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('FBRTCStore',['FBRTCDispatcher','FluxStore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;'use strict';j=babelHelpers.inherits(l,i);k=j&&j.prototype;function l(){k.constructor.call(this,h);}l.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};f.exports=l;},null);
__d('FBRTCCallBlockingStore',['Arbiter','AsyncRequest','BanzaiLogger','ChannelConstants','FBRTCDispatcher','FBRTCStore','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;'use strict';var q=false,r=0,s=null,t='call_block_setting_changed';o=babelHelpers.inherits(u,m);p=o&&o.prototype;u.prototype.init=function(v){this.$FBRTCCallBlockingStore1(v);h.subscribe(k.getArbiterType('videocall_block_setting'),this.$FBRTCCallBlockingStore2.bind(this));};u.prototype.__onDispatch=function(v){if(v.type!==t)return;this.$FBRTCCallBlockingStore1(v.data);};u.prototype.$FBRTCCallBlockingStore1=function(v){switch(v){case 0:q=false;this.$FBRTCCallBlockingStore3();break;case -1:q=true;this.$FBRTCCallBlockingStore3();break;default:q=true;this.$FBRTCCallBlockingStore4(v);}this.__emitChange();};u.prototype.$FBRTCCallBlockingStore4=function(v){if(s===null)s=n(this.turnOnVideoCalling.bind(this),v*1000);};u.prototype.getBlockingStatus=function(){return q;};u.prototype.turnOnVideoCalling=function(){new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore5.bind(this)).setData({call_blocked_until:0}).send();};u.prototype.turnOffVideoCalling=function(v){r=v;new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore6.bind(this)).setData({call_blocked_until:v}).send();};u.prototype.$FBRTCCallBlockingStore3=function(){if(s){clearTimeout(s);s=null;}};u.prototype.$FBRTCCallBlockingStore5=function(){l.dispatch({type:t,data:0});j.log('VideoCallLoggerConfig',{event:t,message:'enable'});};u.prototype.$FBRTCCallBlockingStore6=function(){l.dispatch({type:t,data:r});j.log('VideoCallLoggerConfig',{event:t,message:'disable_'+r});};u.prototype.$FBRTCCallBlockingStore2=function(v,w){l.dispatch({type:t,data:w.obj.value});};function u(){o.apply(this,arguments);}f.exports=new u();},null);
__d('ChatOptions',['Arbiter','ChannelConstants','ChatSidebarActions','FBRTCCallBlockingStore','JSLogger','PresenceUtil','ChatOptionsInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=l.create('chat_options'),o={};(function(){var q=c('ChatOptionsInitialData');for(var r in q){var s=q[r];if(r==='call_blocked_until'){k.init(s);}else o[r]=!!s;}})();var p=Object.assign(new h(),{getSetting:function(q){return o[q];},setSetting:function(q,r,s){if(q==='sidebar_mode'){r?j.enable():j.disable();return;}if(this.getSetting(q)==r)return;if(s){s='from_'+s;n.log(s,{name:q,new_value:r,old_value:this.getSetting(q)});}o[q]=!!r;h.inform('chat/option-changed',{name:q,value:r});}});h.subscribe(i.getArbiterType('setting'),function(q,r){var s=r.obj;if(s.window_id===m.getSessionID())return;p.setSetting(s.setting,!!s.value,'channel');});h.subscribe(l.DUMP_EVENT,function(q,r){r.chat_options=o;});f.exports=p;},null);
__d('GroupChatMessageBlockAlert',['DialogX','GenderConst','MercuryParticipants','React','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogTitle.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q={show:function(r,s,t){var u=new h({width:445},k.createElement('div',null,k.createElement(o,null,p._("See Conversations?")),k.createElement(l,null,this.dialogBodyText(r)),k.createElement(n,null,k.createElement(m,{action:'cancel',label:this.leaveGroupButton(),onClick:function(){return t();}}),k.createElement(m,{use:'confirm',action:'cancel',label:this.openChatButton(),onClick:function(){return s();}}))));u.show();},openChatButton:function(){return p._("See Conversation");},leaveGroupButton:function(){return p._("Leave Group");},dialogBodyText:function(r){if(r.length!==1){return p._("People you've blocked are in this conversation. If you see this conversation, you'll get each other's messages to the group.");}else{var s='';j.get(r.pop(),function(t){switch(t.gender){case i.FEMALE_SINGULAR:s=p._("{name} is in this group conversation but you've blocked her. If you see this conversation, you'll see her messages to the group and she'll see yours.",[p.param('name',t.short_name)]);break;case i.MALE_SINGULAR:s=p._("{name} is in this group conversation but you've blocked him. If you see this conversation, you'll see his messages to the group and he'll see yours.",[p.param('name',t.short_name)]);break;default:s=p._("{name} is in this group conversation but you've blocked them. If you see this conversation, you'll see their messages to the group and they'll see yours.",[p.param('name',t.short_name)]);}});return s;}}};f.exports=q;},null);
__d('TypingDetector',['ArbiterMixin','Event','Input','Run','SubscriptionsHandler','TypingStates','createObjectFrom','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(q,r){this._input=q;this._ignoreKeys={};this._getValueFn=r;}Object.assign(p.prototype,h,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=o;this.reset();this._subscriptions=new l();this._subscriptions.addSubscriptions(i.listen(this._input,'keyup',this._update.bind(this)),k.onUnload(this._onunload.bind(this)));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(q){this._ignoreKeys=n(q);},destroy:function(){this._subscriptions.release();},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var q=i.getKeyCode(event),r=this._currentState;if(!this._ignoreKeys[q]){var s=this._getValueFn?this._getValueFn():j.getValue(this._input);if(s.trim().length===0){if(r==m.TYPING)this._transition(m.INACTIVE);}else if(r==m.TYPING){this._recordKeystroke();}else if(r==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}}},_transition:function(q){this.reset();this._currentState=q;this.inform('change',q);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var q=this._lastKeystrokeTime+this._timeout,r=Date.now();if(r>q){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),q-r+10);}}});f.exports=p;},null);
__d('TypingDetectorController',['AsyncRequest','AvailableList','AvailableListConstants','ChannelConnection','ChatVisibility','Keys','MercuryServerRequestsConfig','TypingDetector','TypingStates','emptyFunction','setTimeoutAcrossTransitions','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();function t(u,v,w,x,y,z){'use strict';this.userID=u;this.input=v;this.source=w;this.threadID=y;this.remoteState=p.INACTIVE;this.notifyTimer=null;x=x||{};this.notifyDelay=x.notifyDelay||this.notifyDelay;this._typingDetector=new o(v,z);this._typingDetector.init(x);this._typingDetector.subscribe('change',this._stateChange.bind(this));}t.prototype.setUserAndThread=function(u,v){'use strict';if(this.userID!==u||this.threadID!==v){this.resetState();this.userID=u;this.threadID=v;}};t.prototype.setIgnoreEnter=function(u){'use strict';var v=u?[m.RETURN]:[];this._typingDetector.setIgnoreKeys(v);};t.prototype.resetState=function(){'use strict';this._notifyState(p.INACTIVE);this.remoteState=p.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};t.prototype.destroy=function(){'use strict';this.resetState();this._typingDetector.destroy();};t.prototype._stateChange=function(u,v){'use strict';if(v!=p.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(s(this._notifyState,this,v),this.notifyDelay);}else this._notifyState(v,true);};t.prototype._notifyState=function(u,v){'use strict';if(!this.userID&&!this.threadID||!l.isOnline()||u===this.remoteState||k.disconnected())return;this._sendRequest(u,this.userID,v);};t.prototype._sendRequest=function(u,v,w){'use strict';this.remoteState=u;var x={typ:u,to:v,source:this.source,thread:this.threadID},y=new h().setHandler(this._onTypResponse.bind(this,v)).setErrorHandler(q).setData(x).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous_DEPRECATED',!w);if(n.msgrRegion)y.setRequestHeader('X-MSGR-Region',n.msgrRegion);y.send();};t.prototype._onTypResponse=function(u,v){'use strict';var w=v.getPayload()||{};if(w.offline)i.set(u,j.OFFLINE,'typing_response');};Object.assign(t.prototype,{notifyDelay:1000});f.exports=t;},null);
__d('MercuryMessageDeliveryState',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={SENDING:1,SENT:2,DELIVERED:3,ERROR:0,UNKNOWN:-1};f.exports=h;},null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='fbid:'+h.getID(),k={getID:function(){return j;},isViewer:function(l){i.isParticipantID(l);return l===j;}};f.exports=k;},null);
__d('MercuryMessageInfo',['MercuryActionStatus','MercuryMessageDeliveryState','MercuryViewer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={isOutbound:function(l){return l.author===j.getID();},isInbound:function(l){return !k.isOutbound(l);},isSending:function(l){return (l.status===h.UNSENT||l.status===h.UNCONFIRMED||l.status===h.UNABLE_TO_CONFIRM||l.status===h.RESENDING);},isSent:function(l){return (l.status===undefined||l.status===h.SUCCESS);},hasError:function(l){return (l.status===h.FAILED_UNKNOWN_REASON||l.status===h.UNABLE_TO_CONFIRM||l.status===h.ERROR);},getDeliveryState:function(l,m){if(this.hasError(l))return i.ERROR;if(this.isSending(l))return i.SENDING;if(this.isSent(l)){if(l.timestamp<=m)return i.DELIVERED;return i.SENT;}return i.UNKNOWN;}};f.exports=k;},null);
__d('MercuryErrorInfo',['MercuryErrorType','MercuryMessageInfo','fbt'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={getMessage:function(l){var m='';if(k.isConnectionError(l)){m=j._("This message didn't send.");if(k.isTransient(l))m=j._("{message} Check your internet connection and click to try again.",[j.param('message',m)]);}else{if(l&&l.description){m=l.description;}else m=j._("This message failed to send.");if(k.isTransient(l))m=j._("{message} Click to send again.",[j.param('message',m)]);}return m;},isConnectionError:function(l){if(l&&l.type==h.TRANSPORT)return l.code===1001||l.code===1004||l.code===1006;return false;},isTransient:function(l){return l&&l.is_transient;},isPermanent:function(l){return l?!this.isTransient(l):false;},hasErrorStatus:function(l){return i.hasError(l);}};f.exports=k;},null);
__d('MercuryMessageObject',['BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercuryTimePassed','MercurySendMessageFields','fbt','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();v.getForFBID=function(z){'use strict';return y.getForFBID(z);};v.get=function(){'use strict';return y.get();};function v(z){'use strict';this.$MercuryMessageObject1=z;this.$MercuryMessageObject2=q.getForFBID(z);}v.prototype.constructUserGeneratedMessageObject=function(z,aa,ba,ca,da){'use strict';var ea=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,aa,ba);if(typeof z=='string')z=z.replace(/^\s+/,'').replace(/\s+$/,'');ea.body=z;ea.has_attachment=false;ea.html_body=false;ea.attachments=[];ea.specific_to_list=ca||[];ea.creator_info=da;return ea;};v.prototype.constructStickerMessageObject=function(z,aa,ba){'use strict';var ca=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,aa,ba);ca.has_attachment=true;ca.html_body=false;ca.attachments=[];ca.sticker_id=z;ca.specific_to_list=[];return ca;};v.prototype.constructAttachmentMessageObject=function(z,aa){'use strict';var ba=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,z,aa);ba.attachments=[];ba.specific_to_list=[];return ba;};v.prototype.constructLogMessageObject=function(z,aa,ba,ca){'use strict';var da=w(this.$MercuryMessageObject1,j.LOG_MESSAGE,z,aa);da.log_message_type=ba;da.log_message_data=ca;if(ca&&ca.untypedData&&ca.untypedData.ttl)da.ephemeral_ttl_mode=ca.untypedData.ttl;return da;};v.prototype.normalizeNewMessage=function(z){'use strict';if(z.status===undefined)z.status=i.UNSENT;z.timestamp_absolute=t._("Today").toString();z.offline_threading_id=z.offline_threading_id||l.generateOfflineThreadingID(z.timestamp);if(!z.offline_threading_id)h.bumpEntityKey('chat.web','invalid_otid_generated');z.message_id=z.message_id||z.offline_threading_id;var aa=k.getParticipantIDFromUserID(this.$MercuryMessageObject1);z.specific_to_list=z.specific_to_list||[];if(z.specific_to_list.length&&z.specific_to_list.indexOf(aa)===-1)z.specific_to_list.push(aa);if(!z.thread_id){z.thread_id='root:'+z.offline_threading_id;}else{var ba=this.$MercuryMessageObject2.getThreadMetaNow(z.thread_id);if(ba&&ba.ephemeral_ttl_mode!==null&&z.ephemeral_ttl_mode===undefined)z.ephemeral_ttl_mode=ba.ephemeral_ttl_mode;}if(z.specific_to_list.length==1){z.thread_id='user:'+this.$MercuryMessageObject1;}else if(z.specific_to_list.length==2){var ca=z.specific_to_list[0]==aa?z.specific_to_list[1]:z.specific_to_list[0];z.thread_id=k.getThreadIDFromParticipantID(ca);}if(!z.specific_to_list.length){var da=k.tokenize(z.thread_id),ea=da.type,fa=da.value;if(ea=='user')z.specific_to_list=['fbid:'+fa,aa];}if(!z[s.MANUAL_RETRY_CNT])z[s.MANUAL_RETRY_CNT]=0;};v.prototype.normalizeResendMessage=function(z){'use strict';z.status=i.RESENDING;z.timestamp=Date.now();z[s.MANUAL_RETRY_CNT]+=1;};v.prototype.normalizeAddAttachmentPlaceholder=function(z,aa,ba){'use strict';if(ba.preview_attachments.length>0){z.has_attachment=true;z.preview_attachments=ba.preview_attachments;}z.client_state=m.DO_NOT_SEND_TO_SERVER;z.status=i.RESENDING;z.upload_id=aa;};function w(z,aa,ba,ca){var da=x(ba)?[n.CHAT]:[],ea=Date.now(),fa=u(new Date(ea),'g:ia'),ga={action_type:aa,thread_id:ca,author:k.getParticipantIDFromUserID(z),author_email:null,timestamp:ea,timestamp_absolute:new Date(ea).toLocaleDateString(),timestamp_relative:fa,timestamp_time_passed:r.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:ba,source_tags:da};return ga;}function x(z){switch(z){case p.CHAT_WEB:case p.CHAT_JABBER:case p.CHAT_IPHONE:case p.CHAT_MEEBO:case p.CHAT_ORCA:case p.CHAT_TEST:case p.CHAT:case p.DESKTOP:return true;default:return false;}}var y=new o(v);f.exports=v;},null);
__d('MercuryMessageActions',['AsyncRequest','MessagingTag','MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();function p(q){this.$MercuryMessageActions1=q;this.$MercuryMessageActions2=l.getForFBID(this.$MercuryMessageActions1);this.__serverRequests=n.getForFBID(this.$MercuryMessageActions1);this.__dispatcher=k.getForFBID(this.$MercuryMessageActions1);}p.prototype.send=function(q,r,s){r=r||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(q);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers._extends({},q),m.CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(q,s);r(q.thread_id);};p.prototype.resend=function(q,r){var s=babelHelpers._extends({},q);this.$MercuryMessageActions2.normalizeResendMessage(s);this.send(s,undefined,r);};p.prototype.addAttachmentPlaceholder=function(q,r,s){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(q,r,s);this.$MercuryMessageActions2.normalizeNewMessage(q);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers._extends({},q),m.CLIENT_SEND_MESSAGE));};p.prototype.cancelAttachmentPlaceholder=function(q,r){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:q,upload_data:r,action_type:j.CANCEL_ATTACHMENT_PLACEHOLDER},m.CLIENT_SEND_MESSAGE));};p.prototype.confirmAttachmentPlaceholder=function(q,r){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:q,upload_data:r,action_type:j.CONFIRM_ATTACHMENT_PLACEHOLDER},m.CLIENT_SEND_MESSAGE));};p.prototype['delete']=function(q,r,s){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(q,r,j.DELETE_MESSAGES,s||m.CLIENT_DELETE_MESSAGES));};p.prototype.unwrap=function(q){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:q.thread_id,unwrapped_message_id:q.message_id,action_type:j.UNWRAP_MESSAGE},m.CLIENT_UNWRAP_MESSAGE));};p.prototype.__constructClientSingleMessagePayload=function(q,r){return {actions:[q],from_client:true,payload_source:r};};p.prototype.$MercuryMessageActions4=function(q,r){return {actions:[q],from_client:false,payload_source:r};};p.prototype.$MercuryMessageActions3=function(q,r,s,t){return {actions:[{action_type:s,action_id:null,thread_id:q,message_ids:r}],from_client:true,payload_source:t};};Object.assign(p,o);f.exports=p;},null);
__d('MercuryMessageError.react',['CurrentUser','ImmutableObject','MercuryErrorInfo','MercuryMessageActions','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'MercuryMessageError',propTypes:{authorFBID:o.string,message:o.instanceOf(i).isRequired},getDefaultProps:function(){return {authorFBID:h.getID()};},render:function(){var q=this.props.message,r=q.error_data;return (l.createElement('div',babelHelpers._extends({},this.props,{className:n(this.props.className,this._getClassNameFromStatus(q)),tabIndex:j.isTransient(r)?0:null,onClick:j.isTransient(r)?this.messageResend:null}),l.createElement('div',{className:"_2fs1"}),l.createElement('span',{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(q)}})));},messageResend:function(){k.getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(q){if(j.hasErrorStatus(q)){return "_2fs2"+(' '+"_2fs3")+(j.isTransient(q.error_data)?' '+"_2fs4":'')+(j.isPermanent(q.error_data)?' '+"_2fs5":'');}else return "_2fs6 _2fs2";},_getTextFromStatus:function(q){var r='',s=q.error_data;if(j.hasErrorStatus(q))r=j.getMessage(s);if(typeof r==='object'&&r.__html)r=r.__html;return r;}});f.exports=p;},null);
__d('PhotoStoreCore',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(i){if(!this._photoCache[i])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[i];},hasBeenCreated:function(i){return !!this._photoCache[i];},clearSetCache:function(i){delete this._photoCache[i];delete this._postCreateCallbacks[i];},getByIndex:function(i,j,k){this.getPhotoCache(i).getItemAtIndex(j,k);},getByIndexImmediate:function(i,j){if(this._photoCache[i])return this._photoCache[i].getItemAtIndexImmediate(j);return undefined;},getItemsInAvailableRange:function(i){var j=this.getAvailableRange(i),k=[];for(var l=j.offset;l<j.length;l++)k.push(this.getByIndexImmediate(i,l));return k;},getItemsAfterIndex:function(i,j,k,l){var m=this.getCursorByIndexImmediate(i,j);this.fetchForward(i,m,k,l);},getAllByIDImmediate:function(i){var j=Object.keys(this._photoCache);return j.map((function(k){return this.getByIndexImmediate(k,this.getIndexForID(k,i));}).bind(this)).filter(function(k){return !!k;});},getIndexForID:function(i,j){if(this._photoCache[i])return this._photoCache[i].getIndexForID(j);return undefined;},getEndIndex:function(i){var j=this.getAvailableRange(i);return j.offset+j.length-1;},getCursorByIndexImmediate:function(i,j){var k=this.getByIndexImmediate(i,j);if(k)return this._photoCache[i].getCursorForID(k.id);return undefined;},hasNextPage:function(i){var j=this.getCursorByIndexImmediate(i,this.getEndIndex(i));return this.getPhotoCache(i).hasNextPage(j);},getAvailableRange:function(i){return this.getPhotoCache(i).getAvailableRange();},hasLooped:function(i){return this.getPhotoCache(i).hasLooped();},fetchForward:function(i,j,k,l){this.getPhotoCache(i).getItemsAfterCursor(j,k,l);},fetchBackward:function(i,j,k,l){this.getPhotoCache(i).getItemsBeforeCursor(j,k,l);},executePostCreate:function(i,j){if(this._photoCache[i]){j&&j();}else this._postCreateCallbacks[i]=j;},runPostCreateCallback:function(i){var j=this._postCreateCallbacks[i];if(j){j();delete this._postCreateCallbacks[i];}},setPreFetchCallback:function(i,j){this.getPhotoCache(i).setPreFetchCallback(j);},updateData:function(i){var j=i.set_id;if(!this._photoCache[j]){this._photoCache[j]=new i.cache_class(i);this.runPostCreateCallback(j);}else if(i.query_metadata.action==h.actions.UPDATE){this._photoCache[j].updateData(i);}else this._photoCache[j].addData(i);},updateFeedbackData:function(i){var j=Object.keys(i);j.forEach(function(k){return h.getAllByIDImmediate(k).forEach(function(l){l.feedback=i[k].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach((function(i){return this.clearSetCache(i);}).bind(this));}};f.exports=h;},null);
__d("XMercuryThreadLikeIconController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});},null);
__d("XMessagingSaveNicknameController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessagingSaveThreadColorController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessagingSaveThreadEmojiController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d('MercuryThreadActions',['AsyncDialog','AsyncRequest','EmojiLikeConstants','IrisProtocolMessageLifetime','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryViewer','MessagingGenericAdminTextType','MessagingTag','XNFXMessengerBlockActionController','URI','XMercuryThreadLikeIconController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','MercuryAssert','XMessengerNotificationsSettingsDialogController','cssVar','MercuryMessageActions','MercuryMessageObject','MercuryThreads','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=c('MercuryMessageActions').get(),ja=c('MercuryMessageObject').get(),ka=c('MercuryThreads').get(),la=c('MercuryThreadIDMap').get();function ma(na){this.$MercuryThreadActions1=na;this.__serverRequests=t.getForFBID(this.$MercuryThreadActions1);this.__dispatcher=n.getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=s.getForFBID(this.$MercuryThreadActions1);}ma.prototype.markRead=function(na,oa){this.batchMarkRead([na],oa);};ma.prototype.batchMarkRead=function(na,oa){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(na,true,oa));};ma.prototype.markUnread=function(na,oa){this.batchMarkUnread([na],oa);};ma.prototype.batchMarkUnread=function(na,oa){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(na,false,oa));};ma.prototype.markSeen=function(na,oa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.MARK_THREAD_SEEN,r.CLIENT_MARK_THREAD_SEEN,{persistent:oa}));};ma.prototype.archive=function(na,oa){this.batchArchive([na],oa);};ma.prototype.batchArchive=function(na,oa){na.forEach((function(pa){this.__serverRequests.changeThreadArchivedStatus(pa,true,oa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(na,true));};ma.prototype.unarchive=function(na,oa){this.batchUnarchive([na],oa);};ma.prototype.batchUnarchive=function(na,oa){na.forEach((function(pa){this.__serverRequests.changeThreadArchivedStatus(pa,false,oa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(na,false));};ma.prototype.markSpam=function(na,oa){this.batchMarkSpam([na],oa);};ma.prototype.batchMarkSpam=function(na,oa){na.forEach((function(pa){this.__serverRequests.markThreadSpam(pa,oa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(na,y.SPAM));};ma.prototype.unmarkSpam=function(na,oa){this.batchUnmarkSpam([na],oa);};ma.prototype.batchUnmarkSpam=function(na,oa){na.forEach((function(pa){this.__serverRequests.unmarkThreadSpam(pa,oa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(na,y.INBOX));};ma.prototype.changeFolder=function(na,oa){this.batchChangeFolder([na],oa);};ma.prototype.batchChangeFolder=function(na,oa){na.forEach((function(pa){this.__serverRequests.changeThreadFolder(pa,oa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(na,oa));};ma.prototype['delete']=function(na,oa){this.batchDelete([na],oa);};ma.prototype.batchDelete=function(na,oa){na.forEach((function(pa){this.__serverRequests.deleteThread(pa,oa);}).bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(na,l.DELETE_THREAD,r.CLIENT_DELETE_THREAD));};ma.prototype.openNotificationSettings=function(na){fa.isThreadID(na);this.__threadIDMap.getServerIDFromClientID(na,function(oa){var pa=ga.getURIBuilder().setString('thread_key_id',oa).setBool('modify',false).getURI();new i().setURI(pa).send();});};ma.prototype.unmute=function(na){this.updateMuteSetting(na,0);};ma.prototype.updateMuteSetting=function(na,oa){this.__serverRequests.changeMutingOnThread(na,oa);this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.CHANGE_MUTE_SETTINGS,r.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:oa}));};ma.prototype.blockMessages=function(na){var oa=z.getURIBuilder().setInt('thread_fbid',o.getUserIDFromThreadID(na)).setEnum('location','www_chat_head').getURI();h.send(new i(oa));};ma.prototype.unblockMessages=function(na){var oa=JSON.stringify({reportable_ent_token:o.getUserIDFromThreadID(na),initial_action_name:q.block_messages});new i(new aa('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:oa})).send();};ma.prototype.turnOffSecretMode=function(na){if(ka.isEmptyLocalThread(na))return;ia.send(ja.constructLogMessageObject(v.TITAN_WEB,na,p.GENERIC_ADMIN_TEXT,{message_type:x.THREAD_EPHEMERAL_SEND_MODE,untypedData:{ttl:k.TTL_OFF}}),null,m.WEBMESSENGER);};ma.prototype.turnOnSecretMode=function(na){if(ka.isEmptyLocalThread(na))return;ia.send(ja.constructLogMessageObject(v.TITAN_WEB,na,p.GENERIC_ADMIN_TEXT,{message_type:x.THREAD_EPHEMERAL_SEND_MODE,untypedData:{ttl:k.TTL_1HOUR}}),null,m.WEBMESSENGER);};ma.prototype.leaveGroup=function(na){if(!ka.isEmptyLocalThread(na))ia.send(ja.constructLogMessageObject(v.TITAN_WEB,na,p.UNSUBSCRIBE,{removed_participants:[w.getID()]}),null,m.WEBMESSENGER);};ma.prototype.changeThreadColor=function(na,oa,pa){if(ka.isEmptyLocalThread(na))return;la.getServerIDFromClientID(na,function(qa){var ra={};if(oa!="#0084ff")ra.color_choice=oa;ra.thread_or_other_fbid=qa;var sa=da.getURIBuilder().setEnum('source',pa).getURI();new i(sa).setMethod('POST').setData(ra).send();});};ma.prototype.changeThreadEmoji=function(na,oa,pa){if(ka.isEmptyLocalThread(na))return;la.getServerIDFromClientID(na,function(qa){var ra={};if(oa!=j.THUMBS_UP_EMOJI)ra.emoji_choice=oa;ra.thread_or_other_fbid=qa;var sa=ea.getURIBuilder().setEnum('source',pa).getURI();new i(sa).setMethod('POST').setData(ra).send();});};ma.prototype.changeThreadNicknames=function(na,oa,pa,qa){if(ka.isEmptyLocalThread(na))return;la.getServerIDFromClientID(na,function(ra){var sa={thread_or_other_fbid:ra,participant_id:oa,nickname:pa},ta=ca.getURIBuilder().setEnum('source',qa).getURI();new i(ta).setMethod('POST').setData(sa).send();});};ma.prototype.addParticipants=function(na,oa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.ADD_PARTICIPANTS,r.CLIENT_ADD_PARTICIPANTS,{participants:oa}));};ma.prototype.unpinThread=function(na){this.__serverRequests.unpinThread(na);this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.UNPIN_THREAD,r.CLIENT_UNPIN_THREAD));};ma.prototype.updateCustomLike=function(na,oa){var pa=ba.getURIBuilder().setString('emoji',oa).getURI();new i().setURI(pa).setHandler((function(qa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.UPDATE_CUSTOM_LIKE,r.CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:qa.getPayload()}));}).bind(this)).send();};ma.prototype.movePendingToInbox=function(na){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.MOVE_PENDING_TO_INBOX,r.CLIENT_MOVE_PENDING_TO_INBOX));};ma.prototype.updateSnippet=function(na,oa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.UPDATE_SNIPPET,r.CLIENT_UPDATE_SNIPPET,{deleted_ids:oa}));};ma.prototype.$MercuryThreadActions2=function(na,oa,pa){return this.__constructClientPayload(na,l.CHANGE_READ_STATUS,r.CLIENT_CHANGE_READ_STATUS,{mark_as_read:oa,source:pa});};ma.prototype.$MercuryThreadActions3=function(na,oa){return this.__constructClientPayload(na,l.CHANGE_ARCHIVED_STATUS,r.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:oa});};ma.prototype.$MercuryThreadActions4=function(na,oa){return this.__constructClientPayload(na,l.CHANGE_FOLDER,r.CLIENT_CHANGE_FOLDER,{new_folder:oa});};ma.prototype.__constructClientPayload=function(na,oa,pa,qa){return {actions:na.map(function(ra){return babelHelpers._extends({action_type:oa,action_id:null,thread_id:ra},qa);}),from_client:true,payload_source:pa};};Object.assign(ma,u);f.exports=ma;},null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=k.activity_limit||60000,o=k.idle_limit||1800000,p=k.idle_poll_interval||300000,q=j.create('chat_activity'),r=Date.now(),s=true;function t(){var x=Date.now();return !!(s&&x-r<n);}var u=Object.assign(new h(),{isActive:t});function v(){var x=r;r=Date.now();if(r-x>o){q.debug('idle_to_active',x);l.doSync();}u.inform('activity');}i.listen(window,'focus',function(){s=true;v();});i.listen(window,'blur',function(){s=false;});m.subscribe(function(){v();});function w(x){var y=x&&x.at&&l.verifyNumber(x.at);if(typeof y!=='number')y=null;return y||0;}setInterval(function(){var x=Date.now(),y=w(l.get()),z=Math.max(r,y);if(x-z>o){q.debug('idle',{cookie:y,local:r});u.inform('idle',x-z);}},p);l.registerStateStorer(function(x){var y=w(x);if(y<r)x.at=r;return x;});h.subscribe(j.DUMP_EVENT,function(x,y){y.chat_activity={activity_limit:n,idle_limit:o,idle_poll_interval:p,last_active_time:r};});f.exports=u;},null);
__d('MercuryMessages',['BanzaiODS','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryDispatcher','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonMixin','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','invariant','isMessengerDotComURI','mergeDeep','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=new i(),ja=k.getInstance('mercury_messages');function ka(ta,ua){var va=ua;if(ta._localIdsMap[ua])va=ta._localIdsMap[ua];return ta._messages.get(va);}function la(ta){switch(ta){case s.UNKNOWN:case s.SERVER_INITIAL_DATA:case s.SERVER_FETCH_THREAD_INFO:case s.SERVER_THREAD_SYNC:return true;}return false;}function ma(ta,ua){if(!ta._threadsToMessages[ua])ta._threadsToMessages[ua]=new x(function(va){return ka(ta,va).timestamp;},function(va,wa){return wa-va;});return ta._threadsToMessages[ua];}function na(ta,ua,va){ua.forEach(function(wa){var xa=ma(ta,wa);xa.setReachedEndOfArray();ta._emitReorderedChange(wa,va);});}function oa(ta){this._fbid=ta;this._messageActions=u.getForFBID(this._fbid);this._serverRequests=z.getForFBID(this._fbid);this._threadInformer=ba.getForFBID(this._fbid);this._threads=ca.getForFBID(this._fbid);this._threadActions=aa.getForFBID(this._fbid);this._dispatcher=p.getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new l();this._localIdsMap={};this._dispatcher.subscribe('update-messages',(function(ua,va){var wa=(va.actions||[]).filter(function(ya){var za=ya.action_type,ab=(ya.is_forward||ya.thread_id)&&(za==n.LOG_MESSAGE||za==n.USER_GENERATED_MESSAGE||za==n.SEND_MESSAGE||za==n.DELETE_THREAD||za==n.DELETE_MESSAGES||za==n.MARK_MESSAGES_SPAM),bb=ya.upload_id&&ya.upload_data&&(za==n.CANCEL_ATTACHMENT_PLACEHOLDER||za==n.CONFIRM_ATTACHMENT_PLACEHOLDER),cb=ya.note&&za==n.CREATE_PAGE_ADMIN_NOTE,db=ya.replaced_message_id&&za==n.REPLACE_MESSAGE,eb=ya.unwrapped_message_id&&za==n.UNWRAP_MESSAGE;return ab||bb||cb||db||eb;}),xa=la(va.payload_source);this.handleUpdates(wa,xa,va.payload_source,va.from_client);if(va.end_of_history)na(this,va.end_of_history,va.payload_source);if(this._didChange){this._didChange=false;ia.emit('change');}}).bind(this));this._dispatcher.subscribe('invalidate-thread-state',(function(ua,va){this._invalidateThreadState(va);}).bind(this));this._dispatcher.subscribe('invalidate-global-state',(function(){return this.invalidateGlobalState();}).bind(this));ja.debug('constructed',JSON.stringify({fbid:this._fbid}));}Object.assign(oa.prototype,{getMessagesFromIDs:function(ta){return (ta||[]).map(ka.bind(null,this)).filter(function(ua){return ua;});},getServerMessageID:function(ta){var ua=ta;if(this._localIdsMap[ta])ua=this._localIdsMap[ta];return ua;},hasLoadedNMessages:function(ta,ua){var va=ma(this,ta);return va.hasReachedEndOfArray()||va.getCurrentArraySize()>=ua;},hasLoadedExactlyNMessages:function(ta,ua){var va=ma(this,ta);return va.getCurrentArraySize()==ua;},invalidateGlobalState:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new l();this._localIdsMap={};},getThreadMessagesRange:function(ta,ua,va,wa,xa,ya){var za=ma(this,ta),ab=(function(kb){wa(pa(this,kb));}).bind(this),bb=za.executeOrEnqueue(ua,va,ab),cb=za.getUnavailableResources(bb),db=this._failedHistoryFetchThreads[ta];if(cb.length&&!db){var eb=za.getCurrentArraySize(),fb=this._localTitanMessagesCount[ta]||0,gb=eb-fb,hb=cb.length+fb,ib=this.getCurrentlyLoadedMessages(ta),jb=ib.length?ib[0].timestamp:null;ja.debug('fetch_missing_messages',JSON.stringify({threadID:ta,offset:ua,limit:va,timestamp:jb,missingIndices:cb,messageCount:eb,localMessageCount:fb}));this._serverRequests.fetchThreadMessages(ta,gb,hb,jb,xa,ya);}else this._failedHistoryFetchThreads[ta]=false;return bb;},getThreadMessagesRangeNow:function(ta,ua,va){var wa=ma(this,ta),xa=[];for(var ya=ua;ya<ua+va;ya++){var za=wa.getResourceAtIndex(ya),ab=ka(this,za);ab&&xa.push(ab);}return xa;},getThreadMessagesSinceTimestamp:function(ta,ua){var va=ma(this,ta),wa=va.getElementsUntil(ua);return pa(this,wa);},hasLoadedAllMessages:function(ta){return ma(this,ta).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(ta){var ua=ma(this,ta).getAllResources();return pa(this,ua);},unsubscribe:function(ta,ua){o.isThreadID(ua);var va=ma(this,ua);va.unsubscribe(ta);},_addNewMessage:function(ta,ua){sa(ua);this._messages.set(ta,new j(ua));},_addNewPageAdminNote:function(ta,ua){var va=this._messages.get(ta);if(va){var wa=va.page_admin_notes?va.page_admin_notes.slice():[],xa=false,ya=true;for(var za=0;za<wa.length;++za)if(wa[za].id===ua.id){xa=true;ya=false;break;}else if((wa[za].id===null||wa[za].id===undefined)&&wa[za].body===ua.body){xa=true;wa[za]=ua;}if(!xa)wa.push(ua);if(ya){var ab={};ab.page_admin_notes=wa;this._updateMessage(ta,va,ab);}}},_updateMessage:function(ta,ua,va){var wa=j.set(ua,va);this._messages.set(ta,wa);return wa;},_shouldSortOutOfOrderMessages:function(ta,ua,va){if(ta==s.CLIENT_CHANNEL_MESSAGE){var wa=this.getThreadMessagesSinceTimestamp(ua,va);if(wa.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(ta===s.SERVER_INVALIDATE_THREAD_STATE||ta===s.SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;},_preprocessIncomingAction:function(ta,ua){var va=ta.action_type;if(ua==s.CLIENT_CHANNEL_MESSAGE&&va==n.USER_GENERATED_MESSAGE&&ta.offline_threading_id&&this._localIdsMap[ta.offline_threading_id]===ta.offline_threading_id){ta.client_message_id=ta.offline_threading_id;ta.status=m.SUCCESS;ta.action_type=n.SEND_MESSAGE;va=ta.action_type;}if(ua===s.CLIENT_CHANNEL_MESSAGE&&va==n.USER_GENERATED_MESSAGE){var wa=this._threads.getThreadMetaNow(ta.thread_id);if(wa&&wa.folder)ta.folder=wa.folder;}return ta;},handleUpdates:function(ta,ua,va,wa){var xa,ya={};for(var za=0;za<ta.length;za++){var ab=this._preprocessIncomingAction(ta[za],va),bb=ab.action_type,cb=ka(this,ab.message_id);if(bb==n.LOG_MESSAGE)if(this.isLocalMessage(ab))continue;if(ab.is_forward||va==s.SERVER_SEARCH){if(!this._messages.has(ab.message_id))this._addNewMessage(ab.message_id,ab);continue;}else if(ab.client_state===r.SEND_TO_SERVER){this._addNewMessage(ab.message_id,ab);continue;}else if(bb==n.SEND_MESSAGE){var db=ab.client_message_id;if(db&&this._localIdsMap[db]&&ab.status){var eb=ka(this,db),fb=eb.status;if(eb.status==m.SUCCESS)continue;if(!ya[ab.thread_id])ya[ab.thread_id]=[];this._updateLocalMessage(ab);if(typeof fb!==undefined||ab.status==m.FAILED_UNKNOWN_REASON||ab.status==m.UNABLE_TO_CONFIRM||ab.status==m.SUCCESS||ab.status==m.ERROR)this._emitUpdatedChange(ab.thread_id,ka(this,db).message_id,va);}continue;}else if(bb==n.DELETE_THREAD){ma(this,ab.thread_id).removeAllResources();continue;}else if(bb==n.DELETE_MESSAGES){this._deleteMessages(ab.thread_id,ab.message_ids,va);ha((function(){this._threadActions.updateSnippet(ab.thread_id,ab.message_ids);}).bind(this));continue;}else if(bb==n.CREATE_PAGE_ADMIN_NOTE){this._addNewPageAdminNote(ab.message_id,ab.note);this._emitUpdatedChange(ab.thread_id,ab.message_id,'link_shim');continue;}else if(ab.offline_threading_id&&this._localIdsMap[ab.offline_threading_id]||cb&&!cb.is_forward){if(cb&&ab.ranges&&ab.ranges.length>0){var gb=cb.message_id;this._updateMessage(this._localIdsMap[gb]||gb,cb,{ranges:ta.ranges});this._emitUpdatedChange(cb.thread_id,cb.message_id,'link_shim');}continue;}else if(bb===n.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(ab.upload_id,ab.upload_data);continue;}else if(bb===n.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(ab.upload_id,ab.upload_data);continue;}else if(bb==n.REPLACE_MESSAGE){if(this._replaceMessage(ab)){if(!ya[ab.thread_id])ya[ab.thread_id]=[];ya[ab.thread_id].push(ab.message_id);this._emitUpdatedChange(ab.thread_id,ab.replaced_message_id,va);this._emitUpdatedChange(ab.thread_id,ab.message_id,va);ua=true;}continue;}else if(bb==n.UNWRAP_MESSAGE){if(this._unwrapMessage(ab))this._emitUpdatedChange(ab.thread_id,ab.unwrapped_message_id,va);}else{if(va===s.CLIENT_SEND_MESSAGE){this._localIdsMap[ab.message_id]=ab.message_id;if(ab.thread_id=='root:'+ab.offline_threading_id)ma(this,ab.thread_id).setReachedEndOfArray();}if(bb==n.LOG_MESSAGE&&ab.log_message_type==q.SERVER_ERROR)this._failedHistoryFetchThreads[ab.thread_id]=true;if(ab.client_state===r.DO_NOT_SEND_TO_SERVER&&ab.upload_id)this._uploadMessages[ab.upload_id]=ab;if(!ya[ab.thread_id])ya[ab.thread_id]=[];ya[ab.thread_id].push(ab.message_id);this._addNewMessage(ab.message_id,ab);if(ab.offline_threading_id&&ab.offline_threading_id!=ab.message_id){this._localIdsMap[ab.offline_threading_id]=ab.message_id;v.addServerID(ab.offline_threading_id,ab.message_id);if(ab.threading_id)v.addServerID(ab.threading_id,ab.message_id);}if(ab[y.MANUAL_RETRY_CNT]>0){xa=ma(this,ab.thread_id);xa.resortResources([ab.message_id]);this._emitReorderedChange(ab.thread_id,s.CLIENT_SEND_MESSAGE);}ua=ua||this._shouldSortOutOfOrderMessages(va,ab.thread_id,ab.timestamp);if(!ua)this._emitReceivedChange(ka(this,ab.message_id));continue;}}for(var hb in ya){xa=ma(this,hb);var ib=xa.getAllResources(),jb=ib.filter((function(kb){var lb=this._messages.get(kb);if(!lb)return true;return lb.action_type==n.LOG_MESSAGE&&lb.log_message_type==q.SERVER_ERROR;}).bind(this));xa.removeResources(jb);if(wa)qa(this,hb,ya[hb]);if(ua){xa.addResources(ya[hb]);this._emitReorderedChange(hb,va);}else xa.addResourcesWithoutSorting(ya[hb].reverse(),0);this._threadInformer.updatedThread(hb);}this._didChange&&ja.debug('handle_updates',JSON.stringify({localMessageCounts:this._localTitanMessagesCount}));},isFirstMessage:function(ta){var ua=ma(this,ta.thread_id);if(ua.getCurrentArraySize()===0)return false;var va=ua.getResourceAtIndex(ua.getCurrentArraySize()-1),wa=ka(this,va).message_id,xa=ka(this,ta.message_id).message_id;return ua.hasReachedEndOfArray()&&wa==xa;},isLocalMessage:function(ta){if(ta.offline_threading_id!==null&&ta.offline_threading_id===ta.message_id)return true;if(ta.threading_id!==null&&ta.threading_id===ta.message_id)return true;return false;},_deleteMessages:function(ta,ua,va){if(!ua.length)return;this._deleteIndividualMessages(ta,ua,va);if(va!==s.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(ta,ua);},_deleteIndividualMessages:function(ta,ua,va){var wa=ua.map(function(ya){return ka(this,ya).message_id;},this),xa=ma(this,ta);xa.removeResources(wa);this._emitReorderedChange(ta,va);},_updateLocalMessage:function(ta){var ua=ka(this,ta.client_message_id),va={};va.status=ta.status;if(ta.status===m.SUCCESS||ta.error_data)va.error_data=ta.error_data;var wa=ta.message_id,xa=ta.client_message_id;if(this._messages.has(wa)){this._updateMessage(wa,ua,va);return false;}if(ta.threading_id)va.threading_id=ta.threading_id;if(ta.timestamp)va.timestamp=ta.timestamp;if(ta.log_message_data)va.log_message_data=ta.log_message_data;if(ta.ranges&&ta.ranges.length){sa(ta);va.ranges=ta.ranges;}if(ta.attachments&&ta.attachments.length){va.raw_attachments=null;va.attachments=ta.attachments;}this._localIdsMap[xa]=wa;v.addServerID(xa,wa);var ya=this._updateMessage(wa,ua,va);this._messages.set(xa,new j());if(ra(ya))this._localTitanMessagesCount[ya.thread_id]--;return true;},_replaceMessage:function(ta){var ua=ta.replaced_message_id,va=ka(this,ua);if(!va)return false;var wa={};wa.status=ta.status;if(ta.timestamp)wa.timestamp=ta.timestamp;if(ta.log_message_data)wa.log_message_data=ta.log_message_data;if(ta.ranges&&ta.ranges.length){sa(ta);wa.ranges=ta.ranges;}if(ta.attachments&&ta.attachments.length){wa.raw_attachments=null;wa.attachments=ta.attachments;}if(ta.body)wa.body=ta.body;var xa=ta.message_id;v.addServerID(xa,xa);this._updateMessage(xa,va,wa);this._messages['delete'](ua);return true;},_unwrapMessage:function(ta){var ua=ka(this,ta.unwrapped_message_id);if(!ua||!ua.tags)return false;var va=ua.tags.slice(0);va.push(w.UNWRAPPED_TAG);var wa={tags:va};this._updateMessage(ta.unwrapped_message_id,ua,wa);return true;},getNumberLocalMessages:function(ta){return this._localTitanMessagesCount[ta]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(ta,ua){var va=this._popPendingAttachmentMessage(ta,ua);delete va.preview_attachments;this._serverRequests.sendNewMessage(va);},_cancelAttachmentPlaceholder:function(ta,ua){var va=this._popPendingAttachmentMessage(ta,ua);this._deleteIndividualMessages(va.thread_id,[va.message_id]);if(this._localTitanMessagesCount[va.thread_id])this._localTitanMessagesCount[va.thread_id]--;},_popPendingAttachmentMessage:function(ta,ua){var va=this._uploadMessages[ta];!va?ea(0):undefined;va.image_ids=ua.image_ids;va.file_ids=ua.file_ids;va.audio_ids=ua.audio_ids;va.gif_ids=ua.gif_ids;va.video_ids=ua.video_ids;va.client_state=r.SEND_TO_SERVER;delete this._uploadMessages[ta];return va;},_emitUpdatedChange:function(ta,ua,va){this._didChange=true;this._threadInformer.updatedMessage(ta,ua,va);},_emitReceivedChange:function(ta){this._didChange=true;this._threadInformer.receivedMessage(ta);},_emitReorderedChange:function(ta,ua){this._didChange=true;this._threadInformer.reorderedMessages(ta,ua);},_invalidateThreadState:function(ta){if(!this._threadsToMessages[ta])return;var ua=this._threadsToMessages[ta].getAllResources();ua.forEach((function(va){var wa=ka(this,va).offline_threading_id;this._messages['delete'](va);var xa=this._localIdsMap[wa];if(xa)this._messages['delete'](xa);delete this._localIdsMap[va];delete this._localIdsMap[wa];}).bind(this));delete this._threadsToMessages[ta];}});Object.assign(oa,t,{addListener:function(ta,ua){return ia.addListener(ta,ua);}});function pa(ta,ua){var va=ua.map(ka.bind(null,ta));return va.reverse();}function qa(ta,ua,va){var wa=va.filter(function(xa){return ra(ka(ta,xa));});if(!ta._localTitanMessagesCount[ua])ta._localTitanMessagesCount[ua]=0;ta._localTitanMessagesCount[ua]+=wa.length;}function ra(ta){var ua=ta.action_type;if(ua==n.USER_GENERATED_MESSAGE)return true;switch(ta.log_message_type){case q.SUBSCRIBE:case q.UNSUBSCRIBE:case q.SERVER_ERROR:case q.LIVE_LISTEN:return false;default:return true;}}function sa(ta){if(!ta.ranges)return;ta.ranges.forEach(function(ua){if(!ua.entity||ua.entity.external||!ua.entity.url)return;var va=new da(ua.entity.url);if(fa(da.getRequestURI())&&!va.getDomain()){va.setProtocol('https').setDomain('www.facebook.com');ua.entity.url=va.toString();}});}f.exports=oa;},null);
__d('MercuryNotificationRenderer',['MercuryAssert','MercuryIDs','MercuryParticipants','MercuryViewer','fbt','MercuryMessages','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryMessages').get(),n=c('MercuryThreads').get();function o(p,q){h.isThreadID(p);n.getThreadMeta(p,function(r){m.getThreadMessagesRange(p,0,1,function(s){var t=s.length&&s[s.length-1];if(t&&t.author!=k.getID()){j.get(t.author,function(u){var v=u.short_name;if(r.custom_nickname){var w=i.getUserIDFromParticipantID(u.id);if(r.custom_nickname[w])v=r.custom_nickname[w];}if(r.name){q(l._("{senderName} messaged {groupName}",[l.param('senderName',v),l.param('groupName',r.name)]));}else if(i.isGroupChat(p)){q(l._("{name} messaged your group",[l.param('name',v)]));}else q(l._("{name} messaged you",[l.param('name',v)]));});}else q(l._("New message!"));});});}f.exports={renderDocumentTitle:o};},null);
__d('ChatTitleBarBlinker',['ChatActivity','ChatConfig','DocumentTitle','JSLogger','MercuryNotificationRenderer','PresenceState','MercuryThreadInformer','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=c('MercuryThreadInformer').get(),o=c('MercuryTimestampTracker').get(),p=k.create('chat_title'),q=null,r=0,s=false;function t(){if(q){q.stop();q=null;return true;}return false;}function u(z){var aa=z||o.getLastUserMessageTimestamp();if(r<=aa){r=aa;if(t()||s)m.doSync();}}var v={blink:function(z,aa){if(!q&&r<aa)l.renderDocumentTitle(z,function(ba){if(!q)q=j.blink(ba);});},stopBlinking:function(){u();},blinkingElsewhere:function(){s=true;}};function w(z){var aa=m.verifyNumber(z.sb2);if(!aa||aa<=r)return null;return aa;}function x(z){var aa=z&&w(z);if(aa){r=aa;p.debug('load',r);t();s=false;}}function y(z){var aa=w(z);if(!aa){p.debug('store',r);z.sb2=r;s=false;}return z;}m.registerStateStorer(y);m.registerStateLoader(x);n.subscribe('thread-read-changed',function(z,aa){var ba=o.getLastUserMessageTimestamp(),ca=0;for(var da in aa)if(aa[da].mark_as_read&&aa[da].timestamp>=ba&&aa[da].timestamp>ca)ca=aa[da].timestamp;ca&&u(ca);});h.subscribe('activity',function(){u();});(function(){var z=m.getInitial();if(z)r=w(z)||0;})();f.exports=v;},null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();m.getForFBID=function(o){return n.getForFBID(o);};m.get=function(){return n.get();};function m(o){this.$MercuryBlockedParticipants1=o;this.$MercuryBlockedParticipants2=new l();this.$MercuryBlockedParticipants3=j.getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',(function(p,q){if(q.message_blocked_ids)this.$MercuryBlockedParticipants2=new l(q.message_blocked_ids);var r=q.actions||q.global_actions;for(var s=r,t=Array.isArray(s),u=0,s=t?s:s[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var v;if(t){if(u>=s.length)break;v=s[u++];}else{u=s.next();if(u.done)break;v=u.value;}var w=v;if(w.action_type!==i.UPDATE_BLOCKER_STATUS)continue;if(w.message_blocked){this.$MercuryBlockedParticipants4(w.thread_fbid);}else this.$MercuryBlockedParticipants5(w.thread_fbid);}}).bind(this));}m.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};m.prototype.setIDs=function(o){this.$MercuryBlockedParticipants2=o;};m.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};m.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};m.prototype.$MercuryBlockedParticipants4=function(o){this.$MercuryBlockedParticipants2.add(h.getParticipantIDFromUserID(o));};m.prototype.$MercuryBlockedParticipants5=function(o){this.$MercuryBlockedParticipants2['delete'](h.getParticipantIDFromUserID(o));};m.prototype.isMessageBlocked=function(o){if(!o.is_canonical)return false;var p=o.participants.filter((function(q){return q!=h.getParticipantIDFromUserID(this.getFBID());}).bind(this));return !p.every((function(q){return !this.$MercuryBlockedParticipants2.has(q);}).bind(this));};m.prototype.isPresentInGroupThread=function(o){if(!o.is_canonical&&this.$MercuryBlockedParticipants7(o).length>0)return true;return false;};m.prototype.inGroupThread=function(o){if(o.is_canonical)return [];return this.$MercuryBlockedParticipants7(o);};m.prototype.$MercuryBlockedParticipants7=function(o){var p=o.participants.filter((function(r){return r!=h.getParticipantIDFromUserID(this.getFBID());}).bind(this)),q=p.filter((function(r){return this.$MercuryBlockedParticipants2.has(r)!==false;}).bind(this));return q;};var n=new k(m);f.exports=m;},null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={messageMentionsViewer:function(k,l){i.get(h.getID(),function(m){l(new RegExp('@'+m.firstName,'i').test(k.body));});}};f.exports=j;},null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','isFacebookURI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=null,p={init:function(t){if(!o)i.init(t);},play:function(t,u,v){if(o){j.playRemote(o.contentWindow,t,u,false);}else j.playLocal(t,u,v);},stop:function(t){if(!o)i.stop(t);}},q=new l(location.href);if(q.getSubdomain()&&q.getSubdomain()!=='www')q.setSubdomain('www');var r=q.getDomain();function s(){if(m.ie()<9)return false;if(h.RPC_DISABLED)return false;return k.isSupported()&&j.supportsRPC();}if(n(q)&&location.host!==r&&s()){o=document.createElement('iframe');o.setAttribute('src','//'+r+'/sound_iframe.php');o.style.display='none';document.body.appendChild(o);}f.exports=p;},null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','MercuryConfig','MercuryGroupThreadMentions','MercuryThreadInfo','MercuryViewer','MessagingTag','Sound','MercuryBlockedParticipants','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=c('MercuryBlockedParticipants').get(),t=c('MercuryThreads').get();r.init(['audio/ogg','audio/mpeg']);function u(w){if(k.getSetting('sound'))r.play([j.get('sound.notif_ogg_url'),j.get('sound.notif_mp3_url')],w,false);}var v={messageReceived:function(w){if(p.isViewer(w.author)||!w.is_unread||w.folder!=q.INBOX&&w.folder!=q.ARCHIVED)return;var x=w.thread_id,y=i.isActive();if(y){var z=false;v.inform('before-alert',{threadID:x,cancelAlert:function(){z=true;}});}t.getThreadMeta(x,function(aa){var ba=o.isMuted(aa);n.messageMentionsViewer(w,function(ca){if(ba&&(!m.GroupChatMentionsGK||!ca))return;if(s.isPresentInGroupThread(aa))return;var da=w.timestamp;if(y){!z&&u(da);}else{l.blink(x,da);u(da);}l.blinkingElsewhere();});});}};f.exports=Object.assign(v,h);},null);
__d('MessagingGiftWrap.react',['CurrentEnvironment','ReactComponentWithPureRenderMixin','React','cx','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=j.PropTypes,n=j.createClass({displayName:'MessagingGiftWrap',mixins:[i],propTypes:{isSticker:m.bool,onUnwrap:m.func},getDefaultProps:function(){return {onUnwrap:l};},getInitialState:function(){return {unwrapped:false};},render:function(){var o=h.messengerdotcom;return (j.createElement('div',{className:"_4p0m"+(this.state.unwrapped?' '+"_4p0o":'')+(o?' '+"_mxz":'')+(o?' '+"_4br2":'')+(!o?' '+"_3_om":'')+(this.props.isSticker?' '+"_52vq":''),onClick:this._handleClick},j.createElement('div',{className:"_4p0r"}),j.createElement('div',{className:"_4p0s _4p0t"}),j.createElement('div',{className:"_4p0s _4p0u"})));},_handleClick:function(o){o.stopPropagation();this.setState({unwrapped:true});this.props.onUnwrap&&this.props.onUnwrap();}});f.exports=n;},null);
__d('MercuryXMATRenderer',['MercuryIDs','MercuryParticipants','MessagingGenericAdminTextType','React','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={renderText:function(n){var o=n.log_message_body;switch(n.log_message_data.message_type){case j.TURN_ON_PUSH:var p=n.log_message_data.untypedData&&n.log_message_data.untypedData.recipient_id,q=p&&i.getNow(h.getParticipantIDFromUserID(p)),r=h.getUserIDFromParticipantID(n.author),s=i.getNow(h.getParticipantIDFromUserID(r));if(r!==n.other_user_fbid){if(q){o=l._("You asked {admin-text-message} to turn on notifications for Messenger on mobile.",[l.param('admin-text-message',q.name)]);}else o=l._("You asked a contact to turn on notifications for Messenger on mobile.");}else if(s){o=l._("{admin-text-message} asked you to turn on notifications for Messenger on mobile.",[l.param('admin-text-message',s.name)]);}else o=l._("A contact asked you to turn on notifications for Messenger on mobile.");break;case j.JOURNEY_PROMPT_COLOR:o=l._("You need to be on the latest version of Messenger on a mobile device to pick a color for this conversation.");break;case j.JOURNEY_PROMPT_NICKNAME:var t=null,u=h.getUserIDFromParticipantID(n.author);if(n.other_user_fbid&&u!==n.other_user_fbid){var v=h.getParticipantIDFromUserID(n.other_user_fbid);t=i.getOrFetch(v);}if(t&&t.short_name){o=l._("You need to be on the latest version of Messenger on a mobile device to set a nickname for {admin-text-message} .",[l.param('admin-text-message',t.short_name)]);}else o=l._("You need to be on the latest version of Messenger on a mobile device to set a nickname for yourself.");break;case j.JOURNEY_PROMPT_LIKE:o=l._("You need to be on the latest version of Messenger on a mobile device to pick an emoji for this conversation.");break;case j.JOURNEY_PROMPT_BOT:o=l._("You need to be on the latest version of Messenger on a mobile device to add a subscription to this conversation.");break;default:break;}return k.createElement('span',null,o);}};f.exports=m;},null);
__d('PhotoStore',['Arbiter','PhotoStoreCore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();h.subscribe('update-photos',function(j,k){i.updateData(k);});f.exports=i;},null);
__d('MessagesViewer',['AsyncRequest','Bootloader','DOM','MessagesViewerSetID','PhotoStore','React','ReactDOM','Run','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r={bootstrapWithElem:function(u){r.bootstrapWithConfig({fbid:u.getAttribute('data-fbid'),dimensions:u.getAttribute('data-dimensions'),src:u.getAttribute('href'),endpoint:u.getAttribute('data-endpoint'),disablePaging:u.getAttribute('data-disablepaging')},u);},bootstrapWithConfig:function(u,v){var w=u.setID;if(!w)w=k.MESSAGES;t(function(x,y){s(m.createElement(x,{actorid:u.actorid,dimensions:[u.dimensions],disablepaging:u.disablePaging,disableForward:u.disableForward,open:true,photoid:u.fbid,reverse:false,rootClassName:u.rootClassName,setid:w,snapToPhoto:u.snapToPhoto,thumbsrc:u.src}));if(!l.hasBeenCreated(w)&&u.endpoint){var z=new h(u.endpoint);if(v)z.setRelativeTo(v);z.send();}});},renderVideo:function(u){t(function(v,w){s(m.createElement(w,u));});},preload:function(){o.onAfterLoad(function(){return t(p);});}};function s(u){var v=q('messages_viewer');if(!v){v=j.create('div',{id:'messages_viewer'});document.body.appendChild(v);}u=n.render(u,v);u.subscribeOnce('close',function(){n.unmountComponentAtNode(v);});}function t(u){i.loadModules(["SpotlightMessagesViewer","MessagingVideoViewer.react"],u);}f.exports=r;},null);
__d('MercuryLogMessageRenderer',['Bootloader','CSS','HovercardLink','MercuryViewer','MercuryXMATRenderer','MessagesViewer','MercuryLogMessageType','MercuryParticipants','React','ReactDOM','Image.react','TextWithEntities.react','TooltipLink.react','UserAgent','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y={renderText:function(na,oa){switch(na.log_message_type){case n.SUBSCRIBE:ba(na,oa);break;case n.UNSUBSCRIBE:ga(na,oa);break;case n.THREAD_NAME:ha(na,oa);break;case n.THREAD_IMAGE:ia(na,oa);break;case n.WALLPAPER:ja(na,oa);break;case n.GENERIC_ADMIN_TEXT:ka(na,oa);break;default:h.loadModules(["MercurySpecialLogMessageRenderer"],function(pa){pa.renderText(na,oa);});break;}},renderIcon:function(na){return (p.createElement(r,{className:z(na),src:x('images/spacer.gif')}));},renderLegacy:function(na,oa,pa,qa){z(qa).split(' ').forEach(function(ra){return ra&&i.addClass(na,ra);});this.renderText(qa,function(ra){q.render(p.createElement('span',null,ra),oa);});this.renderAttachmentLegacy(pa,qa);},renderAttachmentLegacy:function(na,oa){if(oa.log_message_type==n.THREAD_IMAGE){var pa=oa.log_message_data.image;if(pa&&pa.preview_url){q.render(p.createElement(r,{className:"_z6a",onClick:function(){return aa(pa);},src:pa.preview_url}),na);i.show(na);}}}};f.exports=y;function z(na){var oa=na.log_message_type,pa=na.log_message_data;return "_5wzu"+(oa==n.SUBSCRIBE?' '+"_5wzj":'')+(oa==n.UNSUBSCRIBE?' '+"_5wzk":'')+(oa==n.THREAD_NAME?' '+"_5wzl":'')+(oa==n.THREAD_IMAGE?' '+"_5wzm":'')+(oa==n.VIDEO_CALL&&pa.answered?' '+"_5wzn":'')+(oa==n.VIDEO_CALL&&!pa.answered?' '+"_5wzo":'')+(oa==n.PHONE_CALL&&pa.answered?' '+"_5wzp":'')+(oa==n.PHONE_CALL&&!pa.answered?' '+"_5wzq":'')+(oa==n.SERVER_ERROR?' '+"_5wzr":'');}function aa(na){m.bootstrapWithConfig({src:na.preview_url,endpoint:na.url,fbid:na.metadata.fbid,dimensions:na.metadata.dimensions,disablePaging:true},null);}function ba(na,oa){var pa=ma(na.log_message_data.added_participants);switch(pa.length){case 1:ca(na,oa,pa);break;case 2:da(na,oa,pa);break;case 3:ea(na,oa,pa);break;default:fa(na,oa,pa);break;}}function ca(na,oa,pa){var qa=[na.author,pa[0]];o.getMulti(qa,function(ra){if(na.author==k.getID()){oa(w._("You added {subscriber1}.",[w.param('subscriber1',la(ra[pa[0]]))]));}else if(pa[0]==k.getID()){oa(w._("{actor} added you.",[w.param('actor',la(ra[na.author]))]));}else oa(w._("{actor} added {subscriber1}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ra[pa[0]]))]));});}function da(na,oa,pa){var qa=[na.author].concat(pa);o.getMulti(qa,function(ra){if(na.author==k.getID()){oa(w._("You added {subscriber1} and {subscriber2}.",[w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]]))]));}else if(pa[0]==k.getID()){oa(w._("{actor} added you and {subscriber2}.",[w.param('actor',la(ra[na.author])),w.param('subscriber2',la(ra[pa[1]]))]));}else oa(w._("{actor} added {subscriber1} and {subscriber2}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]]))]));});}function ea(na,oa,pa){var qa=[na.author].concat(pa);o.getMulti(qa,function(ra){if(na.author==k.getID()){oa(w._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]])),w.param('subscriber3',la(ra[pa[2]]))]));}else if(pa[0]==k.getID()){oa(w._("{actor} added you, {subscriber2} and {subscriber3}.",[w.param('actor',la(ra[na.author])),w.param('subscriber2',la(ra[pa[1]])),w.param('subscriber3',la(ra[pa[2]]))]));}else oa(w._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]])),w.param('subscriber3',la(ra[pa[2]]))]));});}function fa(na,oa,pa){var qa=[na.author].concat(pa);o.getMulti(qa,function(ra){function sa(ua){var va=p.createElement('div',null,ua.map(function(wa){return p.createElement('div',null,wa.name);}));return (p.createElement(t,{alignH:'center',position:'above',tooltip:va},w._({"*":"{num} more"},[w.param('num',ua.length,[0])])));}var ta=pa.map(function(ua){return ra[ua];});if(na.author==k.getID()){oa(w._("You added {subscriber1}, {subscriber2} and {more_people}.",[w.param('subscriber1',la(ta[0])),w.param('subscriber2',la(ta[1])),w.param('more_people',sa(ta.slice(2)))]));}else if(pa[0]==k.getID()){oa(w._("{actor} added you, {subscriber2} and {more_people}.",[w.param('actor',la(ra[na.author])),w.param('subscriber2',la(ta[1])),w.param('more_people',sa(ta.slice(2)))]));}else oa(w._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ta[0])),w.param('subscriber2',la(ta[1])),w.param('more_people',sa(ta.slice(2)))]));});}function ga(na,oa){var pa=[na.author],qa=na.log_message_data.removed_participants,ra;if(qa.length===1){ra=qa[0];pa.push(ra);}o.getMulti(pa,function(sa){var ta=sa[na.author],ua=sa[ra];if(na.author==k.getID()){if(!ra||ra==na.author){oa(w._("You left the conversation."));}else oa(w._("You removed {name} from the conversation.",[w.param('name',la(ua))]));}else if(!ra||ra==na.author){oa(w._("{actor} left the conversation.",[w.param('actor',la(ta))]));}else if(ra==k.getID()){oa(w._("{actor} removed you from the conversation.",[w.param('actor',la(ta))]));}else oa(w._("{actor} removed {name} from the conversation.",[w.param('actor',la(ta)),w.param('name',la(ua))]));});}function ha(na,oa){var pa=na.log_message_data.name,qa="_5wzs"+(u.isBrowser('Chrome')?' '+"_4fbd":'');if(na.author==k.getID()){if(pa){oa(w._("You named the conversation: {name}.",[w.param('name',p.createElement('span',{className:qa},p.createElement(s,{renderEmoticons:true,renderEmoji:true,text:pa})))]));}else oa(w._("You removed the conversation name."));}else o.get(na.author,function(ra){var sa=la(ra);if(pa){oa(w._("{actor} named the conversation: {name}.",[w.param('actor',sa),w.param('name',p.createElement('span',{className:qa},p.createElement(s,{renderEmoticons:true,renderEmoji:true,text:pa})))]));}else oa(w._("{actor} removed the conversation name.",[w.param('actor',sa)]));});}function ia(na,oa){if(na.author==k.getID()){if(na.log_message_data.image){oa(w._("You changed the conversation picture."));}else oa(w._("You removed the conversation picture."));}else o.get(na.author,function(pa){var qa=la(pa);if(na.log_message_data.image){oa(w._("{actor} changed the conversation picture.",[w.param('actor',qa)]));}else oa(w._("{actor} removed the conversation picture.",[w.param('actor',qa)]));});}function ja(na,oa){if(na.author==k.getID()){oa(w._("You changed the wallpaper."));}else o.get(na.author,function(pa){var qa=la(pa);oa(w._("{actor} changed the wallpaper.",[w.param('actor',qa)]));});}function ka(na,oa){var pa=l.renderText(na);oa(pa);}function la(na,oa){var pa=na.fbid,qa=j.constructEndpoint({id:pa});if(na.href)return (p.createElement('a',{className:"_5wzt",href:na.href,'data-hovercard':qa},oa?na.short_name:na.name));return na.name;}function ma(na){var oa=na.indexOf(k.getID());if(oa>0){var pa=na.filter(function(qa){return qa!==k.getID();});return [k.getID()].concat(pa);}return na;}},null);
__d('MercuryShareAttachmentRenderLocations',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={CHAT:'chat',CHAT_PREVIEW:'chat_preview',MESSENGER:'messenger',WEB_INBOX:'web_inbox',getValues:function(){return [h.CHAT,h.CHAT_PREVIEW,h.MESSENGER,h.WEB_INBOX];},isPreview:function(i){return i===h.CHAT_PREVIEW;}};f.exports=h;},null);
__d('MercuryMeMessageProcessor',['ImmutableObject','MercuryActionType','MercuryConfig','MercuryLogMessageType','MercuryParticipants'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(o){if(!o)return false;if(!j.MessengerRenderMeAsAdminMessageGK)return false;if(o.action_type!==i.USER_GENERATED_MESSAGE)return false;var p=o.body;if(typeof p==='string'&&p.startsWith('/me ')&&p.length>4)return true;return false;}function n(o){var p=l.getOrFetch(o.author),q=p?p.short_name:'/me',r=o.body.replace('/me',q);o=h.set(o,{action_type:i.LOG_MESSAGE,body:r,log_message_body:r,log_message_data:{message_type:'',untypedData:{}},log_message_type:k.GENERIC_ADMIN_TEXT});return o;}f.exports={transform:n,shouldTransform:m};},null);
__d('MercuryMessageGroup',['MercuryActionType','MercuryAttachmentType','MercuryMeMessageProcessor','MercuryShareAttachmentRenderLocations','MercuryThreadlistConstants','enumerate'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={calculateMessageGroups:function(q,r){var s=[],t=null,u={value:null},v=m(q),w;while(!(w=v.next()).done){var x=n.canAppendMessageToLastGroup(u.value,w.value,r);if(!x){t=[];s.push(t);}t.push(w.value);u=w;}return s;},canAppendMessageToLastGroup:function(q,r,s){var t=l.GROUPING_THRESHOLD;if(!q||o(q,s)||o(r,s)||q.author!=r.author||q.timestamp<r.timestamp-t||q.is_spoof_warning!==r.is_spoof_warning||q.page_admin_notes)return false;return true;}};function o(q,r){var s=q.has_attachment;if(s&&(r===k.MESSENGER||r===k.CHAT))s=p(q);return !!(q.action_type==h.LOG_MESSAGE||j.shouldTransform(q)||s||q.forward_count||q.html_body||q.body&&q.body.length>l.MAX_CHARS_BEFORE_BREAK);}function p(q){var r=q.attachments[0];return (!r||r.attach_type===i.STICKER||r.attach_type===i.ANIMATED_IMAGE);}f.exports=n;},null);
__d('MercuryTypingReceiver',['Arbiter','ChannelConstants','FBID','MercuryActionType','MercuryIDs','MercuryPayloadSource','MercuryDispatcher','MercurySingletonMixin','MercuryViewer','TypingStates','isEmpty','mixInEventEmitter','setTimeoutAcrossTransitions','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryThreadIDMap').get(),v=30000;function w(x){'use strict';this.$MercuryTypingReceiver1=null;this.$MercuryTypingReceiver2={};this.$MercuryTypingReceiver3=n.getForFBID(x);this.$MercuryTypingReceiver3.subscribe('update-typing-state',(function(z,aa){var ba=aa.payload_source;if(ba!=m.CLIENT_CHANNEL_MESSAGE)return;var ca=aa.actions;if(!ca||!ca.length)return;var da=k.USER_GENERATED_MESSAGE;ca.forEach((function(ea){if(ea.action_type==da&&ea.author!=p.getID())this.$MercuryTypingReceiver4(ea.thread_id,ea.author);}).bind(this));}).bind(this));var y;if(j.isUser(x)){y=[i.getArbiterType('typ'),i.getArbiterType('ttyp')];}else y=[i.getArbiterType('page_typing')];h.subscribe(y,(function(z,aa){var ba=aa.obj,ca=this.$MercuryTypingReceiver5(ba);if(ca){var da=l.getParticipantIDFromUserID(ba.from);if(ba.st==q.TYPING){this.$MercuryTypingReceiver2[ca]=this.$MercuryTypingReceiver2[ca]||{};var ea=this.$MercuryTypingReceiver2[ca][da];this.$MercuryTypingReceiver2[ca][da]=Date.now();if(!this.$MercuryTypingReceiver1)this.$MercuryTypingReceiver1=t((function(){this.$MercuryTypingReceiver6();}).bind(this),3000);!ea&&this.$MercuryTypingReceiver7(ca);}else if(ba.st==q.INACTIVE)this.$MercuryTypingReceiver4(ca,da);}}).bind(this));}w.prototype.$MercuryTypingReceiver8=function(x){'use strict';var y=this.$MercuryTypingReceiver2[x]||{},z=Object.keys(y);z.sort(function(aa,ba){return y[aa]-y[ba];});return z;};w.prototype.$MercuryTypingReceiver6=function(){'use strict';this.$MercuryTypingReceiver1=null;var x=Date.now(),y={},z=false;for(var aa in this.$MercuryTypingReceiver2){var ba=false;for(var ca in this.$MercuryTypingReceiver2[aa]||{})if(this.$MercuryTypingReceiver2[aa][ca]<x-v){delete this.$MercuryTypingReceiver2[aa][ca];ba=true;}else z=true;if(ba)y[aa]=this.$MercuryTypingReceiver8(aa);}if(!r(y))this.$MercuryTypingReceiver9(y);if(z)this.$MercuryTypingReceiver1=t((function(){this.$MercuryTypingReceiver6();}).bind(this),3000);};w.prototype.$MercuryTypingReceiver4=function(x,y){'use strict';if(x in this.$MercuryTypingReceiver2)if(y in this.$MercuryTypingReceiver2[x]){delete this.$MercuryTypingReceiver2[x][y];this.$MercuryTypingReceiver7(x);}};w.prototype.$MercuryTypingReceiver9=function(x){'use strict';this.releaseHeldEventType('state-changed');this.emitAndHold('state-changed',x);};w.prototype.$MercuryTypingReceiver7=function(x){'use strict';var y={};y[x]=this.$MercuryTypingReceiver8(x);this.$MercuryTypingReceiver9(y);};w.prototype.$MercuryTypingReceiver5=function(x){'use strict';if(x.thread_fbid)return u.getClientIDFromServerIDNow(x.thread_fbid.toString());if(x.type==='typ'||x.type==='page_typing')return l.getThreadIDFromUserID(x.from);return null;};s(w,{'state-changed':true});Object.assign(w,o);f.exports=w;},null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s,t=l.SUCCESS;r=babelHelpers.inherits(u,p(i));s=r&&r.prototype;u.getForFBID=function(y){'use strict';return v.getForFBID(y);};u.get=function(){'use strict';return v.get();};function u(y){'use strict';s.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=y;this.$MercuryRoger4=m.getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=o.getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',(function(z,aa){for(var ba in aa){var ca=this.$MercuryRoger1[ba]||j.OrderedMap();ca=ca.withMutations((function(da){for(var ea in aa[ba]){var fa=this.$MercuryRoger5.getThreadMetaNow(ba);if(fa&&fa.participants)if(fa.participants.indexOf(ea)==-1){this.$MercuryRoger2.push(x(this.$MercuryRoger1));continue;}var ga=da.get(ea),ha=aa[ba][ea];if(!ga||ha>ga)da.set(ea,ha);}}).bind(this));this.$MercuryRoger1[ba]=ca.sort();}aa&&this.inform('change',aa);}).bind(this));this.$MercuryRoger4.subscribe('invalidate-global-state',(function(){this.$MercuryRoger6();}).bind(this));h.subscribe(k.DUMP_EVENT,(function(z,aa){aa.bad_read_receipts={receipts:this.$MercuryRoger2};}).bind(this));}u.prototype.getSeenBy=function(y,z){'use strict';if(!y)return [];var aa=[],ba=this.$MercuryRoger1[y.thread_id];if(!ba)return aa;ba.forEach(function(ca,da){if(w(y,ca,da,z))aa.push(da);});return aa;};u.prototype.wasSeenByAll=function(y){'use strict';if(!y)return false;var z=this.$MercuryRoger1[y.thread_id];if(!z)return false;return z.every(function(aa,ba){return w(y,aa,ba);});};u.prototype.getSeenTimestamps=function(y){'use strict';var z=this.$MercuryRoger1[y];if(!z){z=j.OrderedMap();this.$MercuryRoger1[y]=z;}return z;};u.prototype.getSeenTimestamp=function(y,z){'use strict';var aa=this.$MercuryRoger1[y];return aa?aa.get(z):null;};u.prototype.$MercuryRoger6=function(){'use strict';this.$MercuryRoger1={};this.$MercuryRoger2=[];};var v=new n(u);function w(y,z,aa,ba){return !!(z>=y.timestamp&&(y.status===undefined||y.status===t)&&(!ba||aa!=y.author));}function x(y){return q(y,function(z){return z.toJS();});}f.exports=u;},null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','setTimeoutAcrossTransitions','MercuryMessages','MercuryRoger','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryMessages').get(),n=c('MercuryRoger').get(),o=c('MercuryThreadInformer').get(),p=c('MercuryThreads').get(),q={},r={},s=k['roger.seen_delay'],t={getSeenBy:function(z,aa){if(r[z])return [];return n.getSeenBy(u(z),aa);},wasSeenByAll:function(z){if(r[z])return false;return n.wasSeenByAll(u(z));}};Object.assign(t,h);function u(z){if(!q[z]){var aa=p.getThreadMetaNow(z);if(aa)q[z]={thread_id:z,author:aa.participants[0],timestamp:aa.timestamp};}return q[z];}function v(z){var aa=false;m.getThreadMessagesRange(z,0,1,function(ba){var ca=ba[0];if(!ca)return;var da=ca.timestamp;if(ca.action_id||ca.status==j.SUCCESS)da-=i.getServerTimeOffset();var ea=t.getSeenBy(z);if(r[z]){clearTimeout(r[z]);delete r[z];}var fa=da+s,ga=fa-Date.now();if(ga>0)r[z]=l(function(){delete r[z];w(z);},ga);q[z]=ca;var ha=t.getSeenBy(z);if(ea.length||ha.length)aa=true;});return aa;}function w(z){var aa={};aa[z]=true;x(aa);}function x(z){t.inform('state-changed',z);t.inform('change');}function y(event,z){var aa={};for(var ba in z)if(v(ba))aa[ba]=true;for(var ca in aa){x(aa);break;}}n.subscribe('change',function(z,aa){for(var ba in aa)!r[ba]&&w(ba);});o.subscribe('messages-received',y);o.subscribe('messages-reordered',y);o.subscribe('messages-updated',y);f.exports=t;},null);
__d('MercuryIndicatorController',['ArbiterMixin','DOM','MercuryActionType','MercuryDelayedRoger','MercuryIDs','MercuryMessageSourceTags','MercuryParticipants','MercuryViewer','WorkModeConfig','arrayContains','formatDate','removeFromArray','fbt','MercuryRoger','MercuryThreads','MercuryTypingReceiver'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryRoger').get(),v=c('MercuryThreads').get(),w=c('MercuryTypingReceiver').get(),x=[];function y(z){this._threadID=z;this._canonicalUser=l.getUserIDFromThreadID(z);x.push(this);}Object.assign(y.prototype,h,{destroy:function(){s(x,this);},setLastMessage:function(z){this._lastMsg=z;this._handleStateChange();},_informStateChanged:function(z){if(z.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&o.isViewer(this._lastMsg.author))z.self_authored=true;this._currentActivity=z.activity;this.inform('state-changed',z);},_notifySentFrom:function(){var z,aa,ba=this._lastMsg.source_tags||[];if(q(ba,m.MESSENGER)){if(!p.is_work_user){z=i.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},t._("Sent from Messenger"));}else z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Work Chat"));aa='sentFromMobile';}else if(q(ba,m.MOBILE)){z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Mobile"));aa='sentFromMobile';}else if(q(ba,m.EMAIL)){z=t._("Sent from email");aa='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:aa,text:z});},_notifySeenTimestamp:function(z){var aa=u.getSeenTimestamp(this._threadID,z[0])*.001,ba=Date.now()*.001,ca;if(aa<ba-518400){ca='M j';}else if(aa<ba-86400){ca='D g:ia';}else ca='g:ia';this._informStateChanged({activity:'seen-timestamp',text:t._("Seen {timestamp}",[t.param('timestamp',r(aa,ca))])});},_nameNormalizer:function(z){var aa;n.getMulti(z,function(ba){function ca(ea){if(ba[ea]!==undefined&&ba[ea].short_name){return ba[ea].short_name.toLowerCase();}else return ea;}var da=z.map(ca);aa=function(ea){var fa=ca(ea),ga=da.indexOf(fa)!==da.lastIndexOf(fa);return ga?ba[ea].name:ba[ea].short_name;};});return aa;},_seenByEveryone:function(z,aa,ba){var ca=ba?ba.participants.length:0,da=z.length;if(aa.author!=o.getID()&&(!ba||ba.participants.indexOf(aa.author)>-1))da++;return ca>2&&da>=ca-1;},_notifySeenBy:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,(function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea=null;if(da&&da.custom_nickname)ea=da.custom_nickname;var fa=[];for(var ga in ca){var ha=ca[ga],ia=ha.short_name;if(ea&&ea[ha.fbid])ia=ea[ha.fbid];fa[ga]=ia;}var ja,ka=false;if(this._seenByEveryone(z,aa,da)){ja=t._("Seen by everyone");}else if(z.length==1){ja=t._("Seen by {user}",[t.param('user',fa[z[0]])]);}else if(z.length==2){ja=t._("Seen by {user1}, {user2}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]])]);}else if(z.length==3){ja=t._("Seen by {user1}, {user2}, {user3}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]]),t.param('user3',fa[z[2]])]);}else if(z.length>3){var la=Object.keys(ca).length-2,ma=t._({"*":"{num} more"},[t.param('num',la,[0])]),na=i.create('span',{className:'more'},ma);ja=t._("Seen by {user1}, {user2}, {=num more link}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]]),t.param('=num more link',na)]);ka=true;}this._informStateChanged({activity:'seen-by',text:ja,seenBy:z,tooltip:ka});}).bind(this));ba&&this._informStateChanged({activity:'none'});},_notifyTyping:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,(function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea=da?da.participants.length:0,fa;if(da)fa=this._nameNormalizer(da.participants);if(!fa)fa=function(la){return ca[la].short_name;};var ga,ha=false;if(ea>2&&z.length>=ea-1){ga=t._("Everyone is typing...");}else if(z.length==1){ga=t._("{name} is typing...",[t.param('name',ca[z[0]].short_name)]);}else if(z.length==2){ga=t._("{user1} and {user2} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name)]);}else if(z.length==3){ga=t._("{user1}, {user2}, and {user3} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('user3',ca[z[2]].short_name)]);}else if(z.length>3){var ia=Object.keys(ca).length-2,ja=t._({"*":"{num} more"},[t.param('num',ia,[0])]),ka=i.create('a',{href:'#'},ja);ga=t._("{user1}, {user2}, and {=num more link} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('=num more link',ka)]);ha=true;}this._informStateChanged({activity:'typing',text:ga,typing:z,tooltip:ha});}).bind(this));ba&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var z=j.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==z){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=o.getID()){this._notifySentFrom();return;}var aa=k.getSeenBy(this._threadID,true);if(aa.length)if(this._canonicalUser){this._notifySeenTimestamp(aa);return;}else{this._notifySeenBy(aa);return;}this._informStateChanged({activity:'none'});}});w.addRetroactiveListener('state-changed',function(z){x.forEach(function(aa){var ba=z[aa._threadID];if(ba!==undefined){aa._typing=ba;aa._handleStateChange();}});});k.subscribe('state-changed',function(z,aa){x.forEach(function(ba){aa[ba._threadID]&&ba._handleStateChange();});});f.exports=y;},null);
__d('MercuryLastMessageIndicator.react',['DOM','MercuryIndicatorController','MercuryParticipants','React','ReactDOM','TooltipData','cx','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r=k.createClass({displayName:'MercuryLastMessageIndicator',propTypes:{hideTyping:q.bool,indicatorWillShow:q.func,indicatorDidShow:q.func,lastMessage:q.object,threadID:q.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:o,indicatorDidShow:o};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(s){if(s.threadID!=this.props.threadID){this._destroy();this._setup(s);}else if(s.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(s.lastMessage);},componentWillUpdate:function(s,t){if(this.isVisible(s,t))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (k.createElement('div',{className:this.getRootClass()},k.createElement('div',{className:"_510h"}),k.createElement('span',{className:"_510f",ref:'text'},'')));},getRootClass:function(){var s="_510g"+(this.state.data.self_authored?' '+"_510e":''),t=this.state.data.activity,u=null;if(String(t).startsWith('seen')){u='seen';}else if(t=='typing'){u=this.props.hideTyping?null:t;}else u=t;return p(s,u,this.props.className);},isVisible:function(s,t){s=s||this.props;t=t||this.state;return (t.data&&t.data.activity!='none'&&!(s.hideTyping&&t.data.activity=='typing'));},setText:function(){if(this.state.data.text)h.setContent(l.findDOMNode(this.refs.text),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)j.getMulti(this.state.data.seenBy,(function(s){var t=h.create('div',null,this.state.data.seenBy.map(function(u){return h.create('div',null,s[u].name);}));m.set(h.find(l.findDOMNode(this),'span.more'),t,'above','center');}).bind(this));},_setup:function(s){this._controller=new i(s.threadID);this._subscription=this._controller.subscribe('state-changed',(function(t,u){return this.setState({data:u});}).bind(this));s.lastMessage&&this._controller.setLastMessage(s.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});f.exports=r;},null);
__d('MessengerContextBannerBootloader',['BootloadedComponent.react','CurrentUser','DOM','JSResource','React','ReactDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(q,r,s,t,u){var v=j.create('div');o(q,r,function(w){m.render(w,v,s(v));},t,u);}function o(q,r,s,t,u,v){v=babelHelpers._extends({left:0,position:'absolute',right:0,top:0},v);p({otherUserFBIDs:t&&[t],threadID:q,style:v},r,s,u);}function p(q,r,s,t){s(l.createElement(h,babelHelpers._extends({bootloadPlaceholder:l.createElement('div',{style:{height:80}}),bootloadLoader:k('MessengerContextBannerContainer.react'),location:r,onResize:t,viewer:i.getID()},q)));}f.exports={bootload:n,getBootloadedComponent:o};},null);
__d('MessengerHotLikePreviewEvents',['mixInEventEmitter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={START:'start',STOP:'stop',POP:'pop',REMOVE:'remove',FINISH_ANIMATION:'finish_animation'};h(i,{start:true,stop:true,pop:true,remove:'remove',finish_animation:'finish_animation'});f.exports=i;},null);
__d('StickersDispatcher',['Dispatcher_DEPRECATED','StickerConstants'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=Object.assign(new h(),{_handleUpdate:function(k,l){var m=babelHelpers._extends({payloadSource:k},l);this.dispatch(m);},handleUpdateFromViewActions:function(k){this._handleUpdate(i.PayloadSource.VIEW_ACTION,k);}});f.exports=j;},null);
__d('StickerActions',['BanzaiLogger','StickersDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j({ADD_PACK:null,CLICKED_STICKER_IN_THREAD:null,HIDE_TRAY:null,REMOVE_PACK:null,REPLACE_STICKER_STATE:null,RESET_NUM_NEW_PACKS:null,SELECT_PACK:null,SELECT_STORE_PACK:null,SHOW_TRAY:null,UPDATE_TRAY_DATA:null,TRAY_DATA_READY:null}),l={Types:k,addPack:function(m){i.dispatch({type:k.ADD_PACK,packID:m});},removePack:function(m){i.dispatch({type:k.REMOVE_PACK,packID:m});},selectPack:function(m,n){if(!n)h.log('StickersLoggerConfig',{event:'select_pack',packid:m});i.dispatch({type:k.SELECT_PACK,packID:m});},selectStorePack:function(m){i.dispatch({type:k.SELECT_STORE_PACK,packID:m});},resetNumNewPacks:function(){i.dispatch({type:k.RESET_NUM_NEW_PACKS});},handleStickerClick:function(m,n){i.dispatch({packID:m,threadID:n,type:l.Types.CLICKED_STICKER_IN_THREAD});},showStickerTray:function(m){i.dispatch({type:l.Types.SHOW_TRAY,threadID:m});},hideStickerTray:function(){i.dispatch({type:l.Types.HIDE_TRAY});},updateTrayData:function(){i.dispatch({type:l.Types.UPDATE_TRAY_DATA});},loadedTrayData:function(){i.dispatch({type:l.Types.TRAY_DATA_READY});}};f.exports=l;},null);
__d("XStickerPackImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int",defaultValue:50}});},null);
__d("XStickerQueryImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/query\/images\/",{query:{type:"String",required:true},sticker_interface:{type:"String"}});},null);
__d("XStickerStateInitialDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/",{});},null);
__d("XStickerStatePackDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});},null);
__d("XStickerStateStoreDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/store\/",{});},null);
__d("XStickersAddPackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/addpack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},is_promoted:{type:"Bool",defaultValue:false},no_async_dom:{type:"Bool",defaultValue:false}});},null);
__d("XStickersRemovePackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/removepack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},no_async_dom:{type:"Bool",defaultValue:false}});},null);
__d('StickerServerRequests',['Promise','AsyncRequest','XStickerPackImagesController','XStickersAddPackController','XStickersRemovePackController','XStickerStateInitialDataController','XStickerStatePackDataController','XStickerStateStoreDataController','XStickerQueryImagesController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q={addPack:function(s,t,u){var v=k.getURIBuilder().setInt('pack_id',s).setBool('is_promoted',t).getURI();new i(v).setHandler(function(w){return u(w.payload);}).send();},removePack:function(s,t){var u=l.getURIBuilder().setInt('pack_id',s).getURI();new i(u).setHandler(function(v){return t(v.payload);}).send();},getStickersForPack:function(s,t){var u=j.getURIBuilder().setInt('pack_id',s).setInt('sticker_size',t).getURI();return new h(function(v,w){return (new i().setURI(u).setMethod('GET').setReadOnly(true).setHandler(function(x){return v(x.payload);}).send());});},getStickersForQuery:function(s,t,u){new i().setURI(p.getURIBuilder().setString('query',s).setString('sticker_interface',t).getURI()).setMethod('GET').setReadOnly(true).setHandler(function(v){return u(v);}).send();},fetchTrayData:function(s){return r(m.getURIBuilder().getURI(),s,true);},fetchStoreData:function(s){return r(o.getURIBuilder().getURI(),s);},fetchPackData:function(s,t){return r(n.getURIBuilder().setInt('pack_id',s).getURI(),t);}};function r(s,t,u){return new h(function(v,w){return (new i(s).setHandler(function(x){return v(x.getPayload());}).setAllowCrossPageTransition(u).send());}).then(t);}f.exports=q;},null);
__d('StickerImages',['StickerServerRequests'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={},j={},k={requestStickersForPack:function(l,m,n){if(!l)return;if(!j[l]){j[l]=h.getStickersForPack(l,m);j[l].then((function(o){o.forEach((function(p){return this.cacheSticker(p);}).bind(this));}).bind(this));}j[l].then(function(o){return n(o);});},cacheSticker:function(l){i[l.id]=l;},getSticker:function(l){return i[l];}};f.exports=k;},null);
__d('StickerState',['ImmutableObject','StickerConfig','PresenceState','StickerActions','StickerConstants','StickerImages','StickerServerRequests'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o={},p,q,r,s=null,t=0,u={},v=[],w=[],x=[],y=null,z=null,aa=j.get();if(aa)y=aa.tray_pack_id;var ba=i.ShowStickerReplyNUX,ca={onTrayDataReady:function(ea){if(!q)q=n.fetchTrayData(function(fa){v=fa.packs.map(function(ga){return da(ga);});r=fa.mru;t=fa.num_new_packs;x=fa.tags;});q.then(function(){ea();k.loadedTrayData();});},onStoreDataReady:function(ea){if(!p)p=n.fetchStoreData(function(fa){w=fa.packs.map(function(ga){return da(ga);});});p.then(ea);},onPackDataReady:function(ea,fa){if(!o[ea])o[ea]=n.fetchPackData(ea,function(ga){da(ga);});o[ea].then(fa);},getPacksInTrayAllInterfaces:function(){return v;},getPacksInTray:function(){var ea=[],fa;for(var ga=0;ga<v.length;ga++)if(v[ga].id==l.EMOTICON_PACK_ID){fa=v[ga];}else if(v[ga].isMessengerCapable)ea.push(v[ga]);fa&&ea.push(fa);return ea;},getPacksInCommentsTray:function(){var ea=[],fa=[],ga;for(var ha=0;ha<v.length;ha++)if(v[ha].id==l.EMOTICON_PACK_ID){ga=v[ha];}else if(v[ha].isCommentsCapable){ea.push(v[ha]);}else fa.push(v[ha]);var ia=ea.concat(fa);if(ga)ia.push(ga);return ia;},getPacksInComposerTray:function(){return v.filter(function(ea){return ea.isComposerCapable;});},getPacksInFramesTray:function(){return v.filter(function(ea){return ea.isFramePack;});},getPackIDsInTray:function(){return v.map(function(ea){return ea.id;});},getPacksInStore:function(){return w.filter(function(ea){return ea.isMessengerCapable;});},getComposerPacksInStore:function(){return w.filter(function(ea){return ea.isComposerCapable;});},getPack:function(ea){return u[ea];},getNumNewPacks:function(){return t;},getFeaturedTags:function(){return x;},resetNumNewPacks:function(){t=0;},addMRUPack:function(){if(r){this._addPackToTray(r);r=null;}},addPack:function(ea){var fa=false;if(u[ea])fa=u[ea].isPromoted;n.addPack(ea,fa,(function(ga){this._addPackToTray(ga);}).bind(this));},removePack:function(ea){n.removePack(ea,function(fa){v=v.filter(function(ga){return ga.id!==fa;});u[fa]=h.set(u[fa],{isInTray:false});w=w.map(function(ga){return u[ga.id];});k.updateTrayData();});},setTrayPackID:function(ea){y=ea;j.doSync();},getTrayPackID:function(ea){if(ea&&ea.length>0&&!ea.some(function(fa){return fa.id===y;})){return ea[0].id;}else return y;},setStorePackID:function(ea){z=ea;},getStorePackID:function(){return z;},shouldShowStickerReplyNUX:function(){return ba;},clearShowStickerReplyNUX:function(){ba=false;},_addPackToTray:function(ea,fa){da(ea);u[ea.id]=h.set(u[ea.id],{isPurchased:!fa,isInTray:true});var ga=v.filter(function(ia){return ia.id===ea.id;}).length>0;if(!ga){var ha;if(!fa){ha=v.filter(function(ia){return ia.isMRU||ia.isSearch;}).length;}else ha=v.filter(function(ia){return ia.id!==l.EMOTICON_PACK_ID;}).length;v.splice(ha,0,u[ea.id]);}w=w.map(function(ia){return u[ia.id];});k.updateTrayData();},_addRecentlyUsedSticker:function(ea){for(var fa=0;fa<s.length;++fa)if(s[fa].id===ea.id){s.splice(fa,1);break;}s.unshift(ea);},getMRUStickerPack:function(ea){if(!s)s=ea;return s;},updateRecentlyUsed:function(ea){if(!s){this.addMRUPack();return;}this._addRecentlyUsedSticker(m.getSticker(ea));}};j.registerStateStorer(function(ea){ea.tray_pack_id=y;});function da(ea){var fa=ea.id;if(!u[fa]){return u[fa]=new h(ea);}else return u[fa]=h.set(u[fa],ea);}f.exports=ca;},null);
__d('AbstractDialogFitHeight',['CSS','DOM','Event','Style','SubscriptionsHandler','Vector','csx','cx','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=450,r=100,s=67,t=67;function u(v){'use strict';this.$AbstractDialogFitHeight1=v;}u.prototype.enable=function(){'use strict';this.$AbstractDialogFitHeight2=new l();this.$AbstractDialogFitHeight2.addSubscriptions(this.$AbstractDialogFitHeight1.subscribe('beforeshow',this.$AbstractDialogFitHeight3.bind(this)),j.listen(window,'resize',p(this.$AbstractDialogFitHeight3.bind(this))));this.$AbstractDialogFitHeight4=i.find(this.$AbstractDialogFitHeight1.getRoot(),"._4-i2");h.addClass(this.$AbstractDialogFitHeight4,"_5pfh");this.$AbstractDialogFitHeight5=r;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._4-i0").length)this.$AbstractDialogFitHeight5+=s;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._5a8u").length)this.$AbstractDialogFitHeight5+=t;};u.prototype.disable=function(){'use strict';this.$AbstractDialogFitHeight2.release();this.$AbstractDialogFitHeight2=null;h.removeClass(this.$AbstractDialogFitHeight4,"_5pfh");};u.prototype.$AbstractDialogFitHeight3=function(){'use strict';var v=m.getViewportDimensions().y,w=v-this.$AbstractDialogFitHeight5;k.set(this.$AbstractDialogFitHeight4,this.getHeightProperty(),Math.max(q,w)+'px');this.$AbstractDialogFitHeight1.updatePosition();};f.exports=u;},null);
__d('DialogFitHeight',['AbstractDialogFitHeight'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.getHeightProperty=function(){'use strict';return 'height';};function k(){'use strict';i.apply(this,arguments);}f.exports=k;},null);
__d('StickerStoreController',['Bootloader','DialogFitHeight','DOM','LayerAutoFocus','LayerFadeOnHide','LayerHideOnEscape','React','ReactComponentRenderer','StickerActions','XUIDialog.react','XUIDialogBody.react','XUISpinner.react','cx','isSocialPlugin','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=n.PropTypes,x=688,y=320,z=null,aa=n.createClass({displayName:'StoreLayer',propTypes:{isComposer:w.bool,shown:w.bool},getDefaultProps:function(){return {isComposer:false,shown:false};},getInitialState:function(){return {renderStore:function(){return (n.createElement('div',{className:"_5r5e"},n.createElement(s,{background:'light',size:'large'})));}};},componentDidMount:function(){h.loadModules(["StickerStore.react"],(function(da){this.setState({renderStore:(function(){return (n.createElement(da,{isComposer:this.props.isComposer,shown:this.props.shown}));}).bind(this)});}).bind(this));},_onToggle:function(da){v(function(){if(z)z.setProps({shown:da});});},render:function(){var da=u()&&document.body.offsetWidth<x?y:x;return (n.createElement(q,{behaviors:{DialogFitHeight:i,LayerAutoFocus:k,LayerFadeOnHide:l,LayerHideOnEscape:m},onToggle:this._onToggle,shown:this.props.shown,width:da},n.createElement(r,{className:"_5rq- autofocus"},this.state.renderStore())));}});function ba(da){var ea=j.create('div');j.appendContent(document.body,ea);z=new o(aa,ea);z.setProps({isComposer:da,shown:true});}var ca={showStore:function(da,ea){if(!z){ba(!!ea);}else z.setProps({shown:true,isComposer:!!ea});p.selectStorePack(da);}};f.exports=ca;},null);
__d('MercuryParticipantListRenderer',['fbt','MercuryIDs'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(){this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=false;this.$MercuryParticipantListRenderer4=0;this.$MercuryParticipantListRenderer5=null;this.$MercuryParticipantListRenderer6=(function(t){if(this.$MercuryParticipantListRenderer5){var u=i.getUserIDFromParticipantID(t.id);if(this.$MercuryParticipantListRenderer5[u])return this.$MercuryParticipantListRenderer5[u];}return this.$MercuryParticipantListRenderer2?t.short_name:t.name;}).bind(this);}j.prototype.renderParticipantList=function(t){var u=t.map(this.$MercuryParticipantListRenderer6);switch(u.length){case 0:return k(this.$MercuryParticipantListRenderer1);case 1:return l(u);case 2:return this.$MercuryParticipantListRenderer3?n(u):m(u);case 3:return this.$MercuryParticipantListRenderer3?p(u):o(u);default:return this.$MercuryParticipantListRenderer3?r(u,this.$MercuryParticipantListRenderer4):q(u,this.$MercuryParticipantListRenderer4);}};j.prototype.setIsNewThread=function(t){this.$MercuryParticipantListRenderer1=t;return this;};j.prototype.setNameRenderer=function(t){this.$MercuryParticipantListRenderer6=t;return this;};j.prototype.setUseShortName=function(t){this.$MercuryParticipantListRenderer2=t;return this;};j.prototype.setNickname=function(t){this.$MercuryParticipantListRenderer5=t;return this;};j.prototype.setUseAndSeparator=function(t){this.$MercuryParticipantListRenderer3=t;return this;};j.prototype.setTotalParticipantCount=function(t){this.$MercuryParticipantListRenderer4=t;return this;};function k(t){if(t){return h._("New Message");}else return h._("No Participants");}function l(t){return t[0];}function m(t){return h._("{participant1}, {participant2}",[h.param('participant1',t[0]),h.param('participant2',t[1])]);}function n(t){return h._("{participant1} and {participant2}",[h.param('participant1',t[0]),h.param('participant2',t[1])]);}function o(t){return h._("{participant1}, {participant2}, {participant3}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('participant3',t[2])]);}function p(t){return h._("{participant1}, {participant2} and {participant3}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('participant3',t[2])]);}function q(t,u){return h._("{participant1}, {participant2}, {participant3}, {others_link}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('participant3',t[2]),h.param('others_link',s((u||t.length)-3))]);}function r(t,u){return h._("{participant1}, {participant2} and {others_link}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('others_link',s((u||t.length)-2))]);}function s(t){if(t>1){return h._({"*":"{others_count} others"},[h.param('others_count',t,[0])]);}else return h._("1 other");}f.exports=j;},null);
__d('MercuryThreadTitle.react',['MercuryIDs','MercuryParticipantListRenderer','MercuryParticipants','React','TextWithEmoticons.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'MercuryThreadTitle',propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (k.createElement('span',{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=k.createElement(l,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=h.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});j.getMulti(r,(function(s){if(!this.isMounted())return;var t=r.map(function(x){return s[x];}),u=p.thread.custom_nickname?p.thread.custom_nickname:null,v=new i().setUseShortName(p.useShortName).setUseAndSeparator(p.useAndSeparator).setIsNewThread(p.isNewThread).setNickname(u).renderParticipantList(t),w=p.showUnreadCount&&p.thread.unread_count?this._renderTitleWithUnreadCount(v,p.thread.unread_count):v;this.setState({participantNames:w});}).bind(this));},_renderTitleWithUnreadCount:function(p,q){return m._("{conversation-title} ({unread-count})",[m.param('conversation-title',p),m.param('unread-count',q)]);}});f.exports=o;},null);
__d('FBRTCAvailability',['ChannelConstants','PresenceStatus'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={isCallable:function(k){var l=i.getCapabilities(k),m=h.CAPABILITY_VOIP_INTEROP|h.CAPABILITY_VIDEO;return !!(l&m);}};f.exports=j;},null);
__d('FBRTCCallabilityActions',['keyMirror'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h({CALLABILITY_FETCHED:null,CALLABILITY_FETCH_ERROR:null});function j(k){this.$FBRTCCallabilityActions1=k;}j.prototype.callabilityFetched=function(k,l){this.$FBRTCCallabilityActions1.dispatch({type:i.CALLABILITY_FETCHED,userID:k,callability:l});};j.prototype.callabilityFetchError=function(k){this.$FBRTCCallabilityActions1.dispatch({type:i.CALLABILITY_FETCH_ERROR,userID:k});};j.Types=i;f.exports=j;},null);
__d("XRTCCallabilityController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/rtc\/callability\/",{user_id:{type:"Int",required:true}});},null);
__d('FBRTCCallabilityDataManager',['AsyncRequest','FBRTCCallabilityActions','XRTCCallabilityController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(l){this.$FBRTCCallabilityDataManager1=new i(l);}k.prototype.fetchCallability=function(l){var m=j.getURIBuilder().setInt('user_id',parseInt(l,10)).getURI(),n=this.$FBRTCCallabilityDataManager2.bind(this,l),o=this.$FBRTCCallabilityDataManager3.bind(this,l);new h().setURI(m).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).send();};k.prototype.$FBRTCCallabilityDataManager2=function(l,m){this.$FBRTCCallabilityDataManager1.callabilityFetched(l,m.payload);};k.prototype.$FBRTCCallabilityDataManager3=function(l,m){this.$FBRTCCallabilityDataManager1.callabilityFetchError(l);};f.exports=k;},null);
__d('RTCCallabilityStore',['Cache','FBRTCAvailability','FluxStore','FBRTCCallabilityActions','FBRTCCallabilityDataManager','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;'use strict';var p=.5,q=5;n=babelHelpers.inherits(r,j);o=n&&n.prototype;function r(s){o.constructor.call(this,s);this.$RTCCallabilityStore1=new l(s);this.$RTCCallabilityStore2=new h();}r.prototype.__onDispatch=function(s){var t=s.type;switch(t){case k.Types.CALLABILITY_FETCHED:var u=s.userID,v=s.callability;this.$RTCCallabilityStore2.set(u,v.is_callable,null,v.is_callable?q:p);this.__emitChange();break;case k.Types.CALLABILITY_FETCH_ERROR:this.$RTCCallabilityStore2.set(s.userID,false,null,p);this.__emitChange();break;}};r.prototype.isCallable=function(s){if(i.isCallable(s))return true;if(!this.$RTCCallabilityStore2.has(s)){this.$RTCCallabilityStore1.fetchCallability(s);this.$RTCCallabilityStore2.set(s,false,null,p);}return !!this.$RTCCallabilityStore2.get(s);};r.prototype.callButtonTooltip=function(s,t){if(this.isCallable(s))return m._("Start a video call with {shortname}",[m.param('shortname',t)]);return m._("{shortname} is currently unavailable for video calling",[m.param('shortname',t)]);};r.prototype.voiceCallButtonTooltip=function(s,t){if(this.isCallable(s))return m._("Start a voice call with {shortname}",[m.param('shortname',t)]);return m._("{shortname} is currently unavailable for voice calling",[m.param('shortname',t)]);};f.exports=r;},null);
__d('FBRTCCallabilityStore',['FBRTCDispatcher','RTCCallabilityStore'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new i(h);},null);
__d('ContextualLayerAutoFlipHorizontal',['ContextualLayerAutoFlip'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.getValidPositions=function(l){'use strict';return [l.getPosition()];};function k(){'use strict';i.apply(this,arguments);}f.exports=k;},null);
__d('MessengerContextualDialog.react',['ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=12,n=k.createClass(j.createSpec({addedBehaviors:[h,i],displayName:'MessengerContextualDialog',shouldSetARIAProperties:false,theme:{wrapperClassName:"_1r_9",arrowDimensions:{offset:m,length:16}}}));f.exports=n;},null);
__d('P2PAbstractSendMoneyButton.react',['React','TooltipLink.react','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=h.PropTypes,n=h.createClass({displayName:'P2PAbstractSendMoneyButton',propTypes:{button:m.object,isActive:m.bool.isRequired,isDisabled:m.bool,isMessenger:m.bool.isRequired,onClick:m.func.isRequired,onMouseOver:m.func,recipientName:m.string},_clickGuard:false,render:function(){return (h.createElement(i,{alignH:'center',className:l(this.props.className,(this.props.isActive?"open":'')+(this.props.isDisabled?' '+"disabled":'')+(this.props.isActive?' '+"_10gz":'')+(this.props.isDisabled?' '+"_10g-":'')+(!this.props.isMessenger&&!this.props.className?' '+"_5uqy":'')+(this.props.isMessenger?' '+"_3ggc":'')),href:'#',onClick:this._handleClick,onMouseDown:this._prepareForClick,onMouseOver:this.props.onMouseOver,position:'above',role:'button',title:this._getLinkTitle()},this.getButton()));},getButton:function(){if(this.props.button)return this.props.button;return h.createElement('i',{className:"_5s8l"});},_getLinkTitle:function(){if(this.props.isDisabled)return null;return k._("Send Money");},_prepareForClick:function(){this.props.onMouseDown&&this.props.onMouseDown();this._clickGuard=this.props.isActive;},_handleClick:function(o){o.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}this.props.onClick();}});f.exports=n;},null);
__d('MessengerDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('MessengerURIConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={COMPOSE_SUBPATH:'/new',GROUPS_PATH:'/groups',PEOPLE_PATH:'/people',FILTERED_REQUESTS_PATH:'/filtered',MESSAGE_REQUESTS_PATH:'/requests',THREAD_PREFIX:'/t/',GROUP_PREFIX:'group-'};f.exports=h;},null);
__d('MessengerStateProcessor',['MercuryAPIArgsSource','MercuryIDs','MercuryParticipantTypes','MercuryParticipants','MercuryThreadIDMap','MercuryThreads','MercuryVanityIDMap','MessengerURIConstants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p={preprocess:function(r){var s=r.activeThreadID;if(s){var t=i.getUserIDFromThreadID(s),u=t&&k.getNow(i.getParticipantIDFromUserID(t));if(u&&u.type!==j.EVENT){r.threadKey=u.vanity||t;}else if(t&&!u){var v=i.getParticipantIDFromUserID(t);r.threadKey=n.hasID(v)?n.getVanity(v):t;}else{var w=l.get(),x=w.getServerIDFromClientIDNow(s);r.threadKey=x||s;}}delete r.activeThreadID;return r;},postprocess:function(r){var s=l.get(),t=m.get(),u=q(r.threadKey),v;v=i.isValid(u)?u:s.getClientIDFromServerIDNow(u);if(!v){var w=k.getIDFromVanityOrFBID(u),x=w&&t.getCanonicalThreadToParticipant(w,null,h.MESSENGER);if(x)v=x.thread_id;}if(v){r.activeThreadID=v;r.serverThreadID=s.getServerIDFromClientIDNow(v);}delete r.threadKey;return r;}};function q(r){if(!r)return null;return r.startsWith(o.GROUP_PREFIX)?r.substr(o.GROUP_PREFIX.length):r;}f.exports=p;},null);
__d('MessengerURISerializer',['MessagingTag','MessengerStateProcessor','MessengerURIConstants','MessengerView','URI','WWWBase'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n='/?$',o={serialize:function(q){var r=new l(m.uri);q=i.preprocess(q);switch(q.masterView){case k.MASTER.GROUPS:r.setPath(j.GROUPS_PATH);break;case k.MASTER.PEOPLE:r.setPath(j.PEOPLE_PATH);break;}switch(q.folder){case h.OTHER:r.setPath(j.FILTERED_REQUESTS_PATH);break;case h.PENDING:r.setPath(j.MESSAGE_REQUESTS_PATH);break;}if(q.detailView===k.DETAIL.COMPOSE){r.setPath(r.getPath()+j.COMPOSE_SUBPATH);}else if(q.threadKey)r.setPath(r.getPath()+j.THREAD_PREFIX+q.threadKey);return r;},deserialize:function(q){var r={},s=q.getPath();if(s.match('^'+j.GROUPS_PATH)){r.masterView=k.MASTER.GROUPS;}else if(s.match('^'+j.PEOPLE_PATH)){r.masterView=k.MASTER.PEOPLE;}else r.masterView=k.MASTER.RECENT;if(s.match('^'+j.FILTERED_REQUESTS_PATH)){r.folder=h.OTHER;}else if(s.match('^'+j.MESSAGE_REQUESTS_PATH)){r.folder=h.PENDING;}else r.folder=h.INBOX;if(s.match(j.COMPOSE_SUBPATH+n)){r.detailView=k.DETAIL.COMPOSE;}else{var t=p(s);if(t){r.threadKey=t;r.detailView=k.DETAIL.THREAD;}}return i.postprocess(r);}};function p(q){var r=q.match(j.THREAD_PREFIX+'([^/]+)'+n);return r&&r[1];}f.exports=o;},null);
__d('MessengerActions',['MessengerDispatcher','MessengerURISerializer','MessengerView','URI','goURI','keyMirror'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=m({HIDE_DIALOG:null,REPLACE_STATE:null,SHOW_DIALOG:null}),o={Types:n,changeDetailView:function(q){p(function(r){if(r.detailView!==q)return {detailView:q};});},changeMasterView:function(q){p(function(r){if(r.masterView!==q)return {masterView:q};});},selectThread:function(q){p(function(r){if(r.activeThreadID!==q)return {activeThreadID:q,detailView:j.DETAIL.THREAD};});},changeState:function(q){h.dispatch({type:n.REPLACE_STATE,nextState:q});},showDialog:function(q,r){h.dispatch({type:o.Types.SHOW_DIALOG,dialogClass:q,dialogProps:r});},hideDialog:function(q){h.dispatch({type:o.Types.HIDE_DIALOG,dialogClass:q});},changeFolder:function(q){p(function(r){if(r.folder!==q)return {folder:q};});}};function p(q){var r=i.deserialize(new k(window.location.href)),s=q(r);if(s)l(i.serialize(Object.assign(r,s)));}f.exports=o;},null);
__d('P2PActionConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={CREDIT_CARDS_UPDATED:'credit_cards_updated',CREDIT_CARDS_UPDATED_ERROR:'credit_cards_updated_error',CHANNEL_EVENTS_ALLOWED:'channel_events_allowed',CHANNEL_EVENTS_IGNORED:'channel_events_ignored',CREDIT_CARD_SAVING:'credit_card_saving',CREDIT_CARD_ADDED:'credit_card_added',CREDIT_CARD_ADDED_ERROR:'credit_card_added_error',CREDIT_CARD_ADDED_ERROR_CLEARED:'credit_card_added_error_cleared',CREDIT_CARD_DELETED:'credit_card_deleted',CREDIT_CARD_DELETED_ERROR:'credit_card_deleted_error',CREDIT_CARD_UPDATED:'credit_card_updated',CREDIT_CARD_UPDATED_ERROR:'credit_card_updated_error',PRESET_CREDIT_CARD_UPDATED:'preset_credit_card_updated',PRESET_CREDIT_CARD_UPDATED_ERROR:'preset_credit_card_updated_error',CREDIT_CARD_VERIFIED:'credit_card_verified',CREDIT_CARD_VERIFIED_ERROR:'credit_card_verified_error',TRANSFERS_UPDATED:'transfers_updated',TRANSFERS_UPDATED_ERROR:'transfers_updated_error',NUX_TRANSFERS_UPDATED:'nux_transfers_updated',TRANSFER_ADDED:'transfer_added',TRANSFER_ADDED_ERROR:'transfer_added_error',TRANSFER_UPDATED:'transfer_updated',TRANSFER_UPDATED_ERROR:'transfer_updated_error',TRANSFER_ACCEPTED:'transfer_accepted',TRANSFER_DECLINED:'transfer_declined',CHAT_SEND_VIEW_OPENED:'chat_send_view_opened',CHAT_SEND_VIEW_CLOSED:'chat_send_view_closed',BIN_NUMBER_VALIDATED:'bin_number_validated',BIN_NUMBER_VALIDATED_ERROR:'bin_number_validated_error',USER_ELIGIBILITY_UDPATED:'user_eligibility_updated',FRIENDS_LIST_UPDATED:'friends_list_updated',DIALOG_SHOWN:'dialog_shown',DIALOG_CLOSED:'dialog_closed',BANNER_STATES_UPDATED:'banner_states_updated',BANNER_DISMISSED:'banner_dismissed',BANNER_VIEWED:'banner_viewed',BANNER_COMPLETED:'banner_completed',MONEYPENNY_TRANSFER_CREATED:'moneypenny_transfer_created',MONEYPENNY_TRANSFER_CREATED_ERROR:'moneypenny_transfer_created_error',PLATFORM_CONTEXT_ADDED:'platform_context_added',PLATFORM_CONTEXT_ADDED_ERROR:'platform_context_added_error',PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED:'platform_context_save_errors_cleared',PLATFORM_CONTEXT_BANNER_DISMISSED:'platform_context_banner_dismissed',PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD:'platform_context_product_item_sold',PLATFORM_CONTEXT_CHANGED:'platform_context_changed',EXTENSIVE_TRANSFER_DETAILS_UPDATED:'extensive_transfer_details_updated',ADDRESS_SAVING:'address_saving',ADDRESSES_UPDATED:'addresses_updated',ADDRESS_ADDED:'address_added',ADDRESS_ADDED_ERROR:'address_added_error',ADDRESS_ADDED_ERROR_CLEARED:'address_added_error_cleared',CHECKOUT_CART_INITIATED:'checkout_cart_initiated',CHECKOUT_CART_CREATED:'checkout_cart_created',CHECKOUT_SHIPPING_OPTION_SELECTED:'checkout_shipping_option_selected',CHECKOUT_ADDRESS_SELECTED:'checkout_address_selected',CHECKOUT_CREDIT_CARD_SELECTED:'checkout_credit_card_selected',CHECKOUT_ADDRESS_FORM_TOGGLED:'checkout_address_form_toggled',CHECKOUT_CREDIT_CARD_FORM_TOGGLED:'checkout_credit_card_form_toggled',CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED:'checkout_address_options_toggled',CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED:'checkout_credit_card_edit_options_toggled',CHECKOUT_ADDRESS_FORM_VALIDATED:'checkout_address_form_validated',CHECKOUT_CREDIT_CARD_FORM_VALIDATED:'checkout_credit_card_form_validated',CHECKOUT_EDIT_COMPLETED:'checkout_completed',CHECKOUT_PROCESSING:'checkout_processing',CHECKOUT_BUYER_PROFILE_UPDATED:'checkout_buyer_profile_updated',PAYMENT_REQUEST_INITIATED:'payment_request_initiated',PAYMENT_REQUEST_INITIATED_COMPLETE:'payment_request_initiated_completed',PAYMENT_REQUEST_CREATED:'payment_request_created',PAYMENT_REQUEST_CREATED_ERROR:'payment_request_created_error',PAYMENT_REQUEST_UPDATED:'payment_request_updated',PAYMENT_REQUEST_DECLINE_INITIATED:'payment_request_decline_initiated',PAYMENT_REQUEST_DECLINED:'payment_request_declined',PAYMENT_REQUEST_DECLINE_ERROR:'payment_request_decline_error',PAYMENT_REQUESTS_FETCHED:'payment_requests_fetched',PAYMENT_REQUEST_CANCEL_INITIATED:'payment_request_cancel_initiated',PAYMENT_REQUEST_CANCELED:'payment_request_canceled',PAYMENT_REQUEST_CANCEL_ERROR:'payment_request_cancel_error'};f.exports=h;},null);
__d('P2PDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('P2PActions',['ChatOpenTab','CurrentEnvironment','MessengerActions','P2PActionConstants','P2PDispatcher','MercuryShareAttachmentRenderLocations'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={updateCreditCards:function(o){l.dispatch({type:k.CREDIT_CARDS_UPDATED,data:o});},updateCreditCardsError:function(){l.dispatch({type:k.CREDIT_CARDS_UPDATED_ERROR});},ignoreCreditCardChannelEvents:function(){l.dispatch({type:k.CHANNEL_EVENTS_IGNORED});},allowCreditCardChannelEvents:function(){l.dispatch({type:k.CHANNEL_EVENTS_ALLOWED});},creditCardSaving:function(){l.dispatch({type:k.CREDIT_CARD_SAVING});},addCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_ADDED,data:o});},addCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_ADDED_ERROR,data:o});},addCreditCardErrorCleared:function(){l.dispatch({type:k.CREDIT_CARD_ADDED_ERROR_CLEARED});},updatePresetCreditCard:function(o){l.dispatch({type:k.PRESET_CREDIT_CARD_UPDATED,data:o});},updatePresetCreditCardError:function(o){l.dispatch({type:k.PRESET_CREDIT_CARD_UPDATED_ERROR,data:o});},updateCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_UPDATED,data:o});},updateCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_UPDATED_ERROR,data:o});},deleteCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_DELETED,data:o});},deleteCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_DELETED_ERROR,data:o});},verifyCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_VERIFIED,data:o});},verifyCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_VERIFIED_ERROR,data:o});},updateTransfers:function(o){l.dispatch({type:k.TRANSFERS_UPDATED,data:o});},updateTransfersError:function(o){l.dispatch({type:k.TRANSFERS_UPDATED_ERROR,data:o});},updateNUXTransfers:function(o){l.dispatch({type:k.NUX_TRANSFERS_UPDATED,data:o});},transferAdded:function(o){l.dispatch({type:k.TRANSFER_ADDED,data:o});},transferAddedError:function(o){l.dispatch({type:k.TRANSFER_ADDED_ERROR,data:o});},transferUpdated:function(o){l.dispatch({type:k.TRANSFER_UPDATED,data:o});},transferUpdatedError:function(o){l.dispatch({type:k.TRANSFER_UPDATED_ERROR,data:o});},transferAccepted:function(){l.dispatch({type:k.TRANSFER_ACCEPTED});},transferDeclined:function(o){l.dispatch({type:k.TRANSFER_DECLINED,data:o});},chatSendViewOpened:function(o){function p(){l.dispatch({type:k.CHAT_SEND_VIEW_OPENED,data:o});}if(o.referrer===m.WEB_INBOX){p();}else if(h.canOpenTab()){h.openThread(o.threadID,null,null,p);}else if(i.messengerdotcom){j.selectThread(o.threadID);p();}else p();},chatSendViewClosed:function(o){l.dispatch({type:k.CHAT_SEND_VIEW_CLOSED,data:o});},binNumberValidated:function(o){l.dispatch({type:k.BIN_NUMBER_VALIDATED,data:o});},binNumberValidatedError:function(o){l.dispatch({type:k.BIN_NUMBER_VALIDATED_ERROR,data:o});},friendsListUpdated:function(o){l.dispatch({type:k.FRIENDS_LIST_UPDATED,data:o});},userEligibilityUpdated:function(o){l.dispatch({type:k.USER_ELIGIBILITY_UDPATED,data:o});},showDialog:function(o,p){l.dispatch({type:k.DIALOG_SHOWN,data:{dialogClass:o,dialogProps:p}});},hideDialog:function(){l.dispatch({type:k.DIALOG_CLOSED});},bannerStatesUpdated:function(o){l.dispatch({type:k.BANNER_STATES_UPDATED,data:o});},bannerDismissed:function(o){l.dispatch({type:k.BANNER_DISMISSED,data:o});},bannerCompleted:function(o){l.dispatch({type:k.BANNER_COMPLETED,data:o});},moneypennyTransferCreated:function(o){l.dispatch({type:k.MONEYPENNY_TRANSFER_CREATED,data:o});},moneypennyTransferCreatedError:function(o){l.dispatch({type:k.MONEYPENNY_TRANSFER_CREATED_ERROR,data:o});},addPlatformContext:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_ADDED,data:o});},addPlatformContextError:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_ADDED_ERROR,data:o});},clearPlatformContextSaveErrors:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED,data:o});},platformContextBannerDismissed:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_BANNER_DISMISSED,data:o});},platformContextProductItemSold:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD,data:o});},platformContextChanged:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_CHANGED,data:o});},extensiveTransferDetailsLoaded:function(o){l.dispatch({type:k.EXTENSIVE_TRANSFER_DETAILS_UPDATED,data:o});},updateAddresses:function(o){l.dispatch({type:k.ADDRESSES_UPDATED,data:o});},addressSaving:function(){l.dispatch({type:k.ADDRESS_SAVING});},addAddress:function(o){l.dispatch({type:k.ADDRESS_ADDED,data:o});},addAddressError:function(o){l.dispatch({type:k.ADDRESS_ADDED_ERROR,data:o});},addAddressErrorCleared:function(){l.dispatch({type:k.ADDRESS_ADDED_ERROR_CLEARED});},checkoutCartInitiated:function(){l.dispatch({type:k.CHECKOUT_CART_INITIATED});},checkoutCartCreated:function(o){l.dispatch({type:k.CHECKOUT_CART_CREATED,data:o});},checkoutShippingOptionSelected:function(o){l.dispatch({type:k.CHECKOUT_SHIPPING_OPTION_SELECTED,data:o});},checkoutAddressSelected:function(o){l.dispatch({type:k.CHECKOUT_ADDRESS_SELECTED,data:o});},checkoutCreditCardSelected:function(o){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_SELECTED,data:o});},checkoutAddressFormToggled:function(o){l.dispatch({type:k.CHECKOUT_ADDRESS_FORM_TOGGLED,data:o});},checkoutCreditCardFormToggled:function(o){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_FORM_TOGGLED,data:o});},checkoutAddressEditOptionsToggled:function(o){l.dispatch({type:k.CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED,data:o});},checkoutCreditCardEditOptionsToggled:function(o){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED,data:o});},checkoutCreditCardFormValidated:function(o,p){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_FORM_VALIDATED,data:{isValid:o,formData:p}});},checkoutAddressFormValidated:function(o,p){l.dispatch({type:k.CHECKOUT_ADDRESS_FORM_VALIDATED,data:{isValid:o,formData:p}});},checkoutEditCompleted:function(){l.dispatch({type:k.CHECKOUT_EDIT_COMPLETED});},checkoutProcessing:function(o){l.dispatch({type:k.CHECKOUT_PROCESSING,data:o});},checkoutBuyerProfileUpdated:function(o){l.dispatch({type:k.CHECKOUT_BUYER_PROFILE_UPDATED,data:o});},paymentRequestInitiated:function(){l.dispatch({type:k.PAYMENT_REQUEST_INITIATED});},paymentRequestInitiatedComplete:function(){l.dispatch({type:k.PAYMENT_REQUEST_INITIATED_COMPLETE});},paymentRequestCreated:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CREATED,data:o});},paymentRequestCreatedError:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CREATED_ERROR,data:o});},paymentRequestUpdated:function(o){l.dispatch({type:k.PAYMENT_REQUEST_UPDATED,data:o});},paymentRequestDeclineInitiated:function(){l.dispatch({type:k.PAYMENT_REQUEST_DECLINE_INITIATED});},paymentRequestDeclined:function(o){l.dispatch({type:k.PAYMENT_REQUEST_DECLINED,data:o});},paymentRequestDeclineError:function(o){l.dispatch({type:k.PAYMENT_REQUEST_DECLINE_ERROR,data:o});},paymentRequestCancelInitiated:function(){l.dispatch({type:k.PAYMENT_REQUEST_CANCEL_INITIATED});},paymentRequestCanceled:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CANCELED,data:o});},paymentRequestCancelError:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CANCEL_ERROR,data:o});},paymentRequestsFetched:function(o){l.dispatch({type:k.PAYMENT_REQUESTS_FETCHED,data:o});}};f.exports=n;},null);
__d('P2PLoadingMask.react',['React','XUISpinner.react','cx'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'P2PLoadingMask',propTypes:{visible:k.bool},getDefaultProps:function(){return {visible:false};},render:function(){if(!this.props.visible)return null;return (h.createElement('div',{className:"_3de"},h.createElement(i,{background:'dark',size:'large',className:"_3df"}),h.createElement('div',{className:"_3dg"})));}});f.exports=l;},null);
__d('P2PLogger',['BanzaiLogger'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='P2PPaymentLoggerConfig',j={log:function(k,l){l=babelHelpers._extends({event:k},l);h.log(i,l);}};f.exports=j;},null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';var m,n;k=babelHelpers.inherits(o,i);l=k&&k.prototype;function o(){l.constructor.call(this);n={};m=j.register(this.onEventDispatched.bind(this));}o.prototype.onEventDispatched=function(p){var q=p.data,r=p.type;switch(r){case h.CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(q);this.emit('change');break;case h.CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(q);this.emit('change');break;}};o.prototype.getStateByThreadID=function(p){return n[p];};o.prototype.handleChatSendViewOpened=function(p){n[p.threadID]={amount:p.amount,groupSendRecipientUserID:p.groupSendRecipientUserID,groupSendReceiptDetails:p.groupSendReceiptDetails,groupThreadFBID:p.groupThreadFBID,openRequestTab:p.openRequestTab,memoText:p.memoText,platformData:p.platformData,referrer:p.referrer,paymentRequestID:p.paymentRequestID,sendMoneyDialogShown:true,useModal:p.useModal};};o.prototype.handleChatSendViewClosed=function(p){n[p.threadID]={amount:'',groupSendRecipientUserID:null,groupSendReceiptDetails:null,groupThreadFBID:'',openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,useModal:false};};f.exports=new o();},null);
__d('P2PSendMoneyContainerBootloader.react',['Bootloader','CurrentEnvironment','DeferredComponent.react','MercuryIDs','MessengerContextualDialog.react','P2PAbstractSendMoneyButton.react','P2PActions','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','React','ReactLayeredComponentMixin','ReactDOM','Run','XUIContextualDialog.react','cx','emptyFunction','P2PSendMoneyDialogStore'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();c('P2PSendMoneyDialogStore');var z=s.PropTypes,aa=i.messengerdotcom,ba=s.createClass({displayName:'P2PSendMoneyContainerBootloader',propTypes:{button:z.node,className:z.string,flyoutAlignment:z.string,onTrigger:z.func,participantIDs:z.array,referrer:z.string,threadID:z.string},getInitialState:function(){return {showPlaceholderDialog:false};},mixins:[t],_clicked:false,log:function(ca,da){p.log(ca,babelHelpers._extends({www_event_referrer:this.props.referrer,www_event_flow:r.UI_FLOW_P2P_SEND},da));},onPlaceholderClick:function(){var ca=this.props.threadID?k.tokenize(this.props.threadID).value:null;this._handleDialogVisibility(!this.state.showPlaceholderDialog);this.log(q.UI_ACTN_SEND_MONEY_BUTTON_PLACEHOLDER_CLICKED,{object_id:ca});this._clicked=false;},_handleDialogVisibility:function(ca){if(!ca){n.chatSendViewClosed({threadID:this.props.threadID});}else n.chatSendViewOpened({referrer:this.props.referrer,threadID:this.props.threadID});this.setState({showPlaceholderDialog:ca});},renderLayers:function(){var ca={};if(this.state.showPlaceholderDialog){var da=i.messengerdotcom,ea=da?l:w,fa=da?282:260;ca.placeholderDialog=s.createElement(ea,{alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:da?'right':'left',context:u.findDOMNode(this.refs.placeholderButton),onBlur:(function(){if(!this._clicked)this._handleDialogVisibility(false);this._clicked=false;}).bind(this),ref:'dialog',shown:true,width:fa,position:'above'},s.createElement('div',{className:"_c_5"},s.createElement(o,{visible:true})));}return ca;},render:function(){return (s.createElement(j,babelHelpers._extends({deferredComponent:this._bootloadComponent,deferredPlaceholder:this._renderPlaceholder()},this.props)));},_renderPlaceholder:function(){return (s.createElement(m,{button:this.props.button,className:this.props.className,isActive:false,isDisabled:false,isMessenger:aa,onClick:this.onPlaceholderClick,onMouseDown:(function(){return this._clicked=true;}).bind(this),onMouseOver:this._bootloadComponentNow,ref:'placeholderButton'}));},_bootloadComponent:function(ca){v.onAfterLoad((function(){h.loadModules(["P2PSendMoneyContainer.react"],(function(){ca.apply(this,arguments);this.setState({showPlaceholderDialog:false});}).bind(this));}).bind(this));},_bootloadComponentNow:function(){h.loadModules(["P2PSendMoneyContainer.react"],y);}});f.exports=ba;},null);
__d('WebMessengerThreadPermalinks',['MercuryIDs','MessagingTag','URI','WebMessengerPermalinkConstants','WWWBase','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={getThreadURI:function(r,s,t){if(h.isCanonical(r)){o(r,s,t);}else p(r,s,t);}};function o(r,s,t){var u=new j(l.uri),v=h.tokenize(r).value;u.setPath(q(t)+'/'+v);s&&s(u.toString());}function p(r,s,t){m('MercuryThreadIDMap',function(u){var v=u.get();v.getServerIDFromClientID(r,function(w){var x=new j(l.uri);x.setPath(k.getURIPathForThreadID(w,q(t)));s&&s(x.toString());});});}function q(r){var s=k.BASE_PATH;if(r&&r!=i.INBOX)s+='/'+r;return s;}f.exports=n;},null);
__d('ChatTabView',['Promise','AsyncRequest','AsyncSignal','AvailableListConstants','BanzaiODS','BootloadedComponent.react','Bootloader','ChatBehavior','ChatConfig','ChatNubLogger','ChatOpenTab','ChatPhotoUploader.react','ChatTabActions','ChatTabMessagesView','ChatTabSheetController','ChatTabViewEvents','ChatTabViewInstances','ChatTitleLink.react','ChatVisibility','CSS','CurrentUser','Dock','DOM','DOMQuery','DragDropTarget','EmojiLikeUtils','EmoticonsList','EmoticonUtils','Event','FBID','FBRTCCallabilityStore','JSResource','Keys','LogHistory','MercuryCanonicalGroupThreadManager','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryShareAttachmentRenderLocations','MercurySourceType','MercuryThreadInfo','MercuryThreadTitle.react','MercuryTypingAnimation.react','MercuryViewer','MessagingTag','NubController','P2PGKValues','P2PSendMoneyContainerBootloader.react','PagesMercuryChatTabIndicatorHandler','Parent','PhotosUploadWaterfall','PresenceStatus','React','ReactComponentRenderer','ReactDOM','Run','Scroll','SelectionPosition','ShortProfiles','SimpleXUIDialog','SiteData','StickerActions','StickerConstants','StickerState','Style','SubscriptionsHandler','SyntheticMouseEvent','ChatTabTemplates','TextAreaControl','TooltipData','TypingDetectorController','UserAgent_DEPRECATED','WaterfallIDGenerator','WebMessengerThreadPermalinks','WorkFileUploadsGating','WorkModeConfig','XStickerReplyNUXController','createCancelableFunction','csx','cx','emptyFunction','fbt','getActiveElement','isEmpty','requireWeak','setIntervalAcrossTransitions','ChatReactInput','MercuryBlockedParticipants','MercuryTypingReceiver','MercuryMessageObject','MercuryMessages','MercuryServerRequests','MercuryThreadActions','MercuryThreadIDMap','MercuryThreadInformer','MercuryThreads','MercuryMessageActions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc){'use strict';if(c.__markCompiled)c.__markCompiled();var pc=c('ChatReactInput').module,qc=c('MercuryBlockedParticipants').get(),rc=c('MercuryTypingReceiver').get(),sc=c('MercuryMessageObject').get(),tc=c('MercuryMessages').get(),uc=c('MercuryServerRequests').get(),vc=c('MercuryThreadActions').get(),wc=c('MercuryThreadIDMap').get(),xc=c('MercuryThreadInformer').get(),yc=c('MercuryThreads').get(),zc=c('MercuryMessageActions').get(),ad=/^\s*$/,bd=x,cd,dd='right',ed=960,fd=10,gd=p.get('chat_react_composer'),hd=p.get('chat_react_header'),id=oa.getInstance('chat_tab_view');nc('AvailableList',function(ee){ee.subscribe(k.ON_AVAILABILITY_CHANGED,ae);});function jd(ee,fe){var ge=da.create('div');fe=fe&&fe.filter(function(je){return je!=ya.getID();});if(mc(fe))return yb.remove(ee);var he=fe.length,ie=he-fd;if(ie>1)fe=fe.slice(0,fd);sa.getMulti(fe,function(je){for(var ke in je){var le=je[ke],me=wb[':fb:mercury:chat:multichat-tooltip-item'].build();da.setContent(me.getNode('name'),le.name);var ne=ra.getUserIDFromParticipantID(ke),oe=ne&&gb.get(ne)==k.ACTIVE;aa.conditionShow(me.getNode('icon'),oe);aa.conditionClass(me.getNode('name'),'tooltipItemWithIcon',oe);da.appendContent(ge,me.getRoot());}if(ie>1){var pe=kc._("and {number of hidden chat participants} more.",[kc.param('number of hidden chat participants',ie)]);da.appendContent(ge,da.create('div',{},pe));}yb.set(ee,ge,'above');});}var kd={},ld=null,md=false;function nd(ee,fe,ge){if(ge){kd[ee]=fe;if(!ld)ld=oc(od,600);}else{aa.removeClass(fe,'highlightTitle');delete kd[ee];}}function od(){for(var ee in kd){var fe=kd[ee];if(fe.parentNode){aa.conditionClass(fe,'highlightTitle',md);}else delete kd[ee];}md=!md;if(!Object.keys(kd).length){clearInterval(ld);ld=null;}}function pd(ee){var fe=ra.tokenize(ee);switch(fe.type){case 'user':return wb[':fb:mercury:chat:user-tab'].build();}return wb[':fb:mercury:chat:multichat-tab'].build();}function qd(ee){var fe=ee._getInputValue(),ge=ee._filesUploader,he=ge?ge.getAttachments():[];if(vd(ee))sd(ee,fe,he,function(ie){ie=de(ie,ge);zc.send(ie,function(je){var ke=yc.getThreadMetaNow(je);if(ke&&ke.folder===za.PENDING)vc.movePendingToInbox(je);});ge&&ge.removeAttachments();if(ee._sharePreview)ee._sharePreview.setProps({share:null,uri:null});if(gd){ee._composer.onSend();}else ee._chatInput.component.resetState();ee._typingDetector&&ee._typingDetector.resetState();if(ee._messagesView){ee._messagesView.scrollToBottom();ee._messagesView.setShouldScrollToBottom(true);ee.tryMarkAsRead();}});}function rd(ee,fe){if(fe===0)return;xd(ee,fb.POST_PUBLISHED,{count:fe});ee._waterfallID=bc.generate();}function sd(ee,fe,ge,he){yc.getThreadMeta(ee._threadID,function(ie){if(ie&&ie.is_canonical&&!va.canReply(ie)){ee._showMessageBlockedDialog(ie);return;}var je=ua.CHAT_WEB,ke=sc.constructUserGeneratedMessageObject(fe,je,ee._threadID);if(ge.length>0){ke.has_attachment=true;ke.raw_attachments=ge;}if(ee._sharePreview){var le=ee._sharePreview.component.getShareData();if(le){ke.has_attachment=true;ke.shareable_attachment=le;}}if(yc.isNewEmptyLocalThread(ee._threadID)){var me=ee._sheetController.getAddFriendsParticipants();ee._sheetController.closeAddFriendsSheet();if(me===null||me.length===0)return;me=me.filter(function(qe){return qe!=ya.getID();});if(me.length===0){ke.thread_id=ra.getThreadIDFromUserID(ba.getID());}else if(me.length===1){ke.thread_id=ra.getThreadIDFromParticipantID(me[0]);}else{var ne=ee.getMessagesView().getThreadID();if(ne!=ee._threadID)ke.thread_id=ne;vc.addParticipants(ee._threadID,me);}}if(yc.isEmptyLocalThread(ee._threadID)){ke.offline_threading_id=ra.tokenize(ee._threadID).value;var oe=yc.getThreadMetaNow(ie.thread_id);ke.specific_to_list=Array.from(oe.participants);}if(typeof ke!='undefined')ke.signatureID=ee._signatureID;ke.ui_push_phase=pb.push_phase;he(ke);if(ee._threadID!==ke.thread_id&&!ee.isUploading()){var pe=ee._getInputValue();t.closeTab(ee._threadID);r.openThread(ke.thread_id,'ChatTabView',null,fe?jc:function(qe){return qe.appendTextToInput(pe);});}});}function td(ee){ee._blocked=true;ee._sheetController.openUploadWarningTabSheet();}function ud(ee){return ee.isUploading();}function vd(ee){var fe=ee._getInputValue();if(!ad.test(fe))return true;var ge=ee._filesUploader;if(ge&&(ge.getAttachments().length>0||ge.getImageFiles().length>0||ge.getAnimatedImageFiles().length>0||ge.getVideoFiles().length>0||ge.getAudioFiles().length>0||ge.getFiles().length>0))return true;if(ee._sharePreview&&ee._sharePreview.component.getShareData())return true;return false;}function wd(ee){ee._nubController.flyoutContentChanged();var fe=ee._getNode('attachmentShelf');lb.setTop(fe,fe.scrollHeight);}function xd(ee,fe,ge){fb.sendSignal(babelHelpers._extends({qn:ee._waterfallID,step:fe,uploader:fb.APP_CHAT},ge||{}));}function yd(ee,fe,ge,he,ie){if(fe)uc.ensureThreadIsFetched(fe);this._threadID=ee;this._signatureID=ge;this._eventListeners=[];this._onlineStatus=k.OFFLINE;this._tabTemplate=pd(ee);this._tabElem=this._tabTemplate.getRoot();if(ie&&ie.getTabElem()){this.insertBefore(ie);}else this.appendTo(he);this._stickersFlyoutShown=false;this._messagesView=null;this._titlebar=this._getNode('nubFlyoutTitlebar');if(!gd){this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._contentSearchNode=this._getNode('contentSearchContainer');this._fileUploaderNode=this._getNode('fileUploaderContainer');}this._pagesMessageIndicator=this._getNode('pagesMessageIndicator');this._waterfallID=bc.generate();this._subscriptionsHandler=new ub();this._canonicalGroupSearchSubscriptionID=null;this._initializeSheetController();var je=[jc,this._initializeHeader.bind(this),this._initializeUIListeners.bind(this),this._initializeAutoSendPhotoUploader.bind(this),this._initializeAutoSendFileUploader.bind(this),this._initializeTitleHREF.bind(this),this._initializeP2P.bind(this),this._initializeInput.bind(this),this._initializeStickers.bind(this),this._initializeContentSearch.bind(this),(function(){yc.getThreadMeta(this._threadID,(function(pe){this._updateMutingSettings(pe);this._updateMessageBlockSettings(pe);this._updateMessageManageSettings(pe);this._updateSecretModeSettings(pe);this._updateCustomLike(pe);}).bind(this));}).bind(this),(function(){this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);}).bind(this),this._initializeUnloadListeners.bind(this),this._initializeDragDropTarget.bind(this),this._initializePageMessagingIndicator.bind(this),this._initializeP2PChatThreadBannerContainer.bind(this),this._initializeP2PRainMoneyContainer.bind(this)];for(var ke=je,le=Array.isArray(ke),me=0,ke=le?ke:ke[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ne;if(le){if(me>=ke.length)break;ne=ke[me++];}else{me=ke.next();if(me.done)break;ne=me.value;}var oe=ne;oe();}bd.set(ee,this);this._logOpenTab();}function zd(ee){if(ee._photoUploader&&ee._photoUploader.isUploading())xd(ee,fb.CANCEL_DURING_UPLOAD);}function ae(){for(var ee=bd.values(),fe=Array.isArray(ee),ge=0,ee=fe?ee:ee[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var he;if(fe){if(ge>=ee.length)break;he=ee[ge++];}else{ge=ee.next();if(ge.done)break;he=ge.value;}var ie=he;ie.updateAvailableStatus();ie.updateTitlebarTooltip();}}function be(){for(var ee=bd.values(),fe=Array.isArray(ee),ge=0,ee=fe?ee:ee[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var he;if(fe){if(ge>=ee.length)break;he=ee[ge++];}else{ge=ee.next();if(ge.done)break;he=ge.value;}var ie=he;ie.updateCallLink();}}la.addListener(be);o.subscribe(o.ON_CHANGED,function(){for(var ee=bd.keys(),fe=Array.isArray(ee),ge=0,ee=fe?ee:ee[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var he;if(fe){if(ge>=ee.length)break;he=ee[ge++];}else{ge=ee.next();if(ge.done)break;he=ge.value;}var ie=he;yc.getThreadMeta(ie,function(je){bd.get(ie)._updateUnreadCount(je);});}});rc.addRetroactiveListener('state-changed',function(ee){for(var fe in ee){var ge=ee[fe]&&ee[fe].length,he=bd.get(fe);he&&he.showTypingIndicator(ge);}});xc.subscribe('threads-updated',function(ee,fe){for(var ge=bd.keys(),he=Array.isArray(ge),ie=0,ge=he?ge:ge[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var je;if(he){if(ie>=ge.length)break;je=ge[ie++];}else{ie=ge.next();if(ie.done)break;je=ie.value;}var ke=je,le=bd.get(ke);fe[ke]&&le.updateTab();if(le._newThreadIDFromPhotoUpload&&!le.isUploading()&&fe[le._newThreadIDFromPhotoUpload]){t.closeTab(le._threadID);r.openThread(le._newThreadIDFromPhotoUpload,'ChatTabView');le._newThreadIDFromPhotoUpload=null;}}});xc.subscribe('threads-deleted',function(ee,fe){for(var ge=bd.keys(),he=Array.isArray(ge),ie=0,ge=he?ge:ge[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var je;if(he){if(ie>=ge.length)break;je=ge[ie++];}else{ie=ge.next();if(ie.done)break;je=ie.value;}var ke=je;fe[ke]&&t.closeTab(ke,'thread_deleted');if(yc.isNewEmptyLocalThread(ke)){var le=bd.get(ke);le.ensureValidCanonicalGroup(fe);}}});Object.assign(yd.prototype,{getThreadID:function(){return this._threadID;},getTabElem:function(){return this._tabElem;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(ee){setTimeout((function(){this._sheetController.openNameConversationSheet(ee);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return aa.shown(this._tabElem);},isUploading:function(){var ee=gd?this._composer&&this._composer.isUploading():!!(this._fileUploader&&this._fileUploader.isUploading()||this._photoUploader&&this._photoUploader.isUploading());return !!(ee||this._filesUploader&&this._filesUploader.isUploading()||this._sharePreview&&this._sharePreview.component.isLoading());},setVisibleState:function(ee,fe){var ge=aa.shown(this._tabElem),he=aa.hasClass(this._tabElem,'opened');aa.conditionShow(this._tabElem,ee);aa.conditionClass(this._tabElem,'opened',fe);if(!(ge&&he)&&ee&&fe){if(!this._messagesView)this._updateChatTabMessagesView(this._threadID);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();this.setP2PChatThreadBannerContainerVisibility();}},_updateChatTabMessagesView:function(ee){if(this._messagesView&&this._messagesView.getThreadID()===ee)return;var fe=ra.tokenize(ee);this._messagesView&&this._messagesView.destroy();this._messagesView=new u(ee,this._sheetController,this._getNode('scrollingArea'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this,qa.ShowContextBanner&&fe.type==='user');},focus:function(){if(aa.hasClass(this._tabElem,'opened')){try{this._focusInput();}catch(ee){}}else this._getNode('dockButton').focus();},isFocused:function(){var ee=lc();return eb.bySelector(ee,"._50mz")===this._tabElem;},hasEmptyInput:function(){return ad.test(this._getInputValue());},getInputElem:function(){if(gd)return this._composer&&jb.findDOMNode(this._composer.getInput());if(!this._chatInput||!this._chatInput.component.isMounted())return null;return jb.findDOMNode(this._chatInput.component);},getMessagesView:function(){return this._messagesView;},setStickersFlyoutPackID:function(ee){if(!this._stickerButton.isMounted())return;qb.selectPack(ee);this._toggleStickersFlyoutShown(true);},loadShareFromParams:function(ee,fe){this._getSharePreview().done(function(ge){ge.setProps({share:{params:fe,type:ee},uri:null});});},_linkDropped:function(ee){this._getSharePreview().done(function(fe){fe.setProps({share:null,uri:ee});});},_filesDropped:function(ee){this._loadReactMenu().done(function(fe){var ge=fe.component.getFileUploaderPromise();if(ge)ge.done(function(he){setTimeout(function(){he.addDroppedFiles(ee);},0);});});},_toggleStickersFlyoutShown:function(ee){this._stickerButton.showFlyout();this._stickersFlyoutShown=ee;},showStickerReplyNUX:function(){if(cd)return;new i(fc.getURIBuilder().getURI()).setRelativeTo(this._getNode('stickerButtonContainer')).setData({thread_id:this._threadID}).setHandler(function(ee){sb.clearShowStickerReplyNUX();}).send();},insertBefore:function(ee){da.insertBefore(ee.getTabElem(),this._tabElem);},appendTo:function(ee){da.appendContent(ee,this._tabElem);},nextTabIs:function(ee){var fe=ee&&ee.getTabElem();return this._tabElem.nextSibling==fe;},getScrollTop:function(){return lb.getTop(da.find(this._tabElem,'.fbNubFlyoutBody.scrollable'));},setScrollTop:function(ee){lb.setTop(da.find(this._tabElem,'.fbNubFlyoutBody.scrollable'),ee);},destroy:function(){this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._checkUnsentMessages&&this._checkUnsentMessages.cancel();this._logUnsentPhotos&&this._logUnsentPhotos.cancel();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();jb.unmountComponentAtNode(this._getNode('animationContainer'));jb.unmountComponentAtNode(this._getNode('menuContainer'));if(hd){if(this._addToThreadButton){this._addToThreadButton.unmount();this._addToThreadButton=null;}if(this._archiveWarning){this._archiveWarning.unmount();this._archiveWarning=null;}if(this._videoCallButton){this._videoCallButton.unmount();this._videoCallButton=null;}if(this._closeButton){this._closeButton.unmount();this._closeButton=null;}if(this._title){this._title.unmount();this._title=null;}}if(this._sharePreview){this._sharePreview.unmount();this._sharePreview=null;}this._subscriptionsHandler&&this._subscriptionsHandler.release();jb.unmountComponentAtNode(this._getNode('name'));if(!hd)jb.unmountComponentAtNode(this._getNode('titlebarText'));if(gd){jb.unmountComponentAtNode(this._getNode('footer'));}else{try{jb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));jb.unmountComponentAtNode(this._getNode('fileUploaderContainer'));}catch(ee){l.bumpEntityKey('chat.web','chattab.unmount_failed');}jb.unmountComponentAtNode(this._getNode('stickerButtonContainer'));jb.unmountComponentAtNode(this._getNode('inputContainer'));if(this._getNode('hotLikeContainer'))jb.unmountComponentAtNode(this._getNode('hotLikeContainer'));if(this._p2pButtonContainer){if(this._p2pButton)this._p2pButton.unmount();this._p2pButtonContainer=null;this._p2pButton=null;}if(this._p2pChatThreadBannerContainerEl){jb.unmountComponentAtNode(this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainerEl=null;}if(this._p2pRainMoneyContainerEl){jb.unmountComponentAtNode(this._p2pRainMoneyContainerEl);this._p2pRainMoneyContainerEl=null;}}da.remove(this._tabElem);bd['delete'](this._threadID);ca.unregisterNubController(this._nubController);},updateAvailableStatus:function(){yc.getThreadMeta(this._threadID,(function(ee){var fe=k.OFFLINE,ge=this._getCanonicalUserID(),he=null;if(ge){fe=gb.get(ge);he=nb.getNow(ge);}else{var ie=ee.participants.map(function(ke){return ra.getUserIDFromParticipantID(ke);});fe=gb.getGroup(ie);}if(!z.isOnline())fe=k.OFFLINE;this.updateCallLink();aa.conditionClass(this._tabElem,"_5238",fe===k.ACTIVE&&(he===undefined||he===null||!he.is_messenger_only));var je=this._getNode('presenceIndicator');this._onlineStatus=fe;this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.notifyPageOnlineStatusChanged(fe);switch(fe){case k.ACTIVE:je.setAttribute('alt',kc._("Online"));break;default:je.removeAttribute('alt');break;}}).bind(this));},updateTab:function(){yc.getThreadMeta(this._threadID,(function(ee){var fe=[this._getNode('name')];if(!hd){fe.push(this._getNode('titlebarText'));}else if(this._title)this._title.setProps({thread:ee},(function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.component.getTitle());}).bind(this));for(var ge=fe,he=Array.isArray(ge),ie=0,ge=he?ge:ge[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var je;if(he){if(ie>=ge.length)break;je=ge[ie++];}else{ie=ge.next();if(ie.done)break;je=ie.value;}var ke=je;jb.render(hb.createElement(wa,{isNewThread:yc.isNewEmptyLocalThread(this._threadID),thread:ee,useAndSeparator:true,useShortName:!ee.is_canonical,viewer:ba.getID()}),ke);}this._updateControls(ee);this._updateMessageBlockSettings(ee);this._updateMessageManageSettings(ee);this._updateSecretModeSettings(ee);this._updateMutingSettings(ee);this._updateUnreadCount(ee);this.updateTitlebarTooltip();this._updateArchiveWarning(ee);this._updateConfidentialStatus(ee);this._updateEmployeeAwayWarning(ee);this._updateOfficeStatus(ee);this._updateNewThread(ee);this._updateNameConversationSheet(ee);this._updateReadOnlySheet(ee);this._updateSwitchToWork(ee);this._updateCustomLike(ee);}).bind(this));},_updateNameConversationSheet:function(ee){if(va.canReply(ee)&&!ee.name&&!ee.is_canonical&&!ee.name_conversation_sheet_dismissed&&!ee.has_email_participant&&!ee.read_only&&!yc.isEmptyLocalThread(ee.thread_id)&&!qa.SuppressNamingUpsell){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(ee){var fe=va.showComposer(ee),ge=va.canReply(ee),he=yc.isEmptyLocalThread(ee.thread_id);if(!ge&&!fe&&!he)this._sheetController.openReadOnlySheet();},_updateMessageManageSettings:function(ee){var fe=ra.getParticipantIDFromFromThreadID(ee.thread_id),ge=sa.getNow(fe);this._updateMenuPropsSafe({isBusinessEnabled:ge&&ge.is_business_enabled});},updateSignatureID:function(ee){this._signatureID=ee;},_updateMessageBlockSettings:function(ee){this._updateMenuPropsSafe({hasMessageBlocked:qc.isMessageBlocked(ee),isEmptyConversation:ee&&ee.message_count==0});},_updateCustomLike:function(ee){if(gd||!this._getNode('hotLikeContainer'))return;var fe="_6h1 _6gb";jb.render(hb.createElement(m,{bootloadPlaceholder:hb.createElement('a',{className:fe}),bootloadLoader:ma('MessengerHotLikeButton.react'),className:fe,customLike:ee.custom_like_icon,sendSticker:this._stickerSelected.bind(this),sendCustomLike:this._customLikeSelected.bind(this),threadID:this._threadID}),this._getNode('hotLikeContainer'));aa.addClass(this._inputContainerNode,"_n4k");},_updateSecretModeSettings:function(ee){var fe=!!(ee&&ee.ephemeral_ttl_mode);this._updateMenuPropsSafe({hasSecretModeOn:fe});aa.conditionClass(this._tabElem,"_5iq8",fe);var ge=fe?kc._("Type a disappearing message..."):kc._("Type a message...");if(gd){this._composer&&this._composer.setPlaceholder(ge);}else this._chatInput.setProps({placeholder:ge});},_updateMutingSettings:function(ee){var fe=va.isMuted(ee);fe&&this._loadReactMenu();this._updateMenuPropsSafe({isMuted:fe});},_updateMenuPropsSafe:function(ee){if(this._menuPromise)this._menuPromise.done(function(fe){fe&&fe.component&&fe.component.isMounted()&&fe.setProps(ee);});},_updateArchiveWarning:function(ee){if(ba.isEmployee())sa.getMulti(ee.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));},_updateConfidentialStatus:function(ee){if(ee.other_user_fbid)sa.getMulti(ee.participants,(function(fe){var ge=this._getNode('titlebarConfidentialStatus');if(ge){var he=ee.other_user_fbid&&fe[ra.getParticipantIDFromUserID(ee.other_user_fbid)].is_anonymous_crisis_support;aa.conditionShow(ge,he);}}).bind(this));},_updateEmployeeAwayWarning:function(ee){if(!ba.isEmployee())return;kb.onAfterLoad((function(){n.loadModules(["ChatEmployeeAwayWarning"],(function(fe){fe.updateEmployeeAwayWarning(ee,(function(){this._sheetController.openEmployeeAwaySheet();}).bind(this),jc);}).bind(this));}).bind(this));},_updateOfficeStatus:function(ee){var fe=this._getNode('officeStatus');if(!fe||ra.isGroupChat(ee.thread_id))return;kb.onAfterLoad(function(){n.loadModules(["ChatTabOfficeStatus"],function(ge){var he=ra.getParticipantIDFromUserID(ee.other_user_fbid);sa.get(he,function(ie){ge.update(fe,ie);});});});},_updateSwitchToWork:function(ee){if(ba.isEmployee()&&ba.hasWorkUser()&&ra.isGroupChat(ee.thread_id)){sa.getMulti(ee.participants,(function(fe){var ge=this._isEmployeesOnly(fe);this._updateMenuPropsSafe({hasSwitchToWork:ge});}).bind(this));}else this._updateMenuPropsSafe({hasSwitchToWork:false});},_updateControls:function(ee,fe,ge){var he=false;if(ee&&ee.thread_id){var ie=ra.tokenize(ee.thread_id);if(ie.type==='user'){var je=ie.value;he=!ka.isUser(je);}}var ke=va.showComposer(ee)&&(!mc(ee.participants)||!!fe)&&!this._pendingActions,le=this._getNode('footer');aa.conditionShow(le,ke);aa.conditionShow(this._getNode('menuContainer'),ke);var me={isEmptyChat:yc.isNewEmptyLocalThread(ee.thread_id),show:ke};if(he)me.showAddFriend=null;this._updateMenuPropsSafe(me);var ne=ke&&!he;if(hd){this._addToThreadButton&&this._addToThreadButton.setProps({shown:ne});}else aa.conditionShow(this._getNode('addToThreadLink'),ne);if(ge&&ge.length===1&&qa.ShowContextBanner&&qa.ShowContextBannerNullState){this._messagesView&&this._messagesView.renderContextBanner(null,ge[0].info&&ge[0].info.uid);}else this._messagesView&&this._messagesView.unmountContextBanner();this._resizeInputContainer();},_isP2PEnabled:function(){return bb.P2PEnabled;},_getP2PProps:function(){return {button:hb.createElement('i',{className:"hidden_elem"}),className:"_6ga _6gb",flyoutAlignment:dd,onTrigger:this._p2pTriggered.bind(this),referrer:ta.CHAT,threadID:this._threadID};},_renderP2PButton:function(){var ee=this._getCanonicalUserID();if(this._isP2PEnabled()&&ee!==ba.getID()){this._p2pButtonContainer=this._getNode('orionTriggerContainer');this._p2pButton=new ib(cb,this._p2pButtonContainer);this._p2pButton.setProps(this._getP2PProps());aa.addClass(this._inputContainerNode,"_11d6");}else aa.addClass(this._getNode('orionTriggerContainer'),"hidden_elem");},_resizeInputContainer:function(){if(gd)return;},_updateNewThread:function(ee){if(yc.isNewEmptyLocalThread(ee.thread_id))this.showAddFriend();},_isEmployeesOnly:function(ee){for(var fe in ee)if(!ee[fe].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(ee){var fe=this._isEmployeesOnly(ee),ge=hd?this._getNode('archiveContainer'):this._getNode('titanArchiveWarning');if(ge){if(this._titlebarTooltipAnchor)aa.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',fe);aa.conditionShow(ge,fe);if(hd)this._archiveWarning&&this._archiveWarning.setProps({shown:fe});}},updateTitlebarTooltip:function(){yc.getThreadMeta(this._threadID,(function(ee){var fe=hd?jb.findDOMNode(this._title.component):this._titlebarTooltipAnchor;if(!fe)return;jd(fe,ee.participants);}).bind(this));},_getNode:function(ee){return this._tabTemplate.getNode(ee);},_getCanonicalUserID:function(){return ra.getUserIDFromThreadID(this._threadID);},_listen:function(ee,event,fe,ge){var he=this._getNode(ee);if(he){this._eventListeners.push(ja.listen(he,event,fe.bind(this)));}else if(!ge)throw new Error('Could not find node "'+ee+'"');},_closePreClicked:function(ee){this._closeMouseDown=true;},_closeClicked:function(ee){zd(this);t.closeTab(this._threadID);if(ee instanceof vb){ee.stopPropagation();return;}ee.kill();},_closeEnter:function(ee){if(ee.keyCode===na.RETURN)this._closeClicked(ee);},_nubClicked:function(ee){ee.kill();return w.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===na.RETURN||event.keyCode===na.SPACE){w.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===na.ESC){this._handleEscape();event.kill();}else if(event.keyCode===na.TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var ee=w.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!ee&&event.kill();return true;}},_handleEscape:function(){if(this._stickersFlyoutShown){this._toggleStickersFlyoutShown(false);return;}zd(this);if(this.hasEmptyInput()){w.inform('esc-pressed',this._threadID);}else{var ee=kc._("Are you sure you want to close this chat window?"),fe=kc._("You haven't sent your message.");ob.showConfirm(ee,fe,(function(ge){if(ge){w.inform('esc-pressed',this._threadID);}else this.focus();}).bind(this),{autofocusConfirm:true});}},_titleClicked:function(event){var ee=event.getTarget();if(!eb.byClass(ee,'titlebarText')&&!eb.byClass(ee,'uiSelector')&&!eb.byClass(ee,'addToThread')&&!eb.byClass(ee,'optionMenu')&&!eb.byClass(ee,'videoicon')&&!eb.byClass(ee,'phoneicon')&&!eb.bySelector(ee,"._1fu3")&&!eb.bySelector(ee,"._1fu4")&&!eb.byClass(ee,'close')){event.kill();t.lowerTab(this._threadID);this.focus();}},_groupCallEnter:function(ee){if(ee.keyCode===na.RETURN)this._groupCallClicked(ee);},_groupCallClicked:function(ee){if(ee.target)ee.target.blur();if(this._videoCallLinkEnabled){var fe;if(ee.target&&(aa.hasClass(ee.target,'phoneicon')||aa.hasClass(ee.target,"_1fu4"))){fe='chat_tab_voice_icon';}else fe='chat_tab_icon';yc.getThreadMeta(this._threadID,function(ge){var he=ge.participants.map(function(je){return ra.getUserIDFromParticipantID(je);}),ie=he.filter(function(je){return je!==ba.getID();});w.inform('group-call-clicked',{threadID:'GROUP:'+ge.thread_fbid.toString(),usersToCall:ie,clickSource:fe,audioOnly:fe==='chat_tab_voice_icon'});});}if(hd){ee.stopPropagation();}else return false;},_callEnter:function(ee){if(ee.keyCode===na.RETURN)this._callClicked(ee);},_callClicked:function(ee){if(ee.target)ee.target.blur();var fe=this._getCanonicalUserID();if(this._videoCallLinkEnabled){var ge;if(ee.target&&(aa.hasClass(ee.target,'phoneicon')||aa.hasClass(ee.target,"_1fu4"))){ge='chat_tab_voice_icon';}else ge='chat_tab_icon';w.inform('video-call-clicked',{threadID:this._threadID,userID:fe,clickSource:ge,audioOnly:ge==='chat_tab_voice_icon'});}if(hd){ee.stopPropagation();}else return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_getUserParticipants:function(ee){var fe=[];ee.forEach(function(ge){var he=ra.getUserIDFromParticipantID(ge);he&&fe.push(he);});return fe;},_enableDesktopNotif:function(){Notification.requestPermission();},_inputPasted:function(event){if(ac.chrome()){var ee=event.clipboardData||event.originalEvent.clipboardData;if(!ee||!ee.items||ee.items.length<1)return;var fe=ee.items[0].type;if(fe!=='image/png')return;if(ee.items[0].getAsFile){var ge=ee.items[0].getAsFile();this._photoUploader&&this._photoUploader.uploadFiles([ge]);}}},_focusInput:function(){q.processEvent('focus');if(gd){this._composer&&this._composer.getInput().focus();}else this._chatInput&&this._chatInput.component.isMounted()&&this._chatInput.component.focus();},_focusTab:function(){aa.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._closeMouseDown=false;this._setCloseTooltip(true);w.inform('focus-tab',this._threadID);},_blurTab:function(){q.processEvent('blur');aa.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(ee){if(hd&&this._closeButton){this._closeButton.setProps({active:ee});return;}var fe=this._getNode('titlebarCloseButton');if(!fe)return;var ge=ee?kc._("Press Esc to close"):kc._("Close tab");yb.set(fe,ge,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===na.RETURN&&!event.shiftKey){if(ud(this)){td(this);event.kill&&event.kill();return;}qd(this);event.kill?event.kill():event.preventDefault();return;}if(event.keyCode===na.DOWN&&event.shiftKey&&this.hasEmptyInput()){event.kill&&event.kill();t.lowerTab(this._threadID);this.focus();return;}this._handleHotkeyPressed(event);},_showMessageBlockedDialog:function(ee){var fe=this._getCanonicalUserID();if(!fe)return;var ge='fbid:'+fe;sa.get(ge,function(he){n.loadModules(["MessageBlockedDialog"],function(ie){ie.show(ee.thread_id,ee.can_reply,qc.isMessageBlocked(ee),he.short_name);});});},_initializeInput:function(){if(gd){var ee=new ib(m,this._getNode('footer'));ee.setProps({bootloadPlaceholder:hb.createElement('div',null),bootloadLoader:ma('ChatTabComposerContainer.react'),initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onMount:(function(ge){this._composer=ge;}).bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:(function(){return this._toggleStickersFlyoutShown(true);}).bind(this),resizeFn:(function(){this._nubController.flyoutContentChanged();}).bind(this),placeholder:kc._("Type a message..."),photoUploaderProps:this._getPhotoUploaderProps(),fileUploaderProps:this._getFileUploaderProps(),stickerButtonProps:this._getStickerButtonProps(),p2pProps:this._getP2PProps(),onCustomLikeSelect:this._customLikeSelected.bind(this),onStickerSelect:this._stickerSelected.bind(this),threadID:this._threadID,viewer:ba.getID()});return;}var fe=kc._("Type a message...");this._chatInput=new ib(pc,this._getNode('chatInputContainer'));this._chatInput.setProps({initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:(function(){return this._toggleStickersFlyoutShown(true);}).bind(this),resizeFn:(function(ge){tb.set(this._getNode('inputContainer'),'height',ge+'px');this._nubController.flyoutContentChanged();}).bind(this),uploadPhotoFn:(function(ge){this._photoUploader&&this._photoUploader.uploadFiles([ge]);}).bind(this),placeholder:fe});},_initializeSharePreview:function(ee,fe){ja.listen(ee,'keyup',(function(){var ge=fe?fe():ee.value;if(!ge.length)if(this._urlScraper){this._urlScraper.reset();delete this._urlScraperData;}}).bind(this));kb.onAfterLoad((function(){n.loadModules(["URLScraper"],(function(ge){this._urlScraper=new ge(ee,fe);this._urlScraper.subscribe('match',(function(he,ie){this._urlScraperData=ie;this._getSharePreview().done((function(je){var ke=this._urlScraperData;je.setProps({share:null,uri:ke&&ke.url});}).bind(this));}).bind(this));}).bind(this));}).bind(this));},_getSharePreview:function(){if(!this._sharePreview&&!this._sharePreviewPromise){this._sharePreviewLoading=true;this._sharePreviewPromise=new h((function(ee){n.loadModules(["MercurySharePreview.react"],(function(fe){this._sharePreview=new ib(fe,this._getNode('shareAttachmentShelf'));this._sharePreview.setProps({imageSize:{width:ed,height:ed},location:ta.CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:(function(){wd(this);this._unblockSend();}).bind(this)});this._sharePreviewLoading=false;ee(this._sharePreview);}).bind(this));}).bind(this));}return this._sharePreviewPromise;},_initializeThingsWithInputFn:function(ee,fe){if(gd)this._getValueFromReactComposer=fe;this._initializeSharePreview(ee,fe);yc.getThreadMeta(this._threadID,(function(ge){if(ge&&ge.folder===za.PENDING){var he=da.create('div');da.appendContent(this._getNode('chatConv'),he);this._pendingActions=he;jb.render(hb.createElement(m,{bootloadPlaceholder:hb.createElement('div',{style:{height:27}}),bootloadLoader:ma('ChatPendingActions.react'),onDeleteClick:(function(ie){vc.changeFolder(this._threadID,za.OTHER);t.closeTab(this._threadID);}).bind(this),onReplyClick:(function(ie){vc.changeFolder(this._threadID,za.INBOX);da.remove(he);delete this._pendingActions;this._updateControls(ge);}).bind(this)}),he);}wc.getServerIDFromClientID(this._threadID,(function(ie){this._typingDetector=new zb(this._getCanonicalUserID(),ee,'mercury-chat',null,ie,fe);}).bind(this));}).bind(this));},_getInputValue:function(){if(this._getValueFromReactComposer)return this._getValueFromReactComposer();if(!this._chatInput||!this._chatInput.component.isMounted())return '';return this._chatInput.component.getValue()||'';},appendTextToInput:function(ee){if(gd){this._composer&&this._composer.getInput().appendText(ee);}else if(this._chatInput&&this._chatInput.component.isMounted())this._chatInput.component.appendText(ee);},_hasUnfinishedPost:function(){return vd(this)||this.isUploading();},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){vc.markRead(this._threadID);vc.markSeen(this._threadID);return true;}return false;},_chatConvClicked:function(ee){this.tryMarkAsRead();if(eb.byTag(ee.getTarget(),'a')||da.getSelection())return;this.focus();},_inputContainerClicked:function(ee){this.tryMarkAsRead();this.focus();},_initializePageMessagingIndicator:function(){if(!this._pagesMessageIndicator)return;aa.hide(this._pagesMessageIndicator);this._pagesMessageIndicatorHandler=db.tryCreateHandler(this._threadID,this._pagesMessageIndicator,this._onlineStatus);this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.checkResponsiveness();},showTypingIndicator:function(ee){this._renderTypingIndicator();aa.conditionClass(this._tabElem,"_54m8",ee);},_renderTypingIndicator:function(){var ee=aa.hasClass(this._tabElem,'highlightTab')?'light':'dark';jb.render(hb.createElement(xa,{color:ee}),this._getNode('animationContainer'));},_updateUnreadCount:function(ee){var fe=ee.unread_count;if(typeof fe!='undefined'){var ge=!!fe&&(!o.showsTabUnreadUI||o.showsTabUnreadUI()),he=this._getNode('numMessages');aa.conditionShow(he,ge);aa.conditionClass(this._tabElem,'highlightTab',ge);this._renderTypingIndicator();nd(this._threadID,this._tabElem,ge);da.setContent(he,fe);}},ensureValidCanonicalGroup:function(ee){if(this._messagesView&&this._messagesView.getThreadID()===this._threadID)return;if(ee[this._messagesView.getThreadID()])this._updateChatTabMessagesView(this._threadID);},updateCallLink:function(){var ee=ra.isGroupChat(this._threadID);if(ee&&p.get('rtc_conferencing_www')){this._videoCallLinkEnabled=true;if(!hd)aa.conditionClass(this._tabElem,"_26-s",this._videoCallLinkEnabled);}else{var fe=this._getCanonicalUserID();if(!fe||fe===ba.getID()||!ka.isUser(fe)){if(hd){if(this._videoCallButton)this._videoCallButton&&this._videoCallButton.setProps({shown:false});}else{var ge=this._getNode('videoCallLink');if(ge)aa.hide(ge);var he=this._getNode('voiceCallLink');if(he)aa.hide(he);}this._videoCallLinkEnabled=false;return;}this._videoCallLinkEnabled=la.isCallable(fe);if(!hd){aa.conditionClass(this._tabElem,"_4hwz",this._videoCallLinkEnabled);sa.get(ra.getParticipantIDFromUserID(fe),(function(ie){la.callButtonTooltip(fe,ie.short_name);this._setCallButtonTooltips(fe,ie.short_name);}).bind(this));}}},_setCallButtonTooltips:function(ee,fe){var ge=la.callButtonTooltip(ee,fe),he=la.voiceCallButtonTooltip(ee,fe);yb.set(this._getNode('videoCallLink'),ge);var ie=this._getNode('voiceCallLink');if(ie)yb.set(ie,he);},_initializeSheetController:function(){this._sheetController=new v(this._threadID,this._getNode('sheet'),this._tabElem,this);this._sheetController.onClickMessagesBlockedSheet((function(){vc.unblockMessages(this._threadID);this.focus();}).bind(this));this._sheetController.onClickNewMessagesSheet((function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();this.tryMarkAsRead();}).bind(this));this._sheetController.onClickThreadIsMutedSheet((function(){vc.unmute(this._threadID);this.focus();}).bind(this));this._sheetController.onClickSecretModeSheet((function(){vc.turnOffSecretMode(this._threadID);this.focus();}).bind(this));this._sheetController.onTokensChanged((function(ee,fe){this._handleSheetControllerTokensChanged(fe);}).bind(this));this._nubController=new ab().init(this._tabElem);this._sheetController.onResize((function(){this._nubController.flyoutContentChanged();}).bind(this));this._nubController.subscribe('resize',(function(){this._resizeInputContainer();}).bind(this));},_handleSheetControllerTokensChanged:function(ee){this._updateP2PParticipants(ee.tokens);yc.getThreadMeta(this._threadID,(function(fe){this._updateControls(fe,ee.token_count,ee.tokens);}).bind(this));this._updateMessagesViewIfNecessary(ee);},_updateMessagesViewIfNecessary:function(ee){if(!qa.MessengerChatTabSnapCanonialGK||!yc.isEmptyLocalThread(this._threadID))return;var fe=pa.get();fe.unsubscribe(this._canonicalGroupSearchSubscriptionID);if(ee.token_count===1){var ge=ee.tokens[0].info&&ee.tokens[0].info.uid;this._updateMercuryMessagesViewCanonical(ra.getThreadIDFromUserID(ge));return;}this._updateMercuryMessagesViewCanonical(this._threadID);if(ee.token_count>1){var he=ee.tokens.map(function(ie){return ie.info.uid;});this._canonicalGroupSearchSubscriptionID=fe.getCanonicalGroupThreadIDForParticipants(Array.from(he),this._updateMercuryMessagesViewCanonical.bind(this));}},_updateMercuryMessagesViewCanonical:function(ee){if(ee){this._updateChatTabMessagesView(ee);this._messagesView.scrollToBottom();}},_updateP2PParticipants:function(ee){var fe;if(ee&&ee.length===1&&ee[0].info&&ee[0].info.uid)fe=[ra.getParticipantIDFromUserID(ee[0].info.uid)];if(this._p2pButton){this._p2pButton.setProps({participantIDs:fe});}else if(this._composer)this._composer.setParticipantIDs(fe);},_initializeHeader:function(){this._initializeTitle();this._initializeCloseButton();this._initializeReactMenu();this._initializeAddToThreadButton();this._initializeVideoCallButton();this._initializeArchiveWarning();},_loadReactMenu:function(){var ee=ra.isGroupChat(this._threadID),fe=yc.isNewEmptyLocalThread(this._threadID),ge=this._sheetController.openAddFriendsSheet.bind(this._sheetController);ma('ChatTabMenu.react').load().done((function(he){this._reactChatTabMenu=new ib(he,this._getNode('menuContainer'));this._reactChatTabMenu.setProps({sheetController:this._sheetController,onFileUploaderMounted:this.setFilesUploader.bind(this),nameConversationFunc:(function(){return this.showNameConversation();}).bind(this),isGroupChat:ee,isEmptyChat:fe,showAddFriend:ge,threadID:this._threadID,otherUserID:this._getCanonicalUserID(),attachmentsShelf:this._getNode('fileAttachmentShelf'),onUploadFinished:this._unblockSend.bind(this),onUpdateAttachmentsShelf:(function(){return wd(this);}).bind(this),onSubmit:this._focusInput.bind(this)},(function(){this._menuPromiseResolve(this._reactChatTabMenu);}).bind(this));}).bind(this));return this._menuPromise;},_initializeReactMenu:function(){this._menuPromise=new h((function(ee){this._menuPromiseResolve=ee;}).bind(this));this._listen('menuButton','click',(function(ee){ee.preventDefault();this._loadReactMenu().done(function(fe){fe.component.open();});}).bind(this));},_initializeArchiveWarning:function(){var ee=this;if(hd){var fe=(function(){var ge=ee._getNode('archiveContainer');if(!ge)return {v:undefined};kb.onAfterLoad((function(){n.loadModules(["ChatArchiveWarning.react"],(function(he){this._archiveWarning=new ib(he,ge);this._archiveWarning.setProps({isFBAtWork:ec.is_work_user,shown:true});}).bind(this));}).bind(ee));})();if(typeof fe==='object')return fe.v;}},_initializeAddToThreadButton:function(){if(hd){kb.onAfterLoad((function(){n.loadModules(["ChatAddToThreadButton.react"],(function(ee){this._addToThreadButton=new ib(ee,this._getNode('addToThreadContainer'));this._addToThreadButton.setProps({isFBAtWork:ec.is_work_user,onClick:this._addFriendLinkClicked.bind(this),shown:true});}).bind(this));}).bind(this));}else this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);},_initializeVideoCallButton:function(){kb.onAfterLoad((function(){n.loadModules(["ChatVideoCallButton.react"],(function(ee){var fe=ra.isGroupChat(this._threadID);if(fe&&p.get('rtc_conferencing_www')){if(hd){this._videoCallButton=new ib(ee,this._getNode('videoCallButtonContainer'));this._videoCallButton.setProps({shown:true,isAudio:false,isGroupChat:true,userID:null,onClick:this._groupCallClicked.bind(this),onKeyUp:this._groupCallEnter.bind(this)});this._voiceCallButton=new ib(ee,this._getNode('voiceCallButtonContainer'));this._voiceCallButton.setProps({shown:true,isAudio:true,isGroupChat:true,userID:null,onClick:this._groupCallClicked.bind(this),onKeyUp:this._groupCallEnter.bind(this)});}else{this._listen('videoCallLink','click',this._groupCallClicked,true);this._listen('videoCallLink','keyup',this._groupCallEnter,true);if(this._getNode('voiceCallLink')){this._listen('voiceCallLink','click',this._groupCallClicked,true);this._listen('voiceCallLink','keyup',this._groupCallEnter,true);}}}else{if(!ra.getUserIDFromThreadID(this._threadID))return;if(hd){var ge=this._getCanonicalUserID();this._videoCallButton=new ib(ee,this._getNode('videoCallButtonContainer'));this._videoCallButton.setProps({shown:true,isAudio:false,userID:ge,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)});var he=this._getNode('voiceCallButtonContainer');if(he){this._voiceCallButton=new ib(ee,he);this._voiceCallButton.setProps({shown:true,isAudio:true,userID:ge,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)});}}else{this._listen('videoCallLink','click',this._callClicked,true);this._listen('videoCallLink','keyup',this._callEnter,true);if(this._getNode('voiceCallLink')){this._listen('voiceCallLink','click',this._callClicked,true);this._listen('voiceCallLink','keyup',this._callEnter,true);}}}}).bind(this));}).bind(this));},_initializeCloseButton:function(){this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);if(hd)kb.onAfterLoad((function(){n.loadModules(["ChatCloseButton.react"],(function(ee){this._closeButton=new ib(ee,this._getNode('titlebarCloseButtonContainer'));this._closeButton.setProps({active:this.isFocused(),className:"_3olu _3olv",onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)});}).bind(this));}).bind(this));},_initializeTitle:function(){if(hd){var ee=yc.getThreadMetaNow(this._threadID);this._title=new ib(y,this._getNode('titleContainer'));this._title.setProps({isNewThread:yc.isNewEmptyLocalThread(this._threadID),thread:ee,viewer:ba.getID()});}},_initializeTitleHREF:function(){cc.getThreadURI(this._threadID,(function(fe){return this._setTitleHref(fe);}).bind(this));this._titlebarTooltipAnchor=this._getNode('titlebarText');var ee=this._getCanonicalUserID();if(this._getCanonicalUserID())sa.get(ra.getParticipantIDFromUserID(ee),(function(fe){if(fe.href)this._setTitleHref(fe.href);}).bind(this));},_initializeUIListeners:function(){if(this._pagesMessageIndicator)this._listen('scrollingArea','scroll',(function(event){var ee=event.target;if(ee.scrollHeight-ee.offsetHeight!==ee.scrollTop)this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.hideIndicatorAndPreventFutureShow();}).bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);if(this._getNode('inputContainer'))this._listen('inputContainer','click',this._inputContainerClicked);this._listen('sheet','keydown',(function(event){if(!event.getModifiers().any&&event.keyCode===na.TAB){this._focusInput();event.kill();}if(event.keyCode===na.ESC)this._handleEscape();}).bind(this));if(this._getNode('officeStatus'))this._listen('officeStatus','click',function(){return false;},true);},setFilesUploader:function(ee){this._filesUploader=ee;},_getPhotoUploaderProps:function(){return {className:"_6gd",customUI:true,imageClassName:"hidden_elem",linkClassName:"_6gb _6ge",onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)};},_initializeAutoSendPhotoUploader:function(){if(gd)return;this._photoUploader=jb.render(hb.createElement(s,this._getPhotoUploaderProps()),this._getNode('photoUploaderContainer'));},_getStickerButtonProps:function(){return {className:"_6gb _6gf",flyoutAlignment:dd,onFlyoutShown:this._onStickerFlyoutShown.bind(this),onFlyoutHidden:this._onStickerFlyoutHidden.bind(this),onLoad:(function(ee){this._stickerButton=ee;}).bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),threadID:this._threadID};},_initializeStickers:function(){if(gd)return;var ee=this._getStickerButtonProps();jb.render(hb.createElement(m,babelHelpers._extends({bootloadPlaceholder:hb.createElement('a',{className:ee.className}),bootloadLoader:ma('ChatStickerButton.react')},ee)),this._getNode('stickerButtonContainer'));},_getFileUploaderProps:function(){var ee=this._getPhotoUploaderProps();ee.linkClassName="_6gb _6gg";ee.imagesOnly=false;return ee;},_initializeAutoSendFileUploader:function(){if(gd)return;if(!this._fileUploaderNode)return;this._fileUploader=jb.render(hb.createElement(s,this._getFileUploaderProps()),this._fileUploaderNode);},_initializeContentSearch:function(){if(gd)return;if(this._contentSearchNode){var ee="_6gb _6gs";jb.render(hb.createElement(m,{bootloadPlaceholder:hb.createElement('a',{className:ee}),bootloadLoader:ma('ChatContentSearchButton.react'),className:ee,getQuery:(function(){return this._getInputValue();}).bind(this),onLoad:(function(fe){this._contentSearchButton=fe;}).bind(this),onSelect:(function(fe,ge){var he=this.getInputElem();he&&he.select&&he.select();if(fe.platformFBID.toString()===qa.MessengerAppID){this._stickerSelected(fe.resultID.toString());}else{this._photoUploader&&this._photoUploader.uploadURL({attribution_app_id:fe.platformFBID,errorDialogParams:{body:kc._("There was a problem sending this GIF. Choose another one and try again."),title:kc._("Couldn't Send GIF")},external_image_url:fe.source.url,preview_url:fe.media.preview?fe.media.preview.url:fe.media.thumbnail.url,source:fe.source});this._messagesView&&this._messagesView.scrollToBottom();}}).bind(this)}),this._contentSearchNode);aa.addClass(this._inputContainerNode,"_35li");l.bumpEntityKey('chat.web','content_search_button.mounting_attempted');}},_initializeDragDropTarget:function(){if(dc.canUploadFiles){var ee=ea.scry(this._tabElem,"._1ia");if(ee&&ee.length>0){this._dropTarget=new fa(ee[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}}},_initializeP2PChatThreadBannerContainer:function(){var ee=ea.scry(this._tabElem,"._2hc2");if(ee&&ee.length>0){this._p2pChatThreadBannerContainerEl=ee[0];kb.onAfterLoad((function(){n.loadModules(["P2PChatThreadBannerContainer.react"],(function(fe){this._p2pChatThreadBannerContainer=new ib(fe,this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable(),otherUserID:ra.getUserIDFromThreadID(this._threadID),threadID:this._threadID});}).bind(this));}).bind(this));}},_initializeP2PRainMoneyContainer:function(){if(!this._isP2PEnabled||!bb.P2PRainMoneyWWW)return false;var ee=ea.scry(this._tabElem,"._3bpu");if(ee&&ee.length>0){this._p2pRainMoneyContainerEl=ee[0];kb.onAfterLoad((function(){n.loadModules(["P2PRainMoneyContainer.react"],(function(fe){this._p2pRainMoneyContainer=new ib(fe,this._p2pRainMoneyContainerEl);this._p2pRainMoneyContainer.setProps({threadID:this._threadID,width:this._tabElem.clientWidth});}).bind(this));}).bind(this));}},setP2PChatThreadBannerContainerVisibility:function(){if(this._p2pChatThreadBannerContainer)this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable()});},isChatViewable:function(){return (this._tabElem&&aa.hasClass(this._tabElem,'opened')&&!aa.hasClass(this._tabElem,'hidden_elem'));},_initializeP2P:function(){if(gd)return;this._renderP2PButton();},_initializeUnloadListeners:function(){this._checkUnsentMessages=gc((function(){if(this._hasUnfinishedPost())return kc._("You haven't sent your message yet. Do you want to leave without sending?");if(tc.getNumberLocalMessages(this._threadID))return kc._("Your message is still being sent. Are you sure you want to leave?");return null;}).bind(this));kb.onBeforeUnload(this._checkUnsentMessages,false);this._logUnsentPhotos=gc(zd.bind(null,this));kb.onUnload(this._logUnsentPhotos);},_handlePUSubmit:function(ee,fe){xd(this,fb.UPLOAD_START,fe);sd(this,'',[],(function(ge){if(this._threadID!==ge.thread_id){this._newThreadIDFromPhotoUpload=ge.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(ge.thread_id);}ge.content_attachment=null;zc.addAttachmentPlaceholder(ge,fe.upload_id,fe);}).bind(this));ce('submit',fe);this._focusInput();},_handlePULastUploadFailed:function(ee,fe){xd(this,fb.CLIENT_ERROR,fe);ce('failed',fe);zc.cancelAttachmentPlaceholder(fe.upload_id,fe);var ge=kc._("Photo Upload Failed"),he=kc._("Please try again. Make sure you are uploading a valid photo.");if(fe.errorDialogParams){ge=fe.errorDialogParams.title||ge;he=fe.errorDialogParams.body||he;}ob.show(ge,he);},_handlePULastUploadCanceled:function(ee,fe){xd(this,fb.CANCEL_DURING_UPLOAD,fe);ce('canceled',fe);zc.cancelAttachmentPlaceholder(fe.upload_id,fe);},_handlePUAllUploadsCompleted:function(ee,fe){xd(this,fb.ALL_UPLOADS_DONE,fe);ce('completed',fe);zc.confirmAttachmentPlaceholder(fe.upload_id,fe);var ge=fe.image_ids.length||fe.attachments.length;rd(this,ge);},_stickerSelected:function(ee){sd(this,'',[],(function(fe){fe.has_attachment=true;fe.sticker_id=ee;zc.send(fe);this.focus();}).bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_customLikeSelected:function(ee,fe){sd(this,ee.emoji,[],(function(ge){ge.has_attachment=false;zc.send(ga.setEmojiSize(ge,fe));this.focus();}).bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(ee){var fe=ha.symbols[ee];if(!fe)return;if(gd){this._composer&&this._composer.getInput().insertEmoticon(fe);return;}else if(!p.get('chat_basic_input')){this._chatInput.component.insertEmoticon(fe);return;}this._selectionPosition=this._selectionPosition||new mb(this._getNode('input'));var ge=xb.getInstance(this._getNode('input')),he=ge.getValue(),ie=ia.insertEmoticon(fe,he,this._selectionPosition.getPos());ge.setValue(ie.result);this._selectionPosition.setPos(ie.start,ie.end);},_p2pTriggered:function(){sd(this,'',[],(function(ee){this.focus();}).bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_onStickerFlyoutShown:function(ee){this.focus();ee();this._stickersFlyoutShown=true;},_searchStickers:function(ee,fe){this._stickersFlyout&&this._stickersFlyout.setProps({packID:rb.SEARCH_PACK_ID,trigger:ee},fe);},_onStickerFlyoutHidden:function(){this._stickersFlyoutShown=false;if(!gd)this.focus();},_setTitleHref:function(ee){if(hd){this._title&&this._title.setProps({href:ee});}else{var fe=this._getNode('titlebarText');fe.setAttribute('href',ee);fe.removeAttribute('rel');aa.removeClass(fe,'noLink');}},_unblockSend:function(){if(!this._blocked||ud(this))return;this._blocked=false;qd(this);this._sheetController.closeUploadWarningTabSheet();},_logOpenTab:function(){new j('/ajax/chat/opentab_tracking.php',{threadID:this._threadID,userID:this._getCanonicalUserID(),signatureID:this._signatureID}).send();}});function ce(ee,fe){id.debug('photo_uploader:'+ee,'{}');}function de(ee,fe){if(!fe)return ee;var ge=fe.getImageFiles();if(ge.length>0){ee.image_ids=ge;ee.has_attachment=true;}var he=fe.getAnimatedImageFiles();if(he.length>0){ee.gif_ids=he;ee.has_attachment=true;}var ie=fe.getVideoFiles();if(ie.length>0){ee.video_ids=ie;ee.has_attachment=true;}var je=fe.getAudioFiles();if(je.length>0){ee.audio_ids=je;ee.has_attachment=true;}var ke=fe.getFiles();if(ke.length>0){ee.file_ids=ke;ee.has_attachment=true;}return ee;}f.exports=yd;},null);
__d('MNCommerceActionTypes',['keyMirrorRecursive'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null},RETAIL_ITEM:{LOADED:null,LOAD_ERROR:null,RELOAD:null},PROMOTION_STATE:{LOADED:null,LOAD_ERROR:null,RELOAD:null}});f.exports=i;},null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';k=babelHelpers.inherits(m,h);l=k&&k.prototype;function m(){l.constructor.call(this,i);this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}m.prototype.__onDispatch=function(n){var o=n.type;switch(o){case j.DIALOG.SHOW:this.$MNCommerceDialogStateStore1=n.dialogContainer;this.$MNCommerceDialogStateStore2=n.state;this.__emitChange();break;case j.DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};m.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};m.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new m();},null);
__d('FBRTCLogger',['Log','LogHistory','MarauderLogger','formatDate','pageID'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m='webrtc',n='sent_message',o='received_message',p='send_succeeded',q='send_failed',r='info',s='call_action',t='client_event',u='client_error',v='type',w='msg_id',x='ack_msg_id',y='call_id',z='from',aa='to',ba='content',ca='tag',da='peer_id',ea='error_code',fa='trigger',ga='endcallstats',ha=null;ia.getInstance=function(){'use strict';if(!ha)ha=new ia();return ha;};function ia(){'use strict';this.$FBRTCLogger1=i.getInstance(m);}ia.prototype.logToConsole=function(ja){'use strict';var ka='Console';this.$FBRTCLogger2(null,null,ka,ja);this.$FBRTCLogger1.log(ka,ja);};ia.prototype.logReceivedMessage=function(ja,ka,la){'use strict';var ma={};ma[z]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(o,ma);this.$FBRTCLogger2(ja,ka,'Received',la.type+', '+la.msg_id);};ia.prototype.logSentMessage=function(ja,ka,la){'use strict';var ma={};ma[aa]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(n,ma);this.$FBRTCLogger2(ja,ka,'Sent',la.type+', '+la.msg_id);};ia.prototype.logSentMessageSuccess=function(ja,ka,la,ma){'use strict';var na={};na[da]=ja;na[y]=ka;na[v]=la;na[w]=ma;this.$FBRTCLogger3(p,na);};ia.prototype.logSentMessageFailure=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[v]=la;oa[w]=ma;oa[ea]=na;this.$FBRTCLogger3(q,oa);this.$FBRTCLogger2(ja,ka,'Send Failed',la+', '+na);};ia.prototype.logCallAction=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[s]=la;oa[ba]=ma;if(na)oa[fa]=na;this.$FBRTCLogger3(s,oa);this.$FBRTCLogger2(ja,ka,'CallAction',la+', '+ma);};ia.prototype.logEvent=function(ja,ka,event){'use strict';var la={};la[da]=ja;la[y]=ka;la[ba]=event;this.$FBRTCLogger3(t,la);this.$FBRTCLogger2(ja,ka,'Event',event);};ia.prototype.logInfo=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(r,ma);this.$FBRTCLogger2(ja,ka,'Info',la);};ia.prototype.logError=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(u,ma);this.$FBRTCLogger2(ja,ka,'Error',la);};ia.prototype.logErrorWithoutID=function(ja){'use strict';this.logError(null,null,ja);};ia.prototype.logEndCallSummary=function(ja){'use strict';if(!ja)return;var ka={};ka[da]=ja.peerID;ka[y]=ja.callID;ka[ca]=ga;ka[ba]=ja.toString();var la=ja.getExtraInfo();for(var ma in la)if(la.hasOwnProperty(ma))ka[ma]=la[ma];this.$FBRTCLogger3(r,ka);this.$FBRTCLogger2(ja.peerID,ja.callID,'Call Summary',ka);};ia.prototype.$FBRTCLogger3=function(ja,ka){'use strict';ka.page_id=l;this.$FBRTCLogger1.log(ja,ka);j.log(ja,m,ka);};ia.prototype.$FBRTCLogger2=function(ja,ka,la,ma){'use strict';};ia.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};ia.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown',RESET_CALL:'install_screen_sharing_ext_dialog'};ia.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};f.exports=ia;},null);
__d('FBRTCLocalMessageQueue',['CacheStorage','FBRTCLogger','Map','RTCConfig'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l='localstorage',m='RTC_',n='offer',o='offer_msg',p='data_',q=30*1000,r=15*1000,s=500,t=new j();function u(){'use strict';this.$FBRTCLocalMessageQueue1=i.getInstance();}u.prototype.enqueueOffer=function(v,w){'use strict';var x=this.$FBRTCLocalMessageQueue2(v,o);this.$FBRTCLocalMessageQueue3(x,n,w);};u.prototype.getOffer=function(v){'use strict';var w=this.$FBRTCLocalMessageQueue2(v,o);return this.$FBRTCLocalMessageQueue4(w,n);};u.prototype.removeOffer=function(v){'use strict';var w=this.$FBRTCLocalMessageQueue2(v,o);w.remove(n);};u.prototype.enqueueMessage=function(v,w,x,y){'use strict';var z=p+x.toString(),aa=t.get(v)||new j();aa.set(z,y);t.set(v,aa);this.$FBRTCLocalMessageQueue1.logToConsole('Queued '+z);};u.prototype.drainQueue=function(v,w){'use strict';var x=t.get(v)||new j(),y,z;for(var aa=x,ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){if(ba){if(ca>=aa.length)break;var da=aa[ca++];y=da[0];z=da[1];}else{ca=aa.next();if(ca.done)break;var ea=ca.value;y=ea[0];z=ea[1];}void y;w(z);}t.set(v,new j());};u.prototype.enableDequeuing=function(v,w,x,y){'use strict';if(y===undefined)y=r;this.$FBRTCLocalMessageQueue5(v,w,x,y);};u.prototype.$FBRTCLocalMessageQueue5=function(v,w,x,y){'use strict';var z=this.$FBRTCLocalMessageQueue2(v,w),aa=z.keys(),ba=aa.length;for(var ca=0;ca<ba;ca++){var da=this.$FBRTCLocalMessageQueue6(z,aa[ca]);if(da&&x)x(da);}this.$FBRTCLocalMessageQueue1.logToConsole('Dequeued '+ba+' ('+v+') with '+y+' left)');if(y>0){y-=s;setTimeout((function(){this.$FBRTCLocalMessageQueue5(v,w,x,y);}).bind(this),s);}};u.prototype.$FBRTCLocalMessageQueue3=function(v,w,x){'use strict';var y={__t:Date.now(),__d:x};v.set(w,y);};u.prototype.$FBRTCLocalMessageQueue4=function(v,w){'use strict';var x=v.get(w);if(x&&this.$FBRTCLocalMessageQueue7(x)){return x.__d;}else if(x)v.remove(w);return null;};u.prototype.$FBRTCLocalMessageQueue6=function(v,w){'use strict';var x=this.$FBRTCLocalMessageQueue4(v,w);if(x!==null){v.remove(w);return x;}return null;};u.prototype.$FBRTCLocalMessageQueue7=function(v){'use strict';return Date.now()-v.__t<q;};u.prototype.$FBRTCLocalMessageQueue2=function(v,w){'use strict';return new h(l,''+m+v+'_'+w+'_');};f.exports=u;},null);
__d('FBRTCCallControlActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i({ACCEPT_ESCALATION:null,HANG_UP:null,PARENT_WINDOW_START_CALL:null,TOGGLE_FULL_SCREEN:null,TOGGLE_MUTE_AUDIO:null,TOGGLE_MUTE_VIDEO:null,TOGGLE_SCREEN_SHARING:null,TOGGLE_SELF_VIEW:null,SHOW_SETTINGS:null,START_CALL:null,DECLINE_ESCALATION:null,RECEIVED_SIGNALING_MESSAGE:null,RESET_CALL:null,OPEN_SCREEN_IN_NEW:null,CLOSE_STANDALONE_SCREEN:null}),k={Types:j,hangUp:function(){h.dispatch({type:j.HANG_UP});},toggleMuteAudio:function(){h.dispatch({type:j.TOGGLE_MUTE_AUDIO});},toggleMuteVideo:function(){h.dispatch({type:j.TOGGLE_MUTE_VIDEO});},toggleFullScreen:function(){h.dispatch({type:j.TOGGLE_FULL_SCREEN});},toggleSelfView:function(){h.dispatch({type:j.TOGGLE_SELF_VIEW});},showSettings:function(){h.dispatch({type:j.SHOW_SETTINGS});},toggleScreenSharing:function(){h.dispatch({type:j.TOGGLE_SCREEN_SHARING});},startCall:function(){h.dispatch({type:j.START_CALL});},openScreenInNewWindow:function(){h.dispatch({type:j.OPEN_SCREEN_IN_NEW});},receivedSignalingMessage:function(l){h.dispatch({type:j.RECEIVED_SIGNALING_MESSAGE,message_type:l.msgType,message:l});},acceptEscalation:function(){h.dispatch({type:j.ACCEPT_ESCALATION});},declineEscalation:function(){h.dispatch({type:j.DECLINE_ESCALATION});},resetCall:function(l){h.dispatch({type:j.RESET_CALL,trigger:l});},parentWindowStartCall:function(){h.dispatch({type:j.PARENT_WINDOW_START_CALL});}};f.exports=k;},null);
__d('FBRTCMessageListener',['Arbiter','ChannelConstants','FBRTCCallControlActions','FBRTCLocalMessageQueue','FBRTCSupport','RTCConfig','guid','invariant','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=45*1000,r='rtc_child_window_ready',s='rtc_child_window_start_call',t='rtc_child_window_message',u=[],v=null,w=null,x=null,y=null,z=null,aa=false,ba=null,ca={init:function(da,ea){if(aa)return;aa=true;h.subscribe(i.getArbiterType('webrtc'),(function(ga,ha){this._onMessage(ha.obj);}).bind(this));h.subscribe(i.getArbiterType('webrtc_offer'),(function(ga,ha){this._onMessage(ha.obj);}).bind(this));h.subscribe(i.getArbiterType('webrtc_offerack'),(function(ga,ha){this._onMessage(ha.obj);}).bind(this));if(m.RtcConferencingGK)h.subscribe(i.getArbiterType('rtc_multi_json'),(function(ga,ha){this._onMultiwayMessage(ha.obj);}).bind(this));this._localMessageQueue=new k();if(m.PassMessagesBetweenWindowsGK){if(l.isWebrtcSupported()&&window.addEventListener){var fa=da?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener('message',fa,false);}if(da)this._connectToParentWindow(ea);}},setParentWindowNonce:function(da){y=da;},generateNewNonce:function(){z=n();return z;},setMultiwayMessageHandler:function(da,ea){!!ba?o(0):undefined;ba=ea?da.bind(ea):da;},_onMultiwayMessage:function(da){this.emit('multiwayMessageReceived',da);if(ba)ba(da);},setMessageHandler:function(da,ea){!!v?o(0):undefined;v=ea?da.bind(ea):da;while(u.length)v(u.shift());},removeMessageHandler:function(){v=null;},_onMessage:function(da){this.emit('messageReceived',da);if(v){v(da);}else u.push(da);this._passMessageToChildWindow(da);},_connectToParentWindow:function(da){if(window.opener&&window.opener.postMessage){var ea={type:r,nonce:y,childNonce:this.generateNewNonce(),peerID:da};window.opener.postMessage(ea,window.location.origin);}},_verifyWindowMessage:function(event){return event.origin===window.location.origin&&event.data&&z&&event.data.nonce===z;},_handleWindowMessageToParent:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===r){this.setParentWindowNonce(event.data.childNonce);this._setChildWindow(event.source);this._replayQueuedMessagesToChild(event.data.peerID,w);}},_handleWindowMessageToChild:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===t)this._onMessage(event.data.message);if(event.data.type===s)j.parentWindowStartCall();},_replayQueuedMessagesToChild:function(da,ea){this._localMessageQueue.drainQueue(da,function(fa){var ga={type:t,nonce:y,message:fa};ea.postMessage(ga,window.location.origin);});},_setChildWindow:function(da){w=da;clearTimeout(x);x=setTimeout(function(){w=null;},q);this._startCallInChildWindow();this.generateNewNonce();},_passMessageToChildWindow:function(da){if(w){var ea={type:t,nonce:y,message:da};w.postMessage(ea,window.location.origin);}},_startCallInChildWindow:function(){if(w){var da={type:s,nonce:y};w.postMessage(da,window.location.origin);}}};p(ca,{messageReceived:true,multiwayMessageReceived:true});f.exports=ca;},null);
__d('FBRTCMessageHandler',['Bootloader','FBRTCMessageListener','invariant','FBRTCSupport'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=null,m=false,n=null,o={init:function(){if(!m&&k.isReceiveWebrtcSupported()){m=true;i.init(false);i.once('messageReceived',function(r){p();});i.once('multiwayMessageReceived',function(r){q();});}},resetListener:function(){!l?j(0):undefined;i.removeMessageHandler();i.setMessageHandler(l.onMessageReceived,l);}};function p(){if(!l)h.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(r,s,t,u){l=new r(s,u,new t());i.setMessageHandler(l.onMessageReceived,l);});}function q(){if(!n)h.loadModules(["FBRTCGroupCallIncomingController"],function(r){n=new r();i.setMultiwayMessageHandler(n.onMessageReceived,n);});}f.exports=o;},null);
__d('HotLikeSound',['MercuryConfig','SoundPlayer','StickerConstants'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();i.init(['audio/ogg','audio/mpeg']);var k=[h['sound.hot_like_grow_mp3_url'],h['sound.hot_like_grow_ogg_url']],l=[h['sound.hot_like_pop_mp3_url'],h['sound.hot_like_pop_ogg_url']],m=[h['sound.hot_like_outgoing_small_mp3_url'],h['sound.hot_like_outgoing_small_ogg_url']],n=[h['sound.hot_like_outgoing_medium_mp3_url'],h['sound.hot_like_outgoing_medium_ogg_url']],o=[h['sound.hot_like_outgoing_large_mp3_url'],h['sound.hot_like_outgoing_large_ogg_url']],p=function(){return false;},q={setCheckSoundEnabledFunc:function(r){p=r;},start:function(){this._play(k);},stop:function(){i.stop(k);},pop:function(){this.stop();this._play(l);},snap:function(r){this.stop();if(r===j.HOT_LIKE_SMALL_STICKER_ID)this._play(m);if(r===j.HOT_LIKE_MEDIUM_STICKER_ID)this._play(n);if(r===j.HOT_LIKE_LARGE_STICKER_ID)this._play(o);},_play:function(r){if(p())i.play(r);}};f.exports=q;},null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=h.delivery_timeout||120000;r.getForFBID=function(t){return s.getForFBID(t);};r.get=function(){return s.get();};function r(t){this.$MercuryDeliveryState1=t;this.$MercuryDeliveryState2=j.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=m.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=l.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));o.subscribe(p(this.$MercuryDeliveryState8,300,this));}r.prototype.$MercuryDeliveryState7=function(t,u){for(var v in u){var w=u[v];w.forEach((function(x){if(this.$MercuryDeliveryState9(x)){this.$MercuryDeliveryState5.push(x);this.$MercuryDeliveryState4.getServerIDFromClientID(v,(function(y){if(!this.$MercuryDeliveryState6[y])this.$MercuryDeliveryState6[y]=[];this.$MercuryDeliveryState6[y].push(x.message_id);}).bind(this));}}).bind(this));}if(o.isActive(q))this.$MercuryDeliveryState8();};r.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&this.$MercuryDeliveryState6.length===0)return;var t=this.$MercuryDeliveryState5.map(function(u){return u.message_id;});if(t)this.$MercuryDeliveryState2.sendDeliveryReceipts(t,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState5=[];};r.prototype.$MercuryDeliveryState9=function(t){var u=t.author?i.getUserIDFromParticipantID(t.author):null;if(u===this.$MercuryDeliveryState1)return false;if(!t.is_unread)return false;if(!n.allows(u))return false;return true;};var s=new k(r);f.exports=r;},null);
__d('MercuryFilters',['MessagingTag','arrayContains'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=[h.UNREAD],k={ALL:'all',UNREAD:h.UNREAD,getSupportedFilters:function(){return j.concat();},isSupportedFilter:function(l){return i(j,l);}};f.exports=k;},null);
__d('MercuryOrderedThreadlist',['LogHistory','MercuryActionType','MercuryDispatcher','MercuryFilters','MercuryFolders','MercuryPayloadSource','MercurySingletonMixin','MercuryThreadIDMap','MessagingTag','PageMessageEnumTag','RangedCallbackManager','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=h.getInstance('ordered_threadlist_model'),x=k.getSupportedFilters().concat([k.ALL,p.GROUPS]),y=l.getSupportedFolders().concat([p.SPAM]);function z(ja,ka,la,ma){var na=[],oa=false,pa=false,qa=(ka||[]).filter(function(xa){var ya=xa.filter||k.ALL;return (xa.folder==la||!xa.folder&&la==p.INBOX)&&ya==ma;}),ra=ja._threadlistOrderMap[la][ma].getAllResources(),sa;qa.forEach(function(xa){na=na.concat(xa.thread_ids);if(xa.error){if(xa.end>ra.length)pa=xa.error;}else{var ya=xa.end-xa.start;if(xa.thread_ids.length<ya)oa=true;}if(!sa||xa.end>sa)sa=xa.end;});da(ja,na,la,ma);if(oa){ja._threadlistOrderMap[la][ma].setReachedEndOfArray();}else if(pa){ja._threadlistOrderMap[la][ma].setError(pa);}else{var ta=ja._threadlistOrderMap[la][ma].getCurrentArraySize();if(sa&&ta<sa){var ua={},va=ra.concat(na),wa=va.filter(function(xa){var ya=ua[xa];ua[xa]=true;return ya;});if(wa.length){w.warn('duplicate_threads',JSON.stringify({folder:la,expected_final_size:sa,actual_final_size:ta,duplicate_thread_ids:wa}));ja._serverRequests.fetchThreadlistInfo(sa,wa.length,la,ma==k.ALL?null:ma);}}}}function aa(ja,ka){y.forEach(function(la){x.forEach(function(ma){z(ja,ka,la,ma);});});}function ba(ja,ka){var la={};y.forEach(function(ma){la[ma]={};x.forEach(function(na){la[ma][na]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ka.forEach(function(ma){if(ma.is_forward)return;var na=ma.thread_id,oa=ea(ja,na),pa=fa(ja,na);function qa(){pa.forEach(function(sa){if(!v(x,sa))return;la[oa][sa].to_add.push(na);if(!ja._threadlistOrderMap[oa][sa].hasReachedEndOfArray()&&!ja._threadlistOrderMap[oa][sa].hasResource(na))la[oa][sa].to_remove_if_last_after_add[na]=true;});}function ra(sa){if(v(x,sa))if(v(pa,sa)){la[oa][sa].to_add.push(na);}else la[oa][sa].to_remove.push(na);}if(!oa){if(ma.action_type===i.CHANGE_FOLDER||ma.action_type===i.CHANGE_ARCHIVED_STATUS)y.forEach(function(sa){if(sa!==oa)x.forEach(function(ta){ja._threadlistOrderMap[sa][ta].removeResources([na]);});});return;}switch(ma.action_type){case i.DELETE_THREAD:pa.forEach(function(sa){if(!v(x,sa))return;la[oa][sa].to_remove.push(na);});break;case i.CHANGE_ARCHIVED_STATUS:case i.CHANGE_FOLDER:qa();break;case i.CHANGE_READ_STATUS:ra(p.UNREAD);break;case i.USER_GENERATED_MESSAGE:case i.LOG_MESSAGE:pa.forEach(function(sa){if(!v(x,sa))return;if(ga(ja,na,oa,sa))la[oa][sa].to_add.push(na);});break;case i.CHANGE_FLAG:ra(q.FLAG);break;}});y.forEach(function(ma){x.forEach(function(na){var oa=ja._threadlistOrderMap[ma][na];da(ja,la[ma][na].to_add,ma,na);for(var pa=oa.getCurrentArraySize()-1;pa>=0;pa--){var qa=oa.getResourceAtIndex(pa);if(!la[ma][na].to_remove_if_last_after_add[qa])break;la[ma][na].to_remove.push(qa);}oa.removeResources(la[ma][na].to_remove);});});}function ca(ja,ka){var la={};y.forEach(function(ma){la[ma]={};x.forEach(function(na){la[ma][na]=[];});});ka.forEach(function(ma){var na=ea(ja,ma.thread_id),oa=fa(ja,ma.thread_id);if(na)oa.forEach(function(pa){if(ga(ja,ma.thread_id,na,pa))la[na][pa].push(ma.thread_id);});});y.forEach(function(ma){x.forEach(function(na){if(la[ma][na].length>0)da(ja,la[ma][na],ma,na);});});}function da(ja,ka,la,ma){ma=ma||k.ALL;ja._threadlistOrderMap[la][ma].addResources(ka);y.forEach(function(na){if(na!=la)ja._threadlistOrderMap[na][ma].removeResources(ka);});}function ea(ja,ka){var la=ja._threads.getThreadMetaNow(ka),ma=null;if(!la){ma='No thread metadata';}else if(!la.folder)ma='No thread folder';if(ma){var na={error:ma,tid:ka};w.warn('no_thread_folder',JSON.stringify(na));return null;}var oa=la.folder;if(la.is_archived)oa=p.ACTION_ARCHIVED;if(ja._threadlistOrderMap[oa]){return oa;}else return null;}function fa(ja,ka){var la=ja._threads.getThreadMetaNow(ka),ma=[k.ALL];if(!la){var na={error:'no_thread_metadata',tid:ka};w.warn('no_thread_metadata',JSON.stringify(na));return [];}if(la.unread_count)ma.push(p.UNREAD);if(!la.is_canonical)ma.push(p.GROUPS);var oa=la.page_thread_info;if(oa&&oa.flagged)ma.push(q.FLAG);return ma;}function ga(ja,ka,la,ma){var na=ja._threads.getThreadMetaNow(ka);return !!(na&&na.timestamp&&ea(ja,ka)==la&&v(fa(ja,ka),ma));}function ha(ja){this._fbid=ja;this._serverRequests=s.getForFBID(this._fbid);this._threadIDMap=o.getForFBID(this._fbid);this._threadInformer=t.getForFBID(this._fbid);this._threads=u.getForFBID(this._fbid);this._dispatcher=j.getForFBID(this._fbid);this._threadlistOrderMap={};this._initializeThreadlistOrderMap();this._dispatcher.subscribe('update-threadlist',(function(ka,la){if(!ia(la))return;var ma=la.ordered_threadlists;if(ma&&ma.length){aa(this,ma);}else{var na=(la.actions||[]).filter(function(oa){return oa.thread_id;});ca(this,la.threads||[]);ba(this,na);}this._threadInformer.updatedThreadlist();}).bind(this));this._dispatcher.subscribe('invalidate-global-state',(function(){return this._invalidateGlobalState();}).bind(this));}Object.assign(ha.prototype,{getThreadlistOrderMap:function(ja,ka){if(!this._threadlistOrderMap[ja][ka]){x=x.concat([ka]);y.forEach((function(la){this._threadlistOrderMap[la][ka]=new r((function(ma){return this._threads.getThreadMetaNow(ma).timestamp;}).bind(this),function(ma,na){return na-ma;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}).bind(this));}return this._threadlistOrderMap[ja][ka];},getThreadlist:function(ja,ka,la,ma,na,oa){return this.getFilteredThreadlist(ja,ka,la,k.ALL,ma,na,oa);},getFilteredThreadlist:function(ja,ka,la,ma,na,oa,pa){var qa=this.getThreadlistOrderMap(la,ma),ra=qa.executeOrEnqueue(ja,ka,na,oa),sa=qa.getUnavailableResources(ra),ta=qa.getError(ja,ka,oa);if(sa.length||ta){if(qa.getCurrentArraySize()<ja){var ua={start:ja,limit:ka,filter:ma,resources_size:qa.getCurrentArraySize()};w.warn('range_with_gap',JSON.stringify(ua));}qa.setError(false);this._serverRequests.fetchThreadlistInfo(qa.getCurrentArraySize(),sa.length,la,ma==k.ALL?null:ma,pa);}return ra;},getThreadlistUntilTimestamp:function(ja,ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).getElementsUntil(ja);},getAvailableThreadlistNow:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).getAllResources();},getThreadCount:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).getCurrentArraySize();},hasLoadedThreadlist:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).hasReachedEndOfArray();},unsubscribe:function(ja,ka,la){la=la||k.ALL;this.getThreadlistOrderMap(ka,la).unsubscribe(ja);},_invalidateGlobalState:function(){this._threadlistOrderMap={};this._initializeThreadlistOrderMap();},_initializeThreadlistOrderMap:function(){y.forEach((function(ja){this._threadlistOrderMap[ja]={};x.forEach((function(ka){this._threadlistOrderMap[ja][ka]=new r((function(la){return this._threads.getThreadMetaNow(la).timestamp;}).bind(this),function(la,ma){return ma-la;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}).bind(this));}).bind(this));}});Object.assign(ha,n);function ia(ja){switch(ja.payload_source){case m.CLIENT_CHANGE_ARCHIVED_STATUS:case m.CLIENT_CHANGE_READ_STATUS:case m.CLIENT_CHANGE_FOLDER:case m.CLIENT_CHANNEL_MESSAGE:case m.CLIENT_DELETE_MESSAGES:case m.CLIENT_DELETE_THREAD:case m.CLIENT_SEND_MESSAGE:case m.SERVER_SEND_MESSAGE:case m.SERVER_FETCH_THREADLIST_INFO:case m.SERVER_THREAD_SYNC:case m.SERVER_INVALIDATE_GLOBAL_STATE:return true;case m.SERVER_INITIAL_DATA:return !!ja.ordered_threadlists;default:return false;}}f.exports=ha;},null);
__d('MercuryStateCheck',['Arbiter','ChannelConstants','LogHistory','MercuryAPIArgsSource','MercuryConfig','MercuryFolders','MercuryOrderedThreadlist','MercuryServerRequests','MercurySingletonProvider','MercurySyncFakeDFFSender','MessagingTag','URI','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=j.getInstance('mercury_state_check');v.getForFBID=function(x){'use strict';return w.getForFBID(x);};v.get=function(){'use strict';return w.get();};function v(x){'use strict';this.$MercuryStateCheck1=x;this.$MercuryStateCheck2=o.getForFBID(this.$MercuryStateCheck1);this.$MercuryStateCheck3=n.getForFBID(this.$MercuryStateCheck1);h.subscribe(i.ON_INVALID_HISTORY,this.$MercuryStateCheck4.bind(this,i.ON_INVALID_HISTORY));t('ChannelConnection',(function(y){y.subscribe(y.CONNECTED,(function(z,aa){if(!aa.init)this.$MercuryStateCheck5(y.CONNECTED);}).bind(this));}).bind(this));}v.prototype.$MercuryStateCheck4=function(x){'use strict';var y;if(s.getRequestURI().getPath().search(/messages/)!==-1){y=m.getSupportedFolders();}else y=[r.INBOX];u.debug('check',JSON.stringify({folders:y,source:x}));if(l.WWWSyncGlobalDFFOnChannelReconnect){q.sendGlobalDFF();}else this.$MercuryStateCheck2.fetchMissedMessages(y,k.MERCURYSYNC);};v.prototype.$MercuryStateCheck5=function(x){'use strict';var y=this.$MercuryStateCheck3.getAvailableThreadlistNow(r.INBOX)||[];y=y.slice(0,20);u.debug('full_check',JSON.stringify({source:x}));this.$MercuryStateCheck2.fetchThreadData(y,k.MERCURYSYNC);this.$MercuryStateCheck4(x);};var w=new p(v);f.exports=v;},null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonMixin','MercuryThreadInfo','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=o.MAX_UNSEEN_COUNT,x='unseen_thread_hash',y='unseen_thread_list',z=j.getInstance('mercury_unseen_state');function aa(pa){this._fbid=pa;this._serverRequests=r.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threads=t.getForFBID(this._fbid);this._threadInformer=s.getForFBID(this._fbid);this._dispatcher=l.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new i();this._dispatcher.subscribe('update-unseen',(function(qa,ra){ga(this,ra);}).bind(this));this._dispatcher.subscribe('update-thread-ids',(function(qa,ra){ma(this,ra);}).bind(this));}Object.assign(aa.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){z.error('unguarded_unseen_count_fetch','{}');return 0;}return fa(this)||0;},exceedsMaxCount:function(){return this._maxCount||fa(this)>w;},markAsSeen:function(){var pa=fa(this);if(pa===null){this._pendingServerUpdates=true;}else if(pa>0||this._maxCount){this._serverRequests.markSeen();var qa=this._serverRequests.getLastActionTimestamp();ha(this,qa,[]);}}});Object.assign(aa,m);function ba(pa,qa,ra){var sa={};sa[qa]=0;ja(pa,sa,ra);}function ca(pa,qa){pa._unseenResources.setResource(x,qa);pa._unseenResources.setResource(y,Object.keys(qa));}function da(pa,qa){var ra=pa._unseenResources.executeOrEnqueue(x,qa),sa=pa._unseenResources.getUnavailableResources(ra);if(sa.length)pa._serverRequests.fetchUnseenThreadIDs();}function ea(pa){return pa._unseenResources.getResource(x);}function fa(pa){var qa=pa._unseenResources.getResource(y);if(qa){return qa.length;}else return pa._initialUnseenCount;}function ga(pa,qa){var ra=oa(qa);if(qa.unseen_thread_fbids){qa.unseen_thread_fbids.forEach(function(cb){if(cb.folder!=q.INBOX)return;var db=cb.thread_fbids||[];db=db.concat(cb.other_user_fbids||[]);var eb=la(pa,db),fb=pa._lastSeenTimestamp;if(ra&&ra.seen_timestamp)fb=ra.seen_timestamp;ha(pa,fb,eb);if(ra&&ra.unseen_count>w)pa._maxCount=true;});}else if(ra&&ra.seen_timestamp){pa._lastSeenTimestamp=ra.seen_timestamp;if(ra.unseen_count>w){pa._maxCount=true;ca(pa,{});}else{pa._initialUnseenCount=ra.unseen_count;if(pa._initialUnseenCount===0)ca(pa,{});}}else{if(pa._maxCount)return;var sa=qa.actions;if(!sa||!sa.length)return;var ta={},ua={};for(var va=0;va<sa.length;va++){var wa=sa[va];if(wa.is_forward)continue;var xa=wa.action_type,ya=wa.other_user_fbid?wa.other_user_fbid:wa.thread_fbid,za=wa.thread_id?wa.thread_id:ya;if(xa==k.MARK_THREAD_SEEN){ba(pa,za,wa.persistent);continue;}if(!na(pa,wa))continue;if(xa==k.USER_GENERATED_MESSAGE||xa==k.LOG_MESSAGE){var ab=ta[za]?wa.timestamp>ta[za]:false,bb=ab||!ta[za];if(wa.is_unread&&bb)pa._threads.getThreadMeta(za,function(cb){var db=false;if(cb&&cb.last_read_timestamp)if(cb.last_read_timestamp>=wa.timestamp)db=true;if(!n.isMuted(cb)&&!db)ta[za]=wa.timestamp;});}else if(xa==k.CHANGE_READ_STATUS&&wa.mark_as_read)ua[za]=wa.timestamp;}ia(pa,ta);ja(pa,ua);}if(pa._pendingServerUpdates){pa._pendingServerUpdates=false;pa.markAsSeen();}}function ha(pa,qa,ra){var sa=ea(pa);if(sa===undefined||qa>pa._lastSeenTimestamp||pa._maxCount){pa._lastSeenTimestamp=qa;ra=ra||[];if(ra.length<=w)pa._maxCount=false;var ta={},ua=ea(pa)||{};for(var va in ua)if(ua[va]!==true){var wa=ua[va];if(ka(pa,wa))ta[va]=wa;}var xa=Object.assign(u(ra,true),ta);ca(pa,xa);pa._threadInformer.updatedUnseenState();}}function ia(pa,qa){if(pa._maxCount)return;var ra={},sa=false;for(var ta in qa){var ua=qa[ta];if(ka(pa,ua)){ra[ta]=ua;sa=true;}}if(!sa)return;da(pa,function(va){for(var wa in ra){var xa=ra[wa];if(!va[wa]&&ka(pa,xa))va[wa]=ra[wa];}ca(pa,va);pa._threadInformer.updatedUnseenState();});}function ja(pa,qa,ra){var sa=false;if(!v(qa))sa=true;if(sa)da(pa,function(ta){var ua=false;for(var va in qa){var wa=qa[va],xa=wa>=ta[va];if(ta[va]&&(!wa||xa)){delete ta[va];ua=true;}}if(ua){ca(pa,ta);pa._threadInformer.updatedUnseenState();if(ra&&fa(pa)===0)pa._serverRequests.markSeen();}});}function ka(pa,qa){return qa>pa._lastSeenTimestamp;}function la(pa,qa){return qa.map(pa._threadIDMap.convertThreadIDIfAvailable,pa._threadIDMap);}function ma(pa,qa){var ra=ea(pa);if(!ra)return;for(var sa in qa){var ta=qa[sa];if(ra[sa]){ra[ta]=ra[sa];delete ra[sa];}}ca(pa,ra);}function na(pa,qa){var ra=qa.thread_id?pa._threads.getThreadMetaNow(qa.thread_id):null,sa=ra?h.getFromMeta(ra):qa.folder;return sa===q.INBOX||sa===undefined;}function oa(pa){var qa=pa.message_counts||[];for(var ra=0;ra<qa.length;ra++)if(qa[ra].folder==q.INBOX)return qa[ra];return null;}f.exports=aa;},null);