/*!CK:2225123955!*//*1452668702,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["MUDaJ"]); }

__d('SuggestionScraper',['ArbiterMixin','AsyncRequest','ComposerXSessionIDs','Event','HighConfidenceSuggestion','HighConfidenceSuggestionLogger','Keys','OGComposerTagger','SemiInlineSuggestion','SuggestionLoggingUserActions','SuggestionUIPresentation','TaggerBadgeSuggestion','XStructuredSuggestionController','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v,w,x=50;v=babelHelpers.inherits(y,u(h));w=v&&v.prototype;function y(z,aa,ba,ca){'use strict';w.constructor.call(this);this.$SuggestionScraper1=z;this.$SuggestionScraper2=aa;this.$SuggestionScraper3=j.getSessionID(ca);this.$SuggestionScraper4=ba;for(var da=0;da<ba.length;da++){var ea=ba[da];switch(ea){case r.FLYOUT:this.$SuggestionScraper5=new l(aa,z,this.$SuggestionScraper3);break;case r.TAGGER_BADGE:this.$SuggestionScraper6=new s(aa,z,this.$SuggestionScraper3);break;case r.SEMI_INLINE:this.$SuggestionScraper7=new p(this.$SuggestionScraper3);}}}y.prototype.setInputTriggerConfig=function(z,aa){'use strict';this.$SuggestionScraper8=aa;this.$SuggestionScraper9=z;this.$SuggestionScraper10();};y.prototype.setBootloadTriggerConfig=function(z){'use strict';this.$SuggestionScraper11(z);};y.prototype.triggerNow=function(z,aa){'use strict';this.$SuggestionScraper11(z,aa);};y.prototype.$SuggestionScraper10=function(){'use strict';if(this.events)return;var z=function(ba){if(this.$SuggestionScraper8.value)setTimeout(this.$SuggestionScraper12.bind(this,ba),x);},aa=function(ba){var ca=false;if(this.$SuggestionScraper5&&this.$SuggestionScraper5.isShown()||this.$SuggestionScraper6&&this.$SuggestionScraper6.isShown()||this.$SuggestionScraper7&&this.$SuggestionScraper7.isShown()){if(ba.keyCode===n.DELETE||ba.keyCode===n.BACKSPACE)ca=true;}else if((ba.keyCode<n.A||ba.keyCode>n.Z)&&ba.keyCode!==n.DELETE&&ba.keyCode!==n.BACKSPACE)ca=true;if(ca)setTimeout(this.$SuggestionScraper12.bind(this,true),x);};this.events=k.listen(this.$SuggestionScraper8,{keydown:aa.bind(this),mousemove:z.bind(this)});};y.prototype.disableInput=function(){'use strict';if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;};y.prototype.$SuggestionScraper12=function(z){'use strict';var aa=this.$SuggestionScraper8.value;if(!aa){this.$SuggestionScraper13();}else if(this.$SuggestionScraper14(aa))this.$SuggestionScraper11(this.$SuggestionScraper9,aa);};y.prototype.$SuggestionScraper14=function(z){'use strict';if(!z.match(/([a-z].*){5}/i))return false;if(this.$SuggestionScraper15&&this.$SuggestionScraper15.length<=z.length){var aa=z.replace(this.$SuggestionScraper15,'').trim(),ba=aa.match(/([a-z]+){3}/i);if(!ba)return false;if(aa==='the'||aa==='this'||aa==='very')return false;}return true;};y.prototype.$SuggestionScraper11=function(z,aa,ba){'use strict';if(this.$SuggestionScraper16)return;if(this.$SuggestionScraper1.isOGTaggerSet())return;this.$SuggestionScraper17=z;ba=this.$SuggestionScraper18(r.FLYOUT,this.$SuggestionScraper5,ba,z);ba=this.$SuggestionScraper18(r.SEMI_INLINE,this.$SuggestionScraper7,ba,z);if(this.$SuggestionScraper4.length===0)return;var ca=t.getURIBuilder().setString('config_name',z).setString('csid',this.$SuggestionScraper3).setEnumVector('supported_presentation',this.$SuggestionScraper4).getURI();this.$SuggestionScraper16=new i(ca).setData({composer_state:{input:aa},extra_data:ba}).setHandler((function(da){this.$SuggestionScraper19(da.payload);}).bind(this));this.$SuggestionScraper16.send();this.$SuggestionScraper15=aa;};y.prototype.$SuggestionScraper18=function(z,aa,ba,ca){'use strict';if(!aa)return ba;ba=ba||{};var da=this.$SuggestionScraper4.indexOf(z);if(da>=0)if(!aa.isActive()){var ea=this.$SuggestionScraper4.slice(0,da),fa=this.$SuggestionScraper4.slice(da+1);this.$SuggestionScraper4=ea.concat(fa);}else{if(aa.getDisplayingSuggestion())ba.existingHighConfSuggestion=JSON.stringify(aa.getDisplayingSuggestion());aa.setConfigNameForLogging(ca);}return ba;};y.prototype.$SuggestionScraper19=function(z){'use strict';this.$SuggestionScraper16=null;if(z&&z.suggestion_finder_result){switch(z.suggestion_finder_result.presentation){case r.FLYOUT:this.$SuggestionScraper5.update(z.suggestion_finder_result.results);break;case r.TAGGER_BADGE:this.$SuggestionScraper1.saveSuggestion(z.suggestion_finder_result.results,this.$SuggestionScraper17);this.$SuggestionScraper6.update(z.suggestion_finder_result.results);break;case r.ADD_TAG:o.asyncSuggest(z.add_tag_payload,(function(){m.log(q.ADD,this.$SuggestionScraper17,z.suggestion_finder_result.results&&z.suggestion_finder_result.results[0],this.$SuggestionScraper3);}).bind(this),(function(){m.log(q.XOUT,this.$SuggestionScraper17,z.suggestion_finder_result.results&&z.suggestion_finder_result.results[0],this.$SuggestionScraper3);}).bind(this));break;case r.SEMI_INLINE:this.$SuggestionScraper7.update(z.token_text,z.suggestion_finder_result.results);break;case r.TOP_OF_VERBS:this.$SuggestionScraper1.saveSuggestion(z.suggestion_finder_result.results,this.$SuggestionScraper17);break;}}else this.$SuggestionScraper13();};y.prototype.$SuggestionScraper13=function(){'use strict';this.$SuggestionScraper5&&this.$SuggestionScraper5.update(null);this.$SuggestionScraper6&&this.$SuggestionScraper6.update(null);};f.exports=y;},null);