/*!CK:1499082332!*//*1455596457,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["rsUBP"]); }

__d("ChatNotificationConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};},null);
__d("ChatTypeaheadEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ABANDONED_QUERY:"abandoned_query",NEW_QUERY:"new_query",RESULT_SELECTED:"result_selected"};},null);
__d("MercurySyncTopicType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELTA:"delta",DELTAFLOW:"deltaflow"};},null);
__d("MessagingEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",UPDATE_BLOCKER_STATUS:"update_blocker_status",UPDATE_BLOCKEE_STATUS:"update_blockee_status",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"};},null);
__d("OzConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTHOR_TYPES:{BOT:"bot",TRAINER:"trainer",USER:"user"},ATTS:{COMMAND:"\u0040COMMAND",IMAGE:"image",SUGG:"\u0040SUGG",TEMPLATE:"template",SURVEY:"survey"},SESSION_INFO_EVENT:"iframenonce_fb_session_info",TOKENS:{USER_FIRST_NAME:"user-first-name"},REMINDERS:{RANGE_IN_YEARS:5},M_FBIDS:{M:"881263441913087",M_DEV:"1579802578966277",P:"506060876211905"}};},null);
__d('ChatImpressionLogger',['AsyncSignal','ChatConfig','ChatVisibility','Poller','PresencePrivacy','PresenceStatus','requireWeak','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=null;n('AvailableList',function(v){return p=v;});var q=null;function r(){if(!q)return '';return Array.from(q.getSortedList()).toString();}function s(){if(!q||!p)return '';var v=[],w=Array.from(q.getSortedList());for(var x=0;x<w.length;x++)v[x]=p.get(w[x]);return v.toString();}function t(v){v.setURI('/ajax/chat/imps_logging.php').setData({list_availability:s(),sorted_list:r(),source:'periodical_imps'});}var u={init:function(v){q=v;var w=i.get('chat_impression_logging_periodical',0);if(w){var x=i.get('periodical_impression_logging_config.interval'),y=new k({interval:x,setupRequest:t,clearOnQuicklingEvents:false,dontStart:true});l.subscribe('privacy-user-presence-changed',o(function(){if(j.isOnline()){y.start();}else y.stop();}));}this.init=function(){};},logImpression:function(v,w,x){var y=i.get('chat_impression_logging_with_click'),z={list_availability:y?s():'',sorted_list:y?r():'',source:v,target:w,target_presence:m.get(w),viewport_width:document.body.clientWidth};new h('/ajax/chat/ct.php',Object.assign(z,x)).send();}};f.exports=u;},null);
__d('ChatOpenTabEventLogger',['Banzai','ChatImpressionLogger','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k='messaging_tracking',l={log:function(m,n,o,p){var q={referrer:m||'',message_thread_id:n,message_view:'chat',timestamp_send:Date.now(),message_target_ids:null};if(o!==undefined)q.message_target_ids=[o];i.logImpression(m,o,p);h.post(k,q,{delay:0,retry:true});var r=j.getUserIDFromThreadID(String(n));h.post('page_message_button_click',{page_id:r,ref:m});}};f.exports=l;},null);
__d('ChatWelcomeMessage',['ImmutableObject'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){this.$ChatWelcomeMessage1={};}i.prototype.setWelcomeMessage=function(k,l,m){this.$ChatWelcomeMessage1[k]=new h({timestamp:Date.now(),thread_id:k,author:l,body:m});};i.prototype.getWelcomeMessage=function(k){return this.$ChatWelcomeMessage1[k];};var j=new i();f.exports=j;},null);
__d('ChatOpenTabImpl',['ChatApp','ChatOpenTabEventLogger','ChatWelcomeMessage','DOM','GroupChatMessageBlockAlert','LogHistory','MercuryIDs','Toggler','csx','requireWeak','MercuryBlockedParticipants','MercuryThreadActions','MercuryThreadIDMap','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=c('MercuryBlockedParticipants').get(),s=c('MercuryThreadActions').get(),t=c('MercuryThreadIDMap').get(),u=c('MercuryThreads').get(),v=null;q('ChatTabModel',function(x){return v=x;});var w={canOpenTab:function(){return !!(h&&!h.isHidden());},openEmptyTab:function(x,y,z){if(this.canOpenTab()&&v){var aa=v.getEmptyTab();this._openClientTab(aa,null);this._logChatOpenTabEvent(y,aa,null,z);this._closeJewelFlyout();}},openThreadTab:function(x,y,z,aa,ba){if(!n.isValid(x)){t.getClientIDFromServerID(x,function(ca){w.openThreadTabImpl(ca,y,z,aa,ba);});}else w.openThreadTabImpl(x,y,z,aa,ba);},openThreadTabImpl:function(x,y,z,aa,ba){u.getThreadMeta(x,(function(ca){if(r.isPresentInGroupThread(ca)){l.show(r.inGroupThread(ca),(function(){this.openClientTab(x,y,z,aa,ba);}).bind(this),function(){s.leaveGroup(x);});}else this.openClientTab(x,y,z,aa,ba);}).bind(this));},openClientTab:function(x,y,z,aa,ba){this._openClientTab(x,aa,ba);this._logChatOpenTabEvent(y,x,null,z);this._closeJewelFlyout();},openUserTab:function(x,y,z){var aa=n.getThreadIDFromUserID(x);this._openClientTab(aa);this._logChatOpenTabEvent(y,aa,x,z);},openPageTab:function(x,y,z){var aa=n.getThreadIDFromUserID(y);u.getThreadMeta(aa,function(ba){if(x&&x.length>0){var ca=(Date.now()-ba.timestamp)/1000,da=ca/3600;if(ba.message_count===0||da>24)j.setWelcomeMessage(aa,n.getParticipantIDFromUserID(y),x);}});this._openClientTab(aa);this._logChatOpenTabEvent(z,aa,y);},_closeJewelFlyout:function(){var x=k.scry(document,"div._1z4y")[0],y=o.getInstance(x);if(y&&y.getActive())y.hide();},_openClientTab:function(x,y,z){u.getThreadMeta(x,(function(aa){if(!this.canOpenTab())m.getInstance('mercury').error('Unable to open chat tab',x);h.tabController.openTab(x,h.tabsViewport,y,!!z);}).bind(this));},_logChatOpenTabEvent:function(x,y,z,aa){i.log(x,y,z,aa);}};f.exports=w;},null);
__d('ChatPerfInstrumentation',['Promise','BanzaiLogger','ChatPerfEvent','emptyFunction','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m={_startTime:(Number),init:function(){this._startTime=l();return new h(function(n){return n();});},_log:function(event){i.log('ChatPerfLoggerConfig',{event:event,duration:l()-this._startTime});},logTTI:function(){this.logTTI=k;this._log(j.TTI);},logCHAT_CONVERSATION_TTI:function(){this.logCHAT_CONVERSATION_TTI=k;this._log(j.CHAT_CONVERSATION_TTI);}};f.exports=m;},null);
__d('ChatMentionsNotifications',['fbt','CurrentUser','MercuryParticipants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={notifyIfMessageToMe:function(l){var m='fbid:'+i.getID(),n=l.body;j.get(m,function(o){var p=new RegExp(o.short_name,"i");if(p.test(n))k._notify(l);});},_notify:function(l){var m=48,n=l.body;if(n.length>m)n=n.substr(0,m-3)+"...";new Notification(h._("You were tagged in a message!"),{body:n,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};f.exports=k;},null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=false,m=i.getWebChatNotification&&i.getWebChatNotification(),n=l,o=true,p=Object.assign(new h(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;},showsTabUnreadUI:function(){return o;}});function q(){p.inform(p.ON_CHANGED);}i.subscribe&&i.subscribe(j.ON_CHAT_NOTIFICATION_CHANGED,function(){var r=m,s=i.getWebChatNotification();m=s;if(r!=s)q();});h.subscribe('chat/set_does_page_occlude_tabs',function(r,s){n=!!s;q();});h.subscribe('chat/set_show_tab_unread_ui',function(r,s){o=!!s;q();});f.exports=p;},null);
__d('ChatCookieInterface',['ChatConfig','InitialServerTime','MercuryIDs','LogHistory','PresenceState','PresenceUtil'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.getInstance('chat_cookie'),o=i.serverTime,p=h.get('tab_max_load_age')||3600000,q=o-p,r={store:function(v,w){if(v.uct2==w.lastChangeTime)return v;var x=u(v,w),y={};if(!x){y.old_tabs=v&&v.t2&&JSON.stringify(v.t2);y.old_promoted=v&&v.lm2;y.old_time=v&&v.uct2;y.old_reason=v&&v.tr;y.old_window=v&&v.tw;var z=[];w.tabs.forEach(function(aa){if(!aa.fragile||aa.server_id){var ba={i:aa.fragile?j.getThreadIDFromThreadFBID(aa.server_id):aa.id,si:aa.server_id};if(aa.raised)ba.r=1;z.push(ba);}});v.t2=z;v.lm2=w.promotedID;v.uct2=w.lastChangeTime;v.tr=w.lastChangeReason;v.tw=m.getSessionID();n.debug('store','{}');}else n.warn('store_bad_state','{}');return v;},load:function(v,w){if(!v){n.warn('load_bad_state','{}');return false;}var x=u(v,w);if(!x||x===w.lastChangeTime)return false;w.lastChangeTime=x;w.lastChangeReason='load';var y=s(w,v.t2,v.lm2||null),event='load';if(!w.isInitialized)event+='_init';n.log(event,'{}');return y;},tabsChanged:function(){return t.apply(undefined,arguments);}};function s(v,w,x){var y;if(!t(v,w,x))return false;var z=v.tabs.filter(function(ca){return !!ca.fragile;}),aa={};v.promotedID=null;v.tabs=w.map(function(ca){var da={id:ca.i,server_id:ca.si};if(da.id==x)v.promotedID=da.id;if(ca.r)da.raised=true;aa[da.id]=da;return da;});v.tabs=v.tabs.filter(function(ca){return !!ca;});if(v.localRaised)for(var ba in v.localRaised)if(!aa[ba]||!aa[ba].raised)delete v.localRaised[ba];z=z.filter(function(ca){return !aa[ca.id];});(y=v.tabs).push.apply(y,z);return true;}function t(v,w,x){if(x&&x!=v.promotedID)return true;var y=v.tabs.filter(function(ba){return !ba.fragile||ba.server_id;});if(w.length!=y.length)return true;for(var z=0,aa=w.length;z<aa;z++)if(!!w[z].r!==y[z].raised||!w[z].si&&w[z].i!==y[z].id||w[z].si&&w[z].si!==y[z].server_id)return true;return false;}function u(v,w){var x=l.verifyNumber(v.uct2);if(!x||typeof x!=='number'){n.warn('bad_cookie_version','{}');return null;}if(x<w.lastChangeTime||x<q)return null;return x;}f.exports=r;},null);
__d('ChatTabModel',['Arbiter','ChatBehavior','ChatDispatcher','ChatConfig','ChatCookieInterface','ChatTabActions','EventEmitter','InitialServerTime','LogHistory','JSLogger','MercuryAssert','MercuryIDs','MercuryLocalIDs','PresenceState','PresenceUtil','MercuryThreadIDMap','MercuryThreads','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=c('MercuryThreadIDMap').get(),x=c('MercuryThreads').get(),y=c('MercuryTimestampTracker').get(),z=o.serverTime,aa=k.get('tab_max_load_age')||3600000,ba=20,ca=new n(),da=p.getInstance('chat_tab_model'),ea={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function fa(bb){var cb=l.load(bb,ea);cb&&ja();return cb;}function ga(bb,cb,db){var eb=fa(u.get());if(cb===undefined||cb>ea.lastChangeTime){if(bb()){eb=true;ea.lastChangeReason=db||null;ia(cb);}}else da.error('rejected',JSON.stringify({change_time:cb,state_time:ea.lastChangeTime}));eb&&ha();}function ha(){if(ea.isInitialized)ca.emit('change');}function ia(bb){if(bb===undefined)bb=Math.max(y.getLastUserMessageTimestamp()||1,ea.lastChangeTime+1);ea.lastChangeTime=bb;u.doSync();}function ja(bb){var cb=ea.tabs.length-ba;if(cb>0)ea.tabs=ea.tabs.filter(function(db){return db.raised||db.id==bb||cb--<=0;});if(cb>0)ea.tabs=ea.tabs.filter(function(db){return (db.id==ea.promotedID||db.id==bb||cb--<=0);});}function ka(bb){for(var cb=0;cb<ea.tabs.length;cb++)if(ea.tabs[cb].id==bb)return cb;return -1;}function la(bb,cb){var db=x.getThreadMetaNow(bb);if(!db)return false;if(db.is_canonical_user){return oa(bb,cb);}else{var eb=na(bb);if(eb)w.getServerIDFromClientID(bb,function(fb){if(ra(bb,fb)){ia();ha();}});return eb;}}function ma(bb){r.isThreadID(bb);if(na(bb))ha();}function na(bb){if(ka(bb)===-1){ea.tabs.push({id:bb,fragile:true});da.log('open_fragile_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),opened:bb,window_id:v.getSessionID()}));return true;}return false;}function oa(bb,cb){var db=ka(bb);if(db!=-1)if(ea.tabs[db].fragile){ea.tabs.splice(db,1);}else{cb&&(ea.tabs[db].signatureID=cb);return true;}for(var eb=0;eb<=ea.tabs.length;eb++)if(eb==ea.tabs.length||ea.tabs[eb].fragile){ea.tabs.splice(eb,0,{id:bb,signatureID:cb});ja(bb);da.log('open_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),opened:bb,window_id:v.getSessionID()}));return true;}}function pa(bb,cb,db){r.isThreadID(bb);var eb=false;if(ea.localRaised&&cb){ea.localRaised[bb]=true;eb=true;}ga(function(){if(la(bb,db))eb=true;var fb=ka(bb);if(fb!=-1&&!ea.tabs[fb].raised){ea.tabs[fb].raised=true;eb=true;da.log('raise_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),raised:bb,window_id:v.getSessionID()}));}return eb;});}function qa(bb){if(ka(bb)!==-1&&ea.promotedID!==bb){ea.promotedID=bb;return true;}return false;}function ra(bb,cb){var db=ka(bb);if(db!=-1&&ea.tabs[db].fragile){var eb=ea.tabs[db];eb.fragile=s.isLocalThread(bb);eb.server_id=cb;var fb=[];ea.tabs.forEach(function(gb){if(gb.id!=bb){if(eb&&gb.fragile){fb.push(eb);eb=null;}fb.push(gb);}});if(eb)fb.push(eb);ea.tabs=fb;da.log('make_permanent',JSON.stringify({tabs:JSON.stringify(ea.tabs),tab_id:bb,window_id:v.getSessionID()}));return true;}return false;}function sa(bb,cb){r.isThreadID(bb);var db=false;if(ea.localRaised){delete ea.localRaised[bb];db=true;}ga(function(){if(ta(bb))db=true;return db;},undefined,cb);}function ta(bb){var cb=ka(bb);if(bb==ea.promotedID)ea.promotedID=null;if(cb!=-1){ea.tabs.splice(cb,1);da.log('close_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),closed:bb,window_id:v.getSessionID()}));return true;}return false;}function ua(){if(ea.tabs.length){da.log('close_all_tabs',JSON.stringify({closed_tabs:JSON.stringify(ea.tabs),window_id:v.getSessionID()}));ea.tabs=[];ea.promotedID=null;if(ea.localRaised)ea.localRaised={};ia();ha();}}function va(){var bb=[];for(var cb=0;cb<ea.tabs.length;cb++)if(ea.tabs[cb].fragile&&!x.isNewEmptyLocalThread(ea.tabs[cb].id)){bb.push(ea.tabs[cb]);ea.tabs.splice(cb);ha();break;}da.log('close_fragile_tabs',JSON.stringify({tabs:JSON.stringify(ea.tabs),fragile_closed:bb,window_id:v.getSessionID()}));}function wa(bb){r.isThreadID(bb);var cb=false;if(ea.localRaised){delete ea.localRaised[bb];cb=true;}ga(function(){var db=ka(bb);if(db!=-1&&ea.tabs[db].raised){delete ea.tabs[db].raised;da.log('lower_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),lowered:bb,window_id:v.getSessionID()}));cb=true;}return cb;});}function xa(){if(ea.localRaised){ga(function(){var bb=false;ea.tabs.forEach(function(cb){if(cb.raised!=ea.localRaised[cb.id]){bb=true;if(ea.localRaised[cb.id]){cb.raised=true;}else delete cb.raised;}});return bb;});da.log('persist_local_raise',JSON.stringify({tabs:JSON.stringify(ea.tabs),window_id:v.getSessionID()}));}}u.registerStateStorer(function(bb){return l.store(bb,ea);});u.registerStateLoader(function(bb){if(fa(bb))ha();});var ya=null,za={getDispatchToken:function(){return ya;},isTabPromoted:function(bb){if(bb)return bb==ea.promotedID;return false;},indexOf:function(bb){return ka(bb);},getTab:function(bb){r.isThreadID(bb);var cb=this.indexOf(bb);if(cb>-1){var db=ea.tabs[cb];return babelHelpers._extends({},db);}return null;},getEmptyTab:function(){var bb;for(var cb=0;cb<ea.tabs.length;cb++){bb=ea.tabs[cb].id;if(x.isNewEmptyLocalThread(bb))return bb;}bb=t.generateThreadID();x.createNewLocalThread(bb,[]);return bb;},get:function(){var bb=ea.tabs.map(function(cb){var db=babelHelpers._extends({},cb);delete db.fragile;if(ea.localRaised)db.raised=ea.localRaised[db.id];return db;});return {tabs:bb,promoted:ea.promotedID};},promoteThreadInPlaceOfThread:function(bb,cb,db,eb){r.isThreadID(bb);r.isThreadID(cb);ga(function(){var fb=ka(bb),gb=ka(cb);if(eb){ea.promotedID=bb;}else if(ea.promotedID===cb)return true;var hb=ea.tabs[fb];if(db){r.isThreadID(db);var ib=ka(db),jb=ea.tabs[gb];ea.tabs[gb]=hb;ea.tabs.splice(fb,1);ea.tabs.splice(ib,0,jb);}else{ea.tabs[fb]=ea.tabs[gb];ea.tabs[gb]=hb;}return true;});},addListener:function(bb){return ca.addListener('change',bb);}};h.subscribe(q.DUMP_EVENT,function(bb,cb){cb.chat_tabs={promoted:ea.promotedID,tabs:ea.tabs.map(function(db){return babelHelpers._extends({},db);}),time:ea.lastChangeTime,max_load_age:aa};});function ab(){var bb=i.ignoresRemoteTabRaise();if(bb&&!ea.localRaised){da.log('start_ignore_remote_raise','{}');ea.localRaised={};ha();}else if(!bb&&ea.localRaised){da.log('stop_ignore_remote_raise','{}');ea.localRaised=null;ha();}}ya=j.register(function(bb){switch(bb.actionType){case m.Types.CLOSE_TAB:sa(bb.threadID,bb.reason);break;case m.Types.CLOSE_ALL_TABS:ua();break;case m.Types.CLOSE_FRAGILE_TABS:va();break;case m.Types.LOWER_TAB:wa(bb.threadID);break;case m.Types.OPEN_FRAGILE_TAB:ma(bb.threadID);break;case m.Types.OPEN_TAB:r.isThreadID(bb.threadID);ga(function(){return la(bb.threadID);});break;case m.Types.PERSIST_LOCAL_STATE:xa();break;case m.Types.PROMOTE_TAB:r.isThreadID(bb.threadID);ga(qa.bind(null,bb.threadID));break;case m.Types.RAISE_TAB:pa(bb.threadID,bb.userAction,bb.signatureID);break;}});i.subscribe(i.ON_CHANGED,ab);ab();fa(u.getInitial(),true);if(ea.lastChangeTime===0)ea.lastChangeTime=z-600000;ea.isInitialized=true;f.exports=za;},null);
__d('ChatTabViewInstances',['Map'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('ChatNewMessageHandler',['ChatActivity','ChatMentionsNotifications','ChatTabModel','ChatTabViewInstances','JSLogger','MercuryAssert','MercuryBrowserAlerts','UserActivity','MercuryConfig','MercuryThreadlistConstants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=l.create('chat_new_message'),s={_notify:function(t,u,v){if(p.DesktopNotificationsGK)i.notifyIfMessageToMe(u);var w=k.get(t);v.view_is_visible=w&&w.isVisible();v.view_is_focused=w&&w.isFocused();if(!v.view_is_visible)r.log('message_to_hidden');v.is_active=h.isActive();n.messageReceived(u);},newMessage:function(t,u){m.isThreadID(t);var v=j.getTab(t),w={thread_id:t,message_id:u.message_id,to_new_tab:!v,to_raised_tab:v?!!v.raised:true};this._notify(t,u,w);r.log('message',w);}};n.subscribe('before-alert',function(t,event){var u=event.threadID,v=k.get(u),w=j.getTab(u),x=q.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(w&&w.raised&&v&&v.isVisible()&&v.isFocused()&&o.isActive(x)){v.tryMarkAsRead();event.cancelAlert();}});f.exports=s;},null);
__d('ChatTabLRUManager',['ChatTabViewInstances','ChatTabModel','InitialServerTime','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreads').get(),l={getLRUVisibleTab:function(m){if(m.hasRoomForRaisedTab())return undefined;var n=Object.keys(m.getTabsToShow()||{}),o=1*60,p=null,q=Infinity;for(var r=0;r<n.length;r++){var s=n[r],t=k.getThreadMetaNow(s);if(i.isTabPromoted(s))continue;if(!h.get(s).hasEmptyInput()||!t)continue;var u=(j.serverTime-t.timestamp)/1000;if(!t.timestamp||t.timestamp&&t.timestamp<q&&u>o){p=t.thread_id;q=t.timestamp;}}return p;}};f.exports=l;},null);
__d('ChatTabPresence',['AvailableList','ChatTabModel','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={};function l(m){var n=j.getUserIDFromThreadID(m);if(n)h.updateForID(n);}i.addListener(function(){var m=i.get();m.tabs.forEach(function(n){if(n.raised&&!k[n.id])l(n.id);});k={};m.tabs.forEach(function(n){if(n.raised)k[n.id]=true;});});f.exports={};},null);
__d('ChatTabViewEvents',['Arbiter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('ChatQuietLinks',['DataStore','DOM','Event','Parent','UserAgent_DEPRECATED','getOrCreateDOMID'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n={},o={silenceLinks:function(s){p(s,this.removeEmptyHrefs.bind(this));},nukeLinks:function(s){p(s,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(s){q(s,function(t){return !t||t==='#';});},removeAllHrefs:function(s){q(s);}};function p(s,t){var u=!!l.chrome(),v=!!l.chrome()||l.ie()>=9||l.firefox()>=4;if(n[m(s)])return;n[m(s)]=true;if(!v)return;if(!u){t&&t(s);return;}j.listen(s,'mouseover',function w(x){var y=k.byTag(x.getTarget(),'a');if(y){var z=y.getAttribute('href');if(r(z)){h.set(y,'stashedHref',y.getAttribute('href'));y.removeAttribute('href');}}});j.listen(s,'mouseout',function w(x){var y=k.byTag(x.getTarget(),'a'),z=y&&h.remove(y,'stashedHref');if(r(z))y.setAttribute('href',z);});j.listen(s,'mousedown',function(w){if(!w.isDefaultRequested())return true;var x=k.byTag(w.getTarget(),'a'),y=x&&h.get(x,'stashedHref');if(r(y))x.setAttribute('href',y);});}function q(s,t){var u=i.scry(s,'a');if(t)u=u.filter(function(v){return t(v.getAttribute('href'));});u.forEach(function(v){v.removeAttribute('href');if(!v.tabIndex)v.setAttribute('tabindex',0);});}function r(s){return s&&s!=='#';}f.exports=o;},null);
__d('Dock',['Event','shield','Arbiter','ArbiterMixin','BlueBar','ChatQuietLinks','CSS','DataStore','DOM','Parent','Scroll','Style','Toggler','Vector','csx','emptyFunction','WebMessengerWidthControl'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();c('WebMessengerWidthControl');function x(){}Object.assign(x,k,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(y){this.init=w;this.rootEl=y;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();m.removeEmptyHrefs(this.rootEl);h.listen(y,'click',this._onClick.bind(this));h.listen(window,'resize',this._onWindowResize.bind(this));t.subscribe(['show','hide'],(function(z,aa){var ba=aa.getActive();if(!p.contains(y,ba))return;if(n.hasClass(ba,'fbNub')){this.notifyNub(ba,z);if(z==='show')this._resizeNubFlyout(ba);}else{var ca=q.byClass(ba,'fbNubFlyout');if(ca)n.conditionClass(ca,'menuOpened',z==='show');}}).bind(this));this.inform('init',{},j.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return this.viewportDimensions=u.getViewportDimensions();},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+u.getElementDimensions(this.rootEl).y;var y=l.getBar();if(y){var z=s.isFixed(y)?'viewport':'document';this.flyoutHeightOffset+=u.getElementPosition(y,z).y+u.getElementDimensions(y).y;}},toggle:function(y){var z=this._findFlyout(y);if(!z)return;this.subscribe('init',function(){t.toggle(y);});},show:function(y){this.subscribe('init',function(){t.show(y);});},showNub:function(y){n.show(y);},hide:function(y){this.subscribe('init',function(){var z=t.getInstance(y);p.contains(y,z.getActive())&&z.hide();});},hideNub:function(y){n.hide(y);this.hide(y);},setUseMaxHeight:function(y,z){n.conditionClass(y,'maxHeight',z!==false);this._resizeNubFlyout(y);},_resizeNubFlyout:function(y){var z=this._findFlyout(y);if(!z||n.hasClass(y,'placeholder')||!(n.hasClass(y,'openToggler')||n.hasClass(y,'opened')))return;var aa=p.find(z,'div.fbNubFlyoutOuter'),ba=p.find(aa,'div.fbNubFlyoutInner'),ca=p.find(ba,'div.fbNubFlyoutBody'),da=r.getTop(ca),ea=ca.offsetHeight;s.set(ca,'height','auto');var fa=u.getElementDimensions(z),ga=u.getElementDimensions(ca),ha=this.getMaxFlyoutHeight(y);s.set(z,'max-height',ha+'px');s.set(aa,'max-height',ha+'px');fa=u.getElementDimensions(z);var ia=u.getElementDimensions(ba),ja=ia.y-ga.y,ka=fa.y-ja,la=parseInt(ca.style.height||ca.clientHeight,10),ma=ka!==la;if(fa.y>ja&&ma)s.set(ca,'height',ka+'px');n.removeClass(z,'swapDirection');var na=u.getElementPosition(z).x;n.conditionClass(z,'swapDirection',(function(){if(na<0)return true;return na+fa.x>this.viewportDimensions.x;}).bind(this)());if(ma&&da+ea>=ga.y){r.setTop(ca,ca.scrollHeight);}else r.setTop(ca,da);this.notifyNub(y,'resize');},getMaxFlyoutHeight:function(y){var z=this._findFlyout(y),aa=u.getElementPosition(z,'viewport'),ba=u.getElementDimensions(z),ca=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-aa.y-ba.y);return Math.max(ca,0);},resizeAllFlyouts:function(){var y=this._getAllNubs(),z=y.length;while(z--)this._resizeNubFlyout(y[z]);},hideAllFlyouts:function(){var y=this._getAllNubs(),z=y.length;while(z--)this.hide(y[z]);},_getAllNubs:function(){var y=p.scry(this.rootEl,"div._50-v.openToggler");return y.concat(p.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var y=event.getTarget(),z=q.byClass(y,'fbNub');if(z){if(q.byClass(y,'fbNubFlyoutTitlebar')){var aa=q.byTag(y,'a'),ba=y.nodeName=='INPUT'&&y.getAttribute('type')=='submit';if(!aa&&!ba){this.hide(z);return false;}}this.notifyNub(z,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(y){return n.hasClass(y,'fbNubFlyout')?y:p.scry(y,'div.fbNubFlyout')[0]||null;},registerNubController:function(y,z){o.set(y,'dock:nub:controller',z);z.subscribe('nub/button/content-changed',i(this.inform,this,'resize',y));z.subscribe('nub/flyout/content-changed',i(this._resizeNubFlyout,this,y));},unregisterNubController:function(y){o.remove(y,'dock:nub:controller');},notifyNub:function(y,z,aa){var ba=o.get(y,'dock:nub:controller');ba&&ba.inform(z,aa);}});f.exports=b.Dock||x;},null);
__d('NubController',['ArbiterMixin','Dock'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(){}Object.assign(j.prototype,h,{init:function(k){this.el=k;i.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){i.hide(this.el);},show:function(){i.show(this.el);}});f.exports=j;},null);
__d('ChatTabViewSelector',['Arbiter','ArbiterMixin','CSS','ChatTabActions','CurrentUser','DOM','DataStore','Event','MenuDeprecated','MercuryThreadTitle.react','NubController','React','ReactDOM','ChatTabTemplates','Toggler','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=c('MercuryThreadInformer').get(),x=c('MercuryThreads').get();function y(z){var aa=u[':fb:chat:tab:selector'].build(),ba=aa.getRoot(),ca=aa.getNode('menu'),da=m.find(ca,'.uiMenuInner'),ea={},fa=new r().init(ba);j.hide(ba);m.insertBefore(z,ba);function ga(ja){var ka=0;for(var la in ea){var ma=ea[la],na=x.getThreadMetaNow(la),oa=ma.getNode('unreadCount'),pa=na&&na.unread_count||0;ka+=pa;if(pa>9)pa='+';j.conditionClass(oa,'invisible_elem',!pa);m.setContent(oa,pa);}var qa=aa.getNode('numMessages');j.conditionShow(qa,ka);m.setContent(qa,ka);}this.setTabData=function(ja){var ka=ea;ea={};if(ja.length<1){j.hide(ba);return;}j.show(ba);m.empty(da);ja.forEach(function(na){var oa=u[':fb:chat:tab:selector:item'].build(),pa=oa.getNode('content');ea[na.id]=oa;x.getThreadMeta(na.id,function(ra){t.render(s.createElement(q,{thread:ra,useAndSeparator:true,viewer:l.getID()}),pa);});m.prependContent(da,oa.getRoot());n.set(oa.getRoot(),'threadID',na.id);var qa=oa.getNode('closeButton');o.listen(qa,'click',function(event){k.closeTab(na.id,'selector/close-tab');event.kill();});});for(var la in ka)if(ka.hasOwnProperty(la)){var ma=ka[la].getNode('content');ma&&t.unmountComponentAtNode(ma);}fa.flyoutContentChanged();m.setContent(aa.getNode('numTabs'),ja.length);ga();};function ha(event,ja){if(ja.menu!=ca)return;var ka=n.get(ja.item,'threadID');y.inform('selected',ka);v.hide(ba);}function ia(event,ja){p.register(ca);}p.subscribe('select',ha.bind(this));v.listen('show',ba,function(){h.inform('layer_shown',{type:'ChatTabSelector'});ia();});v.listen('hide',ba,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});w.subscribe('threads-updated',ga);}Object.assign(y,i);f.exports=y;},null);
__d('ChatTypeaheadBehavior',['BanzaiLogger','ChatOpenTab','ChatTypeaheadConstants','ChatTypeaheadEvent','CSS','MercuryTypeaheadConstants','Parent','Rect','URI','csx','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();function s(u,v){var w=n.bySelector(u,"._4oes");if(w)l.conditionClass(w,"_5q83",v);}function t(u){'use strict';this._typeahead=u;this._loggedQuery=false;}t.prototype.enable=function(){'use strict';var u=this._typeahead;this._subscriptions=[u.subscribe('focus',(function(){this._loggedQuery=false;u.getData().refreshData();s(u.getElement(),true);}).bind(this)),u.subscribe('blur',(function(v){if(this._loggedQuery)h.log('ChatTypeaheadLoggerConfig',{event:k.ABANDONED_QUERY,max_results:u.getData().getMaxResults(),num_friend_results:u.getView().results.filter(function(w){return w.render_type===m.FRIEND_TYPE;}).length,query:u.getCore().value});u.getCore().reset();s(u.getElement(),false);this._loggedQuery=false;}).bind(this)),u.subscribe('respond',(function(v,w){if(!this._loggedQuery&&u.getCore().getValue().length>0){h.log('ChatTypeaheadLoggerConfig',{event:k.NEW_QUERY});this._loggedQuery=true;}if(w.value&&w.value===u.getCore().getValue()){if(!w.results.length){var x=w.value.toLowerCase(),y=u.getData().getQueryCache();if(!w.isAsync&&!y.hasOwnProperty(x))return;u.getView().showNoResults();}l.addClass(u.getElement(),'hasValue');}}).bind(this)),u.subscribe('reset',function(){l.removeClass(u.getElement(),'hasValue');}),u.subscribe('select',(function(v,w){var x=w.selected.uid;if(w.selected.mercury_thread&&!w.selected.mercury_thread.is_canonical)x=w.selected.mercury_thread.thread_fbid;u.getView().hide();h.log('ChatTypeaheadLoggerConfig',{event:k.RESULT_SELECTED,max_results:u.getData().getMaxResults(),result_type:w.selected.render_type,query:u.getCore().value});this._loggedQuery=false;if(w.selected.render_type===j.MEETING_ROOM_PAGE_TYPE){window.open(new p('/'+x.toString()),'_self',false);}else i.openTabByType(x,w.selected.type,'typeahead');}).bind(this)),u.subscribe('highlight',function(v,w){if(w.index>=0){var x=u.getView().getItems()[w.index];if(x){var y=new o(x),z=x.offsetParent,aa=y.boundWithin(new o(z)).getPositionVector();y.getPositionVector().sub(aa).scrollElementBy(z);}}})];};t.prototype.disable=function(){'use strict';this._subscriptions.forEach(function(u){this._typeahead.unsubscribe(u);},this);this._subscriptions=null;};Object.assign(t.prototype,{_subscriptions:null});f.exports=t;},null);
__d('ChatTabController',['Arbiter','BanzaiLogger','Bootloader','ChatActivity','ChatConfig','ChatNewMessageHandler','ChatTabActions','ChatTabLRUManager','ChatTabModel','ChatTabPolicy','ChatTabViewEvents','ChatTabViewInstances','ChatTabViewSelector','JSLogger','MercuryViewer','Style','UserAgent_DEPRECATED','ChatTabPresence','ChatTypeaheadBehavior','MercuryThreadInformer','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();c('ChatTabPresence');c('ChatTypeaheadBehavior');var y=c('MercuryThreadInformer').get(),z=c('MercuryThreadActions').get(),aa=c('MercuryThreads').get(),ba=l.get('tab_auto_close_timeout')||7200000,ca=u.create('tab_controller');function da(oa,pa,qa){var ra=p.get().tabs,sa=ra[oa],ta,ua;if(ra.length<2)return false;var va=ra.slice(oa+1),wa=ra.slice(0,oa),xa=va.concat(wa);if(!pa)xa.reverse();if(sa)xa.push(sa);for(var ya=0;ya<xa.length;ya++){ta=xa[ya];ua=s.get(ta.id);if(ua&&ua.isVisible()&&(!qa||ta.raised)){ua.focus();return true;}}return false;}function ea(oa,pa){var qa=pa&&pa.getRightmostHiddenTab();if(qa===oa)return null;return qa;}function fa(){return Math.floor(Math.random()*2147483648).toString(16);}function ga(oa,pa,qa,ra){n.raiseTab(oa,true,qa);var sa=pa&&pa.getLeftmostVisibleTab(),ta=pa&&pa.getTabsToShow();if(ta&&!ta[oa]&&sa){p.promoteThreadInPlaceOfThread(oa,sa,ea(oa,pa),true);}else n.promoteTab(oa);h.inform('chat/open-tab',oa);if(ra)return;var ua=s.get(oa);ua&&ua.focus();}function ha(oa,pa){if(!p.getTab(oa))n.raiseTab(oa,false);var qa=pa&&o.getLRUVisibleTab(pa),ra=pa&&pa.getTabsToShow();if(ra&&!ra[oa]&&qa)p.promoteThreadInPlaceOfThread(oa,qa,ea(oa,pa));}function ia(oa){t.subscribe('selected',function(ra,sa){ga(sa,oa);});h.subscribe('page_transition',function(ra,sa){n.closeFragileTabs();});h.subscribe('chat-visibility/go-offline',function(){n.closeAllTabs();});k.subscribe('idle',function(ra,sa){if(sa>ba){var ta=p.get().tabs;ta.forEach(function(ua){var va=ua.id;aa.getThreadMeta(va,function(wa){if(!wa.unread_count){ca.log('autoclose_idle_seen',{thread_id:va,idleness:sa});n.closeTab(va,'autoclose_idle_seen');}});});}});r.subscribe('nub-activated',function(ra,sa){ga(sa,oa);});r.subscribe('focus-tab',function(ra,sa){var ta=p.getTab(sa);if(ta&&ta.raised)ga(sa,oa,ta.signatureID,false);});function pa(ra,sa){i.log('VideoCallLoggerConfig',{event:'chat_tab_call_click'});j.loadModules(["FBRTCCore"],function(ta){ta.startOutgoingCall(sa.userID,sa.clickSource,sa.audioOnly);});}r.subscribe('video-call-clicked',pa);function qa(ra,sa){j.loadModules(["FBRTCCore"],function(ta){ta.startMultiwayCall(sa.threadID,sa.usersToCall,sa.clickSource,sa.audioOnly);});}r.subscribe('group-call-clicked',qa);r.subscribe('interaction-with-tab',function(ra,sa){var ta=p.getTab(sa);ta&&ta.raised&&z.markSeen(sa);});r.subscribe('esc-pressed',function(ra,sa){ca.log('close_esc',{thread_id:sa});var ta=p.indexOf(sa);n.closeTab(sa,'close_esc');setTimeout(function(){da(ta-1,true,true);},0);});y.subscribe('messages-received',function(ra,sa){for(var ta in sa){var ua=sa[ta];for(var va=0;va<ua.length;va++){var wa=ua[va];if(wa.author!=v.getID()){if(!wa.is_unread){ca.log('message_already_read',{action_id:wa.action_id,thread_id:wa.thread_id});continue;}aa.getThreadMeta(ta,function(xa){q.messageIsAllowed(xa,wa,function(){ha(ta,oa);m.newMessage(ta,wa);});});}}}});y.subscribe('thread-read-changed',function(ra,sa){for(var ta in sa)if(!sa[ta].mark_as_read){ca.log('autoclose_marked_unread',{thread_id:ta});n.closeTab(ta,'autoclose_marked_unread');}});r.subscribe('tab-pressed',function(ra,sa){return !da(p.indexOf(sa.id),sa.shiftPressed);});h.subscribe(u.DUMP_EVENT,function(ra,sa){sa.chat_controller={auto_close_timeout:ba};});this.openTab=function(ra,sa,ta,ua){ga(ra,sa,fa(),ua);if(ta)ta(s.get(ra));};}if(x.firefox()){var ja=function(){return w.get(document.body,'overflowX')+' '+w.get(document.body,'overflowY');},ka=ja(),la=function(){var oa=ja();if(oa!==ka){ka=oa;h.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ma=new MutationObserver(la),na={attributes:true,attributeFilter:['class','style']};ma.observe(document.documentElement,na);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))la();},false);}f.exports=ia;},null);
__d('ChatNubLogger',['BanzaiLogger','ScriptPath','pageID'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k='TimeSpentChatNubLoggerConfig',l={INPUT_ACTIVE:'active',INPUT_INACTIVE:'inactive'},m={ENTER:'enter',LEAVE:'leave'},n=l.INPUT_INACTIVE,o=0,p=false;function q(){if(n==l.INPUT_ACTIVE&&!p){n=l.INPUT_INACTIVE;r(m.LEAVE);o=0;}else if(n==l.INPUT_INACTIVE&&p){n=l.INPUT_ACTIVE;o=Date.now();r(m.ENTER);}}function r(event){var t=h.create({retry:true}),u=Date.now();t.log(k,{event:event,client_event_time_ms:u,active_time_ms:event==m.LEAVE?u-o:0,page_id:j,script_path:i.getScriptPath(),page_data:i.getPageInfo()?i.getPageInfo().extraData:{}});}var s={processEvent:function(t){switch(t){case 'focus':p=true;break;case 'blur':p=false;break;default:break;}q();}};f.exports=s;},null);
__d('ChatPhotoUploader.react',['Promise','Bootloader','Image.react','InlineBlock.react','Link.react','MercuryConfig','React','ReactDOM','SubscriptionsHandler','cx','emptyFunction','fbt','ix','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=n.PropTypes,w=n.createClass({displayName:'ChatPhotoUploader',propTypes:{actionURI:v.string,allowCrossPage:v.bool,customUI:v.bool,disabled:v.bool,imageClassName:v.string,imagesOnly:v.bool,linkClassName:v.string,onSubmit:v.func,onAllUploadsComplete:v.func,onLastUploadFail:v.func,onLastUploadCancel:v.func,onMount:v.func,onUploadError:v.func},getDefaultProps:function(){return {actionURI:m.upload_url,allowCrossPage:true,costomUI:false,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:'',onSubmit:r,onAllUploadsComplete:r,onLastUploadFail:r,onLastUploadCancel:r};},shouldComponentUpdate:function(x,y){return x.actionURI!=this.props.actionURI||x.disabled!==this.props.disabled;},componentDidMount:function(){if(this.props.onMount)this.props.onMount(this);},componentDidUpdate:function(x,y){if(this._uploader)this._uploader.setAllowCrossPage(this.props.allowCrossPage);},componentWillUnmount:function(){if(!this.isUploading()||!this.props.allowCrossPage)this._cleanup();},render:function(){var x=this.props.imagesOnly?s._("Add Photos"):s._("Add Files"),y=u("_4q61"+(!this.props.customUI?' '+"_5f0v":'')+(!this.props.customUI?' '+"_509v":''),this.props.linkClassName);return (n.createElement('form',{action:this.props.actionURI,className:"_vzk",title:x,method:'post',onClick:(function(z){z.stopPropagation();if(this.props.disabled)z.preventDefault();}).bind(this),ref:'form'},n.createElement('input',{type:'hidden',name:'attach_id',ref:'attachID'}),n.createElement('input',{type:'hidden',name:'images_only',value:this.props.imagesOnly}),n.createElement(k,{onClick:this._bootloadChatAutoSendPhotoUploader,className:u(this.props.className,"_m _4q60 _3rzn")},n.createElement('input',{disabled:this.props.disabled,type:'file',className:"_n _2__f",name:'attachment[]',multiple:'true',accept:this.props.imagesOnly?'image/*':'*',ref:'input',title:x}),n.createElement(l,{className:y,tabIndex:-1},n.createElement('i',{className:this.props.imageClassName,alt:s._("Camera")})))));},_handleSubmit:function(x,y){this.props.onSubmit(x,y);},_handleAllUploadsCompleted:function(x,y){this.props.onAllUploadsComplete(x,y);if(!this.isMounted())this._cleanup();},_handleLastUploadFailed:function(x,y){this.props.onLastUploadFail(x,y);if(!this.isMounted())this._cleanup();},_handleLastUploadCanceled:function(x,y){this.props.onLastUploadCancel(x,y);if(!this.isMounted())this._cleanup();},_handleUploadError:function(x,y){this.props.onUploadError(y);if(!this.isMounted())this._cleanup();},isUploading:function(){return (this._uploader&&this._uploader.isUploading()||this._uploaderPromiseIsResolving);},_bootloadChatAutoSendPhotoUploader:function(){if(!this._uploaderPromise){this._uploaderPromiseIsResolving=true;this._uploaderPromise=new h((function(x){i.loadModules(["ChatAutoSendPhotoUploader"],(function(y){this._uploaderPromiseIsResolving=false;this._uploader=new y(o.findDOMNode(this.refs.form),o.findDOMNode(this.refs.input),o.findDOMNode(this.refs.attachID));this._uploader.setAllowCrossPage(this.props.allowCrossPage);this._subscriptions=new p();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled),this._uploader.subscribe('file-upload-error',this._handleUploadError));x(this._uploader);}).bind(this));}).bind(this));}return this._uploaderPromise;},uploadFiles:function(x){this._bootloadChatAutoSendPhotoUploader().then(function(y){y.uploadFiles(x);});},uploadURL:function(x){this._bootloadChatAutoSendPhotoUploader().then(function(y){y.uploadURL(x);});},_cleanup:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();}});f.exports=w;},null);
__d('ChatDateBreak.react',['React','cx','formatDate','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.PropTypes,m=h.createClass({displayName:'ChatDateBreak',propTypes:{date:l.instanceOf(Date).isRequired},shouldComponentUpdate:function(n){return this.props.date.getTime()!==n.date.getTime();},render:function(){var n=j(this.props.date,{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});return (h.createElement('time',{className:k(this.props.className,"_5w-5")},h.createElement('span',{className:"_5w-6"},n)));}});f.exports=m;},null);
__d('ChatAnimatedGifs',['URI'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={shouldHideBody:function(j){if(!j.has_attachment)return false;for(var k=0;k<j.attachments.length;k++){var l=j.attachments[k];if(l.preview_url){var m=i.getRawUrlFromSafeUrl(l.preview_url);if(j.body==m)return true;}}return false;},getRawUrlFromSafeUrl:function(j){return new h(j).getQueryData().url;}};f.exports=i;},null);
__d('ChatAttachmentProgressBar.react',['Animation','React','cx'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=i.PropTypes,l=34,m=i.createClass({displayName:'ChatAttachmentProgressBar',propTypes:{ephemeralTTLMode:k.number.isRequired,timestamp:k.number.isRequired,isMessageAuthor:k.bool},componentDidMount:function(){if(!this.refs.progressBar)return;var n=l,o=this.props.ephemeralTTLMode,p=n/o*(Date.now()-this.props.timestamp),q=this._getRemainingTime();if(q>0&&p<n){var r=this.props.isMessageAuthor?'left':'right';new h(this.refs.progressBar).from(r,p).to(r,n).duration(q).go();}},_getRemainingTime:function(){return this.props.ephemeralTTLMode-(Date.now()-this.props.timestamp);},render:function(){return (i.createElement('a',{className:"_4yo"},i.createElement('span',{className:"_1gxq"}),i.createElement('span',{className:"_1gxr",ref:'progressBar'},i.createElement('span',{className:"_4yu"}))));}});f.exports=m;},null);
__d('ChatProgressBar.react',['React','cx'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.PropTypes,k=2000,l=250,m=h.createClass({displayName:'ChatProgressBar',_timer:null,propTypes:{isMessageAuthor:j.bool,onDone:j.func,setExpiredAnimation:j.func,timestamp:j.number.isRequired,ttl:j.number.isRequired},getInitialState:function(){return {percentage:this._getRemainingPercentage()};},componentDidMount:function(){if(this._getRemainingTime()>0){this._animateProgressBar();}else this.props.setExpiredAnimation&&this.props.setExpiredAnimation();},componentWillUnmount:function(){this._timer&&clearTimeout(this._timer);},render:function(){return (h.createElement('div',{className:"_3pcc"+(this._getRemainingTime()<0?' '+"_3pcd":''),ref:'item',style:{width:this.state.percentage.toString()+'%'}}));},_getRemainingTime:function(){return this.props.ttl-(Date.now()-this.props.timestamp)-k;},_getRemainingPercentage:function(){return 100-(Date.now()-this.props.timestamp)/(this.props.ttl-k)*100;},_animateProgressBar:function(){this._timer=setInterval((function(){if(this.isMounted())this.setState({percentage:this._getRemainingPercentage()});if(this._getRemainingTime()<0){clearTimeout(this._timer);this.props.onDone&&this.props.onDone();}}).bind(this),l);}});f.exports=m;},null);
__d('EmojiOnlyMessage.react',['React','cx'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.PropTypes,k=h.createClass({displayName:'EmojiOnlyMessage',propTypes:{sourceURIs:j.arrayOf(j.shape({type:j.string.isRequired,title:j.string,url:j.string.isRequired})).isRequired},render:function(){var l=this.props.sourceURIs,m=0,n=l.map(function(o){m++;return h.createElement('span',{className:"_5qi2",key:m,style:{backgroundImage:'url('+o.url+')'},title:o.title});});return (h.createElement('div',{className:this.props.className,tabIndex:'0'},n));}});f.exports=k;},null);
__d('EmployeeLinkMatcher',['CurrentUser'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=new RegExp('^[\\s.,:]'),j=new RegExp('(?:[\\s.,:]|^)([DTP]\\d{4,})(?:[\\s.,:?]|$)','im'),k=function(n){if(!h.isEmployee())return null;var o=j.exec(n);if(o==null)return null;return {lnk:o[1],idx:o.index+(i.exec(o[0])?1:0)};},l=function(n){var o=h.isEmployee()&&j.exec(n)!=null;return o;},m={match:k,isMatch:l};f.exports=m;},null);
__d('EmployeeLinkRanges',['EmployeeLinkMatcher'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={PHABRICATOR_PREFIX:'https://phabricator.fb.com/',TASKS_PREFIX:'https://our.intern.facebook.com/intern/tasks/?t=',get:function(j){var k=arguments.length<=1||arguments[1]===undefined?0:arguments[1],l=j.substr(k),m=h.match(l);if(!m)return [];var n=m.lnk;k+=m.idx;var o='';switch(n[0].toLowerCase()){case 'd':case 'p':o=this.PHABRICATOR_PREFIX+n.toUpperCase();break;case 't':o=this.TASKS_PREFIX+n.substr(1);break;default:return [];}var p=n.length,q=[{offset:k,length:p,entity:{url:o}}];return q.concat(this.get(j,k+p));}};f.exports=i;},null);
__d('P2PTriggersUtils',['P2PGKValues'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/,j={canSeeTriggers:function(k){if(!h.P2PEnabled)return false;return true;},getMatches:function(k){return k.match(i);}};f.exports=j;},null);
__d('getURLRanges',['URI','URLScraper'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){var l=arguments.length<=1||arguments[1]===undefined?0:arguments[1],m=k.substr(l),n=i.match(m);if(!n)return [];var o=n;if(!/^[a-z][a-z0-9\-+.]+:\/\//i.test(n))o='http://'+n;if(!h.isValidURI(o))return [];l+=m.indexOf(n);var p=n.length,q=[{offset:l,length:n.length,entity:{url:o}}];return q.concat(j(k,l+p));}f.exports=j;},null);
__d('MercuryMessageBody.react',['BootloadedComponent.react','EmoticonsList','EmployeeLinkMatcher','JSResource','Link.react','P2PTriggersUtils','ReactComponentWithPureRenderMixin','React','SupportedEmoji','TextWithEntities.react','URI','URLMatcher','cancelAnimationFrame','cx','EmployeeLinkRanges','fbt','getURLRanges','isFacebookURI','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa=o.PropTypes,ba=o.createClass({displayName:'MercuryMessageBody',mixins:[n],propTypes:{body:aa.string,ranges:aa.array,threadID:aa.string,customLike:aa.object},getInitialState:function(){return {richText:false};},_shouldRenderP2PTriggers:false,componentDidMount:function(){this._raf=z(this.setIsRichText);},targetBlankLinkInterpolator:function(ca,da){if(da.entity&&da.entity.url){var ea=new r(da.entity.url);if(y(ea)&&!ea.getFragment())da.entity.url=ea.addQueryData({__mref:'message_bubble'}).toString();da.entity.url=/.*[^#]/.exec(da.entity.url)[0];}return (o.createElement(l,{href:da.entity.url,shimhash:da.entity.shimhash,s:da.entity.s,target:'_blank'},ca));},setIsRichText:function(){delete this._raf;var ca=this.props,da=ca.body,ea=ca.ranges;da=da||'';this._shouldRenderP2PTriggers=!!(this.props.threadID&&m.canSeeTriggers(this.props.threadID)&&m.getMatches(da));if(ea&&ea.length||i.noncapturingRegexp.test(da)||p.findEmoji(da)||s.match(da)||j.isMatch(da)||this._shouldRenderP2PTriggers)this.setState({richText:true});},componentWillUnmount:function(){this._raf&&t(this._raf);},render:function(){var ca=this.props.body||'';if(ca.startsWith('?OTR'))return (o.createElement('span',{className:"_89h"},w._("[encrypted message]")));ca=ca.replace(/\s+$/,'');if(ca.length===0)return null;if(!this.state.richText)return o.createElement('span',{className:this.props.className},ca);var da=this.props.ranges;if(da==undefined)da=x(ca);if(da==undefined){da=v.get(ca);}else{da=da.concat(v.get(ca));da=da.filter(function(ga){return ga!=undefined;});}var ea={className:this.props.className,interpolator:this.targetBlankLinkInterpolator,text:ca,ranges:da,renderEmoticons:true,renderEmoji:true},fa=o.createElement(q,ea);if(this._shouldRenderP2PTriggers){return (o.createElement(h,babelHelpers._extends({bootloadPlaceholder:fa,bootloadLoader:k('TextWithEntitiesAndP2P.react')},ea,{threadID:this.props.threadID})));}else return fa;}});f.exports=ba;},null);
__d('MessageBubbleMixin',['DOMDimensions','ReactDOM'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=2,k={getInitialState:function(){return {bubbleWidth:null};},componentDidMount:function(){this._restyleBubble(this.props);},componentDidUpdate:function(l){if(l.maxWidth!==this.props.maxWidth||l.body!==this.props.body||!l.attachments&&this.props.attachments)this._restyleBubble(l);},_restyleBubble:function(l){if(this.props.attachments){this.setState({bubbleWidth:null});return;}var m=i.findDOMNode(this.refs.bubble);if(l.maxWidth!==this.props.maxWidth||h.getElementDimensions(m).width>this.props.maxWidth){var n=this.props.maxWidth;this.setState({bubbleWidth:n},this._shrinkBubble);return;}this._shrinkBubble();},_shrinkBubble:function(){var l=i.findDOMNode(this.refs.bubble),m=h.getElementDimensions(l).width,n=i.findDOMNode(this.refs.content),o=n?h.getElementDimensions(n).width+h.measureElementBox(i.findDOMNode(this.refs.contentWrapper),'width',true,false,false):0,p=o+j;if(o>0&&p<this.props.maxWidth&&m-p-this.getBoxWidth()>0)this.setState({bubbleWidth:p});}};f.exports=k;},null);
__d('ChatBubble.react',['Animation','ChatProgressBar.react','DOMDimensions','EmojiLikeUtils','EmojiOnlyMessage.react','MercuryAttachment','MercuryMessageBody.react','MercuryTagHelper','MessageBubbleMixin','MessagingGiftWrap.react','React','ReactDOM','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=r.PropTypes,w=1000,x=r.createClass({displayName:'ChatBubble',_boxWidth:0,mixins:[p],propTypes:{attachments:v.node,body:v.string,customLike:v.object,isEmojiLike:v.bool,isGiftWrapped:v.bool,isMessageAuthor:v.bool,maxWidth:v.number.isRequired,onUnwrap:v.func,threadID:v.string,timestamp:v.number,ttl:v.number},getInitialState:function(){return {emojis:undefined,ephemeralExpiring:false,ephemeralExpired:false};},componentDidMount:function(){if(this.props.attachments&&!this.props.isEmojiLike)return;if(!this.props.emojis){var y=this.props.body||'',z=k.richContent(y);if(z)this.setState({emojis:z});}},render:function(){var y=this.props.body||'';return (r.createElement('div',babelHelpers._extends({},this.props,{className:u("_5w1r"+(this._isEpehmeralStylePreferred()?' '+"_4gx-":'')+(this.state.ephemeralExpiring?' '+"_1xti":'')+(this.state.ephemeralExpired?' '+"_1xtj":'')+(!this.state.emojis?' '+"_3_om":'')+(!!this.state.emojis?' '+"_31xx":''),this.props.className),ref:'bubble',style:{maxWidth:this.props.maxWidth,width:this.state.emojis?null:this.state.bubbleWidth,wordWrap:y.length>=15?'break-word':'inherit'}}),this._renderProgressBar(),r.createElement('div',{className:"_4gx_",ref:'inner'},this._renderContent(),this.props.attachments),this.props.isGiftWrapped?r.createElement(q,{onUnwrap:this.props.onUnwrap}):null));},_renderContent:function(){if(!this.props.body||this.props.isEmojiLike)return null;if(this.state.emojis){var y=k.getSourceURIs(this.state.emojis),z=r.createElement(l,{sourceURIs:y});}else z=r.createElement(n,{body:this.props.body,ranges:this.props.ranges,threadID:this.props.threadID,customLike:this.props.customLike});return (r.createElement('div',{className:"_d97"+(!!this.state.emojis?' '+"_31xy":''),ref:'contentWrapper'},r.createElement('span',{className:"_5yl5",ref:'content'},z)));},_isEpehmeralStylePreferred:function(){if(!this.props.ttl)return false;if(!this.props.attachments)return true;return this.props.attachments.props.attachments.every(function(y){return m.isEphemeralTextStyle(y);});},_onProgressBarAnimationDone:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});new h(this.refs.inner).to('opacity',0).duration(w).go();}},_setExpiredAnimation:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});this.setState({ephemeralExpired:true});}},_renderProgressBar:function(){if(!this.props.timestamp||!this.props.ttl||!this._isEpehmeralStylePreferred()||this.state.emojis&&this.state.emojis.length>0)return null;return (r.createElement(i,{ttl:this.props.ttl,timestamp:this.props.timestamp,isMessageAuthor:this.props.isMessageAuthor,onDone:this._onProgressBarAnimationDone,setExpiredAnimation:this._setExpiredAnimation}));},contentWraps:function(){var y=s.findDOMNode(this.refs.content),z=y.getClientRects(),aa=j.getElementDimensions(y).height;return z&&z.length>1&&z[0].height<aa;},getBoxWidth:function(){if(!this._boxWidth)this._boxWidth=j.measureElementBox(s.findDOMNode(this.refs.bubble),'width',true,true,false);return this._boxWidth;}});f.exports=x;},null);
__d('MercuryTimestamp',['fbt','formatDate','MercuryTimePassed'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=86400000,l=6*k,m={getFormatedTimestamp:function(n){var o=n/1000;return m.getFormattedTimestampByBucket(o,this.getTimeBucket(n));},getFormattedTimestampByBucket:function(n,o){switch(o){case j.TODAY:return {absolute:h._("Today"),relative:i(n,'g:ia')};case j.WEEK_AGO:return {absolute:i(n,'l'),relative:i(n,'D')};case j.CURRENT_YEAR:return {absolute:i(n,'F j'),relative:i(n,'M j')};default:return {absolute:i(n,'F j, Y'),relative:i(n,'n/j/y')};}},getTimeBucket:function(n){var o=new Date(n),p=new Date(),q=new Date(p.getFullYear(),p.getMonth(),p.getDate());if(q<o){return j.TODAY;}else if(q-l<o){return j.WEEK_AGO;}else if(q.getFullYear()===o.getFullYear()){return j.CURRENT_YEAR;}else return j.OTHER_YEAR;},getPreciseTimestamp:function(n){return i(new Date(n),m.getPreciseFormat(n));},getPreciseFormat:function(n){var o=m.getTimeBucket(n);switch(o){case j.TODAY:return 'g:ia';case j.WEEK_AGO:return 'l g:ia';case j.CURRENT_YEAR:return 'F jS, g:ia';case j.OTHER_YEAR:default:return 'F j, Y g:i a';}}};f.exports=m;},null);
__d('ChatMessage.react',['BootloadedComponent.react','ChatAnimatedGifs','ChatAttachmentProgressBar.react','ChatBubble.react','EmojiLikeUtils','MercuryTimestamp','CSS','CurrentUser','ImmutableObject','JSResource','MercuryAttachment','MercuryAttachmentType','MercuryErrorInfo','MercuryIDs','MercuryMessageActions','MercuryMessageError.react','MercuryMessageInfo','MercuryThreads','MessagingGiftWrapChecker','MercuryDisplayTimeFilterMessageRenderer','React','ReactDOM','XUISpinner.react','cssVar','cx','fbt','isRTL','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){'use strict';if(c.__markCompiled)c.__markCompiled();var ja=ba.PropTypes,ka=ba.createClass({displayName:'ChatMessage',propTypes:{message:ja.instanceOf(p).isRequired,maxBubbleWidth:ja.number.isRequired,onAttachmentLoad:ja.func,onStickerClick:ja.func},componentDidMount:function(){n.conditionClass(ca.findDOMNode(this),"_2cnu",this.isOneLine());},isOneLine:function(){var la=this.props.message;return (x.isInbound(la)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps());},shouldComponentUpdate:function(la,ma){return la.message!==this.props.message;},render:function(){var la=this.props.message,ma=r.get(la).length>0,na=x.isInbound(la),oa=u.isGroupChat(la.thread_id),pa=ha(la.body),qa=t.hasErrorStatus(la),ra="_5wd4"+(na?' '+"_1nc7":'')+(!na?' '+"_1nc6":'')+(ma?' '+"_2_-t":'')+(na&&oa?' '+"_5ysy":'')+(qa?' '+"_1zcs":'')+(pa?' '+"direction_rtl":'')+(!pa?' '+"direction_ltr":'');return (ba.createElement('div',{className:ia(this.props.className,ra)},this._renderInner(),this._renderUndertext()));},_renderInner:function(){var la=this.props.message,ma={};if(x.isOutbound(la)){ma['data-hover']='tooltip';ma['data-tooltip-position']='right';ma['aria-label']=ga._("{time}",[ga.param('time',m.getPreciseTimestamp(la.timestamp))]);}if(la.is_filtered_content)return (ba.createElement('div',babelHelpers._extends({className:"_5wd9 _5wdc uiBoxYellow clearfix",ref:'inner'},ma),aa.renderFilteredContent(la)));return (ba.createElement('div',babelHelpers._extends({className:"_5wd9",ref:'inner'},ma),this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (ba.createElement('div',{className:"_3ry4",ref:'undertext'},ba.createElement(w,{className:"_5wda clearfix",message:this.props.message,ref:'status'}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?ba.createElement(h,{bootloadPlaceholder:ba.createElement('span',null),bootloadLoader:q('MercurySpoofWarning.react'),authorID:this.props.message.author,className:"_5wdb"}):null);},_getAttachmentPlaceholder:function(){return (ba.createElement('div',{style:{padding:'20px',text_align:'center'}},ba.createElement(da,null)));},_renderProgressBar:function(){var la=this.props.message;if(!la.ephemeral_ttl_mode||!la.timestamp)return null;return (ba.createElement(j,{ephemeralTTLMode:la.ephemeral_ttl_mode,timestamp:la.timestamp,isMessageAuthor:!x.isInbound(la)}));},_renderAttachments:function(la){var ma=this.props.message,na=y.getForFBID(o.getID()).getThreadMetaNow(ma.thread_id),oa=na?na.custom_like_icon:null,pa=la=='inside'?'attachmentsInside':'attachmentsOutside',qa=r.get(ma).filter(function(sa){var ta=r.isBubblePreferred(sa);return ta&&la==='inside'||!ta&&la==='outside';}),ra=ma.attachments.length>0&&ma.attachments.every(function(sa){return r.isEphemeralAttachmentStyle(sa);});if(qa.length>0)return (ba.createElement(h,{bootloadPlaceholder:this._getAttachmentPlaceholder(),bootloadLoader:q('MercuryAttachments.react'),className:(la==='outside'?"_3e7u":'')+(!!ma.body?' '+"_16ys":'')+(!!ma.ephemeral_ttl_mode?' '+"_3-rb":'')+(' '+"_n4o"),attachments:qa,customLike:oa,isChat:true,isGiftWrapped:z.shouldRenderWithGiftWrap(ma)&&la==='outside',maxWidth:this.props.maxBubbleWidth,message:ma,onUnwrap:this._handleUnwrap,renderProgressBar:ra?this._renderProgressBar:null,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,ref:pa}));},_renderBubble:function(){var la=this.props.message,ma=la.body,na=this._renderAttachments('inside'),oa=x.isInbound(la);if(i.shouldHideBody(la))ma='';if(ma||na)return (ba.createElement('div',{className:"_5wde _n4o"},ba.createElement(k,{attachments:na,body:ma,className:"_5wdf",isMessageAuthor:!oa,maxWidth:this.props.maxBubbleWidth,ranges:la.ranges,ref:'bubble',isEmojiLike:l.isEmojiLike(la),isGiftWrapped:z.shouldRenderWithGiftWrap(la),onUnwrap:this._handleUnwrap,threadID:la.thread_id,ttl:la.ephemeral_ttl_mode,timestamp:la.timestamp,customLike:la.customLike})));},_handleUnwrap:function(){var la="2500ms";setTimeout((function(){return this._persistUnwrapping();}).bind(this),la.substring(0,la.length-2));},_persistUnwrapping:function(){v.get().unwrap(this.props.message);}});f.exports=ka;},null);
__d('ChatMessageGroup.react',['ChatConfig','ChatDateBreak.react','ChatMessage.react','Image.react','immutable','ImmutableObject','MercuryIDs','MercuryParticipants','MercuryTimestamp','React','StoreAndPropBasedStateMixin','cx','fbt','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';if(c.__markCompiled)c.__markCompiled();var u=c('MercuryThreads').get(),v=q.PropTypes,w=new m({name:'',href:'#',image_src:''}),x=h.get('chattab_rounded_profile',false),y=q.createClass({displayName:'ChatMessageGroup',mixins:[r(o)],propTypes:{activeMessageID:v.string,author:v.string,hasDateBreak:v.bool,isCanonical:v.bool,isFromViewer:v.bool,isPageMessage:v.bool,maxBubbleWidth:v.number,messages:v.instanceOf(l.List).isRequired,onAttachmentLoad:v.func,onStickerClick:v.func,threadID:v.string},statics:{calculateState:function(aa){return {participants:z(aa)};}},shouldComponentUpdate:function(aa,ba){return (this.props.activeMessageID!==aa.activeMessageID||this.props.isFromViewer!==aa.isFromViewer||!l.is(this.props.messages,aa.messages)||!l.is(this.state.participants,ba.participants));},render:function(){return (q.createElement('div',{className:"_4tdt"},this._renderProfileColumn(),this._renderName(),q.createElement('div',{className:"_4tdv"},this._renderMessages())));},_renderProfileColumn:function(){if(this.props.isFromViewer)return null;var aa=this.state.participants.get(this.props.author)||w,ba=t._("{name} {time}",[t.param('name',aa.name),t.param('time',p.getPreciseTimestamp(this.props.messages.last().timestamp))]),ca=aa.image_src?q.createElement(k,{src:aa.image_src}):null;return (q.createElement('div',{className:"_31o4"+(x?' '+"_3njy":'')},q.createElement('a',{'aria-label':ba,className:"_4tdw",'data-hover':'tooltip','data-tooltip-position':'left',href:aa.href,ref:'link'},ca)));},_renderName:function(){if(this.props.isCanonical||this.props.isFromViewer)return null;var aa=this.state.participants.get(this.props.messages.first().author);if(!aa)return null;var ba=u.getThreadMetaNow(this.props.threadID),ca=aa.short_name;if(ba&&ba.custom_nickname){var da=n.getUserIDFromParticipantID(aa.id);if(ba.custom_nickname[da])ca=ba.custom_nickname[da];}return (q.createElement('div',{className:"_4tdx"},ca));},_renderMessages:function(){var aa=this.props.messages.size,ba=[];this.props.messages.forEach((function(ca,da,ea){var fa=ca.message_id===this.props.activeMessageID;if(fa&&!(da===0&&this.props.hasDateBreak))ba.push(q.createElement(i,{date:new Date(ca.timestamp),key:'db:'+ca.message_id}));ba.push(q.createElement(j,{isFromViewer:this.props.isFromViewer,key:ca.message_id,maxBubbleWidth:this.props.maxBubbleWidth,message:ca,nextTimestamp:this._getNextTimestamp(ea,aa,da),onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick}));}).bind(this));return ba;},_getNextTimestamp:function(aa,ba,ca){return ca<ba-1?aa.get(ca+1).timestamp:this.props.nextTimestamp;}});function z(aa){return l.Map().withMutations(function(ba){aa.readReceipts.forEach(function(ca,da){ba.set(da,o.getOrFetch(da));});ba.set(aa.author,o.getOrFetch(aa.author));});}f.exports=y;},null);
__d('MercuryLogMessage.react',['DOM','Event','ImmutableObject','MercuryLogMessageRenderer','MercuryLogMessageType','React','ReactDOM','cx','fbt','emptyFunction','formatDate','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=m.PropTypes,u=m.createClass({displayName:'MercuryLogMessage',propTypes:{loadMoreMessages:t.func,maxWidth:t.number,message:t.instanceOf(j).isRequired,onImageLoad:t.func},getDefaultProps:function(){return {onImageLoad:q};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},_renderErrorMessage:function(){return (m.createElement('a',{onClick:this._loadMoreMessages},p._("Show previous messages.")));},_loadMoreMessages:function(){var v=this.props.loadMoreMessages&&this.props.loadMoreMessages();if(v){this.setState({messageText:this._renderErrorMessage()});}else{var w=p._("Couldn't find previous messages.");this.setState({messageText:w});}},componentWillReceiveProps:function(v){if(v.message.log_message_type===l.SERVER_ERROR){this._loadMoreMessages();return;}k.renderText(v.message,(function(w){this.setState({messageText:w});}).bind(this));},shouldComponentUpdate:function(v,w){return (this.state.messageText!=w.messageText||v.maxWidth!==this.props.maxWidth);},componentDidUpdate:function(){var v=n.findDOMNode(this.refs.attachment);if(!v)return;k.renderAttachmentLegacy(v,this.props.message);h.scry(v,'img').forEach((function(w){var x=i.listen(w,'load',(function(){this.props.onImageLoad(w);x.remove();}).bind(this));}).bind(this));},render:function(){return (m.createElement('div',babelHelpers._extends({},this.props,{className:s(this.props.className,"_5ye6"),style:babelHelpers._extends({},this.props.style,this._getStyle()),title:r(new Date(this.props.message.timestamp),'g:ia')}),m.createElement('div',{className:"_5ye7"},k.renderIcon(this.props.message),this.state.messageText),m.createElement('div',{className:"_5ye8",ref:'attachment'})));},_getStyle:function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null;}});f.exports=u;},null);
__d('MessengerDomIDs',['uniqueID'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={COMPOSER_INPUT_DESCRIPTION:h(),CONVERSATION:h(),MAIN_LABEL:h(),MUTE_DIALOG_TITLE:h(),THREAD_INFO_PANEL:h(),THREAD_TITLE:h()};f.exports=i;},null);
__d('MessageList.react',['immutable','ImmutableObject','MercuryActionType','MercuryIDs','MercuryMeMessageProcessor','MercuryMessageGroup','MercuryShareAttachmentRenderLocations','MessengerDomIDs','ReactComponentWithPureRenderMixin','React','ReactDOM','FBRTCExperiment','MercuryLogMessageType','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=q.PropTypes,w=1000*60*60,x=q.createClass({displayName:'MessageList',mixins:[p],propTypes:{DateBreak:v.func.isRequired,deliveryTimestamp:v.number.isRequired,isCanonical:v.bool,isPageMessage:v.bool,location:v.string.isRequired,LogMessage:v.func.isRequired,loadMoreMessages:v.func,MessageGroup:v.func.isRequired,messages:v.instanceOf(h.List).isRequired,onAttachmentLoad:v.func,onStickerClick:v.func,readReceipts:v.instanceOf(h.OrderedMap).isRequired,viewer:v.string.isRequired,thread:v.object,threadID:v.string},getInitialState:function(){return {activeMessageID:null,messageGroups:m.calculateMessageGroups(this.props.messages,this.props.location)};},componentWillReceiveProps:function(da){if(da.messages!==this.props.messages)this.setState({messageGroups:m.calculateMessageGroups(da.messages,da.location)});},render:function(){var da=this.props,ea=da.DateBreak,fa=da.location,ga=da.MessageGroup,ha=[],ia=this.state.activeMessageID,ja=this.state.messageGroups,ka=ja.length,la=this.props.readReceipts,ma=la.last()||0,na=k.getParticipantIDFromUserID(this.props.viewer);for(var oa=0;oa<ka;oa++){var pa=oa>0?ja[oa-1]:null,qa=pa&&pa.length>0?pa[pa.length-1]:null,ra=ja[oa],sa=ra[0],ta=ra[ra.length-1],ua=false;if(!qa||sa.timestamp-qa.timestamp>w){ua=true;ha.push(q.createElement(ea,{date:new Date(sa.timestamp),key:'db:'+sa.message_id,ref:'db:'+sa.message_id}));}if(sa.action_type==j.LOG_MESSAGE){if((fa===n.CHAT||fa===n.MESSENGER)&&(sa.log_message_type===t.VIDEO_CALL||sa.log_message_type===t.PHONE_CALL)){var va=s.gen('rtc_www_xmas'),wa=va.getParam('show_xmas','0');if(wa==='1'){var xa=this._createRTCMessageGroup(sa,na,ja,ka,oa,la,ma,ta);ha.push(xa);}else{var ya=this._createLogMessageGroup(sa);ha.push(ya);}}else{var za=this._createLogMessageGroup(sa);ha.push(za);}continue;}if(l.shouldTransform(sa)){var ab=l.transform(sa);ha.push(this._createLogMessageGroup(ab));continue;}ra=h.List(ra);var bb=z(ja,ka,oa),cb=!ba(la,ra,bb),db=aa(ma,ta),eb=ca(this.props.deliveryTimestamp,ta);ha.push(q.createElement(ga,{activeMessageID:y(ia,ra),author:ra.first().author,deliveryTimestamp:eb,hasDateBreak:ua,isCanonical:this.props.isCanonical,isFromViewer:na===sa.author,isPageMessage:this.props.isPageMessage,key:'mg:'+sa.message_id,lastReadTimestamp:db,maxBubbleWidth:this.props.maxBubbleWidth,messages:ra,nextTimestamp:bb,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:cb?la:h.OrderedMap(),ref:'mg:'+sa.message_id,thread:this.props.thread,threadID:this.props.threadID}));}return (q.createElement('div',{id:fa===n.MESSENGER?o.CONVERSATION:null},ha));},getMessageElement:function(da,ea){if(ea){var fa=this.refs['db:'+da];if(fa)return r.findDOMNode(fa);}var ga=this.state.messageGroups.find(function(ja){return ja.some(function(ka){return ka.message_id===da;});});if(!ga)return null;var ha=ga[0].message_id,ia=this.refs['mg:'+ha];if(!ia)return null;if(ea&&ha===da)return r.findDOMNode(ia);return ia.getMessageElement(da);},_handleMessageDeselect:function(da){this.setState(function(ea){return {activeMessageID:ea.activeMessageID===da?null:ea.activeMessageID};});},_handleMessageSelect:function(da){this.setState({activeMessageID:da});},_createRTCMessageGroup:function(da,ea,fa,ga,ha,ia,ja,ka){var la=this.props.MessageGroup,ma={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:da.log_message_body,log_message_data:da.log_message_data,log_message_type:da.log_message_type,timestamp:da.timestamp}},na=i.setProperty(da,'attachments',[ma]);na=i.setProperty(na,'body','');var oa=h.List([na]),pa=z(fa,ga,ha),qa=!ba(ia,oa,pa),ra=aa(ja,ka),sa=ca(this.props.deliveryTimestamp,ka);return (q.createElement(la,{author:oa.first().author,deliveryTimestamp:sa,isFromViewer:ea===da.author,key:da.message_id,lastReadTimestamp:ra,maxBubbleWidth:this.props.maxBubbleWidth,messages:oa,nextTimestamp:pa,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:qa?ia:h.OrderedMap(),thread:this.props.thread,threadID:this.props.threadID}));},_createLogMessageGroup:function(da){var ea=this.props.LogMessage;return (q.createElement(ea,{className:this.props.location===n.CHAT?"_5w0o":null,key:da.message_id,loadMoreMessages:this.props.loadMoreMessages,message:da,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer}));}});function y(da,ea){return ea.find(function(fa){return fa.message_id===da;})?da:null;}function z(da,ea,fa){return fa<ea-1?da[fa+1][0].timestamp:Infinity;}function aa(da,ea){return ea.timestamp>da?da:Infinity;}function ba(da,ea,fa){return (ea.isEmpty()||da.last()<ea.first().timestamp||da.first()>=fa);}function ca(da,ea){return ea.timestamp>da?da:Infinity;}f.exports=x;},null);
__d('ChatConversation.react',['ChatDateBreak.react','ChatMessageGroup.react','ChatMessage.react','immutable','MercuryActionType','MercuryLogMessage.react','MessageList.react','React','MercuryShareAttachmentRenderLocations','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=o.PropTypes,s=o.createClass({displayName:'ChatConversation',propTypes:{contextBanner:r.object,isCanonical:r.bool.isRequired,loadMoreMessages:r.func,maxBubbleWidth:r.number.isRequired,messages:r.instanceOf(k.List).isRequired,onAttachmentLoad:r.func,onStickerClick:r.func,viewer:r.string.isRequired,threadID:r.string},componentWillReceiveProps:function(t){!(t.maxBubbleWidth===this.props.maxBubbleWidth)?q(0):undefined;},render:function(){return (o.createElement('div',null,this.props.contextBanner,o.createElement(n,{DateBreak:h,LogMessage:m,MessageGroup:i,deliveryTimestamp:0,isCanonical:this.props.isCanonical,location:p.CHAT,loadMoreMessages:this.props.loadMoreMessages,maxBubbleWidth:this.props.maxBubbleWidth,messages:this.props.messages,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,readReceipts:k.OrderedMap(),viewer:this.props.viewer,threadID:this.props.threadID})));}});f.exports=s;},null);
__d('MercuryTypingAnimation.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'MercuryTypingAnimation',propTypes:{color:k.oneOf(['light','dark'])},getDefaultProps:function(){return {color:'dark'};},render:function(){var m="_4a0v"+(this.props.color==='light'?' '+"_4a0w":'')+(this.props.color==='dark'?' '+"_4a0x":'');return (h.createElement('div',{className:j(this.props.className,m)},h.createElement('div',{className:"_4b0g"},h.createElement('div',{className:"_5pd7"}),h.createElement('div',{className:"_5pd7"}),h.createElement('div',{className:"_5pd7"}))));}});f.exports=l;},null);
__d('ChatTypingIndicator.react',['ChatConfig','Image.react','MercuryParticipants','MercuryTypingAnimation.react','ReactComponentWithPureRenderMixin','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.PropTypes,q=h.get('chattab_rounded_profile',false),r=m.createClass({displayName:'ChatTypingIndicator',mixins:[l],propTypes:{userID:p.string,showName:p.bool},render:function(){var t=undefined;if(this.props.userID)t=j.getNow(this.props.userID);if(!t)return null;return (m.createElement('div',{className:"_4tdt"},s(t),this._renderBubble()));},getBubble:function(){return this.refs.bubble;},_renderBubble:function(){var t=this.props.showName;return (m.createElement('div',{className:"_4tdv"},m.createElement('div',{className:"_5wd4"+(' '+"_1nc7")+(' '+"_2cnu")+(t?' '+"_5ysy":'')},m.createElement('div',{className:"_5wd9"+(' '+"_n4o")},m.createElement('div',{className:"_5w1r"+(' '+"_5wdf")+(' '+"_3_om")},m.createElement(k,{className:"_5x7x",ref:'bubble'}))))));}});function s(t){var u=o._("{name}",[o.param('name',t.name)]);return (m.createElement('div',{className:"_31o4"+(q?' '+"_3njy":'')},m.createElement('a',{'aria-label':u,className:"_4tdw",'data-hover':'tooltip','data-tooltip-position':'left',href:t.href||'#',ref:'link'},m.createElement(i,{src:t.image_src,ref:'image'}))));}f.exports=r;},null);
__d('ChatTypingIndicators.react',['ChatTypingIndicator.react','DOM','MercuryIDs','MercuryThreadInformer','MercuryTypingReceiver','MercuryParticipants','React','ReactDOM','SubscriptionsHandler','TooltipData','createObjectFrom','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=n.PropTypes,v=n.createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorClass:u.func,indicatorsWillShow:u.func,indicatorsDidShow:u.func,rootClassName:u.string,threadID:u.string.isRequired,viewer:u.string.isRequired},getDefaultProps:function(){return {indicatorClass:h,indicatorsWillShow:s,indicatorsDidShow:s};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){var w=k.getForFBID(this.props.viewer),x=l.getForFBID(this.props.viewer);this._subscriptions=new p();this._subscriptions.addSubscriptions(x.addRetroactiveListener('state-changed',this.typingStateChanged),w.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(w){if(w.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(w,x){if(x.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();m.getMulti(this.state.typingUserIDs,(function(w){if(this.isMounted())this.state.typingUserIDs.forEach((function(x){var y=w[x],z=this.refs[x]&&this.refs[x].getBubble();if(z&&y)q.set(o.findDOMNode(z),this.renderTooltip(y.short_name),'above','left');}).bind(this));}).bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var w=j.isGroupChat(this.props.threadID);return (n.createElement('div',{className:this.props.rootClassName},this.state.typingUserIDs.map((function(x){return (this._renderTypingIndicator(x,!!w));}).bind(this))));},_renderTypingIndicator:function(w,x){var y=this.props.indicatorClass;return (n.createElement(y,{key:w,ref:w,showName:x,userID:w}));},renderTooltip:function(w){var x=i.create('span');o.render(n.createElement('span',null,t._("{name} is typing...",[t.param('name',w)])),x);return x;},typingStateChanged:function(w){if(this.props.threadID in w)this.setState({typingUserIDs:w[this.props.threadID].slice().sort()});},messagesReceived:function(w,x){if(this.props.threadID in x){var y=x[this.props.threadID],z=r(y.map(function(aa){return aa.author;}));this.setState({typingUserIDs:this.state.typingUserIDs.filter(function(aa){return !z[aa];}).sort()});}}});f.exports=v;},null);
__d('MercuryMessageList',['immutable','LogHistory','Map','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.getInstance('mercury_message_list');function m(o){this.$MercuryMessageList1=h.List(o||[]);this.$MercuryMessageList2();}m.prototype.append=function(o){var p;this.$MercuryMessageList1=(p=this.$MercuryMessageList1).push.apply(p,o);this.$MercuryMessageList2();n('append',o);};m.prototype.prepend=function(o){var p;this.$MercuryMessageList1=(p=this.$MercuryMessageList1).unshift.apply(p,o);this.$MercuryMessageList2();n('prepend',o);};m.prototype.update=function(o){var p=o.filter((function(q){return this.contains(q);}).bind(this));if(p.length===0)return;this.$MercuryMessageList1=this.$MercuryMessageList1.withMutations((function(q){p.forEach((function(r){var s=this.$MercuryMessageList3.get(r.message_id);if(s!==undefined)q.set(s,r);}).bind(this));}).bind(this));n('update',p);};m.prototype.reorder=function(o){this.$MercuryMessageList1=h.List(o);this.$MercuryMessageList2();n('reorder',o);};m.prototype.at=function(o){return this.$MercuryMessageList1.get(o);};m.prototype.contains=function(o){return this.$MercuryMessageList3.has(o.message_id);};m.prototype.toArray=function(){return this.$MercuryMessageList1.toArray();};m.prototype.toMap=function(){return new j(h.Seq(this.$MercuryMessageList1).map(function(o){return [o.message_id,o];}));};m.prototype.$MercuryMessageList2=function(){this.$MercuryMessageList3=new j(h.Seq(this.$MercuryMessageList1).map(function(o,p){return [o.message_id,p];}));};function n(event,o){k(function(){l.debug(event,JSON.stringify({messageIDs:o.map(function(p){return p.message_id;})}));},0);}f.exports=m;},null);
__d('MercuryMessageStore',['MercuryAPIArgsSource','LogHistory','MercuryMessages','MercuryViewer','MercuryMessageList','SubscriptionsHandler','MercuryThreadInformer','MercuryThreadlistConstants','mixInEventEmitter','setImmediate','setTimeoutAcrossTransitions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';if(c.__markCompiled)c.__markCompiled();var s=c('MercuryThreads').get(),t=i.getInstance('mercury_message_store');function u(w,x,y){this.$MercuryMessageStore1=w;this.$MercuryMessageStore2=new l();this.$MercuryMessageStore3=y?j.getForFBID(y):j.get();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore7=x||o.RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore8=y?n.getForFBID(y):n.get();this.$MercuryMessageStore9=new m();this.$MercuryMessageStore9.addSubscriptions(this.$MercuryMessageStore8.subscribe('messages-received',(function(z,aa){return this.$MercuryMessageStore10(aa);}).bind(this)),this.$MercuryMessageStore8.subscribe('messages-updated',(function(z,aa){return aa[this.$MercuryMessageStore1]&&this.$MercuryMessageStore11(aa[this.$MercuryMessageStore1]);}).bind(this)),this.$MercuryMessageStore8.subscribe('messages-reordered',(function(z,aa){return aa[this.$MercuryMessageStore1]&&this.$MercuryMessageStore12();}).bind(this)));t.debug('constructed',JSON.stringify({threadID:this.$MercuryMessageStore1}));this.$MercuryMessageStore13();}u.prototype.setNewThreadID=function(w){this.$MercuryMessageStore14=w;};u.prototype.destroy=function(){this.$MercuryMessageStore9&&this.$MercuryMessageStore9.release();t.debug('destroyed',JSON.stringify({threadID:this.$MercuryMessageStore1}));};u.prototype.subscribe=function(w){return this.addRetroactiveListener('updated',w);};u.prototype.fetchMoreMessages=function(){if(this.hasFetchedAll())return false;this.$MercuryMessageStore13();return true;};u.prototype.hasFetchedAll=function(){if(this.$MercuryMessageStore3.hasLoadedExactlyNMessages(this.$MercuryMessageStore1,this.$MercuryMessageStore6)&&this.$MercuryMessageStore3.hasLoadedAllMessages(this.$MercuryMessageStore1))return true;return s.isNewEmptyLocalThread(this.$MercuryMessageStore1);};u.prototype.$MercuryMessageStore13=function(){var w=this.$MercuryMessageStore6+this.$MercuryMessageStore7*this.$MercuryMessageStore4;t.debug('fetching',JSON.stringify({threadID:this.$MercuryMessageStore1,limit:w}));this.$MercuryMessageStore3.getThreadMessagesRange(this.$MercuryMessageStore1,0,w,this.$MercuryMessageStore15.bind(this),null,h.MERCURY);if(this.$MercuryMessageStore4<10)this.$MercuryMessageStore4+=1;if(this.$MercuryMessageStore3.hasLoadedNMessages(this.$MercuryMessageStore1,w))q((function(){this.$MercuryMessageStore12();}).bind(this));};u.prototype.$MercuryMessageStore15=function(w){if(w&&w.length){this.$MercuryMessageStore5=w[0].timestamp;this.$MercuryMessageStore6=w.length;t.debug('fetched',JSON.stringify({threadID:this.$MercuryMessageStore1,earliestMessageTimestamp:this.$MercuryMessageStore5,count:this.$MercuryMessageStore6}));}else if(w&&!w.length&&!this.$MercuryMessageStore6)this.$MercuryMessageStore16(u.THREAD_IS_EMPTY);};u.prototype.$MercuryMessageStore10=function(w){var x=[],y=w[this.$MercuryMessageStore1];if(y&&y.length)x=x.concat(y);if(this.$MercuryMessageStore14){var z=w[this.$MercuryMessageStore14];if(z&&z.length){x=x.concat(z);this.$MercuryMessageStore14=null;}}if(x.length){this.$MercuryMessageStore2.append(x);this.$MercuryMessageStore6+=x.length;var aa=x.every(function(ba){return ba.author!=k.getID();});this.$MercuryMessageStore16(u.MESSAGES_RECEIVED,{allFromOthers:aa});}};u.prototype.$MercuryMessageStore11=function(w){this.$MercuryMessageStore2.update(this.$MercuryMessageStore3.getMessagesFromIDs(Object.keys(w)));this.$MercuryMessageStore17();this.$MercuryMessageStore16(u.MESSAGES_CHANGED);};u.prototype.$MercuryMessageStore12=function(){if(!this.$MercuryMessageStore5)return;this.$MercuryMessageStore2.reorder(this.$MercuryMessageStore3.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore1,this.$MercuryMessageStore5));this.$MercuryMessageStore17();this.$MercuryMessageStore16(u.MESSAGES_REORDERED);};u.prototype.$MercuryMessageStore16=function(w,x){var y=this.$MercuryMessageStore2.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',babelHelpers._extends({messages:y,eventType:w},x));v(this.$MercuryMessageStore1,w,y);};u.prototype.$MercuryMessageStore17=function(){var w=this.$MercuryMessageStore2.at(0);if(w)this.$MercuryMessageStore5=w.timestamp;};function v(w,x,y){r(function(){t.debug('update:'+x,JSON.stringify({threadID:w,messageIDs:y.map(function(z){return z.message_id;})}));},0);}Object.assign(u,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});p(u,{updated:true});f.exports=u;},null);
__d('ChatTabMessagesView',['Animation','Arbiter','BanzaiLogger','CSS','ChatConversation.react','ChatPerfInstrumentation','ChatTabViewEvents','ChatTypingIndicators.react','ChatWelcomeMessage','CurrentUser','DOM','Event','immutable','MercuryLastMessageIndicator.react','LiveTimer','MercuryIDs','MercuryViewer','MercuryMessageStore','MessengerContextBannerBootloader','MessengerHotLikePreviewEvents','React','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','Scroll','ServerTime','StickerActions','StickerState','StickerStoreController','Style','SubscriptionsHandler','UserAgent_DEPRECATED','arrayContains','getElementPosition','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){'use strict';if(c.__markCompiled)c.__markCompiled();var qa=64,ra=null,sa=20;function ta(va){if(ra===null){var wa=va.childNodes[0];ka.set(va,'overflow','scroll');ra=wa.clientWidth-qa;ka.set(va,'overflow','');}return ra;}function ua(va,wa,xa,ya,za,ab,bb,cb,db){this.loadingIcon=za;this.threadID=va;this.sheetController=wa;this.scrollContainer=xa;this.conversationElem=ya;this.contextBannerEligible=db;this.contextBannerElem=null;this.tabView=cb;v.restart(ga.get()/1000);this._loadingMoreMessages=false;this._initialLoadFinished=false;function eb(){n.inform('interaction-with-tab',va);}this._subscriptions=new la();this._subscriptions.addSubscriptions(i.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),s.listen(this.scrollContainer,'mousedown',eb));if(ma.firefox()){var fb='WheelEvent' in window?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(fb,eb,false);}else this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'mousewheel',eb));this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'scroll',pa(this.scrolling,50,this)));var gb;ca.render(ba.createElement(o,{threadID:this.threadID,indicatorsWillShow:(function(){return (gb=this.isScrolledToBottom());}).bind(this),indicatorsDidShow:(function(){return (gb&&this.scrollToBottom(true));}).bind(this),viewer:q.getID()}),bb);var hb;this.lastMessageIndicatorNode=ab;this.lastMessageIndicator=new da(u,this.lastMessageIndicatorNode);this.lastMessageIndicator.setProps({threadID:this.threadID,hideTyping:true,indicatorWillShow:(function(){return hb=this.isScrolledToBottom();}).bind(this),indicatorDidShow:(function(){return hb&&this.scrollToBottom(true);}).bind(this)});this.initializeConversation();}Object.assign(ua.prototype,{initializeConversation:function(){this._store=new y(this.threadID);this._conversation=new da(l,this.conversationElem);this._conversation.setProps({isCanonical:w.isCanonical(this.threadID),loadMoreMessages:this._loadMoreMessages.bind(this),maxBubbleWidth:ta(this.scrollContainer),messages:t.List(),onAttachmentLoad:(function(va){var wa=this.scrollContainer,xa=fa.getTop(wa)+wa.clientHeight;if(xa+va+sa>=wa.scrollHeight)this.scrollToBottom();}).bind(this),onStickerClick:this._onStickerClick.bind(this),viewer:q.getID(),threadID:this.threadID});this._subscriptions.addSubscriptions(this._store.subscribe(this._updateMessageFromStore.bind(this)),aa.addListener(aa.START,(function(va,wa){if(this.threadID!==wa)return;this._likePreview=va;this._conversation.setProps({messages:this._getNormalizedMessages()},this.scrollToBottom.bind(this));this.scrollToBottom();clearInterval(this._scrollToBottomInterval);this._scrollToBottomInterval=setInterval(this.scrollToBottom.bind(this),50);}).bind(this)),aa.addListener(aa.STOP,(function(va){if(this.threadID!==va)return;this._likePreview=null;}).bind(this)),aa.addListener(aa.FINISH_ANIMATION,(function(va){clearInterval(this._scrollToBottomInterval);}).bind(this)),aa.addListener(aa.REMOVE,(function(va){if(this.threadID!==va)return;clearInterval(this._scrollToBottomInterval);this._likePreview=null;this._conversation.setProps({messages:this._getNormalizedMessages()});}).bind(this)));},_updateMessageFromStore:function(va){if(va.eventType==y.MESSAGES_RECEIVED&&va.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(va.eventType==y.MESSAGES_REORDERED){this._loadingMoreMessages=false;k.hide(this.loadingIcon);}var wa=this.isScrolledToBottom(),xa=this._getLoadingHeight(),ya=this.scrollContainer.scrollHeight,za=fa.getTop(this.scrollContainer);this._messages=va.messages;var ab=p.getWelcomeMessage(this.threadID);if(ab)this._messages.push(ab);this._conversation.setProps({messages:this._getNormalizedMessages()},(function(){if(wa||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(va.eventType==y.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-ya-xa+za);if(!this._initialLoadFinished){this._initialLoadFinished=true;m.logCHAT_CONVERSATION_TTI();}if(this._store.hasFetchedAll()&&this.contextBannerEligible)this.renderContextBanner(this.threadID);}).bind(this));this.lastMessageIndicator.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(va.eventType==y.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(this._messages)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();if(va.eventType==y.MESSAGES_CHANGED)this._checkToAnimateSticker();},setShouldScrollToBottom:function(va){this._shouldScrollToBottom=va;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){k.show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&fa.getTop(this.scrollContainer);},getThreadID:function(){return this.threadID;},destroy:function(){r.scry(this.conversationElem,'.stickerContainer').forEach(function(va){return ca.unmountComponentAtNode(va);});this.unmountContextBanner();ca.unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();ca.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_shouldShowStickerReplyNUX:function(va){if(!ia.shouldShowStickerReplyNUX()||!va.length)return false;var wa=va[va.length-1];if(wa.author===x.getID())return false;if(wa.has_attachment)return wa.attachments.some(function(xa){return xa.attach_type==='sticker';});return false;},isScrolledToBottom:function(va){var wa=this.scrollContainer;va=va||sa;return fa.getTop(wa)+wa.clientHeight>=wa.scrollHeight-va;},isScrolledNearTop:function(){return fa.getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},scrollToBottom:function(va){this.scrollToPosition(this.scrollContainer.scrollHeight,va);},scrollToPosition:function(va,wa){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(wa===true){this._scrollTopAnimation=new h(this.scrollContainer).to('scrollTop',va).ease(h.ease.end).duration(400).go();}else fa.setTop(this.scrollContainer,va);},_loadMoreMessages:function(){return this._store.fetchMoreMessages();},_onStickerClick:function(va,wa){if(!va)return;j.log('StickersLoggerConfig',{event:'click_sticker',packid:va,stickerid:wa});var xa=this.tabView;ia.onTrayDataReady(function(){if(na(ia.getPackIDsInTray(),va)){var ya=ia.getPack(va);if(ya&&ya.isPromoted)ha.addPack(va);xa.setStickersFlyoutPackID(va);}else ja.showStore(va);});},_checkToAnimateSticker:function(){var va=oa(this.scrollContainer);i.inform('chatScrolled/'+this.threadID,{scrollTop:fa.getTop(this.scrollContainer),top:va.y,viewHeight:va.height});},setNewThreadID:function(va){this._store.setNewThreadID(va);},_getNormalizedMessages:function(){if(this._likePreview){this._messages.push(this._likePreview);}else this._messages=this._messages.filter(function(va){return !va.is_like_preview;});return t.List(this._messages);},renderContextBanner:function(va,wa){z.getBootloadedComponent(va,ea.CHAT,(function(xa){ka.set(this.conversationElem,'padding-top','80px');this._conversation.setProps({contextBanner:xa});}).bind(this),wa,(function(xa){ka.set(this.conversationElem,'padding-top',xa+'px');}).bind(this));},unmountContextBanner:function(){if(this._conversation)this._conversation.setProps({contextBanner:null});}});f.exports=ua;},null);
__d('ChatPrivacyActionController',['ChatVisibility','JSLogger','PresencePrivacy'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=function(l,m){this._userID=l;this._logger=i.create('blackbird');this._getState=function(){if(h.isOnline())return j.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var o=this._getState();switch(this._getState()){case k.OFFLINE:if(h.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});h.goOnline((function(){if(!j.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}).bind(this));break;case k.BLOCKED:j.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:j.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};var n=(function(){m&&m(this._getState());}).bind(this);n();this._subscribeToken=j.subscribe('privacy-changed',n);};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';Object.assign(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){this._subscribeToken&&j.unsubscribe(this._subscribeToken);}});f.exports=k;},null);
__d('ChatTabSheetListener',['ChatPrivacyActionController','MercuryIDs','MercuryParticipants','MercuryThreadInformer','MercuryThreads','MercuryViewer'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(o,p){this.$ChatTabSheetListener1=p;this.$ChatTabSheetListener2=o;this.$ChatTabSheetListener3=i.getUserIDFromThreadID(this.$ChatTabSheetListener2);k.get().subscribe('threads-updated',(function(){return this.$ChatTabSheetListener4();}).bind(this));if(this.$ChatTabSheetListener3)this.$ChatTabSheetListener5=new h(this.$ChatTabSheetListener3,(function(q){return this.$ChatTabSheetListener6(q);}).bind(this));}n.prototype.destroy=function(){this.$ChatTabSheetListener5&&this.$ChatTabSheetListener5.destroy();};n.prototype.$ChatTabSheetListener4=function(){var o=l.get();o.getThreadMeta(this.$ChatTabSheetListener2,(function(p){var q=m.getID(),r=p.participants.filter(function(s){return s!==q;});r.length<1&&!o.isNewEmptyLocalThread(this.$ChatTabSheetListener2)?this.$ChatTabSheetListener1.openNoRecipientsSheet():this.$ChatTabSheetListener1.closeNoRecipientsSheet();}).bind(this));};n.prototype.$ChatTabSheetListener6=function(o){switch(o){case h.OFFLINE:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.openOfflineSheet();break;case h.NORMAL:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.closeOfflineSheet();break;case h.BLOCKED:this.$ChatTabSheetListener1.closeOfflineSheet();j.get(i.getParticipantIDFromUserID(this.$ChatTabSheetListener3),(function(p){p.is_friend?this.$ChatTabSheetListener1.openUserBlockedSheet():this.$ChatTabSheetListener1.closeUserBlockedSheet();}).bind(this));break;}};f.exports=n;},null);
__d('ChatTabSheetController',['Bootloader','ChatTabSheetListener','Deferred','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=function(m,n,o,p){this._threadID=m;this._rootElement=n;this._tabElement=o;this._view=p;this._deferred=new j();this._isLoading=false;this._listener=new i(this._threadID,this);};Object.assign(l.prototype,{openAddFriendsSheet:function(){this._load((function(){this._addFriendsTabSheet.open();}).bind(this));},openMessageBlockedTabSheet:function(){this._load((function(){this._threadIsMessageBlockedSheet.open();}).bind(this));},getAddFriendsParticipants:function(){return this._addFriendsTabSheet?this._addFriendsTabSheet.getParticipants():[];},openNameConversationSheet:function(m){this._load((function(){this._nameConversationTabSheet.open(m);}).bind(this));},openReadOnlySheet:function(){this._load((function(){this._readOnlyTabSheet.open();}).bind(this));},openNewMessagesSheet:function(){this._load((function(){this._newMessagesTabSheet.open();}).bind(this));},openUploadWarningTabSheet:function(){this._load((function(){this._uploadWarningTabSheet.open();}).bind(this));},openThreadIsMutedTabSheet:function(){this._load((function(){this._threadIsMutedTabSheet.open();}).bind(this));},openEmployeeAwaySheet:function(){this._load((function(){this._employeeAwaySheet.open();}).bind(this));},openOfflineSheet:function(){this._load((function(){this._offlineTabSheet.open();}).bind(this));},openUserBlockedSheet:function(){this._load((function(){this._userBlockedTabSheet.open();}).bind(this));},openNoRecipientsSheet:function(){this._load((function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.open();}).bind(this));},openSecretModeSheet:function(){this._load((function(){this._secretModeSheet.open();}).bind(this));},closeAddFriendsSheet:function(){this._lazy((function(){this._addFriendsTabSheet.close();}).bind(this));},closeAutomaticNameConversationSheet:function(){this._lazy((function(){if(this._nameConversationTabSheet&&this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();}).bind(this));},closeMessageBlockedTabSheet:function(){this._lazy((function(){this._threadIsMessageBlockedSheet.close();}).bind(this));},closeThreadIsMutedTabSheet:function(){this._lazy((function(){this._threadIsMutedTabSheet.close();}).bind(this));},closeNewMessagesSheet:function(){this._lazy((function(){this._newMessagesTabSheet.close();}).bind(this));},closeUploadWarningTabSheet:function(){this._lazy((function(){this._uploadWarningTabSheet.close();}).bind(this));},closeOfflineSheet:function(){this._lazy((function(){this._offlineTabSheet.close();}).bind(this));},closeUserBlockedSheet:function(){this._lazy((function(){this._userBlockedTabSheet.close();}).bind(this));},closeSecretModeSheet:function(){this._lazy((function(){this._secretModeSheet.close();}).bind(this));},onClickMessagesBlockedSheet:function(m){this._lazy((function(){this._unblockMessagesSub=this._threadIsMessageBlockedSheet.subscribe('clicked',m);}).bind(this));},closeNoRecipientsSheet:function(){this._lazy((function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.close();}).bind(this));},onClickNewMessagesSheet:function(m){this._lazy((function(){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',m);}).bind(this));},onClickThreadIsMutedSheet:function(m){this._lazy((function(){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',m);}).bind(this));},onClickSecretModeSheet:function(m){this._lazy((function(){this._secretModeClickSub=this._secretModeSheet.subscribe('clicked',m);}).bind(this));},onResize:function(m){this._lazy((function(){this._sheetView.subscribe('resize',m);}).bind(this));},onTokensChanged:function(m){this._lazy((function(){this._addFriendsTabSheet.subscribe('chat/tokens-changed',m);}).bind(this));},onEscape:function(m){this._lazy((function(){this._addFriendsTabSheet.subscribe('esc-pressed',m);}).bind(this));},destroy:function(){this._listener&&this._listener.destroy();this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();},_load:function(m){this._bootload();this._deferred.then(m);},_lazy:function(m){this._deferred.then(m);},_bootload:function(){if(this._isLoading)return;this._isLoading=true;h.loadModules(["ChatAddFriendsTabSheet","ChatEmployeeAwaySheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatReadOnlyTabSheet","ChatThreadIsMessageBlockedSheet","ChatThreadIsMutedTabSheet","ChatThreadSecretModeSheet","ChatUploadWarningTabSheet","ChatUserBlockedTabSheet","MercurySheetView"],(function(m,n,o,p,q,r,s,t,u,v,w,x,y){this._sheetView=new y(this._threadID,this._rootElement,this._tabElement);var z=this._threadID,aa=this._rootElement,ba=this._sheetView,ca=this._view;this._addFriendsTabSheet=new m(z,aa,ba,ca);this._employeeAwaySheet=new n(z,aa,ba);this._nameConversationTabSheet=new o(z,aa,ba);this._newMessagesTabSheet=new p(z,aa,ba);this._offlineTabSheet=new r(z,aa,ba);this._readOnlyTabSheet=new s(z,aa,ba);this._threadIsMessageBlockedSheet=new t(z,aa,ba);this._threadIsMutedTabSheet=new u(z,aa,ba);this._secretModeSheet=new v(z,aa,ba);this._uploadWarningTabSheet=new w(z,aa,ba);this._userBlockedTabSheet=new x(z,aa,ba);if(!k.getUserIDFromThreadID(this._threadID))this._noRecipientsTabSheet=new q(z,aa,ba);this._deferred.resolve();}).bind(this));}});f.exports=l;},null);
__d('ChatTitleLink.react',['Link.react','MercuryThreadTitle.react','React','TrackingNodes','UserAgent','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.PropTypes,o=j.createClass({displayName:'ChatTitleLink',propTypes:{href:n.string,isNewThread:n.bool,thread:n.object,viewer:n.string},getDefaultProps:function(){return {href:null};},getTitle:function(){return this.refs.threadTitle.getTitle();},render:function(){if(!this.props.thread)return null;return (j.createElement(h,{'aria-level':'3',className:"titlebarText"+(l.isBrowser('Chrome')&&!l.isPlatform('Windows')?' '+"fixemoji":'')+(this.props.href===null?' '+"noLink":''),'data-ft':k.getTrackingInfo(k.types.TITLE),'data-hover':'tooltip',href:this.props.href},j.createElement(i,{ref:'threadTitle',isNewThread:this.props.isNewThread,thread:this.props.thread,useAndSeparator:true,useShortName:!this.props.thread.is_canonical,viewer:this.props.viewer})));}});f.exports=o;},null);
__d('EmoticonUtils',['EmoticonsList','Parent'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j='emoticon_',k=h.symbols,l={getEmoteFromTarget:function(m){var n=i.byClass(m,'emoticon');if(!n)return null;var o=null;n.className.split(' ').forEach(function(p){if(p.startsWith(j))o=p.substring(j.length);});return k[o]||null;},insertEmoticon:function(m,n,o){var p=n.substring(0,o.start),q=n.substring(o.end);if(o.start>0&&!p.endsWith(' '))m=' '+m;if(!q.startsWith(' '))m+=' ';var r=p+m+q;o.start+=m.length;o.end=o.start;return {result:r,start:o.start,end:o.end};}};f.exports=l;},null);
__d('MercuryCanonicalGroupThreadManager',['KeyedCallbackManager','MercuryIDs','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreads','MercuryServerDispatcher'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(p){this.$MercuryCanonicalGroupThreadManager1=p;this.$MercuryCanonicalGroupThreadManager2=new h();this.$MercuryCanonicalGroupThreadManager3=j.getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4=l.getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager5();}n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};n.prototype.getCanonicalGroupThreadIDForParticipants=function(p,q){if(p.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)p.push(this.$MercuryCanonicalGroupThreadManager1);var r=this.$MercuryCanonicalGroupThreadManager6(p);this.$MercuryCanonicalGroupThreadManager2.setResource(r,undefined);var s=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(r,q);this.$MercuryCanonicalGroupThreadManager7(p);return s;};n.prototype.unsubscribe=function(p){if(p)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(p);};n.prototype.$MercuryCanonicalGroupThreadManager6=function(p){return p.sort().join(',');};n.prototype.$MercuryCanonicalGroupThreadManager8=function(p,q){var r=i.getThreadIDFromThreadFBID(q);this.$MercuryCanonicalGroupThreadManager2.setResource(p,r);};n.prototype.$MercuryCanonicalGroupThreadManager7=function(p){var q={canonical_group_key:this.$MercuryCanonicalGroupThreadManager6(p),participants:p};m.trySend('/ajax/mercury/search_canonical_groups.php',q,null,this.$MercuryCanonicalGroupThreadManager1);};n.prototype.$MercuryCanonicalGroupThreadManager5=function(){m.registerEndpoints({'/ajax/mercury/search_canonical_groups.php':{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:m.IMMEDIATE,handler:(function(p){this.handleUpdate(p);}).bind(this)}});};n.prototype.handleUpdate=function(p){if(p.mercury_payload)this.$MercuryCanonicalGroupThreadManager3.handleUpdate(p.mercury_payload);var q=p.canonical_group;if(q)for(var r in q)this.$MercuryCanonicalGroupThreadManager8(r,q[r]);};var o=new k(n);f.exports=n;},null);
__d("XPagesMercuryIndicatorController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/pages\/messaging\/mercury\/indicator\/",{});},null);
__d('PagesMercuryChatTabIndicatorHandler',['Animation','AsyncRequest','AvailableListConstants','DOM','FBID','MercuryIDs','XPagesMercuryIndicatorController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();o.tryCreateHandler=function(p,q,r){'use strict';if(!q)return null;var s=m.getUserIDFromThreadID(p);if(!s||l.isUser(s))return null;return new o(s,q,r);};function o(p,q,r){'use strict';this.$PagesMercuryChatTabIndicatorHandler1=false;this.$PagesMercuryChatTabIndicatorHandler2=q;this.$PagesMercuryChatTabIndicatorHandler3=false;this.$PagesMercuryChatTabIndicatorHandler4=false;this.$PagesMercuryChatTabIndicatorHandler5=r;this.$PagesMercuryChatTabIndicatorHandler6=false;this.$PagesMercuryChatTabIndicatorHandler7=p;}o.prototype.__getEnableTimeSwitch=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler1;};o.prototype.__getIndicator=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler2;};o.prototype.__getIsShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler4;};o.prototype.__getPageOnlineStatus=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler5;};o.prototype.__getShouldPreventFutureShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler6;};o.prototype.__getTargetID=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler7;};o.prototype.__getIsChecking=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler3;};o.prototype.__getResponsivenessDescription=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler8;};o.prototype.checkResponsiveness=function(){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler3)return;var p=n.getURIBuilder().getURI();this.$PagesMercuryChatTabIndicatorHandler3=true;new i().setURI(p).setMethod('POST').setData({page_id:this.$PagesMercuryChatTabIndicatorHandler7}).setHandler((function(q){this.$PagesMercuryChatTabIndicatorHandler3=false;var r=q.payload;if(r.responsiveness)this.$PagesMercuryChatTabIndicatorHandler9(r.responsiveness,r.enableTimeSwitch);}).bind(this)).send();};o.prototype.hideIndicator=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(false);};o.prototype.hideIndicatorAndPreventFutureShow=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(true);};o.prototype.$PagesMercuryChatTabIndicatorHandler10=function(p){'use strict';this.$PagesMercuryChatTabIndicatorHandler6=this.$PagesMercuryChatTabIndicatorHandler6||p;if(this.$PagesMercuryChatTabIndicatorHandler2&&this.$PagesMercuryChatTabIndicatorHandler4){this.$PagesMercuryChatTabIndicatorHandler4=false;new h(this.$PagesMercuryChatTabIndicatorHandler2).to('height',0).duration(100).hide().go();}};o.prototype.showIndicator=function(){'use strict';if(!this.$PagesMercuryChatTabIndicatorHandler2||this.$PagesMercuryChatTabIndicatorHandler4||this.$PagesMercuryChatTabIndicatorHandler5!==j.OFFLINE||!this.$PagesMercuryChatTabIndicatorHandler8||this.$PagesMercuryChatTabIndicatorHandler6)return;k.setContent(this.$PagesMercuryChatTabIndicatorHandler2,this.$PagesMercuryChatTabIndicatorHandler8);this.$PagesMercuryChatTabIndicatorHandler4=true;new h(this.$PagesMercuryChatTabIndicatorHandler2).show().to('height',16).duration(100).go();};o.prototype.notifyPageOnlineStatusChanged=function(p){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler5===p)return;this.$PagesMercuryChatTabIndicatorHandler5=p;if(!this.$PagesMercuryChatTabIndicatorHandler1)return;switch(p){case j.ACTIVE:this.hideIndicator();break;default:this.showIndicator();break;}};o.prototype.$PagesMercuryChatTabIndicatorHandler9=function(p,q){'use strict';this.$PagesMercuryChatTabIndicatorHandler8=p;this.$PagesMercuryChatTabIndicatorHandler1=q;this.showIndicator();};f.exports=o;},null);
__d('SelectionPosition',['Event','InputSelection','SubscriptionsHandler'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){'use strict';this.$SelectionPosition1=l;this.$SelectionPosition2={start:0,end:0};this.$SelectionPosition3=new j();this.$SelectionPosition4=false;this.updatePos();this.enable();}k.prototype.getPos=function(){'use strict';return babelHelpers._extends({},this.$SelectionPosition2);};k.prototype.setPos=function(l,m){'use strict';this.$SelectionPosition2={start:l,end:m};this.restore();};k.prototype.updatePos=function(){'use strict';this.$SelectionPosition2=i.get(this.$SelectionPosition1);};k.prototype.restore=function(){'use strict';i.set(this.$SelectionPosition1,this.$SelectionPosition2.start,this.$SelectionPosition2.end);};k.prototype.enable=function(){'use strict';if(!this.$SelectionPosition4){this.$SelectionPosition3.addSubscriptions(h.listen(this.$SelectionPosition1,'keyup',this.updatePos.bind(this)),h.listen(this.$SelectionPosition1,'click',this.updatePos.bind(this)));this.$SelectionPosition4=true;}};k.prototype.disable=function(){'use strict';if(this.$SelectionPosition4){this.$SelectionPosition3.release();this.$SelectionPosition4=false;}};f.exports=k;},null);
__d("XStickerReplyNUXController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/tooltip\/",{});},null);
__d('ChatTabViewCoordinator',['Arbiter','ChatTabModel','ChatTabView','ChatTabViewSelector','CSS','JSLogger','FBRTCSupport'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('chat_tab_coordinator');function p(q,r){var s=new k(q),t={},u=false;function v(){var z=i.get(),aa={};z.tabs.forEach(function(ca){aa[ca.id]=1;});o.log('process_tab_changed',{model_tabs:Object.keys(aa),view_tabs:Object.keys(t)});for(var ba in t)if(!aa[ba]){o.log('remove_tab',{tab_id:ba});t[ba].destroy();delete t[ba];}w(z);x(z);if(z.tabNeedsFocus&&!z.tabNeedsFocus.isFocused())z.tabNeedsFocus.focus();}function w(z){var aa=null;z.tabs.forEach(function(ba){var ca=ba.id,da=false;if(!t[ca]){o.log('add_tab',{tab_id:ca});t[ca]=new j(ca,ba.server_id,ba.signatureID,q,aa);da=true;if(t[ca].onBeingReplaced)t[ca].onBeingReplaced(function(fa,ga){t[fa]=ga;});}else t[ca].updateSignatureID(ba.signatureID);if(t[ca].isFocused())z.tabNeedsFocus=t[ca];if(!da&&!t[ca].nextTabIs(aa)){var ea=t[ca].getScrollTop();if(aa){t[ca].insertBefore(aa);}else t[ca].appendTo(q);if(ea)t[ca].setScrollTop(ea);}aa=t[ca];});}function x(z){var aa=r.getTabsToShow(z),ba=[],ca=false;z.tabs.forEach(function(da){if(!aa[da.id]){t[da.id].setVisibleState(false,da.raised);ba.push(da);}});z.tabs.forEach(function(da){if(aa[da.id]){t[da.id].setVisibleState(true,da.raised);ca|=da.raised;}});s.setTabData(ba);y(ca);}function y(z){if(!z&&u){h.inform('layer_hidden',{type:'ChatTab'});u=false;}else if(z&&!u){h.inform('layer_shown',{type:'ChatTab'});u=true;}}if(n.isSendWebrtcSupported())l.addClass(q,'videoCallEnabled');r.subscribe('tabs-changed',v);v();}f.exports=p;},null);
__d('MNCommerceDialogContainer.react',['MNCommerceDialogStateStore','PureStoreBasedStateMixin','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.createClass({displayName:'MNCommerceDialogContainer',mixins:[i(h)],statics:{calculateState:function(){var l=h.getDialogContainer();return {dialogContainer:l};}},render:function(){var l=this.state.dialogContainer;if(!l)return null;return j.createElement(l,null);}});f.exports=k;},null);
__d('MercuryChannelMessageTransformer',['MercuryActionType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j,k){var l={author:j.mercury_author_id,author_email:j.mercury_author_email,body:j.body,subject:j.subject,has_attachment:j.has_attachment,attachments:j.attachments,ephemeral_ttl_mode:j.ephemeral_ttl_mode,html_body:j.html_body,thread_id:j.tid,thread_fbid:j.thread_fbid&&j.thread_fbid.toString(),other_user_fbid:j.other_user_fbid&&j.other_user_fbid.toString(),offline_threading_id:j.offline_threading_id,message_id:j.mid,is_spoof_warning:j.is_spoof_warning,ranges:j.ranges,source:j.mercury_source,source_tags:j.mercury_source_tags,tags:j.tags&&j.tags.split(','),threading_id:j.threading_id,timestamp:j.timestamp,timestamp_absolute:j.timestamp_absolute,timestamp_relative:j.timestamp_relative,timestamp_datetime:j.timestamp_datetime,timestamp_time_passed:j.timestamp_time_passed,action_type:h.USER_GENERATED_MESSAGE,is_unread:j.is_unread,is_forward:false,forward_count:j.forward_count||j.forward,forward_message_ids:j.forward_msg_ids,folder:k,sync_id:undefined,action_id:undefined};if('sync_id' in j){l.sync_id=j.sync_id;}else l.action_id=j.action_id;return l;}f.exports={transform:i};},null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(o){this.$MercuryDelayedDispatcher1=o;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=l.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=h.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=j.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=i.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',(function(p,q){return this.$MercuryDelayedDispatcher7();}).bind(this));}m.getForFBID=function(o){return n.getForFBID(o);};m.get=function(){return n.get();};m.prototype.handleUpdateWaitForThread=function(o,p){var q=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(p);if(q){this.$MercuryDelayedDispatcher8(o);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(p,(function(){return this.$MercuryDelayedDispatcher2.push(o);}).bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(p);};m.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var o=this.$MercuryDelayedDispatcher2[0];this.$MercuryDelayedDispatcher2=this.$MercuryDelayedDispatcher2.slice(1);this.$MercuryDelayedDispatcher8(o);}};m.prototype.$MercuryDelayedDispatcher8=function(o){if(o.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(o);}else this.$MercuryDelayedDispatcher6.handleUpdate(o);};var n=new k(m);f.exports=m;},null);
__d('MercuryChannelHandler',['Arbiter','ChannelConstants','MercuryActionType','MercuryChannelMessageTransformer','MercuryConfig','MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryLogMessageType','MercuryMessages','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonMixin','MercuryThreadInformer','MercuryViewer','MessagingEvent','MessagingTag','PresenceUtil','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z,aa;z=babelHelpers.inherits(ba,y(s));aa=z&&z.prototype;function ba(ca){'use strict';aa.constructor.call(this);this.$MercuryChannelHandler1=ca;this.__payloadPreprocessor=r.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler2=t.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler3=p.getForFBID(this.$MercuryChannelHandler1);this.__delayedDispatcher=m.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler4=[];}ba.prototype.getInstanceFBID=function(){'use strict';return this.$MercuryChannelHandler1;};ba.prototype.$MercuryChannelHandler5=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.message)return;var ea=da.obj.message,fa=ea.other_user_fbid?ea.other_user_fbid:ea.thread_fbid;fa=fa.toString();var ga=k.transform(ea,da.obj.folder);if(this.__shouldDropMessageBecauseOfSync(ea))return;var ha=[babelHelpers._extends({},ga)];ha=ha.concat(ea.forward_actions||[]);var ia=q.CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:ha,payload_source:ia},fa);};ba.prototype.$MercuryChannelHandler7=function(ca,da){'use strict';if(l.WWWSyncDeliveryReceipt)return;var ea=da.obj.other_user_fbid,fa=da.obj.thread_fbid;if(!this.$MercuryChannelHandler6(ca)||!ea&&!fa)return;this.__payloadPreprocessor.handleUpdate({delivery_receipts:[{other_user_fbid:ea?ea.toString():'',thread_fbid:fa?fa.toString():'',time:da.obj.timestamp}]});};ba.prototype.$MercuryChannelHandler8=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=[],fa=da.obj.event==v.READ;if(fa&&l.WWWSyncMarkRead)return;(da.obj.thread_fbids||[]).forEach(function(ga){ea.push({action_type:j.CHANGE_READ_STATUS,action_id:null,thread_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});(da.obj.other_user_fbids||[]).forEach(function(ga){ea.push({action_type:j.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});this.__payloadPreprocessor.handleUpdate({actions:ea,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler9=function(ca,da){'use strict';if(l.WWWSyncThreadDelete)return;if(!this.$MercuryChannelHandler6(ca)||!da.obj||!(da.obj.thread_fbids||da.obj.other_user_fbids))return;var ea=[];(da.obj.thread_fbids||[]).forEach(function(fa){ea.push({action_type:j.DELETE_THREAD,action_id:null,thread_fbid:fa});});(da.obj.other_user_fbids||[]).forEach(function(fa){ea.push({action_type:j.DELETE_THREAD,action_id:null,other_user_fbid:fa});});this.__payloadPreprocessor.handleUpdate({actions:ea,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler10=function(ca,da){'use strict';if(l.WWWSyncDeleteMessage)return;if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.thread_fbids&&!da.obj.other_user_fbids||!da.obj.mids)return;var ea=da.obj.thread_fbids.length?da.obj.thread_fbids[0]:null,fa=da.obj.other_user_fbids.length?da.obj.other_user_fbids[0]:null,ga={action_type:j.DELETE_MESSAGES,action_id:null,thread_fbid:ea,other_user_fbid:fa,message_ids:da.obj.mids};if(l.MessengerGlobalDeleteGK){if(da.obj.updated_thread)return;this.__payloadPreprocessor.handleUpdate({actions:[ga],payload_source:q.CLIENT_CHANNEL_MESSAGE});return;}this.__payloadPreprocessor.handleUpdate({actions:[ga],payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler11=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.folder)return;var ea={action_type:n.MARK_ALL_READ,action_id:da.obj.action_id,folder:da.obj.folder};this.__payloadPreprocessor.handleUpdate({global_actions:[ea]});};ba.prototype.$MercuryChannelHandler12=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=q.CLIENT_CHANNEL_MESSAGE;(da.obj.thread_fbids||[]).forEach(function(fa){var ga={action_type:j.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:fa.toString(),other_user_fbid:null,archived:da.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ga)],payload_source:ea},fa.toString());},this);(da.obj.other_user_fbids||[]).forEach(function(fa){var ga={action_type:j.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:fa.toString(),archived:da.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ga)],payload_source:ea},fa.toString());},this);};ba.prototype.$MercuryChannelHandler13=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=q.CLIENT_CHANNEL_MESSAGE,fa;(da.obj.thread_fbids||[]).forEach(function(ga){if(da.obj.event==v.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?w.SPAM:w.INBOX;var ha={action_type:j.CHANGE_FOLDER,action_id:null,thread_fbid:ga.toString(),other_user_fbid:null,new_folder:fa};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ha)],payload_source:ea},ga.toString());},this);(da.obj.other_user_fbids||[]).forEach(function(ga){if(da.obj.event==v.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?w.SPAM:w.INBOX;var ha={action_type:j.CHANGE_FOLDER,action_id:null,other_user_fbid:ga.toString(),thread_fbid:null,new_folder:fa};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ha)],payload_source:ea},ga.toString());},this);};ba.prototype.$MercuryChannelHandler14=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.tag)return;switch(da.obj.tag){case w.ACTION_ARCHIVED:this.$MercuryChannelHandler12(ca,da);break;case w.INBOX:case w.OTHER:this.$MercuryChannelHandler13(ca,da);break;}};ba.prototype.__markAsSeen=function(ca,da){'use strict';if(!this.$MercuryChannelHandler15(ca)||!da.obj||!da.obj.seen_timestamp)return;this.__payloadPreprocessor.handleUpdate({message_counts:[{seen_timestamp:da.obj.seen_timestamp,folder:w.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:w.INBOX}],payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.__updateModelsFromMercuryPayload=function(ca,da){'use strict';if(!this.$MercuryChannelHandler16(ca)||!da.obj)return;this.$MercuryChannelHandler2.synchronizeInforms((function(){var ea=da.obj,fa=[];(ea.actions||[]).forEach(function(ga){var ha=j.USER_GENERATED_MESSAGE;if(ga.action_type==j.LOG_MESSAGE){if(this.__shouldDropLogMessageBecauseOfSync(ga))return;var ia=q.CLIENT_CHANNEL_MESSAGE,ja;ja=ga.other_user_fbid||ga.thread_fbid;this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ga)],payload_source:ia},ja);}else if(ga.action_type!=ha)fa.push(ga);},this);ea.actions=fa;ea.payload_source=q.CLIENT_CHANNEL_MESSAGE;this.__payloadPreprocessor.handleUpdate(ea);}).bind(this));};ba.prototype.$MercuryChannelHandler17=function(ca,da){'use strict';var ea,fa;if(l.WWWSyncReadReceipt)return;var ga=da.obj.time,ha=da.obj.reader,ia=da.obj.thread_fbid||'';this.__payloadPreprocessor.handleUpdate({roger:(fa={},fa[ia]=(ea={},ea[ha]=ga,ea),fa)});};ba.prototype.$MercuryChannelHandler18=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.message_blocked===undefined||!da.obj.thread_fbid)return;var ea=j.UPDATE_BLOCKER_STATUS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,message_blocked:da.obj.message_blocked,is_blocked_by_recipient:da.obj.is_blocked_by_recipient}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler19=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.got_blocked===undefined||!da.obj.thread_fbid)return;var ea=j.UPDATE_BLOCKEE_STATUS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,got_blocked:da.obj.got_blocked}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler20=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.mute_settings===undefined||!da.obj.thread_fbid&&!da.obj.other_user_fbid)return;var ea=j.CHANGE_MUTE_SETTINGS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,other_user_fbid:da.obj.other_user_fbid,mute_settings:da.obj.mute_settings}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.__handleMessagingPayload=function(ca,da){'use strict';switch(da.obj.event){case v.DELIVER:this.$MercuryChannelHandler5(ca,da);break;case v.DELIVERY_RECEIPT:this.$MercuryChannelHandler7(ca,da);break;case v.READ:case v.UNREAD:this.$MercuryChannelHandler8(ca,da);break;case v.READ_ALL:this.$MercuryChannelHandler11(ca,da);break;case v.DELETE:this.$MercuryChannelHandler9(ca,da);break;case v.DELETE_MESSAGES:this.$MercuryChannelHandler10(ca,da);break;case v.TAG:this.$MercuryChannelHandler14(ca,da);break;case v.REPORT_SPAM:this.$MercuryChannelHandler13(ca,da);break;case v.READ_RECEIPT:this.$MercuryChannelHandler17(ca,da);break;case v.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandler20(ca,da);break;case v.UPDATE_BLOCKER_STATUS:this.$MercuryChannelHandler18(ca,da);break;case v.UPDATE_BLOCKEE_STATUS:this.$MercuryChannelHandler19(ca,da);break;}};ba.prototype.getRouting=function(){'use strict';return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};ba.prototype.__getMessagingPayloadType=function(){'use strict';return i.getArbiterType('messaging');};ba.prototype.__getMercuryPayloadType=function(){'use strict';return i.getArbiterType('mercury');};ba.prototype.__getInboxPayloadType=function(){'use strict';return i.getArbiterType('inbox');};ba.prototype.$MercuryChannelHandler6=function(ca){'use strict';return ca==this.__getMessagingPayloadType();};ba.prototype.$MercuryChannelHandler16=function(ca){'use strict';return ca==this.__getMercuryPayloadType();};ba.prototype.$MercuryChannelHandler15=function(ca){'use strict';return ca==this.__getInboxPayloadType();};ba.prototype.turnOn=function(){'use strict';if(!this.$MercuryChannelHandler4.length){var ca=this.getRouting();for(var da in ca)this.$MercuryChannelHandler4.push(h.subscribe(i.getArbiterType(da),ca[da].bind(this)));}return this;};ba.prototype.turnOff=function(){'use strict';if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(h.unsubscribe);this.$MercuryChannelHandler4=[];}return this;};ba.prototype.__shouldDropMessageBecauseOfSync=function(ca){'use strict';if(!ca.has_attachment&&l.WWWSyncMsgText){return true;}else if(ca.has_attachment&&l.WWWSyncMsgAttach)return true;return false;};ba.prototype.__shouldDropLogMessageBecauseOfSync=function(ca){'use strict';if(l.WWWSyncMsgLog)switch(ca.log_message_type){case o.UNSUBSCRIBE:case o.SUBSCRIBE:case o.THREAD_NAME:case o.VIDEO_CALL:case o.PHONE_CALL:case o.THREAD_IMAGE:case o.ORION:case o.PAGE_REPLY:case o.GENERIC_ADMIN_TEXT:return true;case o.SERVER_ERROR:case o.LIVE_LISTEN:case o.SWITCH_TO_WORK:case o.WALLPAPER:default:break;}return false;};Object.assign(ba,s);f.exports=ba;},null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;m=babelHelpers.inherits(o,l(h));n=m&&m.prototype;function o(q){'use strict';n.constructor.call(this);this.$MercuryDeliveryReceipts1=q;this.$MercuryDeliveryReceipts2=new i();this.$MercuryDeliveryReceipts3=j.getForFBID(this.$MercuryDeliveryReceipts1);this.$MercuryDeliveryReceipts3.subscribe('update-delivery',(function(r,s){if(s.delivery_receipts)for(var t in s.delivery_receipts){var u=s.delivery_receipts[t],v=this.$MercuryDeliveryReceipts2.get(t)||0;if(u>v){this.$MercuryDeliveryReceipts2.set(t,u);this.informDeliveryStatusChanged(t);}}}).bind(this));}o.getForFBID=function(q){'use strict';return p.getForFBID(q);};o.get=function(){'use strict';return p.get();};o.prototype.informDeliveryStatusChanged=function(q){'use strict';var r=new i();r.set(q,true);this.inform('change',r);};o.prototype.getDeliveryTime=function(q){'use strict';return this.$MercuryDeliveryReceipts2.get(q)||0;};var p=new k(o);f.exports=o;},null);
__d('MercurySyncDeltaHolder',['Map'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){this.$MercurySyncDeltaHolder1=new h();this.$MercurySyncDeltaHolder2=[];}i.prototype.peek=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(j,k){return j-k;});return this.$MercurySyncDeltaHolder2[0];};i.prototype.pop=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(l,m){return l-m;});if(this.$MercurySyncDeltaHolder2.length===0)return undefined;var j=this.$MercurySyncDeltaHolder2.shift(),k=this.$MercurySyncDeltaHolder1.get(j);this.$MercurySyncDeltaHolder1['delete'](j);return {seqID:j,delta:k};};i.prototype.push=function(j,k){if(this.$MercurySyncDeltaHolder1.has(j))return;this.$MercurySyncDeltaHolder1.set(j,k);this.$MercurySyncDeltaHolder2.push(j);};f.exports=i;},null);
__d('MercurySyncNewMessageTransformer',['IrisProtocolMessageLifetime','MercuryActionType','MercuryIDs','MercuryTimestamp','MessagingTag'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(n,o){var p=parseInt(o.messageMetadata.timestamp,10),q=k.getFormatedTimestamp(p),r=[];if(o.attachments)r=o.attachments.map(function(t){return t.mercury;});var s=o.messageMetadata.tags?o.messageMetadata.tags[0]:undefined;return {message_id:o.messageMetadata.messageId,threading_id:null,offline_threading_id:o.messageMetadata.offlineThreadingId,author:j.getParticipantIDFromUserID(o.messageMetadata.actorFbId),author_email:o.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:o.ttl?h[o.ttl]:0,timestamp:p,timestamp_absolute:q.absolute,timestamp_relative:q.relative,timestamp_datetime:q.relative,timestamp_time_passed:k.getTimeBucket(p),is_unread:n!==o.messageMetadata.actorFbId,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,forward_count:0,forward_message_ids:[],source:s,tags:o.messageMetadata.tags,is_spoof_warning:false,folder:l.INBOX,thread_fbid:o.messageMetadata.threadKey.threadFbId,other_user_fbid:o.messageMetadata.threadKey.otherUserFbId,body:o.body!==undefined?o.body:'',html_body:null,subject:null,has_attachment:r.length>0,attachments:r,ranges:undefined,thread_id:null,action_id:null,action_type:i.USER_GENERATED_MESSAGE,is_from_iris:true};}f.exports={transform:m};},null);
__d('MercurySyncAdminTextMessageTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(l,m){var n=j.transform(l,m);n.action_type=h.LOG_MESSAGE;n.log_message_body=m.messageMetadata.adminText;n.log_message_data={message_type:m.type,untypedData:m.untypedData};n.log_message_type=i.GENERIC_ADMIN_TEXT;return n;}f.exports={transform:k};},null);
__d('MercurySyncDeliveryReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};},null);
__d('MercurySyncHolesTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(){this.clear();}k.prototype.log=function(){i.log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,h.BASIC);};k.prototype.logVital=function(){i.log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,h.VITAL);};k.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this;};k.prototype.updateData=function(m){this.$MercurySyncHolesTypedLogger1=babelHelpers._extends({},this.$MercurySyncHolesTypedLogger1,m);return this;};k.prototype.setDifference=function(m){this.$MercurySyncHolesTypedLogger1.difference=m;return this;};k.prototype.setSeqID=function(m){this.$MercurySyncHolesTypedLogger1.seq_id=m;return this;};k.prototype.setTopicType=function(m){this.$MercurySyncHolesTypedLogger1.topic_type=m;return this;};k.prototype.setVC=function(m){this.$MercurySyncHolesTypedLogger1.vc=m;return this;};var l={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=k;},null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MessagingTag'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){return k.threadKeys.map(function(l){return {action_type:h.CHANGE_READ_STATUS,action_id:null,other_user_fbid:l.otherUserFbId,thread_fbid:l.threadFbId,mark_as_read:true,timestamp:parseInt(k.watermarkTimestamp,10),folder:i.INBOX};});}f.exports={transform:j};},null);
__d('MercurySyncMessageDeleteTransformer',['MercuryActionType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){return {action_id:null,action_type:h.DELETE_MESSAGES,message_ids:j.messageIds,other_user_fbid:j.threadKey.otherUserFbId,thread_fbid:j.threadKey.threadFbId};}f.exports={transform:i};},null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(m,n){var o=k.transform(m,n);o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={removed_participants:[i.getParticipantIDFromUserID(n.leftParticipantFbId)]};o.log_message_type=j.UNSUBSCRIBE;return o;}f.exports={transform:l};},null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(m,n){var o=k.transform(m,n);o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={added_participants:n.addedParticipants.map(function(p){return (i.getParticipantIDFromUserID(p.userFbId));})};o.log_message_type=j.SUBSCRIBE;return o;}f.exports={transform:l};},null);
__d('MercurySyncRTCEventLogTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(m,n){var o=k.transform(m,n),p=n.messageMetadata.actorFbId,q=p===m?n.messageMetadata.threadKey.otherUserFbId:m;o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={answered:n.duration>0,callee:i.getParticipantIDFromUserID(q),caller:i.getParticipantIDFromUserID(p)};o.log_message_type=j.VIDEO_CALL;return o;}f.exports={transform:l};},null);
__d('MercurySyncReadReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=parseInt(i.actionTimestampMs,10),k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};},null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k,l){l=Object.assign({},l.newMessage,l);return Object.assign(i.transform(k,l),{action_type:h.REPLACE_MESSAGE,replaced_message_id:l.replacedMessageId});}f.exports={transform:j};},null);
__d('MercurySyncThreadDeleteTransformer',['MercuryActionType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){return j.threadKeys.map(function(k){return {action_type:h.DELETE_THREAD,action_id:null,other_user_fbid:k.otherUserFbId,thread_fbid:k.threadFbId};});}f.exports={transform:i};},null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(l,m){var n=j.transform(l,m);n.action_type=h.LOG_MESSAGE;n.log_message_body=m.messageMetadata.adminText;n.log_message_data={name:m.name};n.log_message_type=i.THREAD_NAME;return n;}f.exports={transform:k};},null);
__d('MercurySyncDispatcher',['Arbiter','Map','MercuryConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncAdminTextMessageTransformer','MercurySyncDeliveryReceiptTransformer','MercurySyncHolesTypedLogger','MercurySyncMarkReadTransformer','MercurySyncMessageDeleteTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncRTCEventLogTransformer','MercurySyncThreadDeleteTransformer','MercurySyncThreadNameTransformer','MercurySyncReplaceMessageTransformer','MercurySyncDeltaTypes','MercurySyncTopicType','MercurySingletonProvider'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';if(c.__markCompiled)c.__markCompiled();da.getForFBID=function(fa){return ea.getForFBID(fa);};da.get=function(){return ea.get();};function da(fa){this.$MercurySyncDispatcher1=fa;this.$MercurySyncDispatcher2=k.getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=m.getForFBID(this.$MercurySyncDispatcher1);}da.prototype.process=function(fa){var ga;switch(fa['class']){case aa.NewMessage:if(!this.$MercurySyncDispatcher4(fa))break;ga=s.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ReplaceMessage:if(!this.$MercurySyncDispatcher4(fa))break;ga=z.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.DeliveryReceipt:if(!j.WWWSyncDeliveryReceipt)break;ga=o.transform(fa);this.$MercurySyncDispatcher3.handleUpdate(ga);break;case aa.MarkRead:if(!j.WWWSyncMarkRead)break;ga=q.transform(fa);this.$MercurySyncDispatcher6(ga);break;case aa.ParticipantLeftGroupThread:if(!j.WWWSyncMsgLog)break;ga=u.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ParticipantsAddedToGroupThread:if(!j.WWWSyncMsgLog)break;ga=v.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.RTCEventLog:if(!j.WWWSyncMsgLog)break;ga=w.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ThreadName:if(!j.WWWSyncMsgLog)break;ga=y.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ReadReceipt:if(!j.WWWSyncReadReceipt)break;ga=t.transform(fa);this.$MercurySyncDispatcher3.handleUpdate(ga);break;case aa.AdminTextMessage:if(!j.WWWSyncMsgLog)break;ga=n.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.MessageDelete:if(!j.WWWSyncDeleteMessage)break;ga=r.transform(fa);this.$MercurySyncDispatcher5(ga);break;case aa.ThreadDelete:if(!j.WWWSyncThreadDelete)break;ga=x.transform(fa);this.$MercurySyncDispatcher6(ga);break;default:break;}};da.prototype.$MercurySyncDispatcher4=function(fa){var ga=!!fa.stickerId||fa.attachments&&!!fa.attachments.length;if(!ga&&!j.WWWSyncMsgText){return false;}else if(ga&&!j.WWWSyncMsgAttach)return false;return true;};da.prototype.$MercurySyncDispatcher5=function(fa){var ga=fa.other_user_fbid||fa.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[fa],payload_source:l.CLIENT_CHANNEL_MESSAGE},ga);};da.prototype.$MercurySyncDispatcher6=function(fa){this.$MercurySyncDispatcher3.handleUpdate({actions:fa,payload_source:l.CLIENT_CHANNEL_MESSAGE});};var ea=new ca(da);f.exports=da;},null);
__d('MercurySyncDataFetcherImpl',['Promise','AsyncRequest','MessagingConfig','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=5000;function m(o){return new h(function(p,q){n(o,p,q,0);});}function n(o,p,q,r){if(r>j.syncFetchRetries){q();return;}var s=r===0?0:j.syncFetchInitialTimeoutMs*Math.pow(j.syncFetchTimeoutMultiplier,r);k(function(){var t=false,u=function(){if(t)return;t=true;n(o,p,q,r+1);};new i().setURI(o).setHandler(function(v){t=true;p(v);}).setErrorHandler(u).setTimeoutHandler(l,u).setAllowCrossPageTransition(true).send();},s);}f.exports={fetch:m};},null);
__d('MercurySyncDataFetcher',['Promise','MessagingConfig','MercurySyncDataFetcherImpl','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=500;function m(){var p=0;for(var q=0;q<i.syncFetchRetries;q++){var r=q===0?0:i.syncFetchInitialTimeoutMs*Math.pow(i.syncFetchTimeoutMultiplier,q);p+=r+l;}return p;}var n=m();function o(p){return new h(function(q,r){j.fetch(p).done(q,r);k(r,n);});}f.exports={fetch:o};},null);
__d("XMercuryFetchMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/fetch_message\/",{other_user_or_thread_fbid:{type:"Int",required:true},mid:{type:"String",required:true}});},null);
__d("XMercuryInvalidateGlobalStateController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_global_state\/",{thread_id_to_num_messages:{type:"IntToIntMap"}});},null);
__d("XMercuryInvalidateThreadStateController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_thread_state\/",{other_user_or_thread_fbid:{type:"Int",required:true},num_messages:{type:"Int",required:true}});},null);
__d('MercurySyncDFFDataFetcher',['Promise','AsyncRequest','MercuryMessages','MercuryThreads','MercuryThreadIDMap','MercurySingletonProvider','MercurySyncDataFetcher','XMercuryFetchMessageController','XMercuryInvalidateGlobalStateController','XMercuryInvalidateThreadStateController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();function r(t){this.$MercurySyncDFFDataFetcher1=t;this.__messages=j.getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=k.getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=l.getForFBID(this.$MercurySyncDFFDataFetcher1);}r.getForFBID=function(t){return s.getForFBID(t);};r.get=function(){return s.get();};r.prototype.fetchInvalidateGlobalState=function(){var t=p.getURIBuilder().setIntToIntMap('thread_id_to_num_messages',this.$MercurySyncDFFDataFetcher2()).getURI();return n.fetch(t);};r.prototype.fetchInvalidateThreadState=function(t,u){var v=3,w=t||u,x=this.__threadIDMap.getClientIDFromServerIDNow(w);if(!x)return h.resolve({getPayload:function(){return {};}});var y=this.__messages.getCurrentlyLoadedMessages(x).length,z=q.getURIBuilder().setInt('other_user_or_thread_fbid',w).setInt('num_messages',y+v).getURI();return n.fetch(z);};r.prototype.fetchInvalidateMessage=function(t,u,v){var w=o.getURIBuilder().setInt('other_user_or_thread_fbid',t||u).setString('mid',v).getURI();return n.fetch(w);};r.prototype.$MercurySyncDFFDataFetcher2=function(){var t=this.__threads.getAllLoadedClientThreadIDs(),u={};for(var v=t,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y,aa=this.__messages.getCurrentlyLoadedMessages(z);if(!aa||!aa.length)continue;var ba=this.__threadIDMap.getServerIDFromClientIDNow(z);if(!ba)continue;u[ba]=aa.length;}return u;};var s=new m(r);f.exports=r;},null);
__d('MercurySyncForcedFetchHandler',['Promise','MercurySingletonProvider','MercurySyncDFFDataFetcher','MercuryMessages','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(p){return {getPayload:function(){return {sequence_id:p};}};}n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};function n(p){this.$MercurySyncForcedFetchHandler1=p;this.$MercurySyncForcedFetchHandler2=k.getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=l.getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=j.getForFBID(this.$MercurySyncForcedFetchHandler1);}n.prototype.processMessageDFF=function(p,q,r,s){if(s){var t=q.otherUserFbId!==undefined?q.otherUserFbId.toString():q.threadFbId.toString(),u=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(t);if(u===undefined)return h.resolve(m(p));var v=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([r]);if(v.length===0)return h.resolve(m(p));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(q.otherUserFbId,q.threadFbId,r);};n.prototype.processThreadDFF=function(p,q,r){if(r){var s=q.otherUserFbId!==undefined?q.otherUserFbId.toString():q.threadFbId.toString(),t=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(s);if(t===undefined)return h.resolve(m(p));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(q.otherUserFbId,q.threadFbId);};n.prototype.processGlobalDFF=function(){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalState();};var o=new i(n);f.exports=n;},null);
__d('MercurySyncDeltaHandler',['Arbiter','ChannelConstants','ChannelInitialData','LogHistory','MercuryConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercurySyncDeltaHolder','MercurySyncDeltaTypes','MercurySyncDispatcher','MercurySyncForcedFetchHandler','MercurySyncHolesTypedLogger','MercuryServerPayloadPreprocessor','MercurySyncTopicType','MercurySingletonProvider','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';if(c.__markCompiled)c.__markCompiled();var x=k.getInstance('mercury_sync_delta_handler');y.getForFBID=function(aa){return z.getForFBID(aa);};y.get=function(){return z.get();};function y(aa){this.$MercurySyncDeltaHandler1=aa;this.$MercurySyncDeltaHandler2=q.getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler3=r.getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=t.getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=m.getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=new o();this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler6=[];if(!j.channelConfig)return;this.$MercurySyncDeltaHandler7=j.channelConfig.sequenceId;h.subscribe('channel/message:delta',(function(ba,ca){var da=ca&&ca.obj&&ca.obj.delta,ea=ca&&ca.obj&&ca.obj.iseq;if(!da||!ea)return;this.$MercurySyncDeltaHandler8(ea,u.DELTA);if(l.WWWSyncRaceConditionImprovements){this.$MercurySyncDeltaHandler4.push(ea,da);this.$MercurySyncDeltaHandler9();}else this.$MercurySyncDeltaHandler10(ea,da);}).bind(this));h.subscribe('channel/message:deltaflow',(function(ba,ca){var da=ca&&ca.obj&&parseInt(ca.obj.sequencer,10);this.$MercurySyncDeltaHandler8(da,u.DELTAFLOW);}).bind(this));h.subscribe(i.getArbiterType(i.FAKE_DFF),(function(ba,ca){var da=ca&&ca.obj&&ca.obj.delta;if(!da)return;this.$MercurySyncDeltaHandler6.push(da);this.$MercurySyncDeltaHandler9();}).bind(this));}y.prototype.$MercurySyncDeltaHandler9=function(){if(this.$MercurySyncDeltaHandler5)return;if(this.$MercurySyncDeltaHandler6.length>0){var aa=this.$MercurySyncDeltaHandler6.shift();this.$MercurySyncDeltaHandler10(this.$MercurySyncDeltaHandler7,aa);this.$MercurySyncDeltaHandler9();}var ba=this.$MercurySyncDeltaHandler4.peek();if(!ba)return;var ca=ba-this.$MercurySyncDeltaHandler7;if(ca===1){var da=this.$MercurySyncDeltaHandler4.pop();if(!da)return;var ea=da.seqID,fa=da.delta;this.$MercurySyncDeltaHandler10(ea,fa);this.$MercurySyncDeltaHandler9();}else if(ca>1){this.$MercurySyncDeltaHandler11();}else{this.$MercurySyncDeltaHandler4.pop();this.$MercurySyncDeltaHandler9();}};y.prototype.$MercurySyncDeltaHandler10=function(aa,ba){this.$MercurySyncDeltaHandler7=aa;if(ba['class']===p.ForcedFetch){if(!l.WWWSyncForcedFetch)return;x.debug('DFF',aa.toString());if(ba.threadKey!==undefined&&ba.messageId===undefined){this.$MercurySyncDeltaHandler12(aa,ba);}else if(ba.threadKey!==undefined&&ba.messageId!==undefined){this.$MercurySyncDeltaHandler13(aa,ba);}else this.$MercurySyncDeltaHandler14(aa);}else this.$MercurySyncDeltaHandler2.process(ba);};y.prototype.$MercurySyncDeltaHandler11=function(){x.debug('hole',JSON.stringify({$MercurySyncDeltaHandler7:this.$MercurySyncDeltaHandler7,nextSeqID:this.$MercurySyncDeltaHandler4.peek()}));var aa=this.$MercurySyncDeltaHandler4.peek();!!!aa?w(0):undefined;var ba=aa-1;this.$MercurySyncDeltaHandler14(ba);};y.prototype.$MercurySyncDeltaHandler15=function(aa,ba,ca,da){if(l.WWWSyncRaceConditionImprovements)!!this.$MercurySyncDeltaHandler5?w(0):undefined;this.$MercurySyncDeltaHandler5=true;x.debug('_scheduleDataFetch:start',JSON.stringify({seqID:aa}));ba().done((function(ea){x.debug('_scheduleDataFetch:success',JSON.stringify({seqID:aa}));ca(aa,ea);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler9();}).bind(this),(function(){x.debug('_scheduleDataFetch:failure',JSON.stringify({seqID:aa}));da(aa);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler9();}).bind(this));};y.prototype.$MercurySyncDeltaHandler14=function(aa){this.$MercurySyncDeltaHandler15(undefined,(function(){return this.$MercurySyncDeltaHandler3.processGlobalDFF();}).bind(this),(function(ba,ca){var da=ca.getPayload();this.__payloadPreprocessor.handleUpdate(da);if(da.sequence_id)this.$MercurySyncDeltaHandler7=da.sequence_id;}).bind(this),(function(){this.$MercurySyncDeltaHandler7=aa;}).bind(this));};y.prototype.$MercurySyncDeltaHandler12=function(aa,ba){this.$MercurySyncDeltaHandler15(aa,(function(){return this.$MercurySyncDeltaHandler3.processThreadDFF(aa,ba.threadKey,ba.isLazy);}).bind(this),(function(ca,da){this.__payloadPreprocessor.handleUpdate(da.getPayload());this.$MercurySyncDeltaHandler7=ca;}).bind(this),(function(){var ca=babelHelpers._extends({},ba);delete ca.threadKey;this.$MercurySyncDeltaHandler7=aa-1;this.$MercurySyncDeltaHandler4.push(aa,ca);}).bind(this));};y.prototype.$MercurySyncDeltaHandler13=function(aa,ba){this.$MercurySyncDeltaHandler15(aa,(function(){return this.$MercurySyncDeltaHandler3.processMessageDFF(aa,ba.threadKey,ba.messageId,ba.isLazy);}).bind(this),(function(ca,da){var ea=da.getPayload(),fa=ea.other_user_fbid?ea.other_user_fbid:ea.thread_fbid,ga=[babelHelpers._extends({},ea)],ha=n.CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:ga,payload_source:ha},fa);this.$MercurySyncDeltaHandler7=ca;}).bind(this),(function(){var ca=babelHelpers._extends({},ba);delete ca.messageId;this.$MercurySyncDeltaHandler7=aa-1;this.$MercurySyncDeltaHandler4.push(aa,ca);}).bind(this));};y.prototype.$MercurySyncDeltaHandler8=function(aa,ba){var ca=aa-this.$MercurySyncDeltaHandler7;if(ca!==1&&ca!==0){if(!l.WWWSyncHolesLogging)return;new s().setSeqID(aa).setDifference(ca).setTopicType(ba).log();}};var z=new v(y);f.exports=y;},null);
__d('P2PDialogStore',['EventEmitter','P2PActionConstants','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';var m,n={};k=babelHelpers.inherits(o,h);l=k&&k.prototype;function o(){l.constructor.call(this);m=j.register(this.onEventDispatched.bind(this));n={dialogClass:null,dialogProps:null};}o.prototype.getState=function(){return n;};o.prototype.onEventDispatched=function(p){var q=p.type,r=p.data;switch(q){case i.DIALOG_SHOWN:n.dialogClass=r.dialogClass;n.dialogProps=r.dialogProps;this.emit('change');break;case i.DIALOG_CLOSED:n.dialogClass=null;n.dialogProps=null;this.emit('change');break;}};f.exports=new o();},null);
__d('P2PDialogContainer.react',['P2PDialogStore','React','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=i.createClass({displayName:'P2PDialogContainer',mixins:[j],getInitialState:function(){return h.getState();},componentDidMount:function(){this.dialogStoreSub=h.addListener('change',this.onDialogStoreChange);},componentWillUnmount:function(){if(this.dialogStoreSub){this.dialogStoreSub.remove();this.dialogStoreSub=null;}},onDialogStoreChange:function(){this.setState(h.getState());},renderLayers:function(){if(!this.state.dialogClass)return {};var l=this.state.dialogClass;return {dialog:i.createElement(l,this.state.dialogProps)};},render:function(){return null;}});f.exports=k;},null);
__d('TabsViewport',['Arbiter','ArbiterMixin','ChatTabModel','Dock','DOM','Event','Parent','Vector','ViewportBounds','areJSONRepresentationsEqual','csx','getViewportDimensions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=175,u=269,v=0;function w(){return t;}function x(){return u;}function y(z){this._root=z;var aa=this._recalculateWidth.bind(this);m.listen(window,'resize',aa);k.subscribe('resize',aa);h.subscribeOnce('sidebar/initialized',aa,h.SUBSCRIBE_NEW);j.addListener((function(){return this._recalculateTabs(true);}).bind(this));this._recalculateWidth();this._initialized=true;}Object.assign(y.prototype,i,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var z=y._getAvailableDockWidth(this._root),aa=Math.max(1,Math.floor(z/x())),ba=aa!=this._maxShown;if(!this._viewState||ba||z<=this._viewState.usedWidth||z>this._viewState.widthToShowNext){this._availableWidth=z;this._maxShown=aa;this._viewState=null;this._recalculateTabs(ba);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(z){var aa=y._getTabsToShow(j.get(),this._availableWidth);if(z||!q(this._viewState,aa)){this._viewState=aa;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>x();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var z=j.get(),aa=this._viewState.tabsToShow;return z.tabs.filter(function(ba){return aa[ba.id];});},getRightmostHiddenTab:function(){var z=j.get(),aa=this._viewState.tabsToShow,ba=z.tabs.filter(function(da){return !aa[da.id];}),ca=ba.shift();return ca?ca.id:null;},getLeftmostVisibleTab:function(){var z=this.getShowingTabsOrder(),aa=z.pop();return aa?aa.id:null;},getRaisedVisibleTabs:function(){var z=[],aa=this.getShowingTabsOrder(),ba=aa.length;for(var ca=0;ca<ba;ca++)if(j.getTab(aa[ca].id).raised)z.push(aa[ca].id);return z;},shouldPromoteOnRaise:function(z){if(!this._viewState.tabsToShow[z])return true;if(this._viewState.nextToHide!=z)return false;var aa=j.getTab(z),ba=aa&&aa.raised;return !ba&&this._availableWidth-this._viewState.usedWidth<x()-w();}});Object.assign(y,{_getAvailableDockWidth:function(z){var aa=s.withoutScrollbars().width;aa-=p.getLeft()+p.getRight();aa-=50;var ba=n.byClass(z,'fbDock'),ca=l.find(ba,"._56ox"),da=ca?o.getElementDimensions(ca).x:0;aa-=da;var ea=l.scry(ba,"._56oy");da+=o.getElementDimensions(ea.pop()).x;var fa=o.getElementDimensions(ba),ga=fa.x-da;if(ga>v)v=ga;aa-=v;aa-=15;return Math.max(aa,0);},_getTabsToShow:function(z,aa){aa=Math.max(aa,x()+1);function ba(ra,sa){return ra.raised||!sa?x():w();}var ca=JSON.parse(JSON.stringify(z.tabs)),da=-1,ea=null;if(z.promoted)ca.forEach(function(ra,sa){if(ra.id===z.promoted){da=sa;ea=ra;}});var fa=0,ga=false,ha=0,ia=!ea;ca.forEach(function(ra,sa){var ta=ba(ra,ga);ga=ga||!ra.raised;ra.leftmostOffset=fa+ta;fa+=ta;if(ra.leftmostOffset<aa)ha++;ia|=sa==da;ra.alreadyPlacedPromoted=ia;});function ja(ra,sa,ta){var ua={};for(var va=0;va<sa;va++){var wa=ra[va];if(!wa.alreadyPlacedPromoted&&va==sa-1){ua[ta]=true;}else ua[wa.id]=true;}return ua;}var ka=ja(ca,ha,z.promoted),la=ja(ca,ha-1,z.promoted),ma=null;for(var na in ka)if(!la[na])ma=na;var oa=ca[ha-1],pa=oa?oa.leftmostOffset:0,qa=Infinity;if(ha<ca.length)qa=ca[ha].leftmostOffset;return {nextToHide:ma,tabsToShow:ka,usedWidth:pa,widthToShowNext:qa};}});f.exports=y;},null);
__d('ChatApp',['Promise','CSS','ChatPerfInstrumentation','DOM','JSLogger','React','ReactDOM','TimeSlice','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q={chatOpenTabImpl:undefined,tabsViewport:undefined,tabViewCoordinator:undefined,tabController:undefined,init:function(v,w,x){if(this._isInitialized){l.create('chat_app').error('repeated_init');return;}this._rootElem=v;h.resolve().then(function(){return j.init();}).then(o.guard(function(){return r();},'ChatApp stores')).then(o.guard(function(){return s(x);},'ChatApp data')).then(o.guard(function(){return t(w,v);},'ChatApp UI')).then(o.guard(function(){return u();},'ChatApp Hotlike sound')).done((function(){this._isInitialized=this._isLoaded=true;j.logTTI();}).bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !!(!this._isInitialized||this._isHidden);},hide:function(){if(this.isHidden())return;i.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){i.show(this._rootElem);this.tabsViewport.checkWidth();e(['Dock'],function(v){v.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){e(['UIPagelet'],function(v){v.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');v.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function r(){return new h(function(v){e(['MercuryBlockedParticipants','MercuryChannelHandler','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryStateCheck','MercuryThreads','MercuryUnreadState','MercuryUnseenState','MercurySyncDeltaHandler','P2PSendMoneyDialogStore'],function(w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){w.get();x.get().turnOn();y;z.get();aa.get();ba;da.get();fa.get();ea.get();ca.get();ga.get();v();});});}function s(v){return new h(function(w){e(['MercuryServerPayloadPreprocessor'],function(x){x.get().handleUpdate(v);w();});});}function t(v,w){return new h(function(x){e(['ChatDispatcher','ChatTabController','ChatTabModel','ChatTabViewCoordinator','TabsViewport','MNCommerceDialogContainer.react','P2PDialogContainer.react','FBRTCMessageHandler','ChatOpenTabImpl'],function(y,z,aa,ba,ca,da,ea,fa,ga){y.explicitlyRegisterStore(aa);q.tabsViewport=new ca(v);q.tabViewCoordinator=new ba(v,q.tabsViewport);q.tabController=new z(q.tabsViewport);fa.init();var ha=k.find(w,"._26-x");n.render(m.createElement(da,null),ha);var ia=k.find(w,"._26-y");n.render(m.createElement(ea,null),ia);q.chatOpenTabImpl=ga;x();});});}function u(){return new h(function(v){e(['HotLikeSound','ChatOptions'],function(w,x){w.setCheckSoundEnabledFunc(function(){return x.getSetting('sound');});v();});});}f.exports=q;},null);
__d('ChatSidebarComposeLink.react',['ChatOpenTab','Link.react','React','TooltipData','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;'use strict';m=babelHelpers.inherits(o,j.Component);n=m&&m.prototype;function o(p){n.constructor.call(this,p);}o.prototype.render=function(){var p=l._("New Message");return (j.createElement(i,babelHelpers._extends({className:this.props.className,href:'#',onClick:this.$ChatSidebarComposeLink1},k.propsFor(p))));};o.prototype.$ChatSidebarComposeLink1=function(p){h.openEmptyTab(null,'sidebar');p.preventDefault();};f.exports=o;},null);
__d('SidebarFitWindowHeight',['Arbiter','ArbiterMixin','Event','Style','SubscriptionsHandler','UITinyViewportAction','Vector','mixin','queryThenMutateDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r;q=babelHelpers.inherits(s,o(i));r=q&&q.prototype;function s(t){'use strict';r.constructor.call(this);this.$SidebarFitWindowHeight1=t;this.onViewportUpdate();m.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){'use strict';if(m.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight2=new l();this.$SidebarFitWindowHeight2.addSubscriptions(j.listen(window,'scroll',t),h.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight3!==0){k.set(this.$SidebarFitWindowHeight1,'margin-top','0');this.$SidebarFitWindowHeight3=0;}this.$SidebarFitWindowHeight2&&this.$SidebarFitWindowHeight2.release();}};s.prototype.onScroll=function(){'use strict';p(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){'use strict';this.$SidebarFitWindowHeight4=n.getScrollPosition().y;this.$SidebarFitWindowHeight5||(this.$SidebarFitWindowHeight5=this.$SidebarFitWindowHeight1.offsetHeight);};s.prototype.resizeSidebar=function(){'use strict';var t=-Math.max(Math.min(this.$SidebarFitWindowHeight4,this.$SidebarFitWindowHeight5),0);k.set(this.$SidebarFitWindowHeight1,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight3){this.$SidebarFitWindowHeight3=t;this.inform('resized',t);}};s.prototype.getOffset=function(){'use strict';return this.$SidebarFitWindowHeight3;};f.exports=s;},null);
__d('ChatSidebar',['Arbiter','AsyncRequest','Bootloader','ChatDispatcher','ChatImpressionLogger','ChatSidebarActions','ChatSidebarComposeLink.react','ChatSidebarStore','ChatSidebarVisibility','CSS','DOM','DOMDimensions','Event','JSLogger','KeyEventController','LitestandClassicPlaceHolders','MercuryConfig','Parent','PresencePrivacy','PresenceUtil','React','ReactDOM','Run','ScrollableArea','SidebarFitWindowHeight','SidebarType','Style','ViewportBounds','csx','cx','debounce','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){if(c.__markCompiled)c.__markCompiled();var oa,pa,qa,ra,sa,ta,ua,va=null,wa=false,xa,ya=true,za=null,ab=u.create('chat_sidebar');function bb(){return o.getVisibleType()===ga.SIDEBAR;}function cb(nb,ob){if(!bb())return;if(ob){sa.hide();}else{sa.show();fb();}}function db(){if(!bb()||!ra)return 0;if(va===null)va=ra.offsetWidth;return va;}function eb(){q.removeClass(document.documentElement,'sidebarMode');if(!o.isInitialized()){h.inform('reflow');ia.inform('change');return;}va=null;sa.hide();ua.getCore().reset();q.hide(ra);q.hide(qa);h.inform('sidebar/hide',mb);h.inform('reflow');ia.inform('change');}function fb(){m.show();jb();}function gb(){if(ua&&bb())ua.getCore().getElement().focus();}function hb(nb){var ob=za||p.getViewport(),pb=ob.height;nb.forEach(function(qb){if(qb&&qb!==oa)pb-=s.getElementDimensions(qb).height;});if(xa)pb-=xa.getOffset();if(ta)pb-=s.getElementDimensions(ta).height;return Math.max(0,pb);}function ib(){q.show(qa);va=null;q.show(ra);q.addClass(document.documentElement,'sidebarMode');sa.show();ab.log('sidebar_show');h.inform('sidebar/show',mb);w.destroy('sidebar');ia.inform('change');if(!wa){jb();wa=true;}}function jb(){if(o.getVisibleType()!==ga.SIDEBAR)return;var nb=hb(Array.from(qa.childNodes)),ob=sa.getItemHeight(),pb=8,qb=Math.floor((nb-pb)/ob);ha.set(oa,'height',nb+'px');sa.setNumTopFriends(qb,ya);ya=false;da.onAfterLoad(function(){var rb=Math.floor((nb-pb)/ob);rb=Math.max(rb-2,1);ua.getData().setMaxResults(rb);});h.inform('sidebar/resized',mb);h.inform('reflow');}function kb(){new i('/ajax/chat/settings.php').setHandler(ma).setErrorHandler(ma).setData({sidebar_mode:o.isEnabled(),window_id:aa.getSessionID()}).setAllowCrossPageTransition(true).send();}function lb(){var nb=true;if(!o.isEnabled()){ab.log('state_not_enabled');nb=false;}if(p.hasLowFriendCount()){ab.log('state_not_shown_num_friends');nb=false;}if(!p.isViewportCapable(za))nb=false;var ob=nb?'state_shown':'state_not_shown';ab.log(ob);}var mb={init:function(nb,ob,pb){mb.init=ma;k.explicitlyRegisterStore(o);m.loaded();ra=nb;sa=ob;ua=pb;oa=r.find(nb,'div.fbChatSidebarBody');qa=r.find(nb,"._51x_");ta=r.find(nb,"._5qqe");var qb=r.find(nb,"._x1u");if(qb)ca.render(ba.createElement(n,{className:"_3a-4 _5q85"}),qb);var rb=r.find(nb,"._1ltf");if(rb)da.onAfterLoad(function(){j.loadModules(["ChatSidebarDropdown.react","SidebarType"],function(sb,tb){ca.render(ba.createElement(sb,{sidebarType:tb.SIDEBAR,onToggleSidebar:m.disable}),rb);});});t.listen(window,'resize',(function(){this._cacheViewport();fb();}).bind(this));v.registerKey('q',function(event){if(o.getVisibleType()!==ga.SIDEBAR)return;if(!pa)pa=r.scry(nb,'.inputsearch')[0];if(pa){pa.focus();event.prevent();}});sa.setScrollContainer(y.byClass(sa.getRoot(),'uiScrollableAreaWrap'));sa.subscribe(['render','show','hide'],la(function(sb){var tb=ea.getInstance(sa.getRoot());tb&&tb.adjustGripper();}));h.subscribe('chat/option-changed',function(sb,tb){if(tb.name==='hide_groups')jb();});h.subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps','Ticker/resized'],jb);pb.getCore().subscribe('sidebar/typeahead/active',cb);pb.subscribe('reset',function(){if(!pb.getCore().getValue()&&!sa.isVisible())cb(null,false);});da.onAfterLoad(function(){var sb=r.find(nb,'div.fbChatSidebarMessage div.message');if(sb)j.loadModules(["ChatSidebarSheet.react"],function(tb){ca.render(ba.createElement(tb,{root:nb,onUpdate:jb}),sb,jb);});});z.subscribe('privacy-user-presence-changed',fb);o.addListener(function(){var sb=o.getState(),tb=o.getPrevState();if(sb.visible!==tb.visible)switch(sb.visible){case ga.SIDEBAR:ib();break;case ga.BUDDYLIST:eb();break;}if(sb.enabled!==tb.enabled){if(sb.enabled)setTimeout(gb,0);kb();}});this._cacheViewport();fb();l.init(sa);ia.addPersistentRight(db);h.inform('sidebar/initialized',mb,h.BEHAVIOR_PERSISTENT);xa=new fa(ta);xa.subscribe('resized',fb);m.init();lb();},ensureLoaded:function(){if(!o.isEnabled())return;if(o.isLoaded())return;if(na('pagelet_sidebar'))return;e(['UIPagelet'],function(nb){var ob=r.create('div',{id:'pagelet_sidebar'});r.appendContent(document.body,ob);nb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});m.loaded();},hide:function(){if(!o.isEnabled())return;m.disable();},unhide:function(){if(o.isEnabled())return;m.enable();},_cacheViewport:function(){za=p.getViewport();}};f.exports=mb;},null);